(function(g){g(CodeMirror)})(function(g){function y(a,b){"string"==typeof a?a=new RegExp(a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),b?"gi":"g"):a.global||(a=new RegExp(a.source,a.ignoreCase?"gi":"g"));return{token:function(b){a.lastIndex=b.pos;var d=a.exec(b.string);if(d&&d.index==b.pos)return b.pos+=d[0].length||1,"searching";d?b.pos=d.index:b.skipToEnd()}}}function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function k(a){return a.state.search||(a.state.search=
new z)}function r(a,b,c,d){return a.getSearchCursor(b,d,c)}function t(a){return a.replace(/\\(.)/g,function(a,c){return"n"==c?"\n":"r"==c?"\r":c})}function u(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(c){}else a=t(a);if("string"==typeof a?""==a:a.test(""))a=/x^/;return a}function A(a,b,c,d){b.queryText=c;b.query=u(c);a.removeOverlay(b.overlay,d);b.overlay=y(b.query,d);a.addOverlay(b.overlay);a.showMatchesOnScrollbar&&(b.annotate&&(b.annotate.clear(),
b.annotate=null),b.annotate=a.showMatchesOnScrollbar(b.query,d))}function n(a,b,c){var d=k(a);if(d.query&&c)return p(a,b,d.ignoreCase);b=a.getSelection()||d.lastQuery;B(a,'\x3cdiv class\x3d"custom-deluge-search"\x3e\x3cdiv class\x3d"find-input-div"\x3e\x3cinput type\x3d"text" id\x3d"findBtn" placeholder\x3d"Find.." class\x3d"CodeMirror-search-field custom-ds-block"/\x3e\x3cdiv class\x3d"close-icon" id\x3d"closeDiv"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',b,function(b,d,c){q(a,b,d,c)})}function B(a,
b,c,d){a.searchDialog(b,d,{value:c,selectValueOnOpen:!0,closeOnEnter:!1,closeOnBlur:!1,ignoreCase:!1,clear:function(b,d,c){v(a,d,c)},onClose:function(){m(a)}})}function p(a,b,c,d){a.operation(function(){var f=k(a),e=a.getSearchCursor(f.query,b?f.posFrom:f.posTo,c);if(!e.find(b)&&(e=r(a,f.query,c,b?g.Pos(a.lastLine()):g.Pos(a.firstLine(),0)),!e.find(b)))return;a.setSelection(e.from(),e.to());a.scrollIntoView({from:e.from(),to:e.to()},20);f.posFrom=e.from();f.posTo=e.to();d&&d(e.from(),e.to())})}function m(a){a.operation(function(){var b=
k(a);b.lastQuery=b.query||b.lastQuery;b.lastReplaceQuery=b.replaceQuery||b.lastReplaceQuery;b.query&&(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function v(a,b,c){a.operation(function(){var d=k(a);d.lastQuery=null!=b?b:d.lastQuery;d.lastReplaceQuery=null!=c?c:d.lastReplaceQuery})}function C(a,b,c,d){a.operation(function(){function f(a,b){return e[b]}for(var e=null,l=a.getSearchCursor(b,void 0,d);l.findNext();)"string"!=typeof b?(e=a.getRange(l.from(),
l.to()).match(b),l.replace(c.replace(/\$(\d)/g,f))):l.replace(c)})}function D(a,b,c,d,f){a.searchReplaceDialog(b,f,{value:c,selectValueOnOpen:!0,closeOnEnter:!1,replacementQuery:d,closeOnBlur:!1,ignoreCase:!1,onClose:function(){m(a)},clear:function(b,d,c){v(a,d,c)},findFunction:function(b,d,c){q(a,b,d,c)},replaceAction:function(b,d,c,f,g,k){w(a,b,d,c,f,g,k)}})}function q(a,b,c,d){var f=!1;d&&d.shiftKey&&(f=!0);var e=k(a);e.query!=b&&m(a);if(e.query)return p(a,f,c);var l=null;g.e_stop(d);b&&(b!=e.queryText&&
(A(a,e,b,c),e.posFrom=e.posTo=a.getCursor()),e.ignoreCase=c,l&&(l.style.opacity=1),p(a,d.shiftKey,c,function(b,d){var c;3>d.line&&document.querySelector&&(c=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&c.getBoundingClientRect().bottom-4>a.cursorCoords(d,"window").top&&((l=c).style.opacity=1)}))}function x(a,b){if(!a.getOption("readOnly")){b=k(a);var c=a.getSelection()||b.lastQuery;D(a,"\x3cdiv class\x3d'custom-deluge-search custom-deluge-replace'\x3e\x3cdiv class\x3d'custom-ds-cell'\x3e\x3cdiv class\x3d'custom-ds-row-div'\x3e\x3cdiv class\x3d'find-input-div'\x3e\x3cinput type\x3d'text' id\x3d'findBtn' placeholder\x3d'Find..' class\x3d'CodeMirror-search-field custom-ds-block'/\x3e\x3c/div\x3e\x3cdiv\x3e\x3cinput type\x3d'text' placeholder\x3d'Replace With..' id\x3d'replacementText' class\x3d'CodeMirror-search-field custom-ds-block'/\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'custom-ds-cell custom-ds-buttons'\x3e\x3cdiv class\x3d'custom-ds-row-div'\x3e\x3cdiv class\x3d'custom-ds-block'\x3e\x3cbutton id\x3d'delugeReplaceBtn' class\x3d'replace-btn '\x3eReplace\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'custom-ds-row-div'\x3e\x3cdiv class\x3d'custom-ds-block'\x3e\x3cbutton id\x3d'delugeReplaceAllBtn' class\x3d'replace-btn '\x3eReplace All\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'custom-ds-cell search-close'\x3e\x3cdiv class\x3d'close-icon' id\x3d'closeDiv'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
c,b.lastReplaceQuery,function(b,c,e,g,k,h){w(a,b,c,e,g,k,h)})}}function w(a,b,c,d,f,e,g){if(b){var l=b;b=u(b);c=t(c);k(a).replaceQuery=c;var h=r(a,b,f,a.getCursor("from")),m=h.findNext();q(a,l,f,e);var n=function(){var c=h.from();if(!(m=h.findNext())&&(h=a.getSearchCursor(b,void 0,f),!(m=h.findNext())||c&&h.from().line==c.line&&h.from().ch==c.ch))return;a.setSelection(h.from(),h.to());a.scrollIntoView({from:h.from(),to:h.to()})};e=function(a){h.replace("string"==typeof b?c:c.replace(/\$(\d)/g,function(b,
c){return a[c]}));n()};g?n():d?C(a,b,c,f):e(m)}}function E(a){a.searchDialog('\x3cdiv class\x3d"custom-deluge-go-to"\x3e\x3cinput class\x3d"custom-go-to" type\x3d"text" id\x3d"customDelugeGoTo" placeholder\x3d"Go to line number"\x3e\x3cdiv class\x3d"close-icon" id\x3d"closeDiv"\x3e\x3c/div\x3e\x3c/div\x3e',function(b,c){c=null;var d=0;-1<b.indexOf(",")?(b=b.split(","),b[0]&&(d=b[0].trim()),b[1]&&(c=b[1].trim())):d=b;!parseInt(d)||c&&!parseInt(d)||(d=isNaN(d)?0:d,c=isNaN(c)?0:c-1,d=parseInt(d),c=parseInt(c),
a.setCursor({line:d-1,ch:c}),a.focus())},{value:"",selectValueOnOpen:!0,onClose:function(){m(a)}})}g.commands.find=function(a){n(a)};g.commands.findPersistent=function(a){n(a,!1)};g.commands.findNext=function(a){n(a,!1,!0)};g.commands.findPrev=function(a){n(a,!0,!0)};g.commands.clearSearch=m;g.commands.replace=x;g.commands.replaceAll=function(a){x(a,!0)};g.commands.goToLine=function(a){E(a)}});