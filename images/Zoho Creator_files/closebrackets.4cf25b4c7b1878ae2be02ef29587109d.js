(function(f){DRE.serviceFlags.isEnabled("amd-modules")?"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],f):f(CodeMirror):f(CodeMirror)})(function(f){function p(f,a){f=f.getRange(h(a.line,a.ch-1),h(a.line,a.ch+1));return 2==f.length?f:null}function r(k){function a(d,a){d!=a&&(q+=a);b["'"+d+"'"]=function(e){if(e.getOption("disableInput"))return f.Pass;for(var b=e.listSelections(),m,l,k=0;k<b.length;k++){var n=
b[k],c=n.head;if("'"==d&&"comment"==e.getTokenTypeAt(c))return f.Pass;l=e.getRange(c,h(c.line,c.ch+1));var g=e.getRange(h(c.line,c.ch-1),c);if(n.empty())if(d==a&&l==a)l=e.getRange(c,h(c.line,c.ch+3))==d+d+d?"skipThree":"skip";else if('"'!=g&&"'"!=g||g!=d)if(d==a&&1<c.ch&&e.getRange(h(c.line,c.ch-2),c)==d+d&&(2>=c.ch||e.getRange(h(c.line,c.ch-3),h(c.line,c.ch-2))!=d))l="addFour";else{if(d==a&&f.isWordChar(l)||!(e.getLine(c.line).length==c.ch||0<=q.indexOf(l)&&!f.isWordChar(g)||t.test(l)))return f.Pass;
l="both"}else return f.Pass;else l="surround";if(!m)m=l;else if(m!=l)return f.Pass}e.operation(function(){if("skip"==m)e.execCommand("goCharRight");else if("skipThree"==m)for(var c=0;3>c;c++)e.execCommand("goCharRight");else if("surround"==m){var b=e.getSelections();for(c=0;c<b.length;c++)-1<b[c].indexOf('"')&&'"'==d&&(b[c]=b[c].replace(/"/g,'\\"')),b[c].match(TAGS_SEARCH_PATTERN)?b[c]=d+a:b[c]=d+b[c]+a;e.replaceSelections(b,"around");b=e.listSelections().slice();for(c=0;c<b.length;c++){var l=b,k=
c;var g=b[c];var n=0<f.cmpPos(g.anchor,g.head);g={anchor:new h(g.anchor.line,g.anchor.ch+(n?-1:1)),head:new h(g.head.line,g.head.ch+(n?1:-1))};l[k]=g}e.setSelections(b)}else"both"==m?(e.replaceSelection(d+a,null),e.execCommand("goCharLeft")):"addFour"==m&&(e.replaceSelection(d+d+d+d,"before"),e.execCommand("goCharRight"))})};d!=a&&(b["'"+a+"'"]=function(b){for(var d=b.listSelections(),e=0;e<d.length;e++){var g=d[e];if(!g.empty()||b.getRange(g.head,h(g.head.line,g.head.ch+1))!=a)return f.Pass}b.execCommand("goCharRight")})}
for(var b={name:"autoCloseBrackets",Backspace:function(a){if(a.getOption("disableInput"))return f.Pass;for(var b=a.listSelections(),e=0;e<b.length;e++){if(!b[e].empty())return f.Pass;var d=p(a,b[e].head);if(!d||0!=k.indexOf(d)%2)return f.Pass}for(e=b.length-1;0<=e;e--)d=b[e].head,a.replaceRange("",h(d.line,d.ch-1),h(d.line,d.ch+1))}},q="",g=0;g<k.length;g+=2)a(k.charAt(g),k.charAt(g+1));return b}function u(k){return function(a){if(a.getOption("disableInput"))return f.Pass;for(var b=a.listSelections(),
h=0;h<b.length;h++){if(!b[h].empty())return f.Pass;var g=p(a,b[h].head);if(!g||0!=k.indexOf(g)%2)return f.Pass}a.operation(function(){a.replaceSelection("\n\n",null);a.execCommand("goCharLeft");b=a.listSelections();for(var d=0;d<b.length;d++){var f=b[d].head.line;a.indentLine(f,null,!0);a.indentLine(f+1,null,!0)}})}}var t=/\s/,h=f.Pos;f.defineOption("autoCloseBrackets",!1,function(h,a,b){b!=f.Init&&b&&h.removeKeyMap("autoCloseBrackets");if(a){var k="()[]{}''\"\"";b="()[]{}";"string"==typeof a?k=a:
"object"==typeof a&&(null!=a.pairs&&(k=a.pairs),null!=a.explode&&(b=a.explode));a=r(k);b&&(a.Enter=u(b));h.addKeyMap(a)}})});