var WorkflowBuilder=new function(){var b=this;b.workflowUrl="";b.appUrl="";b.constants={};b.scriptMeta={};b.formFields={};b.actionVsScript={};b.insertFieldsHtml="";b.dataAccessFormFields={};b.dataAccessMulOptFields={};b.workflowTable=null;b.isSaved=!0;b.triggerActionName="";b.wfMeta={};b.wfState=WorkflowConstants.FORM_WF;b.isBuilder=!0;this.init=function(a){b.constants=a;b.workflowUrl=appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/edit";b.appUrl=appbuilder.component.APP.getAppEditUrl()};
this.freezeLayer=function(){var a=$("\x3cdiv\x3e\x3c/div\x3e").addClass("zc-dem-freeze-layer-wb");$("#zc-dem-container").append(a)};this.showLoadingContainer=function(){if(!$("#wf-slider").length)return showLoading();if($("#wf-slider").length)return $("#wf-slider").showLoading()};this.hideLoadingContainer=function(){if(!$("#wf-slider").length)return hideLoading();if($("#wf-slider").length)return $("#wf-slider").hideLoading()};this.removeFreezeLayer=function(){$("#zc-dem-container").find(".zc-dem-freeze-layer-wb").remove()};
this.registerListEvents=function(){b.isWorkflowV2Enabled="true"==$("#workflowListContainer").find("input[elename\x3disWorkflowV2]").val()?!0:!1;b.isFormWfFilter="true"==$("#workflowListContainer").find("input[elename\x3disFormWfFilter]").val()?!0:!1;b.formNameSort();b.wfState&&b.wfState==WorkflowConstants.BLUEPRINT&&void 0==b.blueprint&&(b.blueprint=new BlueprintDashboard(b),b.blueprint.isWorklfowEmpty()?b.blueprint.init():b.blueprint.showBluePrintDashboard());if(b.isWorkflowV2Enabled||b.isFormWfFilter)void 0==
b.workflowTablenew&&(b.workflowTablenew=new workflowDashoard(b)),b.workflowTablenew.isWorklfowEmpty()&&b.workflowTablenew.init();var a=location.hash;b.workflowState=$("#workflowListContainer").find("input[elename\x3dworkflowState]").val();void 0!=a&&""!=a&&(a=a.substr(1),$("#workflowListContainer").find("div[elename\x3dwfFilter] li[wftype\x3d"+a+"]:not(.zc-hide)").length&&(b.wfState=a));$.fn.DataTable.isDataTable("#workflowList")||b.initDataTable();FunctionBuilder.initFunctionList(b.constants)};this.registerListEventsForReload=
function(){b.blueprint=void 0;b.registerListEvents();b.isWorkflowV2Enabled||b.isFormWfFilter?b.isFormWFEmpty=!1:""};this.modifyDataTableSearch=function(){$.fn.dataTable.ext.search.push(function(a,c,b){if(""===a.oPreviousSearch.sSearch)return!0;b=$.fn.DataTable.util.escapeRegex(a.oPreviousSearch.sSearch);c=c.slice();for(var d=0;d<a.aoColumns.length;d++)a.aoColumns[d].bVisible||c.splice(d,1);return(new RegExp("^(?\x3d.*?"+b+").*$","i")).test(c.join(" "))})};this.resetDataTableSearch=function(){$.fn.dataTable.ext.search.pop()};
this.initDataTable=function(){function a(){$(e).find("input[elname\x3dstatusBtn]").zcToggle({type:ZCSwitchType.LARGE,onConfig:{label:ZCSwitchLabel.ENABLED},offConfig:{label:ZCSwitchLabel.DISABLED}})}b.modifyDataTableSearch();var c=$("#workflowListContainer"),d=c.find("div[elename\x3dwfTableContainer]"),e=$("#workflowTableBody");b.workflowTable=$("#workflowList").zcTable({paging:!1,searching:!0,info:!1,ordering:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1,2,3,4,5],orderable:!1}],searchCols:[{targets:[0],
search:b.wfState}],oSearch:{sSearch:$(c).find("input[elename\x3dcustomSearch]").val()},language:{zeroRecords:i18n["zc.workflowlist.noworkflow"]},initComplete:function(a,e){b.isWorkflowV2Enabled||b.isFormWfFilter||($(d).removeClass("zc-dem-form-workflow"),$("#workflowfilterNav .zc-dem-worlflow-filter").hide());$("#workflowList").find("thead").css("display","none");$("#workflowList_filter").css("display","none");0!=this.api().rows().nodes().length||b.workflowTablenew&&b.workflowTablenew.isWorklfowEmpty()?
($(c).find("div[elename\x3dwfTableContainer]").css("opacity","1"),$(c).find("div[elename\x3dno-workflow]").addClass("zc-hide"),$(c).find("li[elename\x3dwfType]").siblings().removeClass("active"),$(c).find("li[elename\x3dwfType][wfType\x3d"+b.wfState+"]").addClass("active")):($(c).find("div[elename\x3dwfTableContainer]").css("opacity","0"),$(c).find("div[elename\x3dno-workflow]").removeClass("zc-hide"),$(c).find("div[elename\x3dno-workflow]").find('input[elename\x3d"addWorkFLowEle"]')[0].focus());
setTimeout(function(){$(c).find("div[elename\x3dwfFilter]").find("li[wfType\x3d"+b.wfState+"]").trigger("click")},50);$("#workflowTableBody").zcScrollPane({autoReinit:!0})},drawCallback:function(a){a=this.api();var e=a.rows({page:"current"}).nodes();a=a.column(0).data().filter(function(a,c){return a==b.wfState?!0:!1}).length;$(c).find("div[elename\x3dreportWFNotify]").addClass("zc-hide");$(c).find(".zc-warning-toast").removeClass("zc-hide");$("#workflowfilterNav").removeClass("zc-reportWf-info");
if(0!=a||(b.isWorkflowV2Enabled||b.isFormWfFilter)&&b.wfState==WorkflowConstants.FORM_WF){$("#no-workflow").addClass("zc-hide");$("#workflowTable").css("opacity","1");$(c).find("div[elename\x3dwfTableContainer]").css("opacity","1");$(c).find("div[elename\x3dno-workflow]").addClass("zc-hide");var f=null;b.wfState==WorkflowConstants.FORM_WF&&(b.isWorkflowV2Enabled||b.isFormWfFilter)?(b.isFormWFEmpty&&b.workflowTablenew.noDataView(),$("#workflowTableBody").hide(),$("#formWorkflowTableBody").show(),$(".zc-dem-workflow-table-head th.whenCol").hide()):
($(".zc-dem-workflow-table-head th.whenCol").show(),$("#workflowTableBody").show(),$("#formWorkflowTableBody").hide(),$("#workflowfilterNav .zc-dem-worlflow-filter").hide(),$(d).removeClass("zc-dem-form-workflow"),e.to$().each(function(a,c){var b=$(c).attr("formlinkName");f!==b&&($(e).eq(a).before('\x3ctr formlinkName\x3d"'+b+'" class\x3d"zc-dem-workflow-name"\x3e\x3ctd colspan\x3d"5"\x3e'+$(c).attr("formDispName")+"\x3c/td\x3e\x3c/tr\x3e"),f=b)}))}else{a=$("#no-workflow");if(b.wfState==WorkflowConstants.BUTTON_WF){$(c).find("div[elename\x3dwfFilter] li[wfType\x3dButtonWf]").addClass("zc-hide");
$(c).find("div[elename\x3dwfFilter]").find("li[wfType\x3d"+WorkflowConstants.FORM_WF+"]").trigger("click");return}$(a).find("i").css("display","block");$(a).find("p").removeClass("hide");$(a).find("i[elname!\x3d"+b.wfState+"]").css("display","none");$(a).find("p[elname!\x3d"+b.wfState+"]").addClass("hide");$(a).removeClass("zc-hide");$("#workflowTable").css("opacity","0");$("#workflowfilterNav .zc-dem-worlflow-filter").hide()}b.wfState==WorkflowConstants.BUTTON_WF&&$(c).find("div[elename\x3dreportWFNotify]").removeClass("zc-hide")}});
$("#newVersionInfo").html($("#newVersionInfo").text().replace("here","\x3ca id\x3d'link-more' class\x3d'link_more'\x3ehere\x3c/a\x3e"));$("#link-more").on("click",function(){window.open("/userhome/"+ZCGlobal.scopeName+"/dashboard/setup#manageUpdates","_blank");localStorage.setItem("isShowPendingTab","true")});$(c).find("input[elename\x3dcustomSearch]").off("keyup change").on("keyup change",function(){var c=$(this).val();""!=c&&($(this).siblings(".zc-common-close").removeClass("hide"),$(this).siblings(".zc-fb-look-up").addClass("hide"));
b.wfState==WorkflowConstants.BLUEPRINT&&b.blueprint&&b.blueprint.tableSearch(c);b.wfState==WorkflowConstants.FORM_WF&&(b.isWorkflowV2Enabled||b.isFormWfFilter)?b.isFormWFEmpty||(""!=c?($("#workflowfilterNav").removeClass("expand"),$("#workflowfilterNav .zc-dem-worlflow-leftarrow").addClass("zc-hide")):(b.isFormWfFilter||($("#workflowfilterNav").addClass("expand"),$("#workflowfilterNav .zc-dem-worlflow-leftarrow").removeClass("zc-hide")),$(this).siblings(".zc-common-close").addClass("hide"),$(this).siblings(".zc-fb-look-up").removeClass("hide")),
setTimeout(function(){b.workflowTablenew.search(c);""==c?b.workflowTablenew.filter():""},200)):(b.wfState!=WorkflowConstants.CUSTOM_FUNCTIONS&&b.wfState!=WorkflowConstants.BLUEPRINT&&b.workflowTable.search(c).draw(),""==c&&($(this).siblings(".zc-common-close").addClass("hide"),$(this).siblings(".zc-fb-look-up").removeClass("hide"),b.workflowTablenew?b.workflowTablenew.filter():"",$("#workflowfilterNav .zc-dem-worlflow-leftarrow").addClass("zc-hide")),a())});$(c).find("i[elename\x3dclearSearch]").off("click").on("click",
function(){$(this).addClass("hide");$(this).siblings(".zc-fb-look-up").removeClass("hide");$(this).siblings("input[elename\x3dcustomSearch]").val("");$(c).find("input[elename\x3dcustomSearch]").trigger("keyup")});$(c).find("input[elename\x3daddWorkFLowEle]").off("click").on("click",function(a){a.preventDefault();if(b.wfState!=WorkflowConstants.BUTTON_WF){var d=$(c).find("div[elename\x3dno-workflow]").hasClass("zc-hide");a=$(this).attr("listtype");"PaymentWf"!=b.wfState||ZCUser.getPlanDetails().isC5PaymentEnabled()||
"single"!=a?(a={},(b.isWorkflowV2Enabled||b.isFormWfFilter)&&b.wfState==WorkflowConstants.FORM_WF?a=b.workflowTablenew.activeFilters():b.wfState==WorkflowConstants.BLUEPRINT&&(a=b.blueprint.activeFilters()),a.wfState=b.wfState,(new ZCNavigator).openNewComponent(function(){$("#new-workflow").trigger("click");$("#create-new-comp").addClass("hide");$(".zc-dem-compnt-typ-options").css("height","100%");d&&($("#workflow-create-types").find("div[elename\x3d"+b.wfState+"] \x3e .zc-dem-compnt-icon").trigger("click"),
b.wfState==WorkflowConstants.SCHEDULE_WF&&$("#wf-event-custom-create").find("input[name\x3deventDate]").blur())},a)):$.upgrade.create({zcFeatureName:"PAYMENT_GATEWAY",featureType:"ZC_FEATURE",zccpn:b.constants.csrfToken,sharedBy:b.constants.scopeName})}});$(c).find("div[elename\x3dwfFilter]").find("li[elename\x3dwfType]").off("click").on("click",function(d){var e=$("#workflowListContainer").find("input[elename\x3disWorkflowError]").val(),f=b.wfState;$(this).siblings().removeClass("active");$(this).siblings().removeClass("active");
$(this).addClass("active");b.wfState=$(this).attr("wfType");$(c).find("#wfListHead").find("input[elename\x3daddWorkFLowEle]").removeAttr("title");(b.isWorkflowV2Enabled||b.isFormWfFilter)&&b.wfState==WorkflowConstants.FORM_WF?$(c).find("input[elename\x3dcustomSearch]").attr("placeholder","Search for Workflows or Actions"):b.wfState==WorkflowConstants.BLUEPRINT?$(c).find("input[elename\x3dcustomSearch]").attr("placeholder",i18n["zc.workflow.builder.blueprint.searchblueprint"]):$(c).find("input[elename\x3dcustomSearch]").attr("placeholder",
"Search for Workflows, Forms or Actions");"true"==e&&b.wfState!=WorkflowConstants.CUSTOM_FUNCTIONS?$(c).find("div[elename\x3dwfTableContainer]").addClass("zc-dem-wfb-toast"):$(c).find("div[elename\x3dwfTableContainer]").removeClass("zc-dem-wfb-toast");b.wfState==WorkflowConstants.BUTTON_WF?$(c).find("div[elename\x3dwfTableContainer]").addClass("zc-dem-wfb-info"):$(c).find("div[elename\x3dwfTableContainer]").removeClass("zc-dem-wfb-info");b.wfState!=WorkflowConstants.CUSTOM_FUNCTIONS?($(c).find("#wfListHead").find("input[elename\x3daddWorkFLowEle]").val(i18n["zc.workflowbuilder.newworkflow"]),
$("#wfFunctionTable").addClass("zc-hide"),$("#form-workflow-nodata-screen").addClass("zc-hide"),$(c).find("#no-custom-function").addClass("zc-hide"),$("#workflowfilterNav div[elename\x3dfunctionsearchblueprintFilter]").addClass("zc-hide"),$(c).find("input[elename\x3dcustomSearch]").parent().removeClass("zc-hide"),$(c).find("input[elename\x3dcustomFuncSearch]").parent().addClass("zc-hide"),$("#workflowfilterNav div[elename\x3dfunctionFilter]").addClass("zc-hide"),b.wfState==WorkflowConstants.BLUEPRINT?
($("#workflowTable").addClass("zc-hide"),$(c).find("#wfListHead").find("input[elename\x3daddWorkFLowEle]").val(i18n["zc.workflow.builder.blueprint.newblueprint"]),$(c).find("#no-workflow").find("input[elename\x3daddWorkFLowEle]").attr("value",i18n["zc.workflow.builder.blueprint.createbp"])):($("#workflowTable").removeClass("zc-hide"),b.blueprint&&b.blueprint.hideBluePrintDashboard(),$(c).find("#no-workflow").find("input[elename\x3daddWorkFLowEle]").attr("value",i18n["zc.workflowbuilder.createworkflow"]),
b.workflowTable.column(0).search(b.wfState).draw())):($(c).find("#wfListHead").find("input[elename\x3daddWorkFLowEle]").val(i18n["zc.workflow.builder.fuctions.dashboard.newfunctionbutton"]),$(c).find("input[elename\x3dcustomSearch]").parent().addClass("zc-hide"),$(c).find("input[elename\x3dcustomFuncSearch]").parent().removeClass("zc-hide"),$("#workflowTable").addClass("zc-hide"),$("#wfFunctionTable").removeClass("zc-hide"),$(c).find("div[elename\x3dno-workflow]").addClass("zc-hide"),$("#form-workflow-nodata-screen").addClass("zc-hide"),
$(c).find("#no-workflow").addClass("zc-hide"),$("#workflowfilterNav div[elename\x3dfunctionFilter]").removeClass("zc-hide"),FunctionBuilder.activeNameSpace=$("#nameSpaceList").find("li").length?$("#nameSpaceList").find("li.active").attr("namespace"):"",e="All"==FunctionBuilder.activeNameSpace?"":"^"+FunctionBuilder.activeNameSpace+"$",FunctionBuilder.functionTable.column(0).search(e,!0,!1,!1).draw());e=$("#workflowListContainer").find("div[elename\x3dwfTableContainer]");var k="";f==WorkflowConstants.BLUEPRINT&&
(new BlueprintDashboard(b)).hideBluePrintDashboard();f==WorkflowConstants.CUSTOM_FUNCTIONS?(k=$(c).find("input[elename\x3dcustomFuncSearch]").val(),""==k?$(c).find("i[elename\x3dclearSearch]").trigger("click"):$(c).find("input[elename\x3dcustomSearch]").val(k)):(k=$(c).find("input[elename\x3dcustomSearch]").val(),$(c).find("input[elename\x3dcustomFuncSearch]").val(k));f=$(c).find("#wfListHead").find("input[elename\x3daddWorkFLowEle]");f.removeClass("zc-dem-disabledbtn");f.addClass("zc-dem-primarybtn");
b.wfState==WorkflowConstants.BUTTON_WF&&(f.attr({title:"Report workflows can only be created from quick or detail view of reports"}),f.removeClass("zc-dem-primarybtn"),f.addClass("zc-dem-disabledbtn"));b.wfState==WorkflowConstants.FORM_WF&&(b.isWorkflowV2Enabled||b.isFormWfFilter)?($(e).addClass("zc-dem-form-workflow"),$("#workflowfilterNav .zc-dem-worlflow-filter").show(),b.workflowTablenew.noDataView(),f=$(c).find("input[elename\x3dcustomSearch]"),$("#dem-app-search-field").trigger("keyup"),""!=
f.val()&&f.trigger("keyup"),setTimeout(function(){$("#workflowTable").css("transition","0.3s")},200)):b.wfState!=WorkflowConstants.CUSTOM_FUNCTIONS&&(b.isWorkflowV2Enabled||b.isFormWfFilter)?($("#workflowTable").css("transition","none"),$("#no-workflow-data").addClass("zc-hide"),$("#workflowfilterNav .zc-dem-worlflow-filter").hide(),$(e).removeClass("zc-dem-form-workflow"),$("#formWorkflowTableBody").addClass("zc-hide"),$(c).find("input[elename\x3dcustomSearch]").trigger("keyup")):($("#workflowfilterNav").removeClass("expand"),
$(c).find("#wfListHead").find("input[elename\x3dcustomFuncSearch]").trigger("keyup"));b.wfState==WorkflowConstants.BLUEPRINT&&($("#workflowfilterNav").removeClass("expand"),void 0==b.blueprint?(b.blueprint=new BlueprintDashboard(b),b.blueprint.init()):b.blueprint.IsInitCompleted?(b.blueprint.showBluePrintDashboard(),f=b.blueprint.isWorklfowEmpty(),b.blueprint.isUpdateNeeded&&b.blueprint.updateBlueprintTable(),b.blueprint.showNoDataScreen(f)):b.blueprint.init());a();d.stopPropagation()});b.workflowTable.off("click",
"a[elename\x3ddeleteBtn]").on("click","a[elename\x3ddeleteBtn]",function(a){var d=$(this).closest("tr[elename\x3dworkflowRow]");b.deleteWorkflows({wfLinkName:$(d).attr("workflowname"),formlinkName:$(d).attr("formlinkName"),wfType:$(d).attr("wfType"),wfName:2==$(d).attr("wfType")?$(d).find("p[elename\x3dapprovalName]").attr("encodedName"):$(d).find("p[elename\x3dwfDispName]").attr("encodedName"),successCallBK:function(){b.workflowTable.row(d).remove().draw();b.workflowTable.rows().nodes();var a=FunctionBuilder.functionTable.rows().nodes().length;
0==b.count()&&0==a?($(c).find("div[elename\x3dwfTableContainer]").css("opacity","0"),$(c).find("div[elename\x3dno-workflow]").removeClass("zc-hide")):0==b.count()&&0<a&&(a=$("#no-workflow"),$(a).find("i").css("display","block"),$(a).find("p").removeClass("hide"),$(a).find("i[elname!\x3d"+b.wfState+"]").css("display","none"),$(a).find("p[elname!\x3d"+b.wfState+"]").addClass("hide"),$(a).removeClass("zc-hide"),$("#workflowTable").css("opacity","0"),$("#workflowfilterNav .zc-dem-worlflow-filter").hide());
(b.isWorkflowV2Enabled||b.isFormWfFilter)&&b.workflowTablenew.noDataView();AccordionMenu.reinit(WorkflowBuilder.constants)}});a.stopPropagation()});a();b.workflowTable.off("click","input[elname\x3dstatusBtn]").on("click","input[elname\x3dstatusBtn]",function(a){var c=$(this),d=$(c).closest("tr[elename\x3dworkflowRow]"),e=$(c).data("zctg").status();b.enableDisableWf({wfName:2==$(d).attr("wfType")?$(d).find("p[elename\x3dapprovalName]").attr("encodedName"):$(d).find("p[elename\x3dwfDispName]").attr("encodedName"),
wfLinkName:$(d).attr("workflowname"),wfType:$(d).attr("wfType"),formLinkName:$(d).attr("formlinkName"),status:e,successCallBK:function(){e?$(c).data("zctg").active():$(c).data("zctg").deActive();b.workflowTable.row(d).invalidate().draw()},event:a});a.stopPropagation()});b.workflowTable.off("click","p[elename\x3dwfDispName]").on("click","p[elename\x3dwfDispName]",function(a){var c=$(this).closest("tr[elename\x3dworkflowRow]");b.getWorkflow({wfLinkName:$(c).attr("workflowname"),wfDispName:$(c).find("p[elename\x3dwfDispName]").find("a").text()});
a.preventDefault();a.stopPropagation()});b.workflowTable.off("click","li[elename\x3dactionEle]").on("click","li[elename\x3dactionEle]",function(a){var c=$(this).closest("tr[elename\x3dworkflowRow]");b.triggerActionName=$(this).attr("actionLinkName");b.getWorkflow({wfLinkName:$(c).attr("workflowname"),wfDispName:$(c).find("p[elename\x3dwfDispName]").find("a").text()});a.stopPropagation()});b.workflowTable.off("click","p[elename\x3dapprovalName]").on("click","p[elename\x3dapprovalName]",function(a){var c=
$(this).closest("tr[elename\x3dworkflowRow]");c={formLinkName:$(c).attr("formlinkName"),approvalLinkName:$(c).attr("workflowname")};b.getApprovalWorkflow(c);a.preventDefault();a.stopPropagation()});b.workflowTable.off("click","li[elename\x3dapprovalAction]").on("click","li[elename\x3dapprovalAction]",function(a){var c=$(this).closest("tr[elename\x3dworkflowRow]");c={formLinkName:$(c).attr("formlinkName"),approvalLinkName:$(c).attr("workflowname"),wfLinkName:$(this).attr("wfLinkName"),triggerAction:$(this).attr("actionLinkName")};
b.getApprovalWorkflow(c);a.stopPropagation()});b.workflowTable.off("mouseenter mouseleave").on("mouseenter mouseleave","div[elename\x3dactionContent]",function(a){var c=$(this).children(".zc-dem-dropdown-menu"),e=$(c).children(".zc-dem-menu-arrow"),f=$(c).find("li[elename\x3dactionEle], li[elename\x3dapprovalAction]"),l=1<$(f).length?!0:!1,q=$(a.target).offset(),n=l?2*$(f).outerHeight(!0):$(f).outerHeight(!0),p=q.top+$(a.target).height()+$(this).outerHeight(!0)/2+($(a.target).outerHeight(!0)-$(a.target).height())/
2-n,m=q.left+$(a.target).outerWidth(!0)+10;n=m+$(c).outerWidth(!0);var r=p+$(c).outerHeight(!0);n-51>$(window).width()&&(m-=$(c).outerWidth(!0)+$(a.target).width()+20);r+51>$(window).height()&&(n=l?4*$(f).outerHeight(!0):2*$(f).outerHeight(!0),p-=$(c).outerHeight(!0)+$(a.target).height()-n+$(this).outerHeight(!0));$(c).css({top:p,left:m,bottom:"auto",right:"auto",position:"fixed"});$(e).css({top:q.top,left:m-$(e).width(),bottom:"auto",right:"auto",position:"fixed"});a.stopPropagation();b.bindToolTip(d)});
b.workflowTable.off("mouseenter","td[elename\x3ddispNameCol]").on("mouseenter","td[elename\x3ddispNameCol]",function(a){a.stopPropagation();a=$(this).find("p[elename\x3dwfDispName] , p[elename\x3dapprovalName]");var c=a.find("a"),b=a.width(),d=c.width();b<d&&a.attr({title:c.text(),"data-title-position":"right"})});d.off("mouseleave","td[elename\x3ddispNameCol]").on("mouseleave","td[elename\x3ddispNameCol]",function(a){$(this).find("p[elename\x3dwfDispName] , p[elename\x3dapprovalName]").removeAttr("title")})};
this.updateBluePrintBuilder=function(){b.wfState=WorkflowConstants.BLUEPRINT;b.blueprint&&(b.blueprint.isUpdateNeeded=!0);$("#workflowListContainer").find("div[elename\x3dwfFilter]").find("li[wftype\x3d'"+b.wfState+"']").trigger("click")};this.updateDataTable=function(){var a={};a.wfType=b.wfMeta.wfType;a.wfLinkName=b.wfMeta.wfLinkName;a.formLinkName=b.wfMeta.formLinkName;$("#workflowListContainer").find("div[elename\x3dwfFilter]").find("li[wftype\x3d'"+b.wfState+"']").trigger("click");$.ajax({url:b.workflowUrl+
"/getWorkflowDetails",type:"POST",async:!1,data:"zccpn\x3d"+b.constants.csrfToken+"\x26workflowObj\x3d"+JSON.stringify(a)+"\x26sb_tracking\x3dfalse",beforeSend:showLoading(),success:function(a,d,e){hideLoading();if(b.wfState==WorkflowConstants.FORM_WF&&(b.isWorkflowV2Enabled||b.isFormWfFilter))b.isFormWFEmpty=!1,b.workflowTablenew.updateWorkFlowFormTable(a,b.wfMeta);else{a=b.getWorkflowRowHtml(a);if(0==b.workflowTable.rows().nodes().length)b.destroyWorkflowTable(),$("#workflowList \x3e tbody").append(a);
else{e=b.wfMeta.wfType==Constants.DATE_SCHEDULE_WF?"custom-schedule":b.wfMeta.formLinkName;d=b.wfMeta.wfType==Constants.APPROVAL_WF?b.workflowTable.row("tr[workflowname\x3d"+b.wfMeta.oldWfLinkName+"][formlinkName\x3d"+e+"][wfType\x3d"+b.wfMeta.wfType+"]"):b.workflowTable.row("tr[workflowname\x3d"+b.wfMeta.oldWfLinkName+"][wfType!\x3d"+Constants.APPROVAL_WF+"]");if(null!=d&&null!=d.index())e=d.index(),d.remove();else if(e=b.wfMeta.wfType==Constants.APPROVAL_WF?b.workflowTable.row("tr[formlinkName\x3d"+
e+"][wfType\x3d"+b.wfMeta.wfType+"]:last").index()+1:b.workflowTable.row("tr[formlinkName\x3d"+e+"][wfType!\x3d"+Constants.APPROVAL_WF+"]:last").index()+1,null==e||void 0==e||isNaN(e)){b.destroyWorkflowTable();$("#workflowList \x3e tbody").append(a);b.initDataTable();return}b.destroyWorkflowTable();0==e?$("#workflowList \x3e tbody").prepend(a):$("#workflowList \x3e tbody \x3e tr").eq(e-1).after(a)}b.initDataTable()}}})};this.count=function(){var a=void 0==b.workflowTable||null==b.workflowTable?0:
b.workflowTable.rows().nodes().length;if(b.isWorkflowV2Enabled||b.isFormWfFilter)a+=b.workflowTablenew.count();return a};this.formNameSort=function(){var a=$("#worlflowFormlist .zc-formlist-withwf").find("li").sort(b.Ascending_sort),c=$("#worlflowFormlist .zc-formlist-withoutwf").find("li").sort(b.Ascending_sort);$("#worlflowFormlist .zc-formlist-withwf ul").html(a);$("#worlflowFormlist .zc-formlist-withoutwf ul").html(c);$("#dem-app-search-field").trigger("keyup")};this.Ascending_sort=function(a,
c){return $(c).attr("formDisplayName").toUpperCase()<$(a).attr("formDisplayName").toUpperCase()?1:-1};this.destroyWorkflowTable=function(){$("#workflowListContainer").find("div[elename\x3dwfTableContainer]").css("opacity","0");$("#workflowListContainer").find("div[elename\x3dno-workflow]").addClass("zc-hide");$("#workflowTableBody").data("zcsp")&&$("#workflowTableBody").data("zcsp").destroy();b.workflowTable.destroy()};this.bindToolTip=function(a){a.find("li[elename\x3dactionEle]").each(function(){b.validateTooltipwidth($(this))});
a.find("p[elename\x3dcriteriaEle]").each(function(){var a=$(this).parent().width(),b=$(this).children().width();a<b&&$(this).attr({title:$(this).text(),"data-title-position":"right"})});a.find("li[elename\x3dapprovalAction]").each(function(){b.validateTooltipwidth($(this))})};this.validateTooltipwidth=function(a){var c=a.width(),b=a.children().children(),e=b.width();c<e&&a.attr({title:b.text(),"data-title-position":"right"})};this.getWorkflowRowHtml=function(a){var c=$("#clonedRow").find("tr").clone(!0,
!0);$(c).attr({formlinkName:a.formLinkName,eventType:a.eventType,subType:a.subType,formDispName:a.formDispName,workflowname:2==a.type?a.approvalLinkName:a.ruleLinkName,wfType:a.type});var d="",e="";switch(a.type){case 1:case 6:e=WorkflowConstants.FORM_WF;d="zc-common-form-icon";break;case 2:e=WorkflowConstants.APPROVAL_WF;d="zc-wb-success-message";break;case 3:case 4:e=WorkflowConstants.SCHEDULE_WF;d="zc-common-calendar";break;case 5:e=WorkflowConstants.BUTTON_WF;d="zc-common-form-icon";break;case 7:e=
WorkflowConstants.PAYMENT_WF,d="zc-wb-currency"}$(c).find("td[elename\x3dwfTypeCol]").text(e);e=$(c).find("td[elename\x3ddispNameCol]");$(e).find("i[name\x3dwfIcon]").addClass(d);$(e).children("span[elename\x3dformDispName]").text(a.formDispName);2==a.type?$(e).children("p[elename\x3dwfDispName]").attr({elename:"approvalName",encodedName:a.EncodedApprovalName}).find("a").attr({href:appbuilder.component.APP.getAppEditUrl()+"/"+a.formLinkName+"/approvalWorkFlow/"+a.approvalLinkName+"/edit"}).text(a.ApprovalName):
$(e).children("p[elename\x3dwfDispName]").attr("encodedName",a.ruleDispNameEncoded).find("a").attr({href:appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/"+a.ruleLinkName+"/edit"}).text(a.ruleDispName);0==a.status||8==a.status?$(c).find('[elname\x3d"statusBtn"]').removeAttr("checked"):$(c).find('[elname\x3d"statusBtn"]').attr("checked");!b.isWorkflowV2Enabled&&!b.isFormWfFilter||a.type!=Constants.FORM_WF&&a.type!=Constants.STATELESS_BUTTON_WF?($(c).find("td[elename\x3dwhenCol]").text(a.when),
$(c).find("td[elename\x3dwhenCol]").find("i[class\x3dzc-wb-rearrange]").hide()):($(c).find("td[elename\x3dwhenCol]").remove(),b.isFormWfFilter||$(c).find("td[elename\x3ddispNameCol]").prepend('\x3ci class\x3d"zc-em zc-wb-rearrange"\x3e\x3c/i\x3e'));$(c).find("td[elename\x3dcreatedonCol]").text(a.createdon);d=$(c).find("div[elename\x3dactionContent]").find("span");e=1==a.actionCount?i18n["zc.workflowlist.action"]:i18n["zc.workflowlist.actions"];$(d).text(a.actionCount+" "+e);if(0==a.actionCount)$(d).addClass("zc-dem-noactions");
else if(2==a.type){$(c).find("div[elename\x3dactionContent]").addClass("zc-dem-approval-actions");d=$("\x3cdiv/\x3e").attr("class","zc-dem-dropdown-menu").append($("\x3cdiv/\x3e").attr("class","zc-dem-menu-arrow"));var f=$("\x3cul/\x3e");$.each(a.levelList,function(a,c){var b=$("\x3cli/\x3e");0==c.levelSeq?$(b).append($("\x3cp/\x3e").append("\x3cb/\x3e").text(i18n["zc.formedit.settings.approvalprocess.onstart"])):$(b).append($("\x3cp/\x3e").append("\x3cb/\x3e").text(i18n["zc.formedit.field.level"]+
" "+c.levelSeq+" "+c.levelType));var d=$("\x3cul/\x3e").attr("class","zc-dem-submenu zc-dem-box-sizing");$.each(c.groupList,function(a,e){$.each(e.actionList,function(a,b){a=b.actionDesc.subStr1+b.actionDesc.subStr2;b=$("\x3cli/\x3e").attr({elename:"approvalAction",wfLinkName:c.wfName,groupLinkName:e.groupLinkName,actionLinkName:b.actionLinkName}).append($("\x3ca/\x3e").append($("\x3csmall/\x3e").text(a)));$(d).append(b)});$(b).append(d)});$(f).append(b)});$(d).append(f);$(c).find("div[elename\x3dactionContent]").append(d)}else{$(c).find("div[elename\x3dactionContent]").addClass("zc-dem-approval-actions");
d=$("\x3cdiv/\x3e").attr("class","zc-dem-dropdown-menu").append($("\x3cdiv/\x3e").attr("class","zc-dem-menu-arrow"));var g=$("\x3cul/\x3e");$.each(a.groupList,function(a,c){a=$("\x3cli/\x3e");var b=$("\x3cp/\x3e").attr("elename","criteriaEle").append($("\x3cb/\x3e").text(c.criteriaStr));c.hasCriteria&&$(a).append(b);var d=$("\x3cul/\x3e").attr("class","zc-dem-submenu zc-dem-box-sizing");$.each(c.actionList,function(a,b){a=b.actionDesc.subStr1+b.actionDesc.subStr2;b=$("\x3cli/\x3e").attr({elename:"actionEle",
groupLinkName:c.groupLinkName,actionLinkName:b.actionLinkName}).append($("\x3ca/\x3e").append($("\x3csmall/\x3e").text(a)));$(d).append(b)});$(a).append(d);$(g).append(a)});$(d).append(g);$(c).find("div[elename\x3dactionContent]").append(d)}return c};this.taskListEvents=function(a){b.setWfHeaderText();$(a).on("click","div[elename\x3daddActionEle]",function(){$(this).addClass("wb-create-new active");b.wfMeta.wfType==Constants.PAYMENT_WF&&$(this).closest("div.wb-sectionleft").removeClass("zc-dem-paymt-grouplist");
b.getAction(this)});$(a).on("click","span[elename\x3daddActionEle]",function(a){a.stopPropagation();$(this).parent().after('\x3cli class\x3d"wb-add-new wb-create-new  wb-new-action-creating active"\x3e\x3cspan class\x3d"wb-add-action-block wb-new-action"\x3eNew Action\x3c/span\x3e\x3c/li\x3e');$("#wf-action-container").find("li[elename\x3dgroupele]").removeAttr("active");$(this).closest("li[elename\x3dgroupele]").attr("active","true");b.getAction(this)});$(a).on("click","li[elename\x3dtaskele]",function(a){$(this).addClass("active");
b.getAction(this)});$(a).on("click","span[elename\x3deditAction]",function(a){a.stopPropagation();a=$(this).closest("li[elename\x3dtaskele]");$(a).addClass("active");b.getAction(a)});$(a).on("click","span[elename\x3ddelActionIcon]",function(a){a.stopPropagation();var c=$(this).closest("li[elename\x3dtaskele]"),e=$("#wf-action-container").attr("workflowname");iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeleteaction"],success:function(){var a=$(c).closest("li[elename\x3dgroupele]"),
d=$(a).find("li[elename\x3dtaskele]").length,h=$(a).find("div[elename\x3dcriteria]").length,k=1==d&&0==h?!0:!1;$.ajax({url:b.workflowUrl+"/deleteAction",type:"POST",data:{zccpn:b.constants.csrfToken,workflowName:e,actionName:$(c).attr("tasklinkname"),deleteGrp:k,sb_tracking:!0,sb_compCategory:WorkflowUtil.getComponentCategory(b.wfMeta.wfType)},beforeSend:WorkflowBuilder.showLoadingContainer(),success:function(e,f,g){WorkflowBuilder.hideLoadingContainer();$(c).remove();1==d&&0==h?$(a).remove():1==
d&&1==h&&(e=b.generateNoTaskElement(),$(a).find("ul").append(e));0==$("#wf-action-container").find("li[elename\x3dgroupele]").length&&WorkflowBuilder.setWfHeaderText()}})}})})};this.setEmailVariables=function(){b.formFields=0!=$("#wf-action-container").find("input[name\x3dwfFormFields]").length?JSON.parse($("#wf-action-container").find("input[name\x3dwfFormFields]").val()):[];b.relatedFields=0!=$("#wf-action-container").find("input[name\x3drelatedFields]").length?JSON.parse($("#wf-action-container").find("input[name\x3drelatedFields]").val()):
"";b.isAdminEmailVerfied="true"===$("#isAdminVerifiedEmail").val();b.isAdminUser="true"===$("#isAdminUser").val();b.wfMeta.wfType!=Constants.DATE_SCHEDULE_WF&&b.formFields.unshift({dispName:i18n["zc.workflowbuilder.loginuserid"],linkName:"zoho.loginuserid",category:"Zoho Variables"});b.formFields.unshift({dispName:i18n["zc.workflowbuilder.adminuserid"],linkName:"zoho.adminuserid",category:"Zoho Variables"});b.insertFieldsHtml=b.constructFormFieldsHtml()};this.showUpgradeButton=function(){var a=!1;
switch(b.wfMeta.wfType){case Constants.FORM_SCHEDULE_WF:case Constants.DATE_SCHEDULE_WF:ZCUser.getPlanDetails().isSchedulesAllowed()||(a=!0);break;case Constants.PAYMENT_WF:ZCUser.getPlanDetails().isC5PaymentEnabled()||(a=!0)}a&&($("#appbuilder-header").find("#upgradeButton").removeClass("zc-hide"),$("#appbuilder-header").find("#upgradeButton").find("a").text(i18n["zc.workflow.upgradetoenable"]))};this.setWorkflowMeta=function(){b.wfMeta.wfLinkName=b.wfMeta.oldWfLinkName=$("#wf-action-container").attr("workflowname");
b.wfMeta.wfDispName=$("#wf-action-container").attr("workflowdispname");b.wfMeta.formLinkName=$("#formName").val();b.wfMeta.formDispName=$("#wf-action-container").find("#formDispName").val();b.wfMeta.wfType=$("#wfType").val();b.wfMeta.eventType=$("#eventType").val();b.wfMeta.subEvent=$("#wf-action-container").find("#subEvent").val()?$("#wf-action-container").find("#subEvent").val():0;b.wfMeta.status=$("#wf-action-container").find("#status").val();b.wfMeta.formComp=$("#wf-action-container").find("#formComp").val();
b.wfMeta.formCompDisplayName=b.getWorkflowMetavalues("formCompDispName");b.wfMeta.subFormComp=$("#wf-action-container").find("#subFormComp").val();b.isWorkflowV2Enabled="true"==$("#wf-action-container").find("#isWorkflowV2Enabled").val()?!0:!1;b.wfMeta.wfType==Constants.FORM_WF||b.wfMeta.wfType==Constants.STATELESS_BUTTON_WF?b.wfState=WorkflowConstants.FORM_WF:b.wfMeta.wfType==Constants.FORM_SCHEDULE_WF||b.wfMeta.wfType==Constants.DATE_SCHEDULE_WF?b.wfState=WorkflowConstants.SCHEDULE_WF:b.wfMeta.wfType==
Constants.CUSTOM_WF?b.wfState=WorkflowConstants.BUTTON_WF:b.wfMeta.wfType==Constants.PAYMENT_WF&&(b.wfState=WorkflowConstants.PAYMENT_WF);b.workflowState=b.wfState};this.getWorkflowMetavalues=function(a){b.workflowMeta=$("#wf-action-container").find("#workflowMeta").val();b.workflowMeta=void 0==b.workflowMeta||""==b.workflowMeta?"":JSON.parse(b.workflowMeta);return b.workflowMeta&&b.workflowMeta[a]?b.workflowMeta[a]:""};this.registerEvents=function(){var a=$("#wf-action-container");b.setWorkflowMeta();
b.registerPaymentEvents(a,$("#pmtStatusTab"));b.taskListEvents(a);b.registerCriteriaEvents(a);b.registerScheduleCriteriaEvents();b.setEmailVariables();b.actionSortable(a);b.registerToolTipEvents(a);b.bindEditorPreview(a);b.showUpgradeButton();$(a).find("ul[elename\x3dwb-blockList]").sortable({axis:"y",cancel:".wb-add-new",stop:function(c,e){var d={};$(a).find("li[elename\x3dgroupele]").each(function(a){var c=$(this).attr("grouplinkname");d[c]=a+1});c=$(a).attr("workflowname");$.ajax({url:b.workflowUrl+
"/updateGroupSeqNo",type:"POST",data:"zccpn\x3d"+b.constants.csrfToken+"\x26workflowName\x3d"+c+"\x26groupsObj\x3d"+JSON.stringify(d),beforeSend:WorkflowBuilder.showLoadingContainer(),success:function(a,c,b){WorkflowBuilder.hideLoadingContainer()}})}}).disableSelection();var c=b.isBuilder?$("#appbuilder-header").find("#zc-comp-settings"):$("#wf-Popup").find("#zc-comp-settings");$(c).off("click").on("click",function(){var c=$(a).attr("workflowname");$.ajax({url:b.workflowUrl+"/showSettings",type:"POST",
data:"zccpn\x3d"+b.constants.csrfToken+"\x26workflowName\x3d"+c,beforeSend:showLoading(),success:function(a,c,d){$(a).iSlide({afterOpen:function(){if(b.isWorkflowV2Enabled){$("#workflow-settings-popup").find("input[name\x3d'when']").val(WorkflowUtil.getEventTypeNames(parseInt(b.wfMeta.eventType)));var a=WorkflowUtil.getSubTypeNames(parseInt(b.wfMeta.eventType),parseInt(b.wfMeta.subEvent));a=b.wfMeta.wfType==Constants.STATELESS_BUTTON_WF?a.replace("{0}",b.wfMeta.buttonName):""!=b.wfMeta.formCompDisplayName?
a.replace("{0}",b.wfMeta.formCompDisplayName)+(""!=b.wfMeta.subFormComp?"."+b.wfMeta.subFormComp:""):a;$("#workflow-settings-popup").find("input[name\x3d'subevent']").val(a)}$("#workflowProperties").zcScrollPane();b.registerSettingsEvents($("#workflow-settings-popup"));$("#new-workflow-name").focus()},afterClose:function(a){$(a.slider).remove()},focusFirstField:!0});hideLoading()}})});setTimeout(function(){""!=b.triggerActionName&&$(a).find("li[elename\x3dtaskele][tasklinkname\x3d"+b.triggerActionName+
"]").trigger("click")},300)};this.registerToolTipEvents=function(a){$(a).find(".wb-action-name").each(function(){var a=this;$(a).closest(".wb-actions-list").find(".zc-wfaction-tooltip").remove();if($(a)[0].scrollWidth>$(a).innerWidth()){var b=$(a).find("span").text().replace("[","").replace("]","").split(","),e=$("\x3cul/\x3e");$.each(b,function(a,c){$(e).append($("\x3cli\x3e\x3c/li\x3e").text(c.trim()))});var f=$("\x3cdiv/\x3e").attr("class","zc-wfaction-tooltip").append(e);$(a).find("span").off("mouseenter").on("mouseenter",
function(c){var b=$(c.target).offset(),d=$(document).height()-50;b=b.top-8;var e=d-b,g=$(f).height();e<g&&(b=d-g);d=$(a).outerWidth()+200;$(f).css({top:b,left:d,display:"block"});c.stopPropagation()});$(a).find("span").off("mouseleave").on("mouseleave",function(a){$(f).css({display:"none"})});$(this).after(f)}})};this.bindEditorPreview=function(a){$(a).find('li[elename\x3d"taskele"][type\x3d'+Constants.CUSTOM_PROCESS+"]").each(function(){b.setEditorPreview(this,void 0)})};this.setEditorPreview=function(a,
c){var b=$(a).find("div.scriptRef");0<b.length&&(!$(a).hasClass("zc-wb-act-delugescript")&&$(a).addClass("zc-wb-act-delugescript"),a=DelugeUtil.renderScript(c?c:$(b).attr("script"),!0),$(b).html(a))};this.registerPaymentEvents=function(a,c){b.wfMeta.wfType==Constants.PAYMENT_WF&&($(c).find("a[elename\x3dpmtStatus]").off("click").on("click",function(){$(c).find("a[elename\x3dpmtStatus]").removeClass("active");var b=$(this).addClass("active").attr("pmtStatus"),e=$(a).scrollTop(),f=$(a).prop("scrollHeight")-
$(a).outerHeight();b=$(a).find("div[elename\x3dgroupCategory][category\x3d"+b+"]").position().top+90;e==b||e==f&&b>f||$(a).animate({scrollTop:b},800)}),$(a).find(".zc-dem-payment-subparent-title").off("click").on("click",function(){var a=$(this).closest("div[elename\x3dgroupCategory]");$(a).hasClass("expand")?$(a).removeClass("expand"):$(a).addClass("expand")}))};this.registerSettingsEvents=function(a){function c(c){if(d()&&(c||b.wfMeta.wfType!=Constants.FORM_SCHEDULE_WF)){c=$(a).find("form[name\x3dworkflowprops]").serialize();
var f="onCriteria"==$(a).find("input[name\x3dschedulerCriteria]:checked").val();c+="\x26criteriaStr\x3d";f&&(c+=encodeURIComponent($(a).find("div[elename\x3dscheduleCriteria]").text().trim()));$(a).find("#new-workflow-name").val();c=c+"\x26zccpn\x3d"+b.constants.csrfToken+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(b.wfMeta.wfType);$.ajax({url:b.workflowUrl+"/saveSettings",type:"POST",data:c,dataType:"json",beforeSend:function(){showPreloader()},success:function(c,
d,f){showStatus(i18n.saved);c.hasOwnProperty("error")?"schedule in progress"==c.error?b.wfMeta.wfType==Constants.FORM_SCHEDULE_WF&&($(a).find("input[name\x3dsaveButton]").hideTextLoading(i18n["zc.formedit.settings.approvalprocess.savesettings"]),e(c.wfStatus)):iAlert(c.error):(b.wfMeta.wfType==Constants.FORM_SCHEDULE_WF&&$(a).find("input[name\x3dsaveButton]").hideTextLoading(i18n["zc.formedit.settings.approvalprocess.savesettings"]),b.wfMeta.wfLinkName=c.workflowName,b.wfMeta.wfDispName=c.workflowDispName,
$(a).find("#current-workflow-name").val(c.workflowName),$("#wf-action-container").attr("workflowname",c.workflowName),AccordionMenu.reinit(WorkflowBuilder.constants),b.isBuilder?(WorkflowBuilder.constants.updateComponent(Constants.WORKFLOW,c.workflowName),history.pushState({},"",b.appUrl+"/workflowbuilder/"+c.workflowName+"/edit"),AccordionMenu.updateStaticName(c.workflowDispName)):$("#wf-Popup").find("#zc-dem-comp-name").text(c.workflowDispName),b.setWfHeaderText())}})}}function d(){$(a).clearError();
var c=!0,d=$(a).find("#new-workflow-name").val();""==d?($(a).find("#new-workflow-name").showError(i18n["zc.workflowbuilder.workflownameinvalid"]),c=!1):50<d.length&&($(a).find("#new-workflow-name").showError(i18n["zc.workflowbuilder.workflownamemaxlen"]),c=!1);if(b.wfMeta.wfType==Constants.FORM_SCHEDULE_WF||b.wfMeta.wfType==Constants.DATE_SCHEDULE_WF)d=$(a).find("input[name\x3deventTime]"),$(d).parent().parent().hasClass("zc-hide")||""!=$(d).val()||($(d).showError(i18n["zc.workflowbuilder.timeinvalid"]),
c=!1),d=$(a).find("input[name\x3deventDate]"),$(d).parent().parent().hasClass("zc-hide")||""!=$(d).val()||($(d).showError(i18n["zc.workflowbuilder.startdateinvalid"]),c=!1);WorkflowBuilder.wfMeta.wfType==Constants.FORM_SCHEDULE_WF&&$(a).find(".zc-dem-triple-textbox select.adjustment").each(function(){var b=$(this).val();if("after"==b||"before"==b){b=$(this).parent().siblings(".zc-dem-input");var d=$(b).val();if(0!=$(a).find("select[name\x3drepeat]").val()||"endAdjustment"!=$(this).attr("name"))isNaN(d)||
""==d?($(b).showError(i18n["zc.workflowbuilder.invalidcount"]),c=!1):1E3<d&&($(b).showError(i18n["zc.workflowbuilder.invalidcountlength"]),c=!1)}else"afterfield"!=b&&"beforefield"!=b||""!=$(this).parent().siblings(".fs-due-delay-2").find("select").val()||($(this).parent().siblings(".fs-due-delay-2").find("select").showError(i18n["zc.workflowbuilder.emptydelay"]),c=!1)});return c}function e(c){c!=WorkflowConstants.ENABLED_STATUS_IN_PROGRESS&&c!=WorkflowConstants.DISABLED_STATUS_IN_PROGRESS||$(a).find("form[name\x3dworkflowprops]").find(".zc-dem-toast").length||
(c=$("\x3cdiv/\x3e").attr("class","zc-dem-toast zc-info-toast").append($("\x3ci/\x3e").attr("class","zc-em zc-common-info-alt zc-toast-icon")).append($("\x3cspan/\x3e").text(i18n["zc.workflowsettings.rescheduleerror"])),$(a).find("form[name\x3dworkflowprops]").prepend(c),$(a).find("#workflowProperties").addClass("zc-dem-saving-process"))}function f(){var c=$(a).find("input[name \x3d eventDate]").val(),b=$(a).find("input[name \x3d eventTime]").val();$("#wf-action-container").find("input[id\x3deventDate]").val(c);
$("#wf-action-container").find("input[id\x3deventTime]").val(b)}$(a).find("select").zcDropDown();$(a).find("select[name\x3dstartAdjustment]").off("change").on("change",function(){var c=$(this).val(),b=$(this).closest(".zc-dem-form-group");$(b).find(".fs-due-delay-1, .fs-due-delay-2").addClass("hide");$(b).removeClass("zc-wb-custom-time zc-wb-custom-time1");"none"!=c?"beforefield"==c||"afterfield"==c?($(a).find("select[name\x3ddelayTxtField]").data("zcdd").setValue(""),$(b).find(".fs-due-delay-2").removeClass("hide"),
$(b).addClass("zc-wb-custom-time1"),$(a).find("select[name\x3ddelayTxtField]").val()):($(a).find("input[name\x3ddueDelay]").val(),$(b).addClass("zc-wb-custom-time"),$(b).find(".fs-due-delay-1").removeClass("hide")):$(a).find("input[name\x3ddueDelay]").val("0")});b.registerScheduleCriteriaEvents();$(a).find("select[name\x3drepeat]").off("change").on("change",function(){4!=$("#wfType").val()&&(0==$(this).val()?($(a).find("select[name\x3dendAdjustment]").closest(".zc-dem-form-group").hide(),$(a).find("select[name\x3dendDateField]").closest(".zc-dem-form-group").hide()):
(""!=$(a).find("select[name\x3dendDateField]").val()&&$(a).find("select[name\x3dendAdjustment]").closest(".zc-dem-form-group").show(),$(a).find("select[name\x3dendDateField]").closest(".zc-dem-form-group").show()))});$(a).find("select[name\x3dendAdjustment]").off("change").on("change",function(){var c=$(this).val(),b=$(this).closest(".zc-dem-form-group");$(b).find(".fs-due-delay-1").addClass("hide");$(b).removeClass("zc-wb-custom-time");"none"!=c?($(b).addClass("zc-wb-custom-time"),$(b).find(".fs-due-delay-1").removeClass("hide")):
$(a).find("input[name\x3dendDueDelay]").val("0")});$(a).find("#endDateField").off("change").on("change",function(){0==$(a).find("select[name\x3drepeat]").val()||""==$(a).find("select[name\x3dendDateField]").val()?$(a).find("select[name\x3dendAdjustment]").closest(".zc-dem-form-group").hide():$(a).find("select[name\x3dendAdjustment]").closest(".zc-dem-form-group").show()});var g=!0;$(a).find("input[name\x3deventTime]").dtPicker({format:"HH:mm:ss",initParent:!0,showClearValue:!0,showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-time",
onChangeCallback:function(){f();g&&c()},onShowCallback:function(){g=!1},onHideCallback:function(){g=!0;c()}});$(a).find("input[name\x3deventDate], input[name\x3dendDate]").dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd"),initParent:!0,showClearValue:!0,showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-calendar",onChangeCallback:function(){f();g&&c()},onShowCallback:function(){g=!1},onHideCallback:function(){g=!0;c()}});if($("#formDateFields").val()){var h=$("#endDateName").val(),
k=$("#endDateField");$.each(JSON.parse($("#formDateFields").val()),function(a,c){a=$("\x3coption\x3e\x3c/option\x3e").text(c.dispname).val(c.linkname).attr("type",c.type);$(k).append(a)});$(k).data("zcdd").setValue(h).trigger("change")}$(a).find("input[eletype\x3dformEventIp], select[eletype\x3dformEventIp]").on("change",function(){c()});(new PaymentConfig(b.constants,a,b.wfMeta.formLinkName)).registerEvents();var l;$(a).find("#new-workflow-name").on("keyup",function(){clearTimeout(l);l=setTimeout(c,
750)});$(a).find("#new-workflow-name").on("keydown",function(){clearTimeout(l)});$(a).find("#wf-Status").zcToggle({type:ZCSwitchType.LARGE,onConfig:{label:ZCSwitchLabel.ENABLED},offConfig:{label:ZCSwitchLabel.DISABLED}});$(a).find("#wf-Status").on("click",function(a){var c=$(this),d=$(c).data("zctg").status();b.enableDisableWf({wfName:b.wfMeta.wfDispName,wfLinkName:b.wfMeta.wfLinkName,wfType:b.wfMeta.wfType,formLinkName:b.wfMeta.formLinkName,status:d,successCallBK:function(){d?$(c).data("zctg").active():
$(c).data("zctg").deActive()},event:a})});$(a).find("#zc-auth-listing").length&&ConnectionContext.initHandlebars();$(a).find("#zc-auth-listing").off("click").on("click",function(){ComponentBuilder.getConnectionsList(b.appUrl+"/workflow/"+b.wfMeta.wfLinkName+"/connection/references")});$(a).find("input[name\x3dsaveButton]").on("click",function(a){$(this).showTextLoading(i18n["zc.workflow.savingaction"]);c(!0);a.stopPropagation()});$(a).find("input[name\x3dcancelButton]").on("click",function(){$(a).find("a.zc-dem-right-close").trigger("click")});
b.wfMeta.wfType==Constants.FORM_SCHEDULE_WF&&e($(a).find("#wfStatus").val())};this.registerCriteriaEvents=function(a){$(a).find("span[elename\x3daddCriteria]").on("click",function(){b.loadCriteriaBuilder("wfCriteria",null,$(this).closest("div[elename\x3dnocriteria]"),!1)});$(a).find("span[elename\x3deditCriteria]").on("click",function(){b.loadCriteriaBuilder("wfCriteria",null,$(this).closest("div[elename\x3dcriteria]"),!0)});$(a).find("span[elename\x3ddelCriteria]").on("click",function(){var a=$(this),
d=$("#wf-action-container").attr("workflowname"),e=$(a).closest("li[elename\x3dgroupele]").attr("grouplinkname");iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeletecriteria"],success:function(){$.ajax({url:b.workflowUrl+"/deleteCriteria",type:"POST",data:"zccpn\x3d"+b.constants.csrfToken+"\x26workflowName\x3d"+d+"\x26groupName\x3d"+e+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(b.wfMeta.wfType),beforeSend:showLoading(),
success:function(c,d,e){hideLoading();if(0==$(a).closest("li[elename\x3dgroupele]").find("li[elename\x3dtaskele]").length)$(a).closest("li[elename\x3dgroupele]").remove(),0==$(a).closest("ul[elename\x3dwb-blockList]").find("li[elename\x3dgroupele]").length&&b.setWfHeaderText();else{c=$(a).closest("div[elename\x3dcriteria]").attr("elename","nocriteria");d=$("\x3cstrong\x3e\x3c/strong\x3e").html(i18n["zc.workflowbuilder.executewithoutcondition"]);e=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus");
var f=$("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon zc-em  zc-common-pencil").attr("elename","addCriteria");$(e).append(f);$(c).html("").append(d).append(e);$(c).closest("li[elename\x3dgroupele]").attr("class","wb-action");b.registerCriteriaEvents(c)}}})}})})};this.registerScheduleCriteriaEvents=function(){$("#workflowProperties").find("input[name\x3dschedulerCriteria]").off("click").on("click",function(){"onCriteria"==$("#workflowProperties").find("input[name\x3dschedulerCriteria]:checked").val()?
""==$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").text().trim()?b.loadCriteriaBuilder("scheduleCriteria",null,a,!1,c):$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").smoothShow(300,function(){}):$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").smoothHide(300,function(){})});var a=$("#workflowProperties").find("div[elename\x3dscheduleCriteria]"),c=function(){""==$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").text().trim()&&$("#workflowProperties").find("#schedulerCriteria1").prop("checked",
"true")};$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").off("click").on("click",function(){"true"==$(this).attr("criteria")?b.loadCriteriaBuilder("scheduleCriteria",null,a,!0,c):b.loadCriteriaBuilder("scheduleCriteria",null,a,!1,c)})};this.actionSortable=function(a){$(a).find("ul[elename\x3dwb-blockList]").each(function(){var a=$(this).find("ul.wb-actionList");$(a).sortable({axis:"y",connectWith:$(a),containment:$(a).closest("ul[elename\x3dwb-blockList]"),scrollSensitivity:100,
cancel:".wb-notaskele,.wb-edit-icon,.wb-dup-icon,.wb-del-icon,.wb-addaction",start:function(a,c){a=$(this).closest("li[elename\x3dgroupele]");1==$(a).find("li[elename\x3dtaskele]").length&&$(a).find("ul").append(b.generateNoTaskElement());c.item.data("fromGroup",a)},update:function(a,c){a=$(this).closest("li[elename\x3dgroupele]");c.item.data("toGroup",a)},stop:function(a,c){var d=c.item.data("fromGroup");a=c.item.data("toGroup");var e=$(d).find("li[elename\x3dtaskele]").length;if(($(a).attr("grouplinkname")==
$(d).attr("grouplinkname")||void 0==a)&&1==e)$(d).find("li[elename\x3dno-taskele]").remove();else if(void 0!=a){var h={};$(d).find("li[elename\x3dtaskele]").each(function(a){var c=$(this).attr("tasklinkname");h[c]=a+1});var k={};$(a).find("li[elename\x3dtaskele]").each(function(a){var c=$(this).attr("tasklinkname");k[c]=a+1});$(a).find("li[elename\x3dno-taskele]").remove();c=$("#wf-action-container").attr("workflowname");$.ajax({url:b.workflowUrl+"/updateActionSeqNo",type:"POST",data:{zccpn:b.constants.csrfToken,
workflowName:c,fromGroupName:$(d).attr("grouplinkname"),toGroupName:$(a).attr("grouplinkname"),fromGroupObj:JSON.stringify(h),toGroupObj:JSON.stringify(k),sb_tracking:!1},beforeSend:WorkflowBuilder.showLoadingContainer(),success:function(a,c,b){WorkflowBuilder.hideLoadingContainer();a=$(d).find("div[elename\x3dcriteria]").length;0==e&&0==a&&$(d).remove()}})}}})})};this.showWorkflowList=function(){window.location.href=appbuilder.component.APP.getAppEditUrl()+"/workflow/edit"};this.getWorkflow=function(a){WebAppearance.showBuilder(b.constants,
{type:Constants.WORKFLOW,compName:a.wfLinkName},!1);AccordionMenu.updateStaticName(a.wfDispName)};this.getApprovalWorkflow=function(a){var c=appbuilder.component.APP.getAppEditUrl()+"/"+a.formLinkName+"/approvalWorkFlow/loadProcess";history.pushState({},"",appbuilder.component.APP.getAppEditUrl()+"/"+a.formLinkName+"/approvalWorkFlow/"+a.approvalLinkName+"/edit");var d=$("#appbuilder-popup");$(d).append('\x3cdiv id\x3d"builder-template" style\x3d"position:absolute; z-index:9999; padding: 50px 0 0; width: 100%; height: 100%;"\x3e\x3c/div\x3e');
var e=$("#builder-template");ComponentBuilder.setupBuilder();$.ajax({beforeSend:function(){$(".zc-builder-icon-hdr").attr("class","zc-builder-icon-hdr zc-workflow-icon");$(e).append(WorkflowCompBuilder.getTemplate());$(d).append('\x3cdiv id\x3d"builder-cont" style\x3d"display:none;width:100%;height:100%;"\x3e\x3c/div\x3e')},url:c,type:"POST",data:"approvalLinkName\x3d"+a.approvalLinkName+"\x26zccpn\x3d"+b.constants.csrfToken+"\x26sb_tracking\x3dfalse",success:function(c){$(d).find("#builder-cont").html(c);
$("#builder-cont").show();$("#zc-dem-comp-name").text($("#wf-action-container").attr("workflowdispname"));appbuilder.updateModule(Modules.APPROVALBUILDER);setTimeout(function(){""!=a.triggerAction&&void 0!=a.triggerAction&&$("#wf-action-container").find("li[wflinkname\x3d"+a.wfLinkName+"][actionname\x3d"+a.triggerAction+"]").find(".wb-edit-icon").trigger("click")},300)}})};this.bindSelect2forInputBox=function(a){$(a.ele).each(function(){var c=a.data.slice(),b=[],e=$(this).val().split(",");$.each(e,
function(c,d){if(""!=d){var e=!0;$.each(a.data,function(a,c){$.each(c,function(a,c){if($.isArray(c)&&($.each(c,function(a,c){if(c.value==d)return e=!1}),!e))return!1});if(!e)return!1});e&&b.push({id:d,text:d,value:d})}});0<b.length&&c.push({text:"User Inputs",children:b});$(this).zcDropDown({showTitle:a.showTitle,formatSelection:function(a){return escapeHTML(a.value)},createSearchChoice:1==a.allowUserInput?function(a,c){if(0===$(c).filter(function(){return 0===this.text.localeCompare(a)}).length)return{id:$.trim(a),
text:$.trim(a),value:$.trim(a)}}:!1,multiple:a.multiselect,allowClear:void 0==a.allowClear?!1:!0,data:c})})};this.saveCriteria=function(a,c){var d=b.getCriteriaData(c),e=!0;if(0==d)return!1;var f=$("#wf-action-container").attr("workflowname"),g=$(a).closest("li[elename\x3dgroupele]").attr("grouplinkname");d=d+"\x26workflowName\x3d"+f+"\x26groupName\x3d"+g+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(b.wfMeta.wfType);$.ajax({async:!1,url:b.workflowUrl+"/saveCriteria",
type:"POST",data:"zccpn\x3d"+b.constants.csrfToken+"\x26"+d,beforeSend:showLoading(),success:function(d,f,g){hideLoading();"error"==d.status?($(c).showErrorBanner(d.errorMsg),e=!1):($(a).attr("elename","criteria").html(""),$(a).html($("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+"  ")),$(a).append($("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(d.criteriaString)),d=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus"),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class",
"wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename","delCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-drag-icon zc-em zc-wb-rearrange")),$(a).append(d),$(a).closest("li[elename\x3dgroupele]").attr("class","wb-condition"),b.registerCriteriaEvents(a))}});return e};this.saveScheduleCriteria=function(a,
c){var d=b.getCriteriaData(c),e=!0;if(0==d)return!1;var f=$("#wf-action-container").attr("workflowname");a=$(a).closest("li[elename\x3dgroupele]").attr("grouplinkname");$.ajax({async:!1,url:b.workflowUrl+"/getCriteriaString",type:"POST",data:"zccpn\x3d"+b.constants.csrfToken+"\x26"+(d+"\x26workflowName\x3d"+f+"\x26groupName\x3d"+a),beforeSend:showLoading(),success:function(a,d,f){hideLoading();"error"==a.status?($(c).showErrorBanner(a.errorMsg),e=!1):(d=$("\x3cdiv\x3e\x3c/div\x3e").attr("class","zc-dem-clearfix zc-approval-criteria-add-edit").attr("elename",
"scheduleCriteria").attr("criteria","true"),a=$("\x3ca\x3e\x3c/a\x3e").text(a.criteriaStr),$(d).append(a),$(d).off("click").on("click",function(){b.registerScheduleCriteriaEvents(this)}),$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").replaceWith(d))}});return e};this.validateCriteria=function(a,c,b){var d={},f=!0;$.ajax({async:!1,url:WorkflowBuilder.workflowUrl+"/validateCriteria",type:"POST",data:"zccpn\x3d"+WorkflowBuilder.constants.csrfToken+"\x26formLinkName\x3d"+b+"\x26sb_tracking\x3dfalse\x26"+
c,success:function(c,b,e){"error"==c.status?($(a).showErrorBanner(c.errorMsg),f=!1):"success"==c.status&&($(a).prevAll("#toastShow:first").length&&$(a).prevAll("#toastShow:first").remove(),d.criteriaString=c.criteriaString)}});d.flag=f;return d};this.getCriteriaData=function(a){a=CriteriaBuilderNew.updateInput($(a).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?a+"\x26isCriteria\x3dtrue":!1};this.getDataAccessCriteria=function(){var a=CriteriaBuilderNew.updateInput($("#dataAccessInput").find(".zc-rule-main")),
c={};if(!CriteriaBuilderNew.frmSubmit)return!1;if(""!=a||0!=a){a=a.split("\x26");for(var b=0;b<a.length;b++){var e=a[b].split("\x3d");c[e[0]]=e[1].replace(/%22/g,'"')}return c}};this.loadCriteriaBuilder=function(a,c,d,e,f){c=null==c?b.wfMeta.formLinkName:c;c="zccpn\x3d"+b.constants.csrfToken+"\x26formlinkname\x3d"+c;if(void 0!==d&&e){var g="wfCriteria-dataAccess"==a||"scheduleCriteria"==a?$(d).text():$(d).find("span").text();g=encodeURIComponent(g.replace(/ && /g," ZC_AND "));c=c+"\x26criteria\x3d"+
g}"scheduleCriteria"==a&&(c+="\x26skipRelatedFields\x3dfalse");$.ajax({url:b.workflowUrl+"/loadCriteriaBuilder",type:"POST",data:c,beforeSend:WorkflowBuilder.showLoadingContainer(),success:function(c,g,l){WorkflowBuilder.hideLoadingContainer();if("wfCriteria-dataAccess"!=a&&void 0!=d)$("#wf-slider").find("div[elename\x3d"+a+"]").removeClass("hide"),iCustomizePopup({title:e?i18n["zc.workflowbuilder.editcriteria"]:i18n["zc.workflowbuilder.addcriteria"],body:c,buttons:[{name:ZCButton.SAVECRITERIA,type:ZCModalConstants.MODAL_SUBMIT},
{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",success:function(c){return"scheduleCriteria"==a?b.saveScheduleCriteria(d,$(c.container)):b.saveCriteria(d,$(c.container))},failure:function(){f&&f()}}),CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW}),CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"));else{var h=$("#wf-slider").find("div[elename\x3d"+a+"]");$(h).html(c).smoothShow(300,function(){$(h).removeClass("hide")});
CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});CriteriaBuilderNew.init($(h).find(".zc-rule-main"))}}})};this.deleteWorkflows=function(a){iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.deleteworkflow"],success:function(){var c={};c.type=a.wfType;c.linkname=a.wfLinkName;c.formlinkname=a.formlinkName;$.ajax({url:b.workflowUrl+"/deleteWorkflows",type:"POST",data:"zccpn\x3d"+b.constants.csrfToken+"\x26workflowObj\x3d"+JSON.stringify(c)+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+
WorkflowUtil.getComponentCategory(b.wfMeta.wfType),beforeSend:showLoading(),success:function(c,e,f){hideLoading();c.validation?a.successCallBK():(c=b.constructErrorResp(c.wfRefObj),iCustomizePopup({body:c,buttons:[{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_SUBMIT}],success:function(){return!0}},function(a){$(a.parentContainer).find("a.zc-dem-dialogue-close").remove();$(a.parentContainer).addClass("zc-dem-dialogue-custom-function").find(".zc-dem-dialogue-header").hide()}))}})}});$(".zc-dem-dialogue-content ").find("i").after('\x3cdiv class\x3d"zc-wfb-delete-label"\x3e'+
i18n["zc.workflowbuilder.wfname"]+" : "+a.wfName+"\x3c/div\x3e")};this.enableDisableWf=function(a){var c=function(){var c="zccpn\x3d"+b.constants.csrfToken+"\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(a.wfType),e=b.workflowUrl+"/enableDisableWf";2==a.wfType?(e=b.appUrl+"/"+a.formLinkName+"/approvalWorkFlow/activateProcess",c+="\x26approvalLinkName\x3d"+a.wfLinkName+"\x26active\x3d"+!a.status+"\x26deleteRecord\x3d"+a.status):c+="\x26eleType\x3d"+a.wfType+"\x26status\x3d"+a.status+"\x26workflowName\x3d"+
a.wfLinkName;$.ajax({url:e,type:"POST",data:c,beforeSend:function(){showPreloader()},success:function(c,b,d){showStatus(i18n.saved);"failure"==c.status?"schedule in progress"==c.statusMsg?(c=$("\x3cp/\x3e").append($("\x3ci/\x3e").attr("class","zc-em zc-common-info-alt")).append($("\x3cspan/\x3e").attr("class","zc-wfb-info-label").text(i18n["zc.workflowbuilder.wfname"]+" : "+a.wfName)).append($("\x3cspan/\x3e").attr("class","zc-dem-dialogue-title").text(i18n["zc.workflowlist.rescheduleerror"])),iCustomizePopup({body:c,
buttons:[{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_SUBMIT}],success:function(){return!0}},function(a){$(a.parentContainer).find("a.zc-dem-dialogue-close").remove();$(a.parentContainer).addClass("zc-dem-dialogue-custom-function").find(".zc-dem-dialogue-header").hide()})):iAlert(c.statusMsg):a.successCallBK()}})};a.status?(a.event.preventDefault(),c()):(a.event.preventDefault(),iConfirm({title:i18n["zc.workflowbuilder.statusconfirm"],message:i18n["zc.workflowbuilder.confirmdisableworkflow"],
button:ZCButton.DISABLE,cbutton:ZCButton.CANCEL,success:function(){c()}}))};this.getAction=function(a){var c=$(a).closest("li[elename\x3dtaskele]"),d=$(a).attr("tasklinkname"),e=$("#wf-action-container").find("li[elename\x3dgroupele][active\x3dtrue]").attr("grouplinkname"),f=$("#wf-action-container").attr("workflowname"),g=$("#formName").val(),h=$("#formDispName").val(),k=$("#wfType").val(),l=$("#eventType").val(),q=$(a).closest("li[elename\x3dgroupele]").find("div[elename\x3dcriteria]").length;$.ajax({url:b.workflowUrl+
"/getAction",beforeSend:WorkflowBuilder.showLoadingContainer(),type:"POST",data:{wfLinkName:f,linkName:d,zccpn:b.constants.csrfToken},success:function(n,p,m){WorkflowBuilder.hideLoadingContainer();p=function(a){$(a.wfActionEle).find(".wb-save-button").hideTextLoading(i18n["zc.workflow.saveaction"]);$(a.wfActionEle).find(".wb-save-button").prop("disabled",!1);iAlert(i18n["zc.deluge.editor.save.requesterror"])};(new WorkflowActionSlider({wfMeta:b.wfMeta,wfType:k,eventType:l,subEventType:b.wfMeta.subEvent,
formLinkName:g,formDispName:h,wfLinkName:f,groupName:e,taskLinkName:d,workflowId:$("#wf-slider").find("div[elename\x3ddelugeheader]").attr("formid"),groupType:$(a).closest("div[elename\x3dgroupCategory]").attr("category"),isWorklfowV2:b.isWorkflowV2Enabled,formFields:b.formFields,beforeCloseWfslider:b.beforeCloseWfslider,taskele:c,criteriaLen:q,response:n,ActionCallBk:{save:{success:function(a){$(a.wfActionEle).find(".wb-save-button").hideTextLoading(i18n["zc.workflow.saveaction"]);$(a.wfActionEle).find(".wb-save-button").prop("disabled",
!1);"failure"!=a.response.status||a.isDelugeTask()?(a.delugeEditor.updateTopBarMenu([{label:i18n["zc.c5.setup.connections.title"],action:1==a.response.isConnectionReferenced?"show":"hide"},{label:i18n["zc.c5.setup.connections.title"],action:"changeAction",attachEvent:{event:"click",action:function(c){ComponentBuilder.getConnectionsList(b.appUrl+"/workflow/"+a.response.WF_LINK_NAME+"/action/"+a.response.LINK_NAME+"/connection/references")}}}]),a.delugeEditor.handleResponse(a.response,function(){a.isSaved=
!0;if(a.isNewGroup){var c=b.generateGroupElement(a.response);$("#wf-action-container").find(".wb-add-new.active").prev(".wb-listmenu").append(c)}else{var d=$("#wf-action-container").find("li[elename\x3dgroupele][active\x3dtrue]");c=b.generateTaskListElement(a.response);$(d).find("li.wb-new-action-creating").replaceWith(c);$(d).find("li[elename\x3dno-taskele]").remove()}WorkflowBuilder.actionSortable($("#wf-action-container"));WorkflowBuilder.registerToolTipEvents($("#wf-action-container"));$(d).removeAttr("active");
a.isDelugeTask()?(a.taskLinkName=a.response.LINK_NAME,a.isEdit=!0,options.workflow={componentType:"Workflow",wfLinkName:a.wfLinkName,actionLinkName:a.taskLinkName},a.delugeEditor.setOptions(options,!0),c=$("#wf-action-container").find("li[elename\x3dtaskele][tasklinkname\x3d"+a.response.LINK_NAME+"]"),b.beforeCloseWfslider(),WorkflowBuilder.setEditorPreview(c),$(c).addClass("active"),$(a.wfActionEle).find("a.back").addClass("zc-hide"),$(a.wfActionEle).find(".wb-save-button").val(i18n["zc.workflow.updateaction"]),
$(a.wfActionEle).find(".zc-wfb-actiontype-cont").prepend($("\x3cspan/\x3e").addClass("non-editable-child")).addClass("non-editable-header"),a.isScheduleWF()&&a.showExecuteNowButton()):$(a.wfActionEle).find("a[elename\x3ddefaultClose]").trigger("click")},function(){$(a.wfActionEle).find(".wb-save-button").prop("disabled",!1)})):iAlert(a.response.errorMessage)},error:p},update:{success:function(a){$(a.wfActionEle).find(".wb-save-button").hideTextLoading(i18n["zc.workflow.updateaction"]);$(a.wfActionEle).find(".wb-save-button").prop("disabled",
!1);"string"==typeof a.response&&(a.response=jQuery.parseJSON(a.response));"failure"!=a.response.status||a.isDelugeTask()?(a.delugeEditor.updateTopBarMenu([{label:i18n["zc.c5.setup.connections.title"],action:1==a.response.isConnectionReferenced?"show":"hide"}]),a.delugeEditor.handleResponse(a.response,function(){a.isSaved=!0;var c=$("#wf-action-container").find("li[elename\x3dtaskele][tasklinkname\x3d"+a.response.TASK_NAME+"]");$(c).find("span.wb-action-name").text(a.response.TASK_DESC.subStr1).append($("\x3cspan/\x3e").text(a.response.TASK_DESC.subStr2));
WorkflowBuilder.registerToolTipEvents($("#wf-action-container"));a.isDelugeTask()?WorkflowBuilder.setEditorPreview(c,a.response.SCRIPT):$(a.wfActionEle).find("a[elename\x3ddefaultClose]").trigger("click")},function(){$(a.wfActionEle).find(".wb-save-button").prop("disabled",!1)})):iAlert(a.response.errorMessage)},error:p}}})).init()}})};this.generateGroupElement=function(a){var c=$("\x3cli/\x3e").attr("class","wb-action");$(c).attr("elename","groupele");$(c).attr("grouplinkname",a.GROUP_NAME);$(c).attr("grouptype",
a.GROUP_TYPE);if(null!=a.criteria){var d=$("\x3cdiv/\x3e").attr("eleName","criteria").attr("class","zc-wb-action-head zc-dem-clearfix");var e=$("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+"  ");$(d).html(e);e=$("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(a.criteria);$(d).append(e);e=$("\x3cspan/\x3e").attr("class","flt-right wb-action-menus");var f=$("\x3cspan/\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria"),
g=$("\x3cspan/\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename","delCriteria"),h=$("\x3cspan/\x3e").attr("class","wb-action-icon wb-drag-icon zc-em zc-wb-rearrange");$(e).append(f).append(g).append(h);$(d).append(e);$(c).append(d).attr("class","wb-condition")}else d=$("\x3cdiv/\x3e").attr("eleName","nocriteria").attr("class","zc-wb-action-head zc-dem-clearfix"),e=$("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executewithoutcondition"]),$(d).html(e),e=
$("\x3cspan/\x3e").attr("class","flt-right wb-action-menus"),b.wfMeta.wfType!=Constants.DATE_SCHEDULE_WF&&(f=$("\x3cspan/\x3e").attr("class","wb-action-icon zc-em  zc-common-pencil").attr("elename","addCriteria"),$(e).append(f)),$(d).append(e);$(c).append(d);WorkflowBuilder.registerCriteriaEvents(d);d=$('\x3cul id\x3d"wb-sortable1" class\x3d"wb-actionList"\x3e\x3c/ul\x3e');$(c).append(d);a=b.generateTaskListElement(a);$(d).append(a);a=$('\x3cspan class\x3d"wb-block-drag-handle"\x3e\x3cspan class\x3d"wb-drag-icon-small"\x3e\x3c/span\x3e\x3c/span\x3e');
$(c).append(a);return c};this.generateTaskListElement=function(a){var c=null!=WorkflowBuilder.wfMeta.subEvent&&"0"!=WorkflowBuilder.wfMeta.subEvent,d=$("\x3cli/\x3e").attr("class","ui-state-default");$(d).attr("elename","taskele");$(d).attr("tasklinkname",a.LINK_NAME);$(d).attr("tasktype",a.TASK_TYPE);var e=$("\x3ca\x3e\x3c/a\x3e").attr("href","javascript:void(0);").attr("class","zc-wfb-indv-action zc-dem-clearfix");b.isWorkflowV2Enabled&&(c||b.wfMeta.wfType!=Constants.FORM_WF)&&$(e).append($("\x3ci/\x3e").attr("class",
"zc-em zc-wb-action-icon "+a.TASK_ICON));$(e).append($("\x3cspan/\x3e").attr("class","wb-handle"));$(e).append(f);c=$("\x3cspan/\x3e").attr("class","wb-actions-list");b.isWorkflowV2Enabled&&$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class",a.TASK_ICON+"  wb-dis-inbl wb-mr5").css("display","none"));f=$("\x3cspan/\x3e").attr("class","wb-action-name zc-dem-text-ellipsis").text(a.TASK_DESC.subStr1);""!=a.TASK_DESC.subStr2?f.append($("\x3cspan/\x3e").text(a.TASK_DESC.subStr2)):$(d).addClass("zc-wb-withoutmsg");
$(c).append(f);$(e).append(c);var f=$('\x3cspan class\x3d"flt-right wb-action-menus"\x3e\x3cspan class\x3d"wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow" elename\x3d"editAction"\x3e\x3c/span\x3e\x3cspan class\x3d"wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow" elename\x3d"delActionIcon"\x3e\x3c/span\x3e\x3cspan class\x3d"wb-action-icon wb-drag-icon zc-em zc-wb-rearrange"\x3e\x3c/span\x3e\x3c/span\x3e');$(e).append(f);$(d).append(e);b.isWorkflowV2Enabled&&(b.isNewFormWF()||b.wfMeta.wfType!=
Constants.FORM_WF)&&a.TASK_TYPE==Constants.CUSTOM_PROCESS&&""!=a.SCRIPT&&($(d).append($("\x3cdiv/\x3e").addClass("scriptRef").attr("script",a.SCRIPT)),$(d).addClass("zc-wb-act-delugescript"));b.scriptOnlyWorkflow()||(a=$("\x3cspan/\x3e").attr("class","wb-addaction").attr("elename","addActionEle").html("+"),$(d).append(a));return d};this.scriptOnlyWorkflow=function(){return b.isWorkflowV2Enabled&&b.wfMeta.wfType==Constants.FORM_WF&&b.wfMeta.subEvent!=Constants.AUTOMATION&&b.wfMeta.subEvent!=Constants.ONSUCCESS};
this.isNewFormWF=function(){return b.wfMeta.wfType==Constants.FORM_WF?null!=b.wfMeta.subEvent&&"0"!=b.wfMeta.subEvent:!1};this.beforeCloseWfslider=function(){$(".wb-new-action-creating").remove();$("#wf-action-container").find("li[elename\x3dtaskele], div[elename\x3daddActionEle]").removeClass("active");$("#wf-action-container").find("li[elename\x3dgroupele]").removeAttr("active");$(".wb-add-new").find("span").removeClass("wb-new-action");b.wfMeta.wfType==Constants.PAYMENT_WF&&$("#wf-action-container").find("div.wb-sectionleft").addClass("zc-dem-paymt-grouplist");
b.setWfHeaderText()};this.setWfHeaderText=function(){var a=$("#wf-action-container"),c=$(a).find("div[elename\x3dwfHeader]"),d=$(a).find("#eventType").val(),e=$(a).find("#wfType").val(),f=a.find("#isStateless").val(),g=$(a).find("#formDispName").val(),h=$(a).find("li[elename\x3dgroupele]").length,k=b.appUrl+"/formbuilder/"+$(a).find("#formName").val()+"/edit",l=b.isWorkflowV2Enabled;$(c).empty();$(c).addClass("zc-wb-breadcrumbs");if(e==Constants.FORM_WF)if(e="",null==WorkflowBuilder.wfMeta.subEvent||
"0"==WorkflowBuilder.wfMeta.subEvent)e=0==h?i18n["zc.workflowbuilder.headerPrefixAFormWf"]:i18n["zc.workflowbuilder.headerPrefixBFormWf"],e=e+" \x3ca\x3e\x3c/a\x3e"+(i18n["zc.workflowbuilder.headerSuffixFormWf"]+" "),e+=1==d?i18n["zc.workflowbuilder.created"]:2==d?i18n["zc.workflowbuilder.edited"]:3==d?i18n["zc.workflowbuilder.deleted"]:i18n["zc.workflowbuilder.createdoredited"],$(c).html(e),$(c).find("a").text(g),$(c).find("a").attr("target","_blank"),$(c).find("a").attr("href",k);else{h=WorkflowUtil.getEventTypeNames(parseInt(d));
d=WorkflowUtil.getSubTypeNames(parseInt(d),parseInt(b.wfMeta.subEvent));d=""!=b.wfMeta.formCompDisplayName?d.replace("{0}",b.wfMeta.formCompDisplayName)+(""!=b.wfMeta.subFormComp?"."+b.wfMeta.subFormComp:""):d;var q=""!=b.wfMeta.formCompDisplayName?"zc-dem-wf-fieldname zc-dem-text-ellipsis":"";"true"==f?(e=i18n["zc.workflow.builder.statelessform.breadcrumb"],g={"{formname}":{value:g,isRedirect:!0,redirectUrl:k,isActive:!0},"{formevent}":{value:d,isActive:!1,"class":q},"{workflowname}":{value:b.wfMeta.wfDispName,
isActive:!1}}):(e=i18n["zc.workflow.builder.fieldrules.breadcrumb"],g={"{formname}":{value:g,isRedirect:!0,redirectUrl:k,isActive:!0},"{recordevent}":{value:h,isActive:!1},"{formevent}":{value:d,isActive:!1,"class":q},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}});$(c).html(b.crateBreadcrumbHtml(e,g))}else e==Constants.DATE_SCHEDULE_WF?(g=$(a).find("#eventDate").val(),k=$(a).find("#eventTime").val(),l?(e=i18n["zc.workflow.builder.schedule.customschedule.ondateandtime.breadcrumb"],g={"{date}":{value:g,
isActive:!0},"{time}":{value:k,isActive:!0},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}},$(c).html(b.crateBreadcrumbHtml(e,g))):(e=0==h?i18n["zc.workflowbuilder.headerPrefixADateScheWf"]:i18n["zc.workflowbuilder.headerPrefixBDateScheWf"],e=e+"\x3ca\x3e\x3c/a\x3e"+(" "+i18n["zc.workflowbuilder.at"]),e+="\x3ca\x3e\x3c/a\x3e",$(c).html(e),$(c).find("a").first().text(g),$(c).find("a").last().text(k)),$(c).find("a").off("click").on("click",function(){$("#appbuilder-header").find("#zc-comp-settings").trigger("click")})):
e==Constants.FORM_SCHEDULE_WF?(f=$(a).find("#dateField").val(),l?(e=i18n["zc.workflow.builder.schedule.formschedule.ondateandtimefield.breadcrumb"],g={"{formname}":{value:g,isRedirect:!0,redirectUrl:k,isActive:!0},"{date-time}":{value:f,isActive:!1,"class":"zc-dem-wf-fieldname zc-dem-text-ellipsis"},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}},$(c).html(b.crateBreadcrumbHtml(e,g))):(e=0==h?i18n["zc.workflowbuilder.headerPrefixAFormScheWf"]:i18n["zc.workflowbuilder.headerPrefixBFormScheWf"],
e=e+"\x3ca\x3e\x3c/a\x3e"+(" "+i18n["zc.workflowbuilder.valueinthe"]),e+="\x3ca\x3e\x3c/a\x3e",$(c).html(e),$(c).find("a").first().text(f),$(c).find("a").last().text(g),$(c).find("a").last().attr("target","_blank"),$(c).find("a").last().attr("href",k))):e==Constants.STATELESS_BUTTON_WF?($(c).empty(),b.wfMeta.buttonName=$(a).find("#buttonName").val(),l?(e=i18n["zc.workflow.builder.dashboard.statelessbutton.breadcrumb"],g={"{formname}":{value:g,isActive:!0,isRedirect:!0,redirectUrl:k},"{buttonname}":{value:b.wfMeta.buttonName,
isActive:!1,"class":"zc-dem-wf-fieldname zc-dem-text-ellipsis"},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}},$(c).html(b.crateBreadcrumbHtml(e,g))):($(c).append(i18n["zc.workflowbuilder.headerPrefixAStatelessButtonWf"]+" ").append($("\x3ca/\x3e").text(b.wfMeta.buttonName)).append(", "+i18n["zc.workflowbuilder.headerPrefixBStatelessButtonWf"]+" ").append($("\x3ca/\x3e").attr({target:"_blank",href:k}).text(g)).append(", "+i18n["zc.workflowbuilder.headerPrefixCStatelessButtonWf"]),$(c).find("a").first().off("click").on("click",
function(){$("#appbuilder-header").find("#zc-comp-settings").trigger("click")}))):e==Constants.CUSTOM_WF?(f=$(a).find("#viewName").val(),$(c).empty(),l?(e=i18n["zc.workflow.builder.customaction.onclickofmenu.noreportname.breadcrumb"],g={"{formname}":{value:g,isActive:!0,isRedirect:!0,redirectUrl:k},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}},f&&""!=f&&(e=i18n["zc.workflow.builder.customaction.onclickofmenu.breadcrumb"],g["{reportname}"]={value:f,isActive:!0,isRedirect:!0,redirectUrl:b.appUrl+
"/report/"+$(a).find("#viewLinkName").val()+"/edit"}),$(c).html(b.crateBreadcrumbHtml(e,g))):$(c).append(i18n["zc.workflowbuilder.headerPrefixACustomWf"]+" ").append($("\x3ca/\x3e").attr({target:"_blank",href:b.appUrl+"/report/"+$(a).find("#viewLinkName").val()+"/edit"}).text(f)).append(", "+i18n["zc.workflowbuilder.headerPrefixBCustomWf"]+" ").append($("\x3ca/\x3e").attr({target:"_blank",href:k}).text(g))):e==Constants.PAYMENT_WF&&(l?(e=i18n["zc.workflow.builder.payment.afterformsubmission.breadcrumb"],
g={"{formname}":{value:g,isActive:!0,isRedirect:!0,redirectUrl:k},"{workflowname}":{value:b.wfMeta.wfDispName,isActive:!1}},$(c).html(b.crateBreadcrumbHtml(e,g))):(e=0==h?i18n["zc.payment.workflow.headerone"]:i18n["zc.payment.workflow.headertwo"],$(c).append(e).append($("\x3ca/\x3e").attr("href",k).text(g))));l&&0==$(a).find("div[elename\x3dwfHeader-help]").length&&(a=$("\x3cdiv/\x3e").attr("elename","wfHeader-help").attr("class","zc-wb-action-info"),"3"==b.wfMeta.eventType?(l="3"==b.wfMeta.subEvent?
"9":"4"==b.wfMeta.subEvent?"10":b.wfMeta.subEvent,$(a).text(WorkflowConstants.ONE_LINER_TEXT[b.wfMeta.wfType+"_"+l])):$(a).text(WorkflowConstants.ONE_LINER_TEXT[b.wfMeta.wfType+"_"+b.wfMeta.subEvent]),l="","3"==b.wfMeta.eventType?(l="3"==b.wfMeta.subEvent?"9":"4"==b.wfMeta.subEvent?"10":b.wfMeta.subEvent,l=WorkflowConstants.HELP_DOC_LINK[b.wfMeta.wfType+"_"+l]):l=WorkflowConstants.HELP_DOC_LINK[b.wfMeta.wfType+"_"+b.wfMeta.subEvent],""!=l&&$(a).append($("\x3ca/\x3e").attr({href:l,target:"_blank"}).text("Learn more")),
$(c).after(a))};this.crateBreadcrumbHtml=function(a,c){var b=$("\x3cul/\x3e");a=a.split("\x3e");for(var e=0;e<a.length;e++)for(var f=$("\x3cli/\x3e"),g=Object.keys(c),h=0;h<g.length;h++){var k=g[h],l=c[g[h]];if(-1!=a[e].indexOf(k)){if(l.isActive){var q=l.isRedirect?"\x3ca target\x3d'_blank' href\x3d"+l.redirectUrl+"\x3e"+escapeHTML(l.value)+"\x3c/a\x3e":q="\x3ca\x3e"+escapeHTML(l.value)+"\x3c/a\x3e";a[e]=a[e].replace(k,q);f.attr({"class":"active"}).html(a[e])}else a[e]=a[e].replace(k,escapeHTML(l.value));
l.class&&f.addClass(l.class)}f.html(a[e]);b.append(f)}return b};this.beforeCloseWfslider=function(){$(".wb-new-action-creating").remove();$("#wf-action-container").find("li[elename\x3dtaskele], div[elename\x3daddActionEle]").removeClass("active");$(".wb-add-new").find("span").removeClass("wb-new-action");b.wfMeta.wfType==Constants.PAYMENT_WF&&$("#wf-action-container").find("div.wb-sectionleft").addClass("zc-dem-paymt-grouplist");b.setWfHeaderText()};this.generateNoTaskElement=function(){var a=$("\x3cli/\x3e").attr("class",
"ui-state-default wb-notaskele");$(a).attr("elename","no-taskele");$(a).attr("tasklinkname","non-associated-task");var c=$("\x3ca\x3e\x3c/a\x3e").attr("href","javascript:void(0);").attr("class","zc-wfb-indv-action zc-dem-clearfix"),b=$("\x3cspan/\x3e").attr("class","wb-actions-list");$(b).append($("\x3cspan/\x3e").attr("class","wb-alert-icon wb-dis-inbl wb-mr5"));$(b).append($("\x3cspan/\x3e").attr("class","wb-action-name zc-dem-text-ellipsis").text(i18n["zc.formedit.settings.approvalprocess.notaskareassociated"]));
$(c).append(b);$(a).append(c);c=$("\x3cspan/\x3e").attr("class","wb-addaction").attr("elename","addActionEle").html("+");$(a).append(c);return a};this.constructErrorResp=function(a){var c=$("\x3cdiv/\x3e").attr("class","zc-dem-dialogue-alertinfo"),b=$("\x3cp/\x3e");$(b).append($("\x3ci/\x3e").attr("class","zc-em zc-common-alert")).append($("\x3cspan/\x3e").attr("class","zc-dem-dialogue-title").text(i18n["zc.workflowlist.deleteerrormessage"]));$(c).append(b);var e=$("\x3cul/\x3e");a.forEach(function(a){var c=
$("\x3cli/\x3e").attr("class","zc-dem-parent");$(c).append($("\x3cspan/\x3e").text(i18n["zc.workflowlist.reportname"]+" : ")).append(escapeHTML(a.viewName)).append($("\x3ci/\x3e").attr("class","zc-em zc-common-angle-right")).append($("\x3cspan/\x3e").text(i18n["zc.workflow.itemname"]+" : ")).append(escapeHTML(a.itemName));if(a.menuNamesList){var b=$("\x3cul/\x3e").attr("class","zc-dem-child");$.each(a.menuNamesList,function(a,c){a=$("\x3cli/\x3e").append($("\x3ci/\x3e").attr("class","zc-em zc-common-angle-right")).append($("\x3cspan/\x3e").text(i18n["zc.workflowlist.menuname"]+
" : ")).append(escapeHTML(c));$(b).append(a)});$(c).append(b)}$(e).append(c)});a=$("\x3cdiv/\x3e").attr("class","zc-dem-dialogue-custom-function-link").append($("\x3ch4/\x3e").text(i18n["zc.workflow.workflowtext"])).append(e);return $("\x3cdiv/\x3e").append(c).append(a)};this.bindInsertFieldsTooltip=function(a){var c=""!=b.insertFieldsHtml?b.insertFieldsHtml:b.constructFormFieldsHtml();$(c).insertAfter($(a).parent());c=$(a).parent().parent().find("li[elename\x3deachfieldoption]");var d=$(a).parent().parent().find("div[elename\x3dinsertformfields]"),
e=$(a).parent().parent().find("div[elename\x3dshowformfieldslist]");$(c).on("click",function(){var c=$(this).find("a").attr("value");c=$(a).val()+"${"+c+"}";$(a).val(c);$(a).focus()});$(d).on("click",function(a){$(this).parent().find("#showformfieldslist").addClass("zc-dem-wf-fieldslist-active");$(this).addClass("zc-dem-wf-insertfields-active")});$(document).on("click",function(a){a.target!=d[0]&&($(e).removeClass("zc-dem-wf-fieldslist-active"),$(d).removeClass("zc-dem-wf-insertfields-active"))})};
this.constructFormFieldsHtml=function(){var a='\x3cdiv class\x3d"insertformfield-row"\x3e\x3cdiv elename\x3d"insertformfields" class\x3d"zc-dem-wf-insertfields"\x3e'+i18n["zc.formedit.settings.insertfields"]+'\x3c/div\x3e\x3cdiv style\x3d"width:210px;" id\x3d"showformfieldslist" elename\x3d"showformfieldslist" class\x3d"zc-dem-wf-fieldslist"\x3e\x3cdiv class\x3d"zc-dem-wf-fieldslist-scroll"\x3e\x3cul\x3e\x3cli\x3e\x3ca value\x3d"" type\x3d"1"\x3e'+i18n["zc.formedit.form.zohovaraibles"]+'\x3c/a\x3e\x3cul\x3e\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"zoho.adminuserid" value\x3d"zoho.adminuserid"\x3e'+
i18n["zc.workflowbuilder.insertfields.adminuserid"]+'\x3c/a\x3e\x3c/li\x3e\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"zoho.loginuserid" value\x3d"zoho.loginuserid"\x3e'+i18n["zc.workflowbuilder.insertfields.loginuserid"]+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/li\x3e",c=[Constants.NAME,Constants.ADDRESS,Constants.IMAGE,Constants.SIGNATURE,Constants.FILE_UPLOAD,Constants.AUDIO,Constants.VIDEO,Constants.PLAIN_TEXT,Constants.SECTION,Constants.SCRIPT];if(b.wfMeta.wfType!=
Constants.DATE_SCHEDULE_WF){var d="";$.each(WorkflowBuilder.formFields,function(a,b){-1==$.inArray(b.compType,c)&&"Form Fields"==b.category&&"integration"!=b.fieldType&&"subform"!=b.fieldType&&(d+='\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"'+b.linkName+'" value\x3d"'+b.linkName+'"\x3e'+escapeHTML(b.dispName)+"\x3c/a\x3e\x3c/li\x3e")});""!=d&&(a+='\x3cli\x3e\x3ca value\x3d"" type\x3d"2"\x3e'+i18n["zc.formedit.form.formfields"]+"\x3c/a\x3e\x3cul\x3e"+d+"\x3c/ul\x3e\x3c/li\x3e")}return a+
"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}};
class wfActionUtil{static getWorkflowUrl(){return appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/edit"}isAdminUser(){return"true"===$("#isAdminUser").val()}isAdminEmailVerfied(){return"true"===$("#isAdminVerifiedEmail").val()}static showLoadingContainer(){if(!$("#wf-slider").length)return showLoading();if($("#wf-slider").length)return $("#wf-slider").showLoading()}static hideLoadingContainer(){if(!$("#wf-slider").length)return hideLoading();if($("#wf-slider").length)return $("#wf-slider").hideLoading()}static enableDtPicker(b,
a,c){a==Constants.DATE?$(b).dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd"),showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-calendar",showClearValue:!0}):a==Constants.DATE_TIME?$(b).dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd")+" "+c,showIcon:!0,iconClass:"calTimeIcon flLeft zc-em zc-fb-date-Time",showClearValue:!0}):a==Constants.TIME&&$(b).dtPicker({format:c,showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-time",showClearValue:!0})}static bindInsertFieldsTooltip(b,
a,c){a=this.constructFormFieldsHtml(a,c);$(a).insertAfter($(b).parent());a=$(b).parent().parent().find("li[elename\x3deachfieldoption]");var d=$(b).parent().parent().find("div[elename\x3dinsertformfields]"),e=$(b).parent().parent().find("div[elename\x3dshowformfieldslist]");$(a).on("click",function(){var a=$(this).find("a").attr("value");a=$(b).val()+"${"+a+"}";$(b).val(a);$(b).focus()});$(d).on("click",function(a){$(this).parent().find("#showformfieldslist").addClass("zc-dem-wf-fieldslist-active");
$(this).addClass("zc-dem-wf-insertfields-active")});$(document).on("click",function(a){a.target!=d[0]&&($(e).removeClass("zc-dem-wf-fieldslist-active"),$(d).removeClass("zc-dem-wf-insertfields-active"))})}static constructFormFieldsHtml(b,a){var c='\x3cdiv class\x3d"insertformfield-row"\x3e\x3cdiv elename\x3d"insertformfields" class\x3d"zc-dem-wf-insertfields"\x3e'+i18n["zc.formedit.settings.insertfields"]+'\x3c/div\x3e\x3cdiv style\x3d"width:210px;" id\x3d"showformfieldslist" elename\x3d"showformfieldslist" class\x3d"zc-dem-wf-fieldslist"\x3e\x3cdiv class\x3d"zc-dem-wf-fieldslist-scroll"\x3e\x3cul\x3e\x3cli\x3e\x3ca value\x3d"" type\x3d"1"\x3e'+
i18n["zc.formedit.form.zohovaraibles"]+'\x3c/a\x3e\x3cul\x3e\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"zoho.adminuserid" value\x3d"zoho.adminuserid"\x3e'+i18n["zc.workflowbuilder.insertfields.adminuserid"]+'\x3c/a\x3e\x3c/li\x3e\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"zoho.loginuserid" value\x3d"zoho.loginuserid"\x3e'+i18n["zc.workflowbuilder.insertfields.loginuserid"]+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/li\x3e",d=[Constants.NAME,
Constants.ADDRESS,Constants.IMAGE,Constants.SIGNATURE,Constants.FILE_UPLOAD,Constants.AUDIO,Constants.VIDEO,Constants.PLAIN_TEXT,Constants.SECTION,Constants.SCRIPT];if(b!=Constants.DATE_SCHEDULE_WF){var e="";$.each(a,function(a,c){-1==$.inArray(c.compType,d)&&"Form Fields"==c.category&&"integration"!=c.fieldType&&"subform"!=c.fieldType&&(e+='\x3cli elename\x3d"eachfieldoption" class\x3d"optValue"\x3e\x3ca title\x3d"'+c.linkName+'" value\x3d"'+c.linkName+'"\x3e'+escapeHTML(c.dispName)+"\x3c/a\x3e\x3c/li\x3e")});
""!=e&&(c+='\x3cli\x3e\x3ca value\x3d"" type\x3d"2"\x3e'+i18n["zc.formedit.form.formfields"]+"\x3c/a\x3e\x3cul\x3e"+e+"\x3c/ul\x3e\x3c/li\x3e")}return c+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}static bindSelect2forInputBox(b){$(b.ele).each(function(){var a=b.data.slice(),c=[],d=$(this).val().split(",");$.each(d,function(a,d){if(""!=d){var e=!0;$.each(b.data,function(a,c){$.each(c,function(a,c){if($.isArray(c)&&($.each(c,function(a,c){if(c.value==d)return e=!1}),!e))return!1});if(!e)return!1});
e&&c.push({id:d,text:d,value:d})}});0<c.length&&a.push({text:"User Inputs",children:c});$(this).zcDropDown({showTitle:b.showTitle,formatSelection:function(a){return escapeHTML(a.value)},createSearchChoice:1==b.allowUserInput?function(a,c){if(0===$(c).filter(function(){return 0===this.text.localeCompare(a)}).length)return{id:$.trim(a),text:$.trim(a),value:$.trim(a)}}:!1,multiple:b.multiselect,allowClear:void 0==b.allowClear?!1:!0,data:a})})}};function workflowDashoard(b){var a=this;a.filterNavObj={currentFormName:"",currentEventName:"All",currentSubEventType:"All"};a.searchConfig={keys:"formDispName ruleDispName when eventName createdon statusName subEventName actionDesc".split(" ")};a.formWorkFlowRows=0;a.workFlowBuilder=b;a.isNewEventAdded=!1;a.dragAndDropListId=[];var c,d,e=$("#workflowListContainer");this.init=function(){a.workFlowBuilder.isFormWfFilter&&e.find(".zc-dem-worlflow-leftarrow").remove();c=$("#worlflowFormlist");d=$("#worlflowFormevent ul");
a.workFlowTableBody=$("#formWorkflowTableBody table");$("#formlistContainer").zcScrollPane({autoReinit:!0});$("#formevent-ul-conatiner").zcScrollPane({autoReinit:!0});if(""==a.filterNavObj.currentFormName||void 0==a.filterNavObj.currentFormName){a.workFlowSideNavActions();var b=c.find(".zc-formlist-withwf").find("li").first().attr("formName");void 0==b&&(b=c.find(".zc-formlist-withoutwf").find("li").first().attr("formName"));void 0==b?a.workFlowBuilder.isFormWFEmpty=!0:(a.workFlowBuilder.isFormWFEmpty=
!1,a.setActiveClassForFormName(b))}else a.workFlowSideNavActions(),a.setActiveClassForFormName(a.filterNavObj.currentFormName)};this.isWorklfowEmpty=function(){return 0==$("#workflowlistnew tr").length&&(a.workFlowBuilder.isWorkflowV2Enabled||a.workFlowBuilder.isFormWfFilter)};this.activeFilters=function(){a.updateFilterObjData();var c=a.filterNavObj.currentSubEventType?a.filterNavObj.currentSubEventType.split("_")[0]:"",b=a.filterNavObj.currentSubEventType?a.filterNavObj.currentSubEventType.substring(c.length+
1):"";return{formName:a.filterNavObj.currentFormName,eventType:"All"!=a.filterNavObj.currentEventName?a.filterNavObj.currentEventName:void 0,subEventType:"All"!=c?c:void 0,compName:b}};this.updateFilterObjData=function(){a.filterNavObj.currentFormName=$("#worlflowFormlist").find("li[class\x3d'active']").attr("formName");a.filterNavObj.currentEventName=$("#worlflowFormevent").find("li[class\x3d'toggle active']").closest("li[eventType]").attr("eventType");a.filterNavObj.currentSubEventType=$("#worlflowFormevent").find("li[class\x3d'toggle active']").attr("subType");
a.filterNavObj.isStateLessForm=$("#worlflowFormevent").find("li[class\x3d'toggle active']").attr("subType")};this.getFormWorkFlowActions=function(){$.ajax({url:a.workFlowBuilder.workflowUrl+"/getWorkflowList",type:"GET",data:{formLinkName:a.filterNavObj.currentFormName,sb_tracking:!1},beforeSend:showLoading(),success:function(c,b,d){$("#dem-app-search-field").trigger("keyup");$("#formWorkflowTableBody table").html("");0==c.workflowList.length?(a.workFlowBuilder.isFormWFEmpty=!0,a.noDataView(),hideLoading()):
(a.workFlowBuilder.isFormWFEmpty=!1,a.workflowList=c.workflowList,a.preProcessWorkFlowList(),a.workflowEevenheadrsList=c.eventList,a.workflowList&&0<a.workflowList.length&&(a.formWorkFlowRows=c.length,a.formWorkFlowTableCreation(a.workflowList)))}})};this.preProcessWorkFlowList=function(){for(var c=0;c<a.workflowList.length;c++)a.workflowList[c].eventName=WorkflowUtil.getEventTypeNames(parseInt(a.workflowList[c].eventType)),a.workflowList[c].statusName=1==a.workflowList[c].status?"Enabled":"Disabled",
a.workflowList[c].subEventName=a.workflowList[c].fieldDisplayName?WorkflowUtil.getSubTypeNames(parseInt(a.workflowList[c].eventType),parseInt(a.workflowList[c].subType)).replace("{0}",a.workflowList[c].fieldDisplayName):WorkflowUtil.getSubTypeNames(parseInt(a.workflowList[c].eventType),parseInt(a.workflowList[c].subType))};this.setActiveClassForFormName=function(c){""!=a.filterNavObj.currentFormName&&void 0!=a.filterNavObj.currentFormName&&$("#worlflowFormlist").find("li[formName\x3d"+a.filterNavObj.currentFormName+
"]").removeClass("active");a.filterNavObj.currentFormName=c;a.getFormWorkFlowActions();$("#worlflowFormlist").find("li[formName\x3d"+a.filterNavObj.currentFormName+"]").attr("class","active")};this.showEventLi=function(a){$("#worlflowFormevent ul").find("li").removeClass("active");var c=d.find("[eventType\x3d'"+a.eventType+"']");c.removeClass("zc-hide");c.find("li[subType\x3d'"+a.subType+"']").removeClass("zc-hide")};this.setSubEvenetDetails=function(c,b){a.filterNavObj.currentEventName=c;a.filterNavObj.currentSubEventType=
b};this.workFlowSideNavActions=function(){$("#workflowfilterNav .zc-dem-worlflow-leftarrow").off("click").on("click",function(){var a=$("#workflowfilterNav");$("#formWorkflowTableBody").zcScrollPane().destroy();$(a).hasClass("expand")?$(a).removeClass("expand"):$(a).addClass("expand");setTimeout(function(){$("#formWorkflowTableBody").zcScrollPane({autoReinit:!0})},500)});$("#worlflowFormlist").off("click","ul li").on("click","ul li",function(){a.reset();a.setActiveClassForFormName($(this).attr("formName"));
a.setSubEvenetDetails("All","All")});$("#worlflowFormevent").off("click",".zc-dem-submenu a").on("click",".zc-dem-submenu a",function(){$(this).next().slideToggle();$(this).parent().toggleClass("toggle")});$("#worlflowFormlist").off("click",".zc-dem-wfb-formlistcontainer a").on("click",".zc-dem-wfb-formlistcontainer a",function(){$(this).parent().find("ul").slideToggle();$(this).parent().toggleClass("toggle")});$("#worlflowFormevent").off("click","li[subType\x3dAll]").on("click","li[subType\x3dAll]",
function(){$("#worlflowFormevent .zc-dem-submenu ul").find("li[subType \x3d "+a.filterNavObj.currentSubEventType+"]").removeClass("active");a.setSubEvenetDetails("All","All");a.filter();$(this).addClass("active")});$("#dem-app-search-field").on("keyup",function(){var b=$(this).val().trim().toLowerCase(),d=c.find(".zc-formlist-withwf"),e=c.find(".zc-formlist-withoutwf");a.showFormContainer(d,e);c.find("li").filter(function(){$(this).toggle(-1<$(this).attr("formdisplayname").toLowerCase().indexOf(b))});
0<d.find("li:visible").length?d.find(".zc-dem-formwf-noresult").addClass("zc-hide"):d.find(".zc-dem-formwf-noresult").removeClass("zc-hide");0<e.find("li:visible").length?e.find(".zc-dem-formwf-noresult").addClass("zc-hide"):e.find(".zc-dem-formwf-noresult").removeClass("zc-hide")});$("#worlflowFormevent").off("click",".zc-dem-submenu ul li").on("click",".zc-dem-submenu ul li",function(){"All"==a.filterNavObj.currentSubEventType?$("#worlflowFormevent ul").find("li[subType \x3d 'All']").removeClass("active"):
$("#worlflowFormevent .zc-dem-submenu ul").find("li[subType \x3d "+a.filterNavObj.currentSubEventType+"]").removeClass("active");var c=$(this).closest("li[eventType]").attr("eventType"),b=$(this).attr("subType");a.setSubEvenetDetails(c,b);a.filter();$(this).toggleClass("active")})};this.showFormContainer=function(a,c){a.addClass("toggle");a.find("ul").css("display","block");c.addClass("toggle");c.find("ul").css("display","block")};this.formWorkFlowTableCreation=function(c){$("#worlflowFormevent ul").html("");
a.isStateless="true"==$("#formlistContainer").find("li[formname\x3d'"+a.filterNavObj.currentFormName+"']").attr("isstateless");(new Promise(function(c,b){b="\x3cli class\x3d'active' subType\x3d'All'\x3e\x3ca\x3eAll\x3c/a\x3e\x3c/li\x3e";for(var d=0;d<a.workflowEevenheadrsList.length;d++){var e=a.workflowEevenheadrsList[d],f=WorkflowUtil.getEventTypeNames(parseInt(e.EventType)),g=e.SubTypes,h="";if(a.workFlowBuilder.isFormWfFilter){var m={Type:"0"};var r=$("\x3ctbody/\x3e").attr("id",t).append(a.headerCreation(e.EventType,
f,m,null));$(a.workFlowTableBody).append(r)}else for(var u=0;u<g.length;u++){m=g[u];r=a.getSubEventTextForEventLi(e.EventType,m.Type);var t=e.EventType+"-"+m.Type;h+="\x3cli class\x3d'"+("0"==m.isExist?"zc-hide":"")+"' subType\x3d'"+m.Type+"'\x3e\x3ca\x3e"+r+"\x3c/a\x3e\x3c/li\x3e";if(m.fieldList){a.sortByKeyValue(m.fieldList,"displayName",!0);for(var v=0;v<m.fieldList.length;v++){var w=t+"-"+m.fieldList[v].linkName;r=$("\x3ctbody/\x3e").attr("id",w).append(a.headerCreation(e.EventType,f,m,m.fieldList[v]));
$(a.workFlowTableBody).append(r);a.dragAndDropListId.push(w)}}else r=$("\x3ctbody/\x3e").attr("id",t).append(a.headerCreation(e.EventType,f,m,null)),$(a.workFlowTableBody).append(r),a.dragAndDropListId.push(t)}b+="\x3cli class\x3d'zc-dem-submenu toggle "+("0"==e.isExist?"zc-hide":"")+"' eventType\x3d'"+e.EventType+"'\x3e\x3ca class\x3d'"+(a.isStateless?"zc-hide":"")+"'\x3e"+f+"\x3ci class\x3d'fa fa-angle-down'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-angle-right'\x3e\x3c/i\x3e\x3c/a\x3e\x3cul\x3e"+h+"\x3c/ul\x3e\x3c/li\x3e"}$("#worlflowFormevent ul").append(b);
c("success")})).then(function(b){$.each(c,function(c,b){a.tableRowCreation(b)});$(a.workFlowTableBody).find("tr[isEmpty\x3dtrue]").hide();$("#worlflowFormevent ul").find("li[subType\x3dAll]").trigger("click");a.checkDragAndDrop();a.initTableListener($(a.workFlowTableBody));a.noDataView();b=e.find("input[elename\x3dcustomSearch]").val();""!=b&&a.search(b);$("#formWorkflowTableBody").zcScrollPane({autoReinit:!0});hideLoading()})};this.getSubEventTextForEventLi=function(a,c){return"5"==c||"6"==c||"7"==
c||"8"==c||"51"==c?WorkflowConstants.SUB_TYPE_NAME_FIELDS[c]:WorkflowUtil.getSubTypeNames(parseInt(a),parseInt(c))};this.checkDragAndDrop=function(){if(!a.workFlowBuilder.isFormWfFilter)for(var c=0;c<a.dragAndDropListId.length;c++){var b="#"+a.dragAndDropListId[c];try{$(b).sortable("disable")}catch(h){}2<$(b).find("tr").length&&(a.bindDragAndDrop(b),$(b).hasClass("ui-sortable-disabled")?$(b).sortable("enable"):a.bindDragAndDrop(b))}};this.headerCreation=function(c,b,d,e){var f=WorkflowUtil.getSubTypeNames(parseInt(c),
parseInt(d.Type)),g=b+" itag \x3cdiv class\x3d'zc-dem-wf-fieldname zc-dem-text-ellipsis'\x3e"+f+"\x3c/div\x3e";f=c+" \x3e "+(a.workFlowBuilder.isFormWfFilter?"0":d.Type);null!=e?(b=g.replace("{0}",e.displayName),d=d.Type+"_"+e.linkName.replace(".","_"),f=c+" \x3e "+d,b=a.isStateless?b.split("itag")[1]:b.split("itag").join('\x3ci class\x3d"zc-li-outline arrows-1-minimal-right"\x3e\x3c/i\x3e'),c='\x3ctr isEmpty\x3d"true" child-count\x3d0 eventType\x3d"'+c+'" subType\x3d"'+d+'" headerGroupName\x3d"'+
f+'" class\x3d"zc-dem-workflow-subEvent zc-dem-workflow-name wflow-header"\x3e\x3ctd colspan\x3d"4" class\x3d""\x3e'+b+"\x3c/td\x3e\x3c/tr\x3e"):(g=a.isStateless?g.split("itag")[1]:g.split("itag").join('\x3ci class\x3d"zc-li-outline arrows-1-minimal-right"\x3e\x3c/i\x3e'),a.workFlowBuilder.isFormWfFilter&&(g=b),c='\x3ctr isEmpty\x3d"true" child-count\x3d0 eventType\x3d"'+c+'" subType\x3d"'+d.Type+'" headerGroupName\x3d"'+f+'" class\x3d"zc-dem-workflow-subEvent zc-dem-workflow-name wflow-header"\x3e\x3ctd colspan\x3d"4" class\x3d""\x3e'+
g+"\x3c/td\x3e\x3c/tr\x3e");return c};this.tableRowCreation=function(c,b){var d=a.workFlowBuilder.getWorkflowRowHtml(c),e=c.subType;c.fieldLinkName&&(e=c.subType+"_"+c.fieldLinkName.replace(".","_"));var f=c.eventType+" \x3e "+e;a.workFlowBuilder.isFormWfFilter&&(f=c.eventType+" \x3e 0");if(b){var g=$(a.workFlowTableBody).find("tr[workflowname\x3d'"+b.oldWfLinkName+"']");a.addRowAttr(c,d,f,e)}if(g&&1==g.length)$(g).replaceWith(d);else{g=$(a.workFlowTableBody).find("tr[workflowname\x3d'"+c.ruleLinkName+
"']");1==g.length&&$(g).remove();b=$(a.workFlowTableBody).find("tr[headerGroupName\x3d'"+f+"']");if(0==$(b).length){var n=$(a.workFlowTableBody).find("tr[eventType\x3d'"+c.eventType+"']:visible").last();0==n.length&&(n=$(a.workFlowTableBody).find("tr[eventType\x3d'"+c.eventType+"']").last());var p=WorkflowUtil.getEventTypeNames(parseInt(c.eventType)),m=WorkflowUtil.getSubTypeNames(parseInt(c.eventType),parseInt(c.subType));g=c.eventType+"-"+c.subType;b="";if(a.isStateless){var r=m;c.fieldLinkName&&
(r=m.replace("{0}",escapeHTML(c.fieldDisplayName)),b=g+"-"+c.fieldLinkName)}else c.fieldLinkName?(r=p+"\x3ci class\x3d\"zc-li-outline arrows-1-minimal-right\"\x3e\x3c/i\x3e\x3cdiv class\x3d'zc-dem-wf-fieldname zc-dem-text-ellipsis'\x3e"+m.replace("{0}",escapeHTML(c.fieldDisplayName))+"\x3c/div\x3e",b=g+"-"+c.fieldLinkName):r=p+"\x3ci class\x3d\"zc-li-outline arrows-1-minimal-right\"\x3e\x3c/i\x3e\x3cdiv class\x3d'zc-dem-wf-fieldname zc-dem-text-ellipsis'\x3e"+m+"\x3c/div\x3e";m=$("\x3ctr/\x3e").attr({isEmpty:!1,
"child-count":0,eventType:c.eventType,subType:e,headerGroupName:f,"class":"zc-dem-workflow-subEvent zc-dem-workflow-name"});var u=$("\x3ctd/\x3e").attr({colspan:4});a.workFlowBuilder.isFormWfFilter&&(r=p);$(u).html(r);$(m).append(u);c.fieldLinkName?(n=$("\x3ctbody/\x3e").attr("id",b).append(m),p=$("#workflowlistnew").find("[id*\x3d"+g+"]"),p=a.fieldElePosition(p,c.fieldLinkName),g=$("#workflowlistnew").find("[id*\x3d"+g+"]"),0==p?$(g[p]).before(n):$(g[p-1]).after(n),a.dragAndDropListId.push(b)):$(n).append(m);
b=$(a.workFlowTableBody).find("tr[headerGroupName\x3d'"+f+"']")}$(b).show();$(b).attr("isEmpty","false");a.addRowAttr(c,d,f,e);c=$(a.workFlowTableBody).find("tr[groupName\x3d'"+f+"']");0==c.length?$(b).after(d):c.last().after(d)}$("#formWorkflowTableBody").find("input[elname\x3dstatusBtn]:not(#clonedRow [elname\x3dstatusBtn])").zcToggle({type:ZCSwitchType.LARGE,onConfig:{label:ZCSwitchLabel.ENABLED},offConfig:{label:ZCSwitchLabel.DISABLED}})};this.fieldElePosition=function(a,c){for(var b=a.length,
d=[c],e=0;e<b;e++)d.push($(a[e]).attr("id").split("-")[2]);d.sort();return d.indexOf(c)};this.addRowAttr=function(a,c,b,d){c.attr({subType:d,groupName:b,ruleLinkName:a.ruleLinkName});c.addClass("sortable-row");$(c).find("td[elename\x3dwfTypeCol]").remove()};this.creategroupName=function(a){var c=a.subType;a.fieldLinkName&&(c=a.subType+"_"+a.fieldLinkName.replace(".","_"));return a.eventType+" \x3e "+c};this.bindDragAndDrop=function(c){jQuery(c).sortable({items:".sortable-row",helper:function(a,c){var b=
c.children();a=c.clone();a.children().each(function(a){$(this).width(b.eq(a).width())});return a},placeholder:"zc-dem-tablerow-palceholder",forcePlaceholderSize:!0,axis:"y",cancel:"tr:first-child input",containment:c,start:function(a,c){c.item.toggleClass("zc-dem-ui-sortable-helper")},stop:function(a,c){c.item.toggleClass("zc-dem-ui-sortable-helper")},update:function(c,b){c=$(c.target).find("tr[elename\x3dworkflowRow]");for(var d=[],e=0;e<c.length;e++){var f=$(c[e]).attr("rulelinkname");d.push(f)}$.ajax({url:a.workFlowBuilder.workflowUrl+
"/reOrderWorkflows",type:"POST",beforeSend:showLoading(),data:{workflowArray:d.toString(),zccpn:a.workFlowBuilder.constants.csrfToken},success:function(a,c,b){hideLoading()}});b.item.hasClass("wflow-header")&&$(this).sortable("cancel")}}).disableSelection()};this.updateWorkFlowFormTable=function(b,e){var f=c.find("li[formName\x3d"+b.formLinkName+"]");0==f.length?(f="\x3cli formStatus\x3d'withWf' formDisplayName\x3d'"+b.formDispName+"' formName\x3d'"+b.formLinkName+"'\x3e\x3ca\x3e\x3ci class\x3d'zc-em zc-common-form'\x3e\x3c/i\x3e"+
b.formDispName+"\x3c/a\x3e\x3c/li\x3e",$("#worlflowFormlist ul").append(f),$("#worlflowFormevent ul").find("li[subType\x3dAll]").trigger("click"),a.setActiveClassForFormName(b.formLinkName),a.workFlowBuilder.formNameSort()):(a.filterNavObj.currentFormName==b.formLinkName?(a.tableRowCreation(b,e),a.showEventLi(b),a.filter(),e=d.find("[eventType\x3d'"+b.eventType+"']"),a.workFlowBuilder.isFormWfFilter||(a.filterNavObj?"All"==a.filterNavObj.currentSubEventType?$("#worlflowFormevent ul").find("li[subType\x3dAll]").trigger("click"):
void 0==a.filterNavObj.currentSubEventType?e.find("li[subType\x3d'"+b.subType+"']").find("a").trigger("click"):e.find("li[subType\x3d'"+a.filterNavObj.currentSubEventType+"']").find("a").trigger("click"):$("#worlflowFormevent ul").find("li[subType\x3dAll]").trigger("click"))):$("#worlflowFormlist ul").find("li[formName\x3d'"+b.formLinkName+"']").trigger("click"),"withOutWf"==f.attr("formStatus")&&(f.attr("formStatus","withWf"),c.find(".zc-formlist-withwf").find("ul").append(f),f=c.find(".zc-formlist-withoutwf"),
0==f.find("li").length&&f.addClass("zc-hide")),a.filterNavObj.currentFormName=b.formLinkName);a.checkDragAndDrop()};this.sortByKeyValue=function(a,c,b){return a.sort(function(a,d){if(b){if(a[c]<d[c])return-1}else if(a[c]>d[c])return-1;return 0})};this.filter=function(){var c=$("#formWorkflowTableBody table tbody tr");"All"==a.filterNavObj.currentEventName?a.reset("filter"):(a.workFlowBuilder.isFormWfFilter||$("#workflowfilterNav").addClass("expand"),c.each(function(c,b){if("true"!=$(b).attr("isEmpty")){c=
$(b).attr("eventType");var d=$(b).attr("subType").split("_")[0];a.workFlowBuilder.isFormWfFilter?$(b).show():c==a.filterNavObj.currentEventName&&d==a.filterNavObj.currentSubEventType?$(b).show():$(b).hide()}}),a.noDataView())};this.search=function(c){if(""==c)a.reset();else{var b=$("#formWorkflowTableBody table tbody");b.find("tr").hide();for(var d=0;d<a.workflowList.length;d++){var e=a.workflowList[d],f=a.creategroupName(e);a.workFlowBuilder.isFormWfFilter&&(f=e.eventType+" \x3e 0");for(var q=!1,
n=0;n<a.searchConfig.keys.length;n++){var p=e[a.searchConfig.keys[n]];p&&0<=p.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())&&(q=!0)}if(e.groupList&&!q)for(n=0;n<e.groupList.length;n++)for(var m=e.groupList[n].actionList,r=0;r<m.length;r++)(p=m[r].actionDesc)&&(p=p.subStr1+p.subStr2),p&&0<=p.toLocaleLowerCase().indexOf(c.toLocaleLowerCase())&&(q=!0);q&&(b.find("tr[headerGroupName\x3d'"+f+"']").show(),b.find("tr[ruleLinkName\x3d'"+e.ruleLinkName+"']").show())}0==$("#formWorkflowTableBody table tbody tr:visible").length?
$("#no-workflow-data").removeClass("zc-hide"):$("#no-workflow-data").addClass("zc-hide")}};this.count=function(){return $("#formWorkflowTableBody table tbody").find("tr[elename\x3dworkflowRow]").length};this.reset=function(a){$("#formWorkflowTableBody table tbody tr").each(function(a,c){"true"!=$(c).attr("isEmpty")&&$(c).show()});$("#no-workflow-data").addClass("zc-hide")};this.noDataView=function(){if("FormWf"==a.workFlowBuilder.wfState){e=$("#workflowListContainer");var b=$("#no-workflow"),d=c.find(".zc-formlist-withwf").find("li").length;
0==d&&0==a.count()?($(b).find("i").css("display","block"),$(b).find("p").removeClass("hide"),$(b).find("i[elname!\x3d"+a.workFlowBuilder.wfState+"]").css("display","none"),$(b).find("p[elname!\x3d"+a.workFlowBuilder.wfState+"]").addClass("hide"),$(b).removeClass("zc-hide"),$("#workflowfilterNav .zc-dem-worlflow-filter").hide(),$("#workflowTable").addClass("zc-hide")):0<d&&0==a.count()?($("#workflowTable").addClass("zc-hide"),$("#form-workflow-nodata-screen").removeClass("zc-hide"),$("#workflowfilterNav").removeClass("expand"),
$("#workflowfilterNav").find(".zc-dem-worlflow-leftarrow").addClass("zc-hide")):0==a.workFlowBuilder.count()?($(e).find("div[elename\x3dwfTableContainer]").css("opacity","0"),$(e).find("div[elename\x3dno-workflow]").removeClass("zc-hide"),$(e).find("div[elename\x3dno-workflow]").find('input[elename\x3d"addWorkFLowEle"]')[0].focus()):($(e).find("div[elename\x3dwfTableContainer]").css("opacity","1"),$(e).find("div[elename\x3dno-workflow]").addClass("zc-hide"),$(b).addClass("zc-hide"),$("#workflowTable").removeClass("zc-hide"),
""==e.find("input[elename\x3dcustomSearch]").val()&&$("#workflowfilterNav").find(".zc-dem-worlflow-leftarrow").removeClass("zc-hide"),$("#workflowfilterNav .zc-dem-worlflow-filter").show(),$("#form-workflow-nodata-screen").addClass("zc-hide"),$("#formWorkflowTableBody").removeClass("zc-hide"),$("#no-workflow-data").addClass("zc-hide"))}};this.initTableListener=function(c){e.find("input[elename\x3dcustomSearch]").attr("placeholder","Search for Workflows or Actions");c.off("click","input[elname\x3dstatusBtn]").on("click",
"input[elname\x3dstatusBtn]",function(c){var b=$(this),d=$(b).closest("tr[elename\x3dworkflowRow]"),e=$(b).data("zctg").status();a.workFlowBuilder.enableDisableWf({wfName:2==$(d).attr("wfType")?$(d).find("span[elename\x3dapprovalName]").attr("encodedName"):$(d).find("p[elename\x3dwfDispName]").attr("encodedName"),wfLinkName:$(d).attr("workflowname"),wfType:$(d).attr("wfType"),formLinkName:$(d).attr("formlinkName"),status:e,successCallBK:function(){e?$(b).data("zctg").active():$(b).data("zctg").deActive()},
event:c});c.stopPropagation()});c.off("click","p[elename\x3dwfDispName]").on("click","p[elename\x3dwfDispName]",function(c){var b=$(this).closest("tr[elename\x3dworkflowRow]");a.workFlowBuilder.getWorkflow({wfLinkName:$(b).attr("workflowname"),wfDispName:$(b).find("p[elename\x3dwfDispName]").find("a").text()});c.preventDefault();c.stopPropagation()});c.off("click","a[elename\x3ddeleteBtn]").on("click","a[elename\x3ddeleteBtn]",function(c){var b=$(this).closest("tr[elename\x3dworkflowRow]");a.workFlowBuilder.deleteWorkflows({wfLinkName:$(b).attr("workflowname"),
formlinkName:$(b).attr("formlinkName"),wfType:$(b).attr("wfType"),wfName:2==$(b).attr("wfType")?$(b).find("span[elename\x3dapprovalName]").attr("encodedName"):$(b).find("p[elename\x3dwfDispName]").attr("encodedName"),successCallBK:function(){$(b).remove();var c=$("#worlflowFormlist"),e=$("#formWorkflowTableBody table tbody");if(0==e.find("tr[formLinkName\x3d'"+$(b).attr("formlinkName")+"']").length){var f=c.find("li[formName\x3d'"+$(b).attr("formlinkName")+"']"),g=c.find(".zc-formlist-withoutwf").find("ul");
c=c.find(".zc-formlist-withwf").find("ul");"withWf"==f.attr("formStatus")?(f.attr("formStatus","withOutWf"),g.append(f),g.parent().removeClass("zc-hide")):(f.attr("formStatus","withWf"),c.append(f),c.parent().removeClass("zc-hide"));0==c.find("li").length?g.find("li").first().trigger("click"):c.find("li").first().trigger("click")}$("#dem-app-search-field").trigger("keyup");if(0==e.find("tr[groupName\x3d'"+$(b).attr("groupName")+"']").length){e.find("tr[headerGroupName\x3d'"+$(b).attr("groupName")+
"']").hide();e.find("tr[headerGroupName\x3d'"+$(b).attr("groupName")+"']").attr("isempty","true");e=d.find("[eventType\x3d'"+$(b).attr("eventType")+"']");if(0<$(b).attr("groupName").split("_").length){f=$(b).attr("eventtype")+"-"+$(b).attr("subtype").split("_")[0]+"-";f=$("#workflowlistnew").find("[id*\x3d'"+f+"']");var h=!1;$.each(f,function(a,c){0<$(c).find("tr:visible").length&&(h=!0)});h||(e.find("li[subType\x3d'"+$(b).attr("subType").split("_")[0]+"']").addClass("zc-hide"),d.find("li[subType\x3dAll]").trigger("click"))}else e.find("li[subType\x3d'"+
$(b).attr("subType")+"']").addClass("zc-hide"),d.find("li[subType\x3dAll]").trigger("click");0==e.find("li:visible").length&&e.addClass("zc-hide")}a.checkDragAndDrop();AccordionMenu.reinit(WorkflowBuilder.constants)}});c.stopPropagation()});c.off("click","li[elename\x3dactionEle]").on("click","li[elename\x3dactionEle]",function(c){var b=$(this).closest("tr[elename\x3dworkflowRow]");a.workFlowBuilder.triggerActionName=$(this).attr("actionLinkName");a.workFlowBuilder.getWorkflow({wfLinkName:$(b).attr("workflowname"),
wfDispName:$(b).find("p[elename\x3dwfDispName]").find("a").text()});c.stopPropagation()});$(c).off("mouseenter mouseleave").on("mouseenter mouseleave","div[elename\x3dactionContent]",function(b){var d=$(this).children(".zc-dem-dropdown-menu"),e=$(d).children(".zc-dem-menu-arrow"),f=$(d).find("li[elename\x3dactionEle], li[elename\x3dapprovalAction]"),g=1<$(f).length?!0:!1,n=$(b.target).offset(),p=g?2*$(f).outerHeight(!0):$(f).outerHeight(!0),m=n.top+$(b.target).height()+$(this).outerHeight(!0)/2+($(b.target).outerHeight(!0)-
$(b.target).height())/2-p,r=n.left+$(b.target).outerWidth(!0)+10;p=r+$(d).outerWidth(!0);var u=m+$(d).outerHeight(!0);p-51>$(window).width()&&(r-=$(d).outerWidth(!0)+$(b.target).width()+20);u+51>$(window).height()&&(p=g?4*$(f).outerHeight(!0):2*$(f).outerHeight(!0),m-=$(d).outerHeight(!0)+$(b.target).height()-p+$(this).outerHeight(!0));$(d).css({top:m,left:r,bottom:"auto",right:"auto",position:"fixed"});$(e).css({top:n.top,left:r-$(e).width(),bottom:"auto",right:"auto",position:"fixed"});b.stopPropagation();
a.workFlowBuilder.bindToolTip(c)});c.off("mouseenter","td[elename\x3ddispNameCol]").on("mouseenter","td[elename\x3ddispNameCol]",function(a){a.stopPropagation();a=$(this).find("p[elename\x3dwfDispName]");var c=a.find("a"),b=a.width(),d=c.width();b<d&&a.attr({title:c.text(),"data-title-position":"right"})});c.off("mouseleave","td[elename\x3ddispNameCol]").on("mouseleave","td[elename\x3ddispNameCol]",function(a){$(this).find("p[elename\x3dwfDispName]").removeAttr("title")})}};class WfCriteriaBuilder{constructor(b){this.config=b}loadCriteriaBuilder(b,a,c,d,e,f){let g=this;a=null==a?this.config.formLinkName:a;a="zccpn\x3d"+variable.csrfToken+"\x26formlinkname\x3d"+a;if(void 0!==c&&d){let d="wfCriteria-dataAccess"==b||"scheduleCriteria"==b?$(c).text():$(c).find("span").text();d=encodeURIComponent(d.replace(/ && /g," ZC_AND "));a=a+"\x26criteria\x3d"+d}"scheduleCriteria"==b&&(a+="\x26skipRelatedFields\x3dfalse");$.ajax({url:wfActionUtil.getWorkflowUrl()+"/loadCriteriaBuilder",
type:"POST",data:a,beforeSend:wfActionUtil.showLoadingContainer(),success:function(a,k,l){wfActionUtil.hideLoadingContainer();if("wfCriteria-dataAccess"!=b&&void 0!=c)$("#wf-slider").find("div[elename\x3d"+b+"]").removeClass("hide"),iCustomizePopup({title:d?i18n["zc.workflowbuilder.editcriteria"]:i18n["zc.workflowbuilder.addcriteria"],body:a,buttons:[{name:ZCButton.SAVECRITERIA,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",
success:function(a){return"scheduleCriteria"==b?g.saveScheduleCriteria(c,$(a.container)):g.saveCriteria(c,$(a.container),f)},failure:function(){e&&e()}}),CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW}),CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"));else{let c=$("#wf-slider").find("div[elename\x3d"+b+"]");$(c).html(a).smoothShow(300,function(){$(c).removeClass("hide")});CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});CriteriaBuilderNew.init($(c).find(".zc-rule-main"))}}})}validateActionCriteria(){let b=
!0;if("onCriteria"==$(this.config.wfEle).find("input:radio[name\x3dcriteriaOption]:checked").val()){this.CriteriaData=this.getCriteriaData($(this.config.wfEle).find("div[elename\x3dwfCriteria]"));let a=this.validateCriteria($(this.config.wfEle).find("div[elename\x3dwfCriteria]"),this.CriteriaData,this.config.formLinkName);0==this.CriteriaData?b=!1:a.flag||(b=!1)}return b}getCriteriaData(b){b=CriteriaBuilderNew.updateInput($(b).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?b+"\x26isCriteria\x3dtrue":
!1}getDataAccessCriteria(){var b=CriteriaBuilderNew.updateInput($("#dataAccessInput").find(".zc-rule-main")),a={};if(!CriteriaBuilderNew.frmSubmit)return!1;if(""!=b||0!=b){b=b.split("\x26");for(var c=0;c<b.length;c++){var d=b[c].split("\x3d");a[d[0]]=d[1].replace(/%22/g,'"')}return a}}validateCriteria(b,a,c){c="zccpn\x3d"+variable.csrfToken+"\x26formLinkName\x3d"+c+"\x26sb_tracking\x3dfalse";c=c+"\x26"+a;let d={},e=!0;$.ajax({async:!1,url:wfActionUtil.getWorkflowUrl()+"/validateCriteria",type:"POST",
data:c,success:function(a,c,h){"error"==a.status?($(b).showErrorBanner(a.errorMsg),e=!1):"success"==a.status&&($(b).prevAll("#toastShow:first").length&&$(b).prevAll("#toastShow:first").remove(),d.criteriaString=a.criteriaString)}});d.flag=e;return d}saveCriteria(b,a,c){var d=this.getCriteriaData(a),e=!0;if(0==d)return!1;let f="";f=c?this.config.workflow_details.type:this.config.wfType;var g=void 0!=$("#wf-action-container").attr("workflowname")?$("#wf-action-container").attr("workflowname"):this.config.workflow_details.ruleLinkName,
h=$(b).closest("li[elename\x3dgroupele]").attr("grouplinkname");d=d+"\x26workflowName\x3d"+g+"\x26groupName\x3d"+h+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(f);$.ajax({async:!1,url:wfActionUtil.getWorkflowUrl()+"/saveCriteria",type:"POST",data:"zccpn\x3d"+variable.csrfToken+"\x26"+d,beforeSend:wfActionUtil.showLoadingContainer(),success:function(d,f,g){wfActionUtil.hideLoadingContainer();"error"==d.status?($(a).showErrorBanner(d.errorMsg),e=!1):c?c(d.criteriaString):
($(b).attr("elename","criteria").html(""),$(b).html($("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+"  ")),$(b).append($("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(d.criteriaString)),d=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus"),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename",
"delCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-drag-icon zc-em zc-wb-rearrange")),$(b).append(d),$(b).closest("li[elename\x3dgroupele]").attr("class","wb-condition"),this.registerCriteriaEvents(b))}});return e}saveScheduleCriteria(b,a){var c=_self.getCriteriaData(a),d=!0;if(0==c)return!1;var e=$("#wf-action-container").attr("workflowname");b=$(b).closest("li[elename\x3dgroupele]").attr("grouplinkname");$.ajax({async:!1,url:_self.workflowUrl+"/getCriteriaString",
type:"POST",data:"zccpn\x3d"+_self.constants.csrfToken+"\x26"+(c+"\x26workflowName\x3d"+e+"\x26groupName\x3d"+b),beforeSend:showLoading(),success:function(c,b,e){hideLoading();"error"==c.status?($(a).showErrorBanner(c.errorMsg),d=!1):(b=$("\x3cdiv\x3e\x3c/div\x3e").attr("class","zc-dem-clearfix zc-approval-criteria-add-edit").attr("elename","scheduleCriteria").attr("criteria","true"),c=$("\x3ca\x3e\x3c/a\x3e").text(c.criteriaStr),$(b).append(c),$(b).off("click").on("click",function(){_self.registerScheduleCriteriaEvents(this)}),
$("#workflowProperties").find("div[elename\x3dscheduleCriteria]").replaceWith(b))}});return d}registerCriteriaEvents(b){let a=this;$(b).find("span[elename\x3daddCriteria]").on("click",function(){a.loadCriteriaBuilder("wfCriteria",null,$(this).closest("div[elename\x3dnocriteria]"),!1)});$(b).find("span[elename\x3deditCriteria]").on("click",function(){a.loadCriteriaBuilder("wfCriteria",null,$(this).closest("div[elename\x3dcriteria]"),!0)});$(b).find("span[elename\x3ddelCriteria]").on("click",function(){var c=
$(this),b=$("#wf-action-container").attr("workflowname"),e=$(c).closest("li[elename\x3dgroupele]").attr("grouplinkname");iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeletecriteria"],success:function(){$.ajax({url:a.workflowUrl+"/deleteCriteria",type:"POST",data:"zccpn\x3d"+a.constants.csrfToken+"\x26workflowName\x3d"+b+"\x26groupName\x3d"+e+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(a.wfMeta.wfType),beforeSend:showLoading(),
success:function(b,d,e){hideLoading();if(0==$(c).closest("li[elename\x3dgroupele]").find("li[elename\x3dtaskele]").length)$(c).closest("li[elename\x3dgroupele]").remove(),$(c).closest("ul[elename\x3dwb-blockList]").find("li[elename\x3dgroupele]");else{b=$(c).closest("div[elename\x3dcriteria]").attr("elename","nocriteria");d=$("\x3cstrong\x3e\x3c/strong\x3e").html(i18n["zc.workflowbuilder.executewithoutcondition"]);e=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus");var f=$("\x3cspan\x3e\x3c/span\x3e").attr("class",
"wb-action-icon zc-em  zc-common-pencil").attr("elename","addCriteria");$(e).append(f);$(b).html("").append(d).append(e);$(b).closest("li[elename\x3dgroupele]").attr("class","wb-action");a.registerCriteriaEvents(b)}}})}})})}}
WorkflowActionSlider=function(b){var a=this;a.isSaved=!0;a.constants=variable;a.appUrl="/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName;a.workflowUrl="/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName+"/workflowbuilder/edit";a.wfType=b.wfType;a.eventType=b.eventType;a.subEventType=b.subEventType;a.wfLinkName=b.wfLinkName;a.formLinkName=b.formLinkName;a.formDispName=b.formDispName;a.groupName=b.groupName;a.taskLinkName=b.taskLinkName;a.isEdit=void 0!==b.taskLinkName?!0:
!1;a.CriteriaData="";a.messageBox=null;a.workflowId=b.workflowId;a.delugeEditor;a.actionType;a.isWorkflowV2Enabled=b.isWorklfowV2;a.wfMeta=b.wfMeta;a.actionCallBk=void 0==b.ActionCallBk?WorkflowBuilder.callBkFunctions:b.ActionCallBk;a.criteriaBuilder=new WfCriteriaBuilder(b);a.formFields=b.formFields;a.beforeCloseWfslider=b.beforeCloseWfslider;a.sliderResp=b.response;this.init=function(){var c=function(){ziaDisableShortcut();if(0<$(b.taskele).length||0==$(b.taskele).length&&1==b.criteriaLen||a.wfType==
Constants.DATE_SCHEDULE_WF||a.wfType==Constants.PRE_ONCOMMIT_WF)$("#wf-slider").find("div[elename\x3dconditionBlock]").addClass("hide"),$("#wf-slider").find(".zc-wfb-action-type").addClass("zc-wfb-wl-newaction");"Email_Notification"==a.taskLinkName&&a.handleUnverifiedAdminEmail();a.wfActionEle=$("#wf-slider");a.widthAdjustEle=a.wfActionEle;var c=$(a.wfActionEle).find("#div-freeflow-editarea");0==c.length&&($(a.wfActionEle).append($("\x3cdiv/\x3e").attr("id","div-freeflow-editarea")),c=$(a.wfActionEle).find("#div-freeflow-editarea"));
var d={metadata:{appLinkName:a.constants.appLinkName,formLinkName:a.formLinkName},sharedBy:a.constants.scopeName,script:"",restriction:DelugeEditorWrapper.prototype.getRestrictedEntries(DELUGE_ACTION_MAP.onsuccess),connectionUrl:a.appUrl+"/workflow/"+a.wfLinkName+"/action/"+a.taskLinkName+"/connection/references"};a.delugeEditor=initializeDelugeEditor($(c).get(0),d);c="true"==$("#wf-slider").find("input[name\x3disConnectionReferenced]").val()?"show":"hide";a.delugeEditor.updateTopBarMenu([{label:i18n["zc.c5.setup.connections.title"],
action:c}]);a.enterListenerForFocusElement();a.delugeEditor.resize();a.registerEvents();!a.isEdit&&(a.isWorkflowV2Enabled&&a.subEventType==Constants.AUTOMATION||a.isWorkflowV2Enabled&&a.scriptOnlyWorkflow())?($("#fieldAction").removeClass("hide"),$(a.wfActionEle).find("div[eleName\x3dstepOne]").addClass("compact"),a.subEventType==Constants.AUTOMATION?($(a.wfActionEle).find("div[name\x3dfieldAction]").trigger("click"),$(a.wfActionEle).find("input[name\x3dactionType]").val("fieldAction")):$(a.wfActionEle).find("input[name\x3dactionType]").val("customProcess"),
a.skipStepOne(),$("#wf-slider").addClass("zc-wfb-newfield-action"),$(a.wfActionEle).find(".zc-wfb-criteriav1").remove(),a.scriptOnlyWorkflow()&&($(a.wfActionEle).find("#customProcess").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dcustomProcess]").removeClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").removeClass("hide"),c=""==a.wfMeta.formComp?void 0:a.wfMeta.formComp,a.displayCustomWorkflowBuilder($(a.wfActionEle).find("#div-freeflow-editarea"),void 0,c))):($("#fieldAction .zc-wfb-criteriav2").remove(),
setTimeout(function(){$("#always").focus();$("#always").prop("checked",!0)},200))},d=function(){if(a.isDelugeTask()&&!a.delugeEditor.isEditorContentModified()||!a.isDelugeTask()&&a.isSaved)return a.beforeCloseWfslider(),!0;iConfirm({title:i18n["zc.workflowbuilder.unsavedchanges"],message:i18n["zc.workflowbuilder.changeslost"],button:ZCButton.CLOSE,cbutton:ZCButton.CANCEL,success:function(){a.beforeCloseWfslider();f.closeModal()}})},e=function(c){DelugeEvents.destroy(a.delugeEditor);$(c.slider).remove();
ziaEnableShortcut();a.wfActionEventDestroy()};if(a.wfType!=Constants.APPROVAL_WF)var f=$(a.sliderResp).find("#wf-slider").iSlide({afterOpen:c,beforeClose:d,afterClose:e});else c()};this.skipStepOne=function(){$("#temp-header").removeClass("hide");$("#org-header").addClass("hide")};this.removeFreezeLayer=function(){$("#zc-dem-container").find(".zc-dem-freeze-layer-wb").remove()};this.scriptOnlyWorkflow=function(){return a.isWorkflowV2Enabled&&a.wfType==Constants.FORM_WF&&a.subEventType!=Constants.AUTOMATION&&
a.subEventType!=Constants.ONSUCCESS};this.enterListenerForFocusElement=function(){$(document).off("keydown.actionNavigator").on("keydown.actionNavigator",function(a){13!=(a.keyCode?a.keyCode:a.which)||"actionCategoryBox"!=$(a.target).attr("elename")&&"actionTypeBox"!=$(a.target).attr("elename")||$(document.activeElement).trigger("click")})};this.arrowListenerForActioncategoryBox=function(){$(document).off("keydown.actionNavigator").on("keydown.actionNavigator",function(c){var b=c.keyCode?c.keyCode:
c.which,e="visible"==$(a.delugeEditor.delugeArea).find(".CodeMirror-cursors").css("visibility"),f=0<$(a.delugeEditor.delugeArea).find(".deluge-expr-layered-builder-active").length;e||f||(a.isDelugeTask()&&a.delugeEditor.isEditorContentModified()&&$("div[popuptype\x3d'iConfirm']"),13==b&&"actionTypeBox"==$(c.target).attr("elename")?a.keyDownActions.selectCurrentElement():39==b?a.keyDownActions.selectNextElement():37==b&&a.keyDownActions.selectPreviousElement())})};this.keyDownActions={selectCurrentElement:function(){$(document.activeElement).trigger("click")},
selectNextElement:function(){var c=a.currentElement.next();"actionCategoryBox"==c.attr("elename")&&setTimeout(function(){c.trigger("click")},200)},selectPreviousElement:function(){var c=a.currentElement.prev();"actionCategoryBox"==c.attr("elename")&&setTimeout(function(){c.trigger("click")},200)}};this.wfActionEventDestroy=function(){$(document).off("keydown.actionNavigator")};this.delugeEditorValidation=function(){return new Promise(function(c,b){var d=!0;a.isDelugeTask()&&a.delugeEditor.isEditorContentModified()&&
(iConfirm({title:i18n["zc.workflowbuilder.unsavedchanges"],message:i18n["zc.workflowbuilder.changeslost"],button:ZCButton.CLOSE,cbutton:ZCButton.CANCEL,success:function(){d=!1}}),c(d))})};this.registerEvents=function(){$(a.wfActionEle).on("keyup change","input, select, textarea",function(c){c=c.keyCode?c.keyCode:c.which;9!=c&&37!=c&&39!=c&&(a.isSaved=!1)});a.wfType!=Constants.APPROVAL_WF&&($(a.wfActionEle).find(".wb-save-button").on("click",function(){$(this).prop("disabled",!0);a.isDelugeTask()?
a.delugeEditor.editor.saveScript():a.processSaveAction()}),$(a.wfActionEle).find(".wb-cancel-button").on("click",function(){$(a.wfActionEle).find("a[elename\x3ddefaultClose]").trigger("click")}),$(a.wfActionEle).find(".wb-execute-button").on("click",function(c){c.preventDefault();a.executeSchedule()}));$(a.wfActionEle).find("input:radio[name\x3dcriteriaOption]").on("change",function(){"onCriteria"===this.value?a.criteriaBuilder.loadCriteriaBuilder("wfCriteria"):($(a.wfActionEle).find("div[elename\x3dwfCriteria]").smoothHide(300,
function(){$(a.wfActionEle).find("div[elename\x3dwfCriteria]").addClass("hide")}),a.CriteriaData="")});$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").on("click",function(){a.currentElement=$(this);var c=$(this).attr("name");a.actionType=c;"fieldAction"==c&&($(a.wfActionEle).find(".zc-wfb-subform-field-actions").addClass("hide"),$(a.wfActionEle).find(".zc-wfb-default-field-actions").removeClass("hide"));var b=$(this).attr("isMainOption");$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display",
"none");if(a.validateActionCriteria()){if(6>$("#wf-slider").find("div[elename\x3dactionTypeContainer] \x3e div[elename\x3dactionCategoryBox],div[elename\x3deachOption]").length+$(a.wfActionEle).find("#moreOptionsList \x3e div").length)$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").attr("isMainOption","true"),$(a.wfActionEle).find("div[elename\x3dmoreOption]").css("display","none");else{if("eachOption"==$(this).attr("elename")){$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display",
"none");var e=$(a.wfActionEle).find("div[name\x3d"+c+"]");b=$("#dynamicOption");$(e).attr("elename","actionCategoryBox");$(e).attr("isMainOption","true");$(e).attr("id","dynamicOption");$("#staticOption").after(e);e=$(a.wfActionEle).find("div[elename\x3dmoreOptionList]");$(b).attr("elename","eachOption");$(b).attr("id","eachOption");$(b).attr("isMainOption","false");$(e).append(b)}else"true"==b?(b=$(a.wfActionEle).find("div[isMainOption\x3dfalse]"),e=$(a.wfActionEle).find("div[elename\x3dmoreOptionList]"),
$(b).attr("elename","eachOption"),$(e).append(b)):(e=$(a.wfActionEle).find("div[name\x3d"+c+"]"),b=$("#dynamicOption"),$(e).attr("id","dynamicOption"),$(e).attr("isMainOption","true"),$("#staticOption").after(e),e=$(a.wfActionEle).find("div[elename\x3dmoreOptionList]"),$(b).attr("id","eachOption"),$(b).attr("isMainOption","false"),$(b).attr("elename","eachOption"),$(e).append(b));$(a.wfActionEle).find("div[elename\x3dmoreOption]").removeAttr("style")}$(a.wfActionEle).find("div[elename\x3dmoreOption]").off("click").on("click",
function(){"none"==$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display")?$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display","block"):$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display","none")});$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").removeClass("selected");$(this).addClass("selected");$(a.wfActionEle).find("div[eleName\x3dstepOne]").addClass("compact");$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").removeAttr("tabindex");
$(a.wfActionEle).find("div[elename\x3dwfCriteria]").css("display","none");$(a.wfActionEle).find("input[name\x3dactionType]").val(c);$(a.wfActionEle).find("div[elename\x3dactionCategory]").addClass("hide");$(a.wfActionEle).find("#"+c).removeClass("hide");a.wfType==Constants.CUSTOM_WF||a.wfType==Constants.FORM_WF&&!a.isNewFormWF()||("customProcess"===c?($(a.wfActionEle).find("#customProcess").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dcustomProcess]").removeClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").removeClass("hide"),
a.displayCustomWorkflowBuilder($(a.wfActionEle).find("#div-freeflow-editarea")),$(a.widthAdjustEle).animate({width:"90%"})):($(a.wfActionEle).find("div[elename\x3dcustomProcess]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide"),$(a.widthAdjustEle).animate({width:"840px"},300)),a.arrowListenerForActioncategoryBox());a.isWorkflowV2Enabled||a.arrowListenerForActioncategoryBox()}});$(a.wfActionEle).find("div[elename\x3dsubformfield-actions]").on("click",function(){$("#temp-header .subformField").removeClass("zc-hide");
$(a.wfActionEle).find(".zc-wfb-default-field-actions").addClass("hide");$(a.wfActionEle).find(".zc-wfb-subform-field-actions").removeClass("hide")});$("#temp-header .subformField").on("click",function(){$("#temp-header .subformField").addClass("zc-hide");$(a.wfActionEle).find(".zc-wfb-default-field-actions").removeClass("hide");$(a.wfActionEle).find(".zc-wfb-subform-field-actions").addClass("hide")});$(a.wfActionEle).find("div[elename\x3dactionTypeBox]").on("click",function(){if(a.validateActionCriteria()&&
($(document).off("keydown"),!$(a.wfActionEle).find("div[eletype\x3dstepThree][elename\x3d"+a.actionType+"]").isVisible())){"EmailConfig"==$(this).attr("name")&&a.handleUnverifiedAdminEmail();$(this).addClass("selected");$(this).find(".zc-common-info-alt").removeClass("zc-hide");$(a.wfActionEle).find("div[eletype\x3dstepThree]").addClass("hide");var c=$(this).closest("div[elename\x3dactionCategory]").attr("id");$(a.wfActionEle).find("div[elename\x3d"+c+"][eletype\x3dstepThree]").removeClass("hide");
$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display","none");$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").removeClass("hide");var b=$(a.wfActionEle).find("div[elename\x3d"+c+"][eletype\x3dstepThree]");$(this).attr("action");if("fieldAction"==c||"alertAction"==c){var e=$(this).attr("name");if("EmailConfig"==e&&ZCGlobal.isOnPremiseVersion&&!SMTPChecker.isMailSettingsConfigured())return;$(a.wfActionEle).find("div[elename\x3daction-config]").addClass("hide");$(a.wfActionEle).find("#"+
e).removeClass("hide");$("#fieldAction .zc-wfb-criteriav2").hide();"fieldConfig"==e?(c=$(this).attr("value"),$(a.wfActionEle).find("#fieldConfig").find(".zc-dem-form-group").addClass("zc-hide"),c=c==WorkflowConstants.HIDE_FIELD||c==WorkflowConstants.SHOW_FIELD?"showHideField":c==WorkflowConstants.ENABLE_FIELD||c==WorkflowConstants.DISABLE_FIELD?"enableDisableField":"showHideSubformEntry",$(a.wfActionEle).find("#fieldConfig").find("div[elename\x3d"+c+"]").removeClass("zc-hide"),$(a.wfActionEle).find("#fieldConfig").find("input[elename\x3dsearchfield]").removeAttr("name"),
$(a.wfActionEle).find("#fieldConfig").find("div[elename\x3d"+c+"]").find("input[elename\x3dsearchfield]").attr("name","actionFields"),$(a.wfActionEle).find("#"+$(this).attr("name")).find(":input[name\x3dtaskType]").val($(this).attr("value"))):"scriptAction"==e&&($(a.wfActionEle).find("div[elename\x3d"+c+"][eletype\x3dstepThree]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide"),c=$(a.wfActionEle).find("div[elename\x3dform-customProcess]"),$(c).attr("origin",
"fieldAction").removeClass("hide"),$(c).find("div[type\x3dcompAction]").addClass("hide"),$(c).find("div[elename\x3d"+$(this).attr("customprocesstype")+"]").removeClass("hide"),$(c).find("input[name\x3dscripttype]").val($(this).attr("id")),c=$(a.wfActionEle).find("#customProcess"),$(c).find("div[elename\x3dactionTypeBox]").attr("flag",!1),$(c).find("#"+$(this).attr("id")).attr("flag",!0));"SMSConfig"==e&&(e=$(a.wfActionEle).find("div[id\x3dSMSConfig][elename\x3daction-config]"),0<$(a.wfActionEle).find("select[name\x3dconnectionId] option").not(".zc-dd-dummy-opt").length?
($(e).find("#no-connection").hide(),$(e).find("#connection-listing-container").show()):($(e).find("#no-connection").show(),$(e).find("#connection-listing-container").hide()))}else if("integAction"==c){e=$(a.wfActionEle).find("div[elename\x3dintegAction][eletype\x3dstepThree]");c=$(this).attr("value");var f=$(this).attr("serviceVersionLinkName"),g=$(this).attr("serviceLinkName");$(e).find("input[name\x3dserviceName]").val(c);$(e).find("input[name\x3dconnectorLinkName]").val(f);e={mainEl:e,sharedByDisp:a.constants.scopeName,
csrfParamName:WorkflowBuilder.constants.csrfParam,csrfToken:WorkflowBuilder.constants.csrfToken,serviceVersionLinkName:f,serviceLinkName:g,formLinkName:a.formLinkName,workflowBuilder:WorkflowBuilder,isEdit:!1};ZCIntegWorkflowContext.getInstance().init(e)}else"dataAccess"==c?(e=$(this).attr("value"),$(a.wfActionEle).find("#dataAccessInput").find(":input[name\x3dtaskType]").val(e),c=$(a.wfActionEle).find("#dataAccessInput").find("div[elename\x3dselectForm]"),20==e?$(c).find("select").find("option").removeClass("hide"):
$(c).find("select").find("option[isThirdPartyFrm\x3dtrue]").addClass("hide"),$(c).find("select").zcDropDown(),$(c).find("select[name\x3dselectForm]").select2("val","select"),$(a.wfActionEle).find("div[elename\x3daction-config]").addClass("hide"),a.dataAccessObj.hideUnrelatedContainers(parseInt(e),!1)):"customProcess"==c&&($(this).find(".zc-wfb-customprocess-desc").find("a").first().attr("href",a.appUrl+"/formbuilder/"+a.formLinkName+"/edit"),$(a.wfActionEle).find("div[elename\x3dform-customProcess]").find("input[name\x3dscripttype]").val($(this).attr("id")),
$(this).siblings().attr("flag",!1),$(this).attr("flag",!0),e=$(this).attr("customprocesstype"),"formAction"==e||"customAction"==e?a.displayCustomWorkflowBuilder($(a.wfActionEle).find("#div-freeflow-editarea")):"fieldInputAction"==e||"fieldUpdateAction"==e||"subFormAction"==e?($(a.wfActionEle).find("div[elename\x3dcustomProcess][eletype\x3dstepThree]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide"),c=$(a.wfActionEle).find("div[elename\x3dform-customProcess]"),
$(c).attr("origin","customProcess").removeClass("hide"),$(c).find("div[type\x3dcompAction]").addClass("hide"),$(c).find("div[elename\x3d"+e+"]").removeClass("hide"),b=c):"customFunction"==e&&($(a.wfActionEle).find("div[elename\x3dcustomProcess][eletype\x3dstepThree]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dcustomFunction][eletype\x3dstepThree]").removeClass("hide"),e=$(a.wfActionEle).find("div[elename\x3dcustomFunction][eletype\x3dstepThree]").find("select[name\x3dapplicationId]").val(),
a.getNamespaceforApp(e)));$(this).closest("div[elename\x3dactionCategory]").addClass("compact");$(a.wfActionEle).find("div[elename\x3dstepOne]").addClass("suboption-selected");a.setDefaultFocus(b)}});$(a.wfActionEle).find("div[elename\x3dform-customProcess]").find("select[name\x3dformCompSelect], input[name\x3dformCompSelect]").on("change",function(){var c=$(this).val();if("select"==c)iAlert(i18n["zc.workflowbuilder.onuserinputvalidate"]);else{var b=$(a.wfActionEle).find("div[elename\x3dform-customProcess]"),
e=$(this).closest("div[elename\x3dform-customProcess]").find("input[name\x3dscripttype]").val(),f=c,g=$("#customProcess").find("#"+e),h=g.find(".zc-wfb-customprocess-name").html();g=g.find(".zc-wfb-customprocess-desc").html();if("onuserinput"==e||"onupdate"==e)e=$(this).data("zcdd").getData().text,g=g.replace("ZC_FIELD_NAME",escapeHTML(e)),f=2==c.split(".").length?c.split(".")[0]:void 0;$(b).find(".zc-wfb-customhead").html(h);$(b).find(".zc-wfb-customhead-desc").html(g);$(b).find("input[name\x3dformCompName]").val(c);
$(a.wfActionEle).find("#"+$(b).attr("origin")).addClass("customprocess-suboption-selected");$(b).addClass("customprocess-compact");$(b).find("div[elename\x3dcustomheader]").removeClass("hide");$(a.wfActionEle).find("div[elename\x3dcustomProcess][eletype\x3dstepThree]").removeClass("hide");$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").removeClass("hide");"fieldAction"==$(b).attr("origin")&&$(a.wfActionEle).find("input[name\x3dactionType]").val("customProcess");a.displayCustomWorkflowBuilder($(a.wfActionEle).find("#div-freeflow-editarea"),
void 0,f)}});$(a.wfActionEle).find("a[elename\x3dback-to-stepthree]").on("click",function(){var c=$(a.wfActionEle).find("div[elename\x3dform-customProcess]");$(a.wfActionEle).find("#"+$(c).attr("origin")).removeClass("customprocess-suboption-selected");$(c).removeClass("customprocess-compact");$(c).find("div[elename\x3dcustomheader]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dcustomProcess][eletype\x3dstepThree]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide");
$(a.widthAdjustEle).animate({width:"840px"},300);"fieldAction"==$(c).attr("origin")&&$(a.wfActionEle).find("input[name\x3dactionType]").val("fieldAction");a.removeHeaderText()});$(a.wfActionEle).find("a[elename\x3dback-to-steptwo]").on("click",function(){$(a.wfActionEle).find("div[eletype\x3dstepThree]:visible").clearError();$(a.wfActionEle).find("div[eletype\x3dstepThree]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dactionTypeBox]").removeClass("selected");
$(a.wfActionEle).find("div[elename\x3dactionTypeBox]").find(".zc-common-info-alt").addClass("zc-hide");$(a.wfActionEle).find("div[elename\x3dactionCategory]").removeClass("compact");$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").attr("tabindex","1");$(a.wfActionEle).find("div[elename\x3dstepOne]").removeClass("suboption-selected");"customprocess"==$(this).attr("type")&&$(a.widthAdjustEle).animate({width:"840px"},300);DelugeEvents.destroy(a.delugeEditor);a.arrowListenerForActioncategoryBox();
$("#fieldAction .zc-wfb-criteriav2").show();a.removeHeaderText();$("#wf-slider").removeClass("zc-wfb-deluge-slider")});$(a.wfActionEle).find("a[elename\x3dback-to-stepone]").on("click",function(){$(a.wfActionEle).find("div[id\x3ddynamicOption]");$(a.wfActionEle).find("div[elename\x3dactionTypeContainer]");var c=$(a.wfActionEle).find("div[elename\x3deachOption]");"integAction"==$(c).attr("name")?$("#staticOption").after(c):$("#dynamicOption").after(c);$(a.wfActionEle).find("div[elename\x3dmoreOption]").css("display",
"none");$(a.wfActionEle).find("div[elename\x3dmoreOptionList]").css("display","none");$(a.wfActionEle).find("div[isMainOption\x3dfalse]").removeAttr("style");$(a.wfActionEle).find("div[elename\x3dactionCategory]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dactionCategoryBox]").removeClass("selected");$(a.wfActionEle).find("div[eleName\x3dstepOne]").removeClass("compact");"onCriteria"==$(a.wfActionEle).find("input:radio[name\x3dcriteriaOption]:checked").val()&&$(a.wfActionEle).find("div[elename\x3dwfCriteria]").css("display",
"block");a.wfType==Constants.CUSTOM_WF||a.wfType==Constants.FORM_WF&&!a.isNewFormWF()||($(a.widthAdjustEle).animate({width:"840px"},300),$(a.wfActionEle).find("div[elename\x3dcustomProcess]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").addClass("hide"));a.enterListenerForFocusElement();a.removeHeaderText()});a.customActionBind();a.customProcessBind();a.fieldActionBind();a.dataAccessObj=new dataAccessBind(a,$(a.wfActionEle).find("div[elename\x3ddataAccess]"));a.dataAccessObj.registerEvents();
a.Select2Bind();(new Alerts(a)).registerEvents(a.wfType);a.isEdit&&(a.loadActions(),a.setDefaultFocus())};this.customActionBind=function(){var c=$(a.wfActionEle).find("div[elename\x3dcustomFunction][eletype\x3dstepThree]");$(c).find("#appId").on("change",function(){a.getNamespaceforApp(this.value)});$(c).find("#namespace").on("change",function(){var b=$(c).find("#appId").find(":selected").val();a.getFunctionforNameSpace(b,this.value)});$(c).find("#fnName").on("change",function(){var b=$(c).find("#appId").find(":selected").val(),
d=$(c).find("#namespace").find(":selected").val();a.getArgumentforFunction(b,d,this.value)});$(c).find("#editfunctionid").on("click",function(){var a={};a.applicationId=$(c).find("#appId").find(":selected").val();a.functionId=$(c).find("#fnName").find(":selected").val();b(!0,a)});$(c).find("#newFunction, #createfunctionid").on("click",function(){b(!1)});var b=function(b,d){var e=$("\x3cdiv\x3e\x3c/div\x3e").attr("elename","functionSlider").attr("class","zc-dem-freeze-layer");$(a.wfActionEle).append(e);
e={zccpn:a.constants.csrfToken};b=!1;d?($.extend(e,d),b=!0):(e.workflowLinkname=a.wfLinkName,e.formLinkName=a.formLinkName,e.eventType=a.eventType,e.applicationId=$(c).find("#appId").find(":selected").val(),e.namespace=$(c).find("#namespace").find(":selected").val());$.ajax({url:"/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName+"/workflowbuilder/edit/getFunction",type:"POST",data:e,beforeSend:$(a.wfActionEle).showLoading(),success:function(c,e,f){$(a.wfActionEle).hideLoading();$(a.wfActionEle).find("#functionMeta").remove();
$(a.wfActionEle).append(c);$(a.wfActionEle).find("#wfFunction").removeClass("hide");$(a.wfActionEle).find("#sliderElem").attr("class","zc-dem-right-popup zc-dem-btn-popup zc-dem-box-sizing zc-wfb-add-newfunc zc-dem-freeze-content active");b&&$(a.wfActionEle).find("#wfFunction").find("input[elename\x3dsaveFunction]").val(i18n["zc.workflowbuilder.updatefunction"]);c=$(a.wfActionEle).find("#wfFunction").find("#div-freeflow-editarea-function");f=$(a.wfActionEle).find("#functionMeta").find("input[elename\x3dfunctionScript]").val();
e=$(a.wfActionEle).find("#functionMeta").find("input[elename\x3disConnectionReferenced]").val();$(c).show();f={script:void 0!=f?f:"",restriction:DelugeEditorWrapper.prototype.getRestrictedEntries(DELUGE_ACTION_MAP.functions),execute:a.executeFunction,sharedBy:a.constants.scopeName,metadata:{appLinkName:a.constants.appLinkName}};void 0!=d&&(f.workflow={componentType:"Function",workflowId:d.functionId,actionType:0},f.connectionUrl=appbuilder.component.APP.getAppEditUrl()+"/customFunction/"+d.functionId+
"/connection/references");a.functionDelugeEditor=initializeDelugeEditor($(c).get(0),f);a.functionDelugeEditor.updateTopBarMenu([{label:i18n["zc.c5.setup.connections.title"],action:"true"==e?"show":"hide"}]);a.functionActionsBind();DelugeEditorWrapper.prototype.saveScript=function(){$(a.wfActionEle).find("#wfFunction").find("input[elename\x3dsaveFunction]").trigger("click")}}})}};this.validateActionCriteria=function(){var c=!0;"onCriteria"==$(a.wfActionEle).find("input:radio[name\x3dcriteriaOption]:checked").val()&&
(a.CriteriaData=a.criteriaBuilder.getCriteriaData($(a.wfActionEle).find("div[elename\x3dwfCriteria]")),0==a.CriteriaData?c=!1:a.criteriaBuilder.validateCriteria($(a.wfActionEle).find("div[elename\x3dwfCriteria]"),a.CriteriaData,a.formLinkName).flag||(c=!1));return c};this.validateFuncExe=function(c){var b=!0;if($("#fnName").find("option").length){if(9==a.eventType||"9"==a.eventType)c=$(c).find("#argumentli").find("input[id\x3dargField]"),b="NVIEW"==$(c).attr("datatype")&&1==$(c).length?!0:!1;b||$("#fnName").showError(i18n["zc.reportedit.customactions.pleaseselectfunction"])}else iAlert(i18n["zc.reportedit.customactions.createfunction"]),
b=!1;return b};this.getNamespaceforApp=function(c,b,e,f){var d={scripttype:"loadnamespaces"};d.appid=c;$.ajax({url:"/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName+"/workflowbuilder/edit/getFuncDetails",type:"GET",data:d,beforeSend:$("#appId").showMiniLoader(),success:function(d,g,l){$("#appId").hideMiniLoader();g=[];g=d;var h=$("#nameSpaceEl").find("select[id\x3dnamespace]").empty();void 0!=$(h).data("zcdd")&&$(h).data("zcdd").destroy();0==g.length?($("#createNewFunctionEl").show(),
$("#nameSpaceEl").hide(),$("#functionEl").hide(),$("#argumentli").hide()):($("#createNewFunctionEl").hide(),$("#nameSpaceEl").show(),$("#functionEl").show(),$.each(g,function(a,c){0==a&&void 0==b?(b=c,$("\x3coption /\x3e",{value:c,selected:!0,text:c}).appendTo(h)):b&&b==c?$("\x3coption /\x3e",{value:c,selected:!0,text:c}).appendTo(h):$("\x3coption /\x3e",{value:c,text:c}).appendTo(h)}),$(h).zcDropDown(),a.getFunctionforNameSpace(c,b,e,f))}})};this.getFunctionforNameSpace=function(c,b,e,f){var d={};
d.appid=c;d.nameSpace=b;d.scripttype="loadfunctions";d.formlinkname=a.formLinkName;$.ajax({url:"/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName+"/workflowbuilder/edit/getFuncDetails",type:"GET",data:d,beforeSend:$("#nameSpaceEl").find("select[id\x3dnamespace]").showMiniLoader(),success:function(d,g,l){$("#nameSpaceEl").find("select[id\x3dnamespace]").hideMiniLoader();g=[];g=d;var h=$("#functionEl").find("select[id\x3dfnName]").empty();void 0!=$(h).data("zcdd")&&$(h).data("zcdd").destroy();
g.length?($("#createNewFunctionEl").hide(),$("#functionEl").show(),$.each(g,function(a,c){0==a&&void 0==e?(e=c.funcID,$("\x3coption /\x3e",{value:c.funcID,selected:!0,text:c.funcName,workflowid:c.funcID}).appendTo(h)):e&&e==c.funcID?$("\x3coption /\x3e",{value:c.funcID,selected:!0,text:c.funcName,workflowid:c.funcID}).appendTo(h):$("\x3coption /\x3e",{value:c.funcID,text:c.funcName,workflowid:c.funcID}).appendTo(h)}),$(h).zcDropDown(),a.getArgumentforFunction(c,b,e,f)):($("#createNewFunctionEl").show(),
$("#functionEl").hide(),$("#argumentli").hide())}})};this.getArgumentforFunction=function(c,b,e,f){void 0==f&&(f=[]);var d={scripttype:"loadfunctionargs"};d.appid=c;d.nameSpace=b;d.functionID=e;$.ajax({url:"/appbuilder/"+a.constants.scopeName+"/"+a.constants.appLinkName+"/workflowbuilder/edit/getFuncDetails",type:"GET",beforeSend:$("#functionEl").find("select[id\x3dfnName]").showMiniLoader(),data:d,success:function(c,b,d){$("#functionEl").find("select[id\x3dfnName]").hideMiniLoader();$("#argumentli").find("#fieldgroup").empty();
if(0!=c.length)for($("#argumentli").show(),b=0;b<c.length;b++){d=c[b];var e='\x3cdiv class\x3d"zc-wfb-setfield-template zc-dem-clearfix"\x3e\x3cdiv class\x3d"zc-dem-field-group"\x3e\x3cinput type\x3d"text" elename\x3d"argName" class\x3d"zc-dem-field zc-dem-input zc-dem-box-sizing" value\x3d"'+d.paramName+'" disabled\x3d""\x3e\x3c/div\x3e\x3cdiv class\x3d"zc-dem-field-group zc-dem-selectbox"\x3e\x3cinput class\x3d"zc-dem-field zc-dem-select zc-dem-box-sizing zc-dem-border-radius-0" name\x3d"argumentList" id\x3d"argField" seqid\x3d"'+
d.seqid+'" argType\x3d"'+d.type+'" datatype\x3d"'+d.dataType+'" placeholder\x3d"Select Field"\x3e\x3c/div\x3e\x3c/div\x3e';$("#fieldgroup").append(e);e=$("#fieldgroup").find("input[id\x3dargField][seqid\x3d"+d.seqid+"]");$(e).val(f[d.seqid]);a.constructArgOptions(d,e)}else $("#argumentli").hide()}})};this.constructArgOptions=function(c,b){var d=[],f=[],g=[],h=[Constants.PLAIN_TEXT,Constants.FILE_UPLOAD,Constants.IMAGE,Constants.AUDIO,Constants.VIDEO,Constants.SIGNATURE,Constants.SECTION,Constants.ANNOTATION],
k=["subform"];$.each(a.formFields,function(a,b){if(0<=$.inArray(b.compType,h)||0<=$.inArray(b.fieldType,k))return!0;a={};if("NVIEW"==c.dataType&&"ID"==b.linkName)return d.push({id:b.linkName,text:c.type+" [FORM OBJECT]",value:b.linkName}),!1;if(b.dataType==c.dataType||b.dataType&&"LIST"==c.dataType.toUpperCase()&&-1!=b.dataType.indexOf("LIST")||b.dataType&&c.dataType.toUpperCase()==b.dataType)if(a={id:b.linkName,text:b.dispName,value:b.linkName},b.hasOwnProperty("compFields")){var e=[];$.each(b.compFields,
function(a,b){b.dataType==c.dataType&&e.push({id:b.linkName,text:b.dispName,value:b.linkName})});a={text:b.dispName,children:e}}else a={id:b.linkName,text:b.dispName,value:b.linkName};$.isEmptyObject(a)||("Form Fields"==b.category?f.push(a):g.push(a))});0<g.length&&d.push({text:i18n["zc.formedit.form.systemfields"],children:g});0<f.length&&d.push({text:i18n["zc.formedit.form.formfields"],children:f});$(b).zcDropDown({data:d})};this.fieldActionBind=function(){var c=["subform","integration","zia"],
b=[Constants.SECTION],e=[Constants.SECTION,Constants.PLAIN_TEXT],f=[Constants.PLAIN_TEXT,Constants.IMAGE,Constants.AUDIO,Constants.VIDEO,Constants.SIGNATURE,Constants.FILE_UPLOAD,Constants.SECTION,Constants.SCRIPT,Constants.MULTI_SELECT,Constants.CHECK_BOX,Constants.SINGLE_SELECT,Constants.INLINE_SINGLE_SELECT,Constants.SYSTEM_LOOKUP,Constants.LOOKUP,Constants.AUTO_NUMBER],g=$(a.wfActionEle).find("input[id\x3dshowHideField]"),h=$(a.wfActionEle).find("input[id\x3denableDisableField]"),k=$(a.wfActionEle).find("input[id\x3dshowHideSubformEntry]"),
l=$(a.wfActionEle).find("#setFieldValue").find("input[id\x3dsetField]"),q=[],n=[],p=[],m=[],r=[];$.each(a.formFields,function(a,d){-1==$.inArray(d.compType,b)&&"Form Fields"==d.category&&q.push({id:d.linkName,text:d.dispName,title:d.linkName});d.compType==Constants.SECTION&&r.push({id:d.linkName,text:d.dispName,title:d.linkName});-1==$.inArray(d.compType,e)&&"Form Fields"==d.category&&"subform"!=d.fieldType&&"zia"!=d.fieldType&&n.push({id:d.linkName,text:d.dispName,title:d.linkName});"subform"==d.fieldType&&
p.push({id:d.linkName,text:d.dispName,title:d.linkName});if(-1==$.inArray(d.compType,f)&&"Form Fields"==d.category&&-1==$.inArray(d.fieldType,c))if(d.hasOwnProperty("compFields")){var g=[];$.each(d.compFields,function(a,c){a=$("#isCompositeComponent").val();let b=d.linkName+"."+c.linkName;"false"==a&&(b=c.linkName);a={id:b,text:c.dispName,value:c.linkName,type:c.fieldType,compType:c.compType,genericType:c.genericCompType,title:b};if(c.compType==Constants.DATE_TIME||c.compType==Constants.TIME)a.timeFormat=
c.timeFormat;g.push(a)});m.push({text:d.dispName,children:g})}else{a={id:d.linkName,text:d.dispName,value:d.linkName,type:d.fieldType,compType:d.compType,genericType:d.genericCompType,title:d.linkName};if(d.compType==Constants.DATE_TIME||d.compType==Constants.TIME)a.timeFormat=d.timeFormat;d.compType==Constants.LINK_FIELD&&(a.linkFieldType=d.linkFieldType);m.push(a)}});r!=[]&&q.push({text:i18n["zc.appedit.quicklinks.sections"],children:r});$(g).zcDropDown({showTitle:!0,multiple:!0,data:q});$(h).zcDropDown({showTitle:!0,
multiple:!0,data:n});$(k).zcDropDown({showTitle:!0,multiple:!0,data:p});$(l).each(function(a,c){$(c).zcDropDown({showTitle:!0,multiple:!1,data:m})});a.setFieldActionBind(m)};this.setFieldActionBind=function(c){var b=$(a.wfActionEle).find("div[id\x3dsetFieldValue][elename\x3daction-config]");$(b).find("input[id\x3dsetField]").on("change",function(){var c=$(this).parent().parent("div[elename\x3dsetFieldValRow]"),b=$(c).find("input[name\x3dsetValue]"),d=$(this).data("zcdd").getData().compType,h=$(this).data("zcdd").getData().timeFormat;
$(c).clearError();$(b).val("");void 0!=$(b).data("dtpicker")&&$(b).data("dtpicker").destroy();d!=Constants.DATE&&d!=Constants.DATE_TIME&&d!=Constants.TIME||a.enableDtPicker(b,d,h)});$(b).find("span[elename\x3daddField]").on("click",function(){var a=!1,b=$(this).parent("div[elename\x3dsetFieldValRow]"),d=$(b).find("input[id\x3dsetField]"),h="";void 0!=$(d).data("zcdd")&&(h=$(d).data("zcdd").getValue());$("div[elename\x3dsetFieldValRow]").clearError();$(d).data("zcdd").destroy();void 0!=$(b).find("input[name\x3dsetValue]").data("dtpicker")&&
($(b).find("input[name\x3dsetValue]").data("dtpicker").destroy(),a=!0);var k=$(b).clone(!0,!0);$(k).find("input").val("");$(k).find("input[id\x3dsetField]").zcDropDown({showTitle:!1,multiple:!1,data:c});$(d).zcDropDown({showTitle:!1,multiple:!1,data:c});$(d).data("zcdd").setValue(h);$(k).find("input[id\x3dsetField]").data("zcdd").setValue("");a&&(d=$(d).data("zcdd").getData().compType,a=d==Constants.DATE?variable.dateformat.toUpperCase():d==Constants.TIME?getTimeFormat():variable.dateformat.toUpperCase()+
" "+getTimeFormat(),d=d==Constants.DATE?"wb-timeicon zc-em zc-common-calendar":d==Constants.TIME?"wb-timeicon zc-em zc-common-time":"calTimeIcon flLeft zc-em zc-fb-date-Time",$(b).find("input[name\x3dsetValue]").dtPicker({format:a,showIcon:!0,iconClass:d,showClearValue:!0}));$(b).after(k)});$(b).find("span[elename\x3dremoveField]").on("click",function(){1<$(this).parent().parent().find("div[elename\x3dsetFieldValRow]").length&&$(this).closest("div[elename\x3dsetFieldValRow]").remove()})};this.enableDtPicker=
function(a,b,e){b==Constants.DATE?$(a).dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd"),showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-calendar",showClearValue:!0}):b==Constants.DATE_TIME?$(a).dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd")+" "+e,showIcon:!0,iconClass:"calTimeIcon flLeft zc-em zc-fb-date-Time",showClearValue:!0}):b==Constants.TIME&&$(a).dtPicker({format:e,showIcon:!0,iconClass:"wb-timeicon zc-em zc-common-time",showClearValue:!0})};this.convertSelect2Data=
function(a){var c=[];$.each(a,function(a,b){c.push({id:b,text:b})});return c};this.setDefaultFocus=function(c){if(c){var b=a.isDelugeTask();c.isVisible()||"fieldAction"!=a.actionType||(c=$(a.wfActionEle).find("div[elename\x3dform-customProcess]"),b=!0);c=b?c:0<$(c).find("form:visible").length?$(c).find("form:visible"):$(a.wfActionEle).find("form:visible");c=$(c);(c=getFirstVisibleFormElement(c))&&("textarea"==c.type?$(c).focus():select2FocusField(c))}};this.createNewFunction=function(){$.ajax({url:appbuilder.component.APP.getAppEditUrl()+
"/workflowbuilder/edit/getFunction",type:"POST",data:"zccpn\x3d"+variable.csrfToken+"\x26eventType\x3d1",beforeSend:showLoading(),success:function(c,b,e){hideLoading();$("#wf-slider").find("#functionMeta").remove();$("#wf-slider").append(c);$("#wfFunction").removeClass("hide");$("#sliderElem").attr("class","zc-dem-right-popup zc-dem-btn-popup zc-dem-box-sizing zc-wfb-add-newfunc zc-dem-freeze-content active");b=$("#wfFunction").find("#div-freeflow-editarea-function");a.functionDelugeEditor=initializeDelugeEditor($(b).get(0));
a.displayCustomWorkflowBuilder($(c).find("#div-freeflow-editarea-function"),void 0);a.functionActionsBind()}})};this.customProcessBind=function(){$(a.wfActionEle).find("input[name\x3dformCompSelect]").each(function(c,b){var d=[],f="fieldUpdateAction"==$(b).parent().parent().attr("elename")?!0:!1,g=[Constants.RICH_TEXT_AREA];c=$(a.wfActionEle).find("input[name\x3dnewformfields]").val();2<c.length&&(c=JSON.parse(c),$.each(c,function(a,c){if("subform"!=c.type||f)"default"!=c.type||!f&&0<=$.inArray(c.fctype,
g)||d.push({id:c.linkName,text:c.dispName,value:c.linkName,title:c.linkName});else{var b=[];$.each(c.subformfields,function(a,d){b.push({id:c.linkName+"."+d.linkName,text:d.dispName,value:c.linkName+"."+d.linkName,title:c.linkName+"."+d.linkName})});d.push({text:c.dispName,children:b})}}));$(b).zcDropDown({showTitle:!0,data:d})})};this.functionActionsBind=function(){var c=$(a.wfActionEle).find("#functionMeta");$(c).find("input[elename\x3dsaveFunction]").on("click",function(){var b={},e=$(a.wfActionEle).find("div[elename\x3dcustomFunction]").find("select[name\x3dapplicationId]").val();
b.appid=e;b.script=a.functionDelugeEditor.getEditorValue();b.zccpn=a.constants.csrfToken;b.scripttype="workflowadd";b.sb_tracking=!0;b.sb_compCategory=WorkflowConstants.FUNCTION;var f=$(c).find("#wfFunction").attr("functionId"),g=$("#namespace").val(),h="";""!=f&&(b.scripttype="workflowmodify",b.functionid=f,h=$("#functionEl").find("#fnName").find("option:selected").text(),b.functionName=g+"."+h);$.ajax({url:a.workflowUrl+"/populateCustomFunction",type:"POST",beforeSend:$(c).find("input[elename\x3dsaveFunction]").showTextLoading(""!=
f?i18n["zc.workflow.updatingaction"]:i18n["zc.workflow.savingaction"]),data:b,success:function(d,l,q){a.functionDelugeEditor.handleResponse(d,function(){var c=!0,f=[],k=d.functionDetails;if("workflowmodify"==b.scripttype){c=!1;var l=!0,q=k.paramDetail,t=$("#argumentli").find("#fieldgroup").find("input[id\x3dargField]"),v=$("#argumentli").find("#fieldgroup").find("input[elename\x3dargName]");$(t).length!=q.length?(c=!0,l=!1):$.each(q,function(a,b){if(b.paramName!=$(v[a]).val()&&b.dataType==$(t[a]).attr("dataType"))c=
!0;else if(b.dataType!=$(t[a]).attr("dataType"))return c=!0,l=!1});if(k.nameSpace!=g||h!=k.functionName)c=!0;l&&$(t).each(function(a,c){f[a]=$(c).val()})}c&&a.getNamespaceforApp(e,k.nameSpace,d.functionid,f);a.closeFunctionSlider()},function(){$(c).find("input[elename\x3dsaveFunction]").hideTextLoading(""!=f?i18n["zc.workflowbuilder.updatefunction"]:i18n["zc.workflowbuilder.savefunction"])})}})});$(c).find("input[elename\x3dcancelFunction], .zc-dem-right-close").on("click",function(){a.functionDelugeEditor.verifyScriptChange(function(){a.closeFunctionSlider()})});
$(c).find("input[elename\x3dexecuteFunction]").on("click",function(){a.executeFunction()})};this.Select2Bind=function(){$(a.wfActionEle).find("select").zcDropDown()};this.closeFunctionSlider=function(){$(a.wfActionEle).find("#sliderElem").removeClass("active").addClass("deactive");$(a.wfActionEle).find("div[elename\x3dfunctionSlider]").remove();setTimeout(function(){$(a.wfActionEle).find("#sliderElem").find("input[elename\x3dsaveFunction]").hideTextLoading();$(a.wfActionEle).find("#sliderElem").removeClass("deactive");
$(a.wfActionEle).find("#sliderElem").addClass("hide")},200)};this.handleUnverifiedAdminEmail=function(){var c=new wfActionUtil;if(!c.isAdminEmailVerfied){var b=c.isAdminUser?WorkflowConstants.unverifiedEmailErrorText.ADMIN_ERROR_TEXT:WorkflowConstants.unverifiedEmailErrorText.DEVELOPER_ERROR_TEXT;iCustomizePopup({title:WorkflowConstants.unverifiedEmailErrorText.CONFIRM_EMAIL_ACCOUNT,body:$("\x3cp/\x3e").text(b),containerClass:"zc-dem-user-unconfirmed",buttons:[{name:c.isAdminUser?WorkflowConstants.unverifiedEmailErrorText.PROCEED_TO_ACCOUNT:
WorkflowConstants.unverifiedEmailErrorText.OK,type:ZCModalConstants.MODAL_SUBMIT}],success:function(b){a.closeActionSlider();c.isAdminUser?window.open(variable.accountsUrl,"_target"):"";return!0},failure:function(){a.closeActionSlider();return!0}},function(){$(".zc-dem-dialogue-content.zc-dem-user-unconfirmed.zc-dem-hideicon i").addClass("zc-dem-email-unconfirmed-icon")})}};this.closeActionSlider=function(){$(a.wfActionEle).find(".zc-dem-right-close").trigger("click")};this.showExecuteNowButton=function(){$(a.wfActionEle).find("input.wb-execute-button").show()};
this.executeFunction=function(c,b){var d=$("#functionMeta"),f={};d=$(d).find("#wfFunction").attr("functionId");f.functionid=d;f.zccpn=a.constants.csrfToken;f.appID=$(a.wfActionEle).find("div[elename\x3dcustomFunction]").find("select[name\x3dapplicationId]").val();f.zohoruntime=(new Date).getTime();f.isSchedulerScript=!1;a.verifyChangesBeforeExecute(a.functionDelugeEditor,b,function(){a.executeScript(c,f)})};this.executeSchedule=function(c,b){if(a.isEdit){var d={};d.wfLinkName=a.wfLinkName;d.actionLinkName=
a.taskLinkName;d.zccpn=a.constants.csrfToken;d.zohoruntime=(new Date).getTime();d.isSchedulerScript=!0;a.verifyChangesBeforeExecute(a.delugeEditor,b,function(){a.executeScript(c,d)})}};this.verifyChangesBeforeExecute=function(a,b,e){a.isEditorContentModified()&&!b?iConfirm({title:i18n["zc.workflow.builder.functions.executefunction"],message:i18n["zc.workflow.builder.function.execute.savechng.alertmsg"],button:ZCButton.PROCEED,cbutton:ZCButton.CANCEL,success:function(){e()}}):e()};this.executeScript=
function(c,b){c&&(c=c.querySelectorAll("input, select, textarea"),a.getFunctionMeta(c,b),b.isArgValue=!0,b.showresult=!0);$.ajax({url:a.workflowUrl+"/executeScript",type:"POST",beforeSend:function(){wfActionUtil.showLoadingContainer()},data:b,success:function(c,d,g){DelugeExecuteWorkflow.handle(c,b.isSchedulerScript?a.executeSchedule:a.executeFunction);wfActionUtil.hideLoadingContainer()}})};this.getFunctionMeta=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];let e=d.getAttribute("name");
isNull(e)||(b[e]=d.value)}};this.loadActions=function(){var c=$(a.wfActionEle).find("input[name\x3dactionType]").val();a.actionType=c;var b=$(a.wfActionEle).find("#"+c);$(a.wfActionEle).find("div[eleName\x3dstepOne]").addClass("hide");$(a.wfActionEle).addClass("zc-wfb-onedit");$(a.wfActionEle).find("div[elename\x3dactionCategory]").addClass("hide");$(a.wfActionEle).find("div[eletype\x3dstepThree]").addClass("hide");$(a.wfActionEle).find("div[elename\x3dwfActionFooter]").removeClass("hide");$(a.wfActionEle).find("div[elename\x3d"+
c+"]").removeClass("hide");$(b).find("div[elename\x3daction-config]").addClass("hide");if("alertAction"===c||"fieldAction"===c){var e=$(a.wfActionEle).find("input[name\x3dtypeOfTask]").val();b=$(a.wfActionEle).find("div[elename\x3dactionTypeBox][value\x3d"+e+"]");var f=$(b).attr("name");$("#"+f).removeClass("hide");b=$(b).find("span[elename\x3dtaskHeader]").text();$(a.wfActionEle).find("div[elename\x3d"+c+"]").find("#editTitle").text(b);"fieldAction"===c&&"setFieldValue"!==f&&(b=$(a.wfActionEle).find("div[elename\x3d"+
c+"]").find("#editTitle"),$(`\x3ci title\x3d"${i18n["zc.form.builder.visibility.hideaction.info"]}" class\x3d"zc-dem-info-icon zc-common-info-alt zc-em zc-field-action-info"\x3e\x3c/i\x3e`).insertAfter(b));"redirectUrl"==f&&(b=$("#redirectUrl").find("select").val(),c=$("#"+f),c.find("div[elename\x3dredirect-config]").addClass("hide"),c.find("div[redirectType\x3d"+b+"]").removeClass("hide"),a.setDefaultFocus(c));"setFieldValue"==f&&(b=$(a.wfActionEle).find("div[id\x3dsetFieldValue][elename\x3daction-config]").find("div[elename\x3dsetFieldValRow]"),
$(b).each(function(c,b){c=$(b).find("input[id\x3dsetField]").data("zcdd").getData().compType;var d=$(b).find("input[id\x3dsetField]").data("zcdd").getData().timeFormat;b=$(b).find("input[name\x3dsetValue]");c!=Constants.DATE&&c!=Constants.DATE_TIME&&c!=Constants.TIME||a.enableDtPicker(b,c,d)}));"successMsg"==f&&(b=$("#"+f),(b=getFirstVisibleFormElement(b))&&$(b).focus());"SMSConfig"==f&&(f=$(a.wfActionEle).find("div[id\x3dSMSConfig][elename\x3daction-config]"),0<$(a.wfActionEle).find("select[name\x3dconnectionId] option").not(".zc-dd-dummy-opt").length?
($(f).find("#no-connection").hide(),$(f).find("#connection-listing-container").show()):($(f).find("#no-connection").show(),$(f).find("#connection-listing-container").hide()))}else if("integAction"===c){b=$(a.wfActionEle).find("input[name\x3dserviceName]").val();f=$(a.wfActionEle).find("input[name\x3dconnectorLinkName]").val();c=$(a.wfActionEle).find("input[name\x3dserviceLinkName]").val();b=$(a.wfActionEle).find("div[elename\x3dactionTypeBox][value\x3d"+b+"]");b=$(b).find("span[elename\x3dtaskHeader]").text();
e=$(a.wfActionEle).find("div[elename\x3dintegAction][eletype\x3dstepThree]");var g=$(e).find("select[name\x3dmoduleLinkName] option:selected").text();b=b+" - "+g;$(e).find("#editTitle").text(b);$(e).find("div[elename\x3dmodulesDiv]").addClass("hide");f={mainEl:e,sharedByDisp:WorkflowBuilder.constants.scopeName,csrfParamName:WorkflowBuilder.constants.csrfParam,csrfToken:WorkflowBuilder.constants.csrfToken,serviceVersionLinkName:f,serviceLinkName:c,formLinkName:a.formLinkName,workflowBuilder:WorkflowBuilder,
isEdit:!0};ZCIntegWorkflowContext.getInstance().init(f)}else if("dataAccess"===c)e=parseInt($(a.wfActionEle).find("input[name\x3dtypeOfTask]").val()),b=$(a.wfActionEle).find("div[elename\x3dactionTypeBox][value\x3d"+e+"]"),b=$(b).find("span[elename\x3dtaskHeader]").text(),$(a.wfActionEle).find("div[elename\x3d"+c+"]").find("#editTitle").text(b),$("#dataAccessInput").removeClass("hide"),b=$(a.wfActionEle).find("div[elename\x3dselectForm]").find("select[name\x3dselectForm]").find(":selected").attr("name"),
$(a.wfActionEle).find("#dataAccessInput").find("select[name\x3dselectForm]").find(":selected").attr("displayName"),c=20==e?i18n["zc.workflowbuilder.addformselect"]:21==e?i18n["zc.workflowbuilder.updateformselect"]:i18n["zc.workflowbuilder.deleteformselect"],$("#dataAccessInput").find("#formSelectLabel").text(c),22!=e&&(f=JSON.parse($("#dataAccessInput").find("input[elename\x3ddataAccessSetValues]").val())),a.dataAccessObj.setDataAccessVariables(e,f,b),a.dataAccessObj.hideUnrelatedContainers(e,!0),
a.dataAccessObj.constructDataAccessForm();else if("customProcess"===c)if("customFunction"==$(a.wfActionEle).find("#customProcess").find("div[elename\x3dactionTypeBox][flag\x3dtrue]").attr("customprocesstype"))$(a.wfActionEle).find("div[elename\x3dcustomProcess][eletype\x3dstepThree]").addClass("hide"),$(a.wfActionEle).find("div[elename\x3dcustomFunction][eletype\x3dstepThree]").removeClass("hide"),f=$(a.wfActionEle).find("div[elename\x3dcustomFunction][eletype\x3dstepThree]"),b=$(f).find("input[name\x3dselectedApplicationId]").val(),
c=$(f).find("input[name\x3dselectedNamespace]").val(),e=$(f).find("input[name\x3dselectedFunctionId]").val(),g=$(f).find("input[name\x3dargumentList]").val(),g=2<g.length?JSON.parse(g):[],$(f).find("select[name\x3dapplicationId]").data("zcdd").setValue(b),a.getNamespaceforApp(b,c,e,g);else{c=$(a.wfActionEle).find("div[elename\x3dform-customProcess]");f=$(c).find("input[name\x3dscript]").val();if(a.isNewFormWF())b=""!=a.wfMeta.formComp?a.wfMeta.formComp:void 0;else{b=$(c).find("input[name\x3dformCompName]").val();
e=a.getScriptTypeNew();if("onuserinput"==e||"onupdate"==e)b=2==b.split(".").length?b.split(".")[0]:void 0;c=$(c).find("input[name\x3dfieldDispName]").val();a.setEditorHeaderOnEdit(escapeHTML(c))}a.displayCustomWorkflowBuilder($("div[elename\x3dcustomProcess][eletype\x3dstepThree]").find("#div-freeflow-editarea"),f,b);a.isScheduleWF()&&a.showExecuteNowButton()}};this.setEditorHeaderOnEdit=function(c){var b=a.getScriptTypeNew(),e="\x3ci\x3e"+i18n["zc.workflowbuilder.delugeScript"]+" -\x3c/i\x3e ",f=
"",g=escapeHTML(a.formDispName);g='\x3ca target\x3d"_blank" href\x3d"'+(a.appUrl+"/formbuilder/"+a.formLinkName+"/edit")+'"\x3e'+g+"\x3c/a\x3e";"onload"==b||"onvalidate"==b||"onsuccess"==b?(e="onload"==b?e+i18n["zc.workflow.onformload"]:"onvalidate"==b?e+i18n["zc.workflow.ondatavalidate"]:e+i18n["zc.workflow.ondatasuccess"],f=2==a.eventType?i18n["zc.workflowbuilder.event.edit-desc"]+g:3==a.eventType?i18n["zc.workflowbuilder.event.delete-desc"]+g:4==a.eventType?i18n["zc.workflowbuilder.event.createoredit-desc"]+
g:i18n["zc.workflowbuilder.event.create-desc"]+g):"onuserinput"==b||"onupdate"==b?(e="onuserinput"==b?e+i18n["zc.workflow.onuserinput"]:e+i18n["zc.workflow.onupdate"],f=i18n["zc.workflowbuilder.event.onupdate-desc"]+g,f=f.replace("ZC_FIELD_NAME",c)):"onaddrow"==b||"ondeleterow"==b?(e="onaddrow"==b?e+i18n["zc.workflowbuilder.subformaddrow"]:e+i18n["zc.workflowbuilder.subformdeleterow"],f=2==a.eventType?i18n["zc.workflowbuilder.event.edit-desc"]+g:4==a.eventType?i18n["zc.workflowbuilder.event.createoredit-desc"]+
g:i18n["zc.workflowbuilder.event.create-desc"]+g):e="\x3ci\x3e"+i18n["zc.workflowbuilder.delugeScript"]+"\x3c/i\x3e";c=$(a.wfActionEle).find("div[elename\x3dcustomProcess]");c.find(".zc-wfb-customprocess-name").html(e);c.find(".zc-wfb-customprocess-desc").html(f)};this.displayCustomWorkflowBuilder=function(c,b,e){$(c).show();c={};c.script=void 0!=b?b:"";c.callback=function(){a.delugeEditor.gotoLine(1)};c.metadata={appLinkName:a.constants.appLinkName.replace(/-/g,"_"),formLinkName:a.formLinkName};
a.isEdit&&(c.workflow={componentType:"Workflow",wfLinkName:a.wfLinkName,actionLinkName:a.taskLinkName});b=a.getScriptTypeNew();a.isHeaderChanged=!1;c.restriction=DelugeEditorWrapper.prototype.getRestrictedEntries(DELUGE_ACTION_MAP[b],a.eventType);var d=["row","old"];void 0!=e&&""!=e?(c.metadata.subformFieldLinkName=e,c.hintRestrictionMap=["old"]):"onvalidate"==b&&"2"==a.eventType?c.hintRestrictionMap=["row"]:c.hintRestrictionMap||(c.hintRestrictionMap=d);c.save=function(){a.wfType==Constants.APPROVAL_WF?
$(a.wfActionEle).find(".wb-save-button").trigger("click"):a.processSaveAction()};a.isScheduleWF()&&(c.execute=a.executeSchedule);a.delugeEditor&&a.delugeEditor.setOptions(c,!0);a.isWorkflowV2Enabled?!a.isEdit&&a.scriptOnlyWorkflow()?(c=$("#temp-header"),e=a.showHeaderTextDelugeScipt(c),c.find(".zc-wfb-header-span").remove(),c.prepend(e.addClass("zc-wfb-header-span"))):a.isEdit?(c=$(a.wfActionEle).find("div[elename\x3dcustomProcess]"),e=a.showHeaderTextDelugeScipt(c),c.find(".zc-wfb-customprocess-title").hide(),
c.find("#deluge-edtior-onedit").show(),c.find("#deluge-edtior-onedit").prepend(e)):a.isEdit||(b=$(a.wfActionEle).find(".zc-wfb-actiontype-cont"),b.hide(),c=$("#org-header"),a.wfMeta.wfType==Constants.CUSTOM_WF?(c=$("#customProcess .selected"),$(c).find(".zc-wfb-customprocess-title").hide(),$(c).append($("\x3cdiv/\x3e").attr("class","zc-wfb-custom-function-editor")),e=a.showHeaderTextDelugeScipt(c),$(c).find(".zc-wfb-custom-function-editor").html(e)):(e=a.showHeaderTextDelugeScipt(c),b.after(e)),$(a.wfActionEle).find("#deluge-edtior-onedit").hide()):
(c=$(a.wfActionEle).find("div[elename\x3dcustomProcess]"),c.find("#deluge-edtior-onedit").removeClass("zc-wfb-nosub-text"),a.isEdit&&a.wfType!=Constants.FORM_WF&&c.find("#deluge-edtior-onedit").addClass("zc-wfb-nosub-text"));$(a.widthAdjustEle).addClass("zc-wfb-deluge-slider");$(a.widthAdjustEle).animate({width:"90%"},0,function(){a.delugeEditor&&a.delugeEditor.resize();a.delugeEditor&&a.delugeEditor.gotoLine(1)})};this.showHeaderTextDelugeScipt=function(c){a.isHeaderChanged=!0;c.find(".no-breadcrumbs").hide();
c.find(".zc-wfb-deluge-header").remove();$("#wf-slider").addClass("zc-wfb-deluge-slider");c=$(".wf-header-breadcrumbs").clone(!0,!0);if(a.wfType==Constants.FORM_WF||a.wfType==Constants.PAYMENT_WF)c=$(".zc-wb-breadcrumbs").clone(!0,!0);return $("\x3cdiv/\x3e").attr("class","zc-wfb-deluge-header zc-wfb-header-span").html(c).prepend($("\x3ch3/\x3e").text(i18n["zc.workflow.builder.createworkflow.delugescript"]))};this.removeHeaderText=function(){a.isHeaderChanged&&($(a.wfActionEle).find(".zc-wfb-actiontype-cont").show(),
$(".no-breadcrumbs").show(),$("#customProcess").find(".zc-wfb-customprocess-title").show(),$(".zc-wfb-deluge-header , .zc-wfb-custom-function-editor").remove(),$("#wf-slider").removeClass(".zc-wfb-deluge-slider"))};this.getScriptType=function(){var c=null;a.wfType==Constants.FORM_WF?c=$(a.wfActionEle).find("#customProcess").find("div[elename\x3dactionTypeBox][flag\x3dtrue]").attr("id"):a.wfType==Constants.FORM_SCHEDULE_WF||a.wfType==Constants.DATE_SCHEDULE_WF||a.wfType==Constants.APPROVAL_WF?c="schedule":
a.wfType==Constants.STATELESS_BUTTON_WF?c="onclick":a.wfType==Constants.CUSTOM_WF&&(c="onsuccess");return c};this.getScriptTypeNew=function(){var c=null;if(a.wfType==Constants.FORM_WF)c=a.isNewFormWF()?WorkflowConstants.scriptVsSubEvents[a.wfMeta.subEvent]:$(a.wfActionEle).find("#customProcess").find("div[elename\x3dactionTypeBox][flag\x3dtrue]").attr("id");else if(a.wfType==Constants.FORM_SCHEDULE_WF||a.wfType==Constants.DATE_SCHEDULE_WF||a.wfType==Constants.APPROVAL_WF)c="schedule";else if(a.wfType==
Constants.STATELESS_BUTTON_WF)c="onclick";else if(a.wfType==Constants.CUSTOM_WF)c="onsuccess";else if(a.wfType==Constants.CUSTOM_WF||a.wfType==Constants.STATELESS_BUTTON_WF)c="onclick";return c};this.isDelugeTask=function(){return a.scriptOnlyWorkflow()?!0:"customProcess"==a.actionType?a.wfType==Constants.CUSTOM_WF?"customFunction"!=$(a.wfActionEle).find("#customProcess").find("div[elename\x3dactionTypeBox][flag\x3dtrue]").attr("id"):!0:!1};this.isScheduleWF=function(){return a.wfType==Constants.DATE_SCHEDULE_WF||
a.wfType==Constants.FORM_SCHEDULE_WF};this.isNewFormWF=function(){return a.wfType==Constants.FORM_WF?null!=a.wfMeta.subEvent&&"0"!=a.wfMeta.subEvent:!1};this.validateFields=function(c){var b={fieldConfig:{"input[name\x3dactionFields]":i18n["zc.workflowbuilder.searchfields"]},setFieldValue:{"input[name\x3dsetField]":i18n["zc.workflowbuilder.fieldname"],"input[name\x3dsetValue]":i18n["zc.workflowbuilder.fieldval"]}},e=$(a.wfActionEle).find("input[name\x3dactionType]").val(),f=$(c).find("input[name\x3dtaskType]").val(),
g=!0;if("alertAction"===e||"integAction"==e){b=$(c).find(":input:not(.no-validate,.select2-focusser,.select2-input)").filter(function(a,c){return $(this).is("[name]")});$(b).each(function(a,c){a=$(c).closest(".zc-dem-form-group");if(!a.hasClass("hide")){var b=$(c).val().trim();if(""==b||"-Select-"==b||"none"==b||"addConnection"==b)b=$(a).find(".zc-dem-form-label").text(),"push-users"==$(a).attr("elename")?$("#sendToUsers").showError(b+" "+i18n["zc.workflowbuilder.cannotbeempty"]):"integAction"==e?
$(c).showError(i18n["zc.builder.connectionauth.linkacc.enterfieldvalues"].replace("{0}",b)):$(c).showError(b+" "+i18n["zc.workflowbuilder.cannotbeempty"]),g=!1}});if("integAction"===e){$(c).find(":input[name\x3dserviceName]").attr("value");b=$(c).find("div[elename\x3dotherFields]").find("div[elename\x3dfieldmap-row]");var h=$(c).find("div[elename\x3dmandatoryFields]").find("div[elename\x3dfieldmap-row]");$.each(h,function(a,c){a=$(c).find("select[name\x3dmandFormFields]");isNull($(a).val())&&($(a).showError(i18n["zc.builder.connectionauth.linkacc.enterfieldvalues"].replace("{0}",
$(c).text())),g=!1)});$.each(b,function(a,c){a=$(c).find("select[name\x3dotherApiFields]").val();var b=$(c).find("select[name\x3dotherFormFields]").val();""!=a&&""!=b||""==a&&""==b||(b=""==a?i18n["zc.workflowbuilder.apifields"]:i18n["zc.workflowbuilder.formfields"],a=""==a?"ApiFields":"FormFields",$(c).find("select[name\x3dother"+a+"]").showError(i18n["zc.builder.connectionauth.linkacc.enterfieldvalues"].replace("{0}",b)),g=!1)})}f==Constants.SENDMAIL&&($(c).find(":input[name\x3demailTo],:input[name\x3demailCc],:input[name\x3demailBcc],:input[name\x3demailReplyTo]").each(function(){var a=
$(this),c=/^[\w]([\w\-\.\+']*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/,b=$(this).parent().parent(),d=$(this).val().split(",");$.each(d,function(d,e){"zoho.adminuserid"!=e&&"zoho.loginuserid"!=e&&"$"!=e[0]&&""!=e&&0==c.test(e)&&($(a).showError($(b).find("label").text()+" field has invalid Email ID : "+escapeHTML(e)),g=!1)})}),b=ZSEC.HTMLPurifier({ALLOWED_STYLE:"ALL",STYLE_VALIDATION:!1,FORCE_BODY:!0}),h=$(c).find("textarea[name\x3demailMessage]").val(),$(c).find("textarea[name\x3demailMessage]").val(b.sanitize(h)));
f==Constants.SENDSMS&&(b=$(c).find("input[name\x3dtoNumber]").val().split(","),$.each(b,function(a,b){a=b.trim();""!=a&&0>a.indexOf("{")&&0>a.indexOf("}")&&(20<b.length||!WorkflowConstants.PHONE_NUM_REGEX.test(a))&&($(c).find("input[name\x3dtoNumber]").showError(i18n["zc.workflowbuilder.validnumber"]),g=!1)}));f==Constants.REDIRECTURL&&(f=$(c).find("input[name\x3dredirectWebsite]").val(),-13!=f.indexOf("\x3c")+f.indexOf("\x3e")+f.indexOf("[")+f.indexOf("]")+f.indexOf("|")+f.indexOf(";")+f.indexOf("*")+
f.indexOf('"')+f.indexOf("~")+f.indexOf("`")+f.indexOf(" ")+f.indexOf("^")+f.indexOf("!")&&($(c).find("input[name\x3dredirectWebsite]").showError(i18n["zc.workflowbuilder.urlvalidate"]),g=!1))}else if("fieldAction"===e){var k=$(c).parent().attr("id");$.each(b[k],function(b,d){"input[name\x3dsetValue]"!=b?$.each($(c).find(""+b),function(a,c){a=$(c).val();if(""===a||"select"===a)c="fieldConfig"==k?$(c).closest(".zc-dem-form-group").find("input[name\x3dactionFields]"):$(c),$(c).showError(d+" "+i18n["zc.workflowbuilder.cannotbeempty"]),
g=!1}):(b=$(a.wfActionEle).find("div[id\x3dsetFieldValue][elename\x3daction-config]").find("div[elename\x3dsetFieldValRow]"),$(b).each(function(c,b){g=a.validateSetFieldValues(b)&&g}))})}else if("dataAccess"===e){f=$(c).find("select[name\x3dselectForm]").val();if(""===f||null==f)setTimeout(function(){$(c).find("select[name\x3dselectForm]").showError(i18n["zc.workflowbuilder.plsselectform"])},200),g=g&&!1;f=parseInt($(c).find("input[name\x3dtaskType]").val());h=$(c).find("div[elename\x3dsetMandFieldValRow]");
b=$(c).find("div[elename\x3dsetFieldValRow]");var l=0;$.each(h,function(c,b){var d=$(this).find("input[name\x3dsetField]");c=$(this).find("input[name\x3dsetValue]");d=$(d).data("zcdd").getData();if(""==c.val()||null==c.val())return $(c).showError("Field value "+i18n["zc.workflowbuilder.cannotbeempty"]),g=g&&!1,!0;d.hasOwnProperty("compType")&&(g=g&&a.validateSetFieldValues(b))});$.each(b,function(c,b){c=$(this).find("input[name\x3dsetField]");var d=$(this).find("input[name\x3dsetValue]"),e=""==c.val()||
null==c.val(),f=""==d.val()||null==d.val(),h=$(c).data("zcdd").getData();if(e&&f)return l++,!0;if(e)return $(c).showError("Field name "+i18n["zc.workflowbuilder.cannotbeempty"]),g=g&&!1,!0;if(f)return $(d).showError("Field value "+i18n["zc.workflowbuilder.cannotbeempty"]),g=g&&!1,!0;h.hasOwnProperty("compType")&&(g=a.validateSetFieldValues(b)&&g)});"22"!=f&&b.length+h.length==l&&($(c).find("div[elename\x3dsetFieldValRow]").find("input[name\x3dsetField]").showError("Field name "+i18n["zc.workflowbuilder.cannotbeempty"]),
$(c).find("div[elename\x3dsetFieldValRow]").find("input[name\x3dsetValue]").showError("Field value "+i18n["zc.workflowbuilder.cannotbeempty"]),g=g&&!1)}else if("customProcess"==e)if("freeWorkflow"==$(c).attr("name")){if(a.delugeEditor&&""==a.delugeEditor.getEditorValue()||a.functionDelugeEditor&&""==a.functionDelugeEditor.getEditorValue())iAlert(i18n["zc.workflowbuilder.scriptcantbeempty"]),g=!1}else"functionworkflow"==$(c).attr("name")&&(a.validateFuncExe($(c))||(g=!1),f=$(c).find("input[id\x3dargField]"),
0!=$(f).length&&$.each(f,function(a,c){""==$(c).val()&&($(c).parent().siblings().find("input[elename\x3dargName]").val(),$(c).showError(i18n["zc.customactions.argfieldvalidate"]),g=!1)}));return g};this.validateSetFieldValues=function(a){var c=$(a).find("input[name\x3dsetValue]"),b=!0;if(""==$(c).val())$(c).showError(i18n["zc.workflowbuilder.valueempty"]),b=!1;else if(""!=$(a).find("input[name\x3dsetField]").data("zcdd").getValue()){var f=$(c).val(),g=$(a).find("input[name\x3dsetField]").data("zcdd").getData();
a=g.compType;g=g.genericType;if(RegexUtil.validateRegex(f,REGEX_TYPE.FIELD_NAME))return b;a==Constants.EMAIL_ADDRESS?0==/^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(f)&&($(c).showError(i18n["zc.workflowbuilder.validateemail"]),b=!1):a==Constants.URL?-15!=f.indexOf("\x3c")+f.indexOf("\x3e")+f.indexOf("[")+f.indexOf("]")+f.indexOf("}")+f.indexOf("{")+f.indexOf("|")+f.indexOf(";")+f.indexOf("*")+f.indexOf('"')+f.indexOf("~")+f.indexOf("`")+f.indexOf(" ")+f.indexOf("^")+f.indexOf("!")&&
($(c).showError(i18n["zc.workflowbuilder.validateurl"]),b=!1):a==Constants.NUMBER&&g!=Constants.DECIMAL||a==Constants.PHONE_NUMBER?$.isNumeric(f)?$.isNumeric(f)&&Math.floor(f)!=f&&(b=a==Constants.PHONE_NUMBER?i18n["zc.workflowbuilder.validatephone"]:i18n["zc.workflowbuilder.nondecimal"],$(c).showError(b),b=!1):(b=a==Constants.PHONE_NUMBER?i18n["zc.workflowbuilder.validatephone"]:i18n["zc.workflowbuilder.validatenumber"],$(c).showError(b),b=!1):g!=Constants.DECIMAL&&a!=Constants.PERCENTAGE&&a!=Constants.CURRENCY||
$.isNumeric(f)||($(c).showError(i18n["zc.workflowbuilder.validatenumber"]),b=!1)}return b};this.processSaveAction=function(){var c=$(a.wfActionEle).find("form:visible"),d=$(c).find("input[name\x3dtaskType]").val();$(c).find("select[name\x3dselectForm]").find(":selected").attr("name");var e=$(c).find("input:radio[name\x3dupdateRecCritOption]:checked").not(":disabled").val();"7"==d&&$(c).find("textarea[name\x3demailMessage]").val(ZE_Init.creatorObj.getContent());if(a.validateFields(c)){var f=$(c).find("select:disabled").removeAttr("disabled"),
g=$(c).serialize();f.attr("disabled","true");a.wfType==Constants.PAYMENT_WF&&(g=g+"\x26groupType\x3d"+b.groupType);if("freeWorkflow"==$(c).attr("name"))if(g+="\x26workflowString\x3d"+encodeURIComponent(a.delugeEditor.getEditorValue()),a.wfType!=Constants.FORM_WF||a.isNewFormWF())g+="\x26scripttype\x3dcustomaction";else{c=$(a.wfActionEle).find("#customProcess").find("div[elename\x3dactionTypeBox][flag\x3dtrue]").attr("id");if(!a.isEdit&&("onuserinput"==c||"onupdate"==c||"onaddrow"==c||"ondeleterow"==
c)){f=$(a.wfActionEle).find("div[elename\x3dform-customProcess]").find("input[name\x3dformCompName]").val();var h=f.split(".");2==h.length?(c="subformonuserinput",g+="\x26formCompLinkName\x3d"+h[0]+"\x26subFormCompLinkName\x3d"+h[1]):g+="\x26formCompLinkName\x3d"+f}g+="\x26scripttype\x3d"+c+"\x26isCustomProcess\x3dtrue"}else"functionworkflow"==$(c).attr("name")&&(g+="\x26scripttype\x3dcustomFunction");if("21"==d||"22"==d)if("22"==d||"21"==d&&"current"!=e){if(0==a.criteriaBuilder.getDataAccessCriteria()){$(a.wfActionEle).find(".wb-save-button").prop("disabled",
!1);return}g+="\x26dataAccessCritMap\x3d"+JSON.stringify(a.criteriaBuilder.getDataAccessCriteria());g+="\x26isDataAccessCriteria\x3dtrue"}else g+="\x26isDataAccessCriteria\x3dfalse";a.handleSaveUpdateAction(a.isEdit,g)}else $(a.wfActionEle).find(".wb-save-button").prop("disabled",!1)};this.handleSaveUpdateAction=function(c,b){c?a.updateAction(b):a.saveAction(b)};this.saveAction=function(c){null==c?$(a.wfActionEle).find(".wb-save-button").prop("disabled",!1):(a.isNewGroup=void 0==a.groupName?!0:!1,
c+="\x26"+a.CriteriaData+"\x26workflowName\x3d"+a.wfLinkName+"\x26formlinkname\x3d"+a.formLinkName+"\x26isNewGroup\x3d"+a.isNewGroup+"\x26groupName\x3d"+a.groupName+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(a.wfType),$.ajax({url:a.workflowUrl+"/saveAction",beforeSend:function(){$(a.wfActionEle).find(".wb-save-button").showTextLoading(i18n["zc.workflow.savingaction"])},type:"POST",data:c,success:function(c,b,f){a.response=c;a.actionCallBk.save.success(a)},error:function(c,
b,f){a.actionCallBk.save.error(a)}}))};this.updateAction=function(c){c+="\x26actionName\x3d"+a.taskLinkName+"\x26workflowName\x3d"+a.wfLinkName+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowUtil.getComponentCategory(a.wfType);$.ajax({beforeSend:function(){$(a.wfActionEle).find(".wb-save-button").showTextLoading(i18n["zc.workflow.updatingaction"])},url:a.workflowUrl+"/updateAction",type:"POST",data:c,success:function(c,b,f){a.response=c;a.actionCallBk.update.success(a)},error:function(c,
b,f){a.actionCallBk.update.error(a)}})}};
Alerts=function(b){var a=this;a.alertEle=$(b.wfActionEle).find("div[elename\x3dalertAction]");a.formLinkName=b.formLinkName;a.emailFields={};a.lazyLoadingObj={};a.lazyLoadingObj.startIndex=1;a.lazyLoadingObj.noOfRecords=500;a.lazyLoadingObj.filterValue="";a.lazyLoadingObj.prevSelectedValue="";a.hasMore=!0;this.registerEvents=function(c){a.emailEvents(c);a.redirectUrlEvents();a.smsEvents();a.pushNotificationEvents();a.successMsgEvents();a.setDefaultMessages()};this.smsEvents=function(){function c(){$(e).find("option:selected").attr("isConnected",
!0);$(e).trigger("change")}var d=$(a.alertEle).find("div[id\x3dSMSConfig][elename\x3daction-config]"),e=$(d).find("select[name\x3dconnectionId]"),f=$(d).find("textarea[name\x3dsmsMessage]");wfActionUtil.bindInsertFieldsTooltip(f,b.wfType,b.formFields);$(d).find("#addNewSMSConnection, .add-new-smsconnection").off("click").on("click",function(){showLoading();var a={sharedByDisp:b.constants.scopeName,csrfParamName:b.constants.csrfParam,csrfToken:b.constants.csrfToken,successCallback:function(a){$(d).find("#no-connection").hide();
$(d).find("#connection-listing-container").show();var c=$("\x3coption\x3e\x3c/option\x3e").html(a.displayName).val(a.connectionId).prop("selected","selected").attr("isConnected",a.isConnected).attr("type",a.connectionType).attr("linkName",a.linkName);$(e).append(c);$(e).data("zcdd").setValue(a.connectionId);$(e).data("preVal",a.connectionId);$(e).trigger("change")},authSuccessCallback:c};ZCSMSContext.getInstance().init(a)});$(e).off("change").on("change",function(){function a(a){0==$(d).find("div[id\x3dconnection-auth-required][class\x3d'zc-dem-error-connection-source']").length&&
(0<$(d).find("div[id\x3dconnection-auth-required][class\x3d'zc-dem-error-connection-source hide']").length?$(d).find("div[id\x3dconnection-auth-required]").removeClass("hide"):$(d).find("a[id\x3daddNewSMSConnection]").after($(connAuthRequiredElement)),$(d).find("#connection-auth-required \x3e input[type\x3dbutton]").removeAttr("disabled").removeAttr("title"),$(d).find("#connection-auth-required \x3e input[type\x3dbutton]").off("click.authorize").on("click.authorize",function(){var e=$(d).find("select[name\x3dconnectionId]").find("option:selected",
this).attr("linkName");e={sharedByDisp:b.constants.scopeName,csrfParamName:b.constants.csrfParam,csrfToken:b.constants.csrfToken,integContext:IntegrationContext.BUILDER,isSystemConnection:a==ConnectionType.SYSTEM,connectionLinkName:e,authSuccessCallback:c};ZCIntegAuthorize.getInstance().triggerAuthorizeAction(e)}))}"false"==$("option:selected",this).attr("isConnected")?a($("option:selected",this).attr("type")):($(d).find("div[id\x3dconnection-auth-required]").addClass("hide"),$(d).find("#connection-auth-required \x3e input[type\x3dbutton]").off("click.authorize"))});
""!=$(e).val()&&$(e).trigger("change");if(b.wfType!=Constants.DATE_SCHEDULE_WF){f=[];var g=[];$.map(b.formFields,function(a,c){a.compType!==Constants.PHONE_NUMBER&&a.compType!=Constants.NUMBER||a.dataType==Constants.DECIMAL_DATATYPE||"Form Fields"!==a.category||g.push({id:"${"+a.linkName+"}",text:a.dispName,value:"${"+a.linkName+"}",title:a.linkName})});0<g.length&&f.push({text:i18n["zc.formedit.form.formfields"],children:g});wfActionUtil.bindSelect2forInputBox({showTitle:!1,ele:$(d).find(":input[name\x3dtoNumber]"),
data:f,multiselect:!1,allowUserInput:!0,allowClear:!0})}else $(d).find(":input[name\x3dtoNumber]").attr("placeholder",i18n["zc.workflow.builder.customschedule.smsconfig.mobnopltext"])};this.getReferField=function(){var a=[],d=[],e=[],f=[],g=[Constants.FILE_UPLOAD,Constants.IMAGE,Constants.SECTION,Constants.PLAIN_TEXT,Constants.AUDIO,Constants.VIDEO,Constants.SIGNATURE,Constants.ANNOTATION],h=["subform","integration"];$.each(b.formFields,function(a,c){a={};if(0<=$.inArray(c.compType,g)||0<=$.inArray(c.fieldType,
h))return!0;if(c.hasOwnProperty("compFields")){var b=[];$.each(c.compFields,function(a,d){debugger;a=$("#isCompositeComponent").val();let e=c.linkName+"."+d.linkName;"false"==a&&(e=d.linkName);b.push({id:"${"+e+"}",text:"\u00a0\u00a0"+d.dispName,value:"${"+d.linkName+"}",title:e})});a={id:"${"+c.linkName+"}",value:"${"+c.linkName+"}",text:"\u00a0"+c.dispName,children:b,title:c.linkName}}else a={id:"${"+c.linkName+"}",text:"\u00a0"+c.dispName,value:"${"+c.linkName+"}",title:c.linkName};$.isEmptyObject(a)||
("Form Fields"==c.category?d.push(a):"System Fields"==c.category?e.push(a):f.push(a))});0<f.length&&a.push({text:i18n["zc.formedit.form.zohovaraibles"],children:f});0<e.length&&a.push({text:i18n["zc.formedit.form.systemfields"],children:e});0<d.length&&a.push({text:i18n["zc.formedit.form.formfields"],children:d});return a};this.emailEvents=function(c){var d=$(a.alertEle).find("#EmailConfig"),e=$(d).find("input[name\x3demailSubject]");wfActionUtil.bindInsertFieldsTooltip(e,b.wfType,b.formFields);$(d).find("input[name\x3demailIncludeFieldValues]").on("change",
function(){this.checked?$(d).find("#templateCon").removeClass("hide"):$(d).find("#templateCon").addClass("hide");$(d).find("select[name\x3demailTemplateStr]").data("select2").val("default2")});$(d).find("select[name\x3dreportAttachment]").on("change",function(){var a=$(this).val(),c=$(this).find(":selected").attr("reporttype"),b=$(d).find("select[name\x3dfileType]");"report"===c?(b.data("zcdd").setValue("PDF"),b.data("zcdd").disable()):b.data("zcdd").enable();""!=a?b.closest(".zc-dem-form-group").smoothShow(300):
b.closest(".zc-dem-form-group").smoothHide(300)});$(d).find("select[name\x3dreportAttachment]").zcDropDown({allowClear:!0});e=$(d).find("input#referFields");var f=a.getReferField();wfActionUtil.bindSelect2forInputBox({showTitle:!0,ele:$(e),data:f,multiselect:!1,allowUserInput:!1});$(d).find("input#referFields").on("change",function(){ZE_Init.creatorObj.insertHTML($(this).val());$(this).data("zcdd").setValue("")});$(d).find("div[elename\x3dmessageBox]").length&&(e=$(d).find("div[elename\x3dmessageBox]").get(),
$(e).attr("id",$(e).attr("id")+"_"+Math.floor(1E7*Math.random()+1)),addRichTextEditor(e,"237",!1,!1),b.messageBox=ZE_Init.creatorObj,$(d).find(".zc-dem-messageeditor").addClass("form-rtf"));$(d).removeDoublequotes();$(d).find("a[elename\x3demailToLinks]").on("click",function(){var a=$(this).attr("linkname"),c=$(d).find("div[elename\x3d"+a+"]");if($(c).is(":visible")){$(c).clearError();$(c).smoothHide(300,function(){}).addClass("hide");$(c).find("input[name\x3demail"+a.substr(3)+"]").data("zcdd").setValue("");
var b=$(d).find("a[elename\x3demailToLinks][linkname\x3d"+a+"]");b.smoothShow(300,function(){b.focus()}).removeClass("zc-hide")}else $(this).smoothHide(300,function(){}).addClass("zc-hide").focus(),$(c).smoothShow(300,function(){}).removeClass("hide"),$(c).find("input:first").focus()});e=[];f={text:i18n["zc.formedit.form.zohovaraibles"],children:[{id:"zoho.adminuserid",text:i18n["zc.workflowbuilder.adminuserid"],value:"zoho.adminuserid"},{id:"zoho.loginuserid",text:i18n["zc.workflowbuilder.loginuserid"],
value:"zoho.loginuserid"}]};b.wfType==Constants.DATE_SCHEDULE_WF&&f.children.pop();e.push(f);var g=[],h=[];f=[];$.map(b.formFields,function(a,c){a.compType==Constants.EMAIL_ADDRESS&&"Form Fields"==a.category&&(c={id:"${"+a.linkName+"}",text:a.dispName,value:"${"+a.linkName+"}",title:a.linkName},g.push(c));a.compType==Constants.FILE_UPLOAD&&(c={id:"${"+a.linkName+"}",text:a.dispName,value:"${"+a.linkName+"}",title:a.linkName},h.push(c))});0<g.length&&e.push({text:i18n["zc.formedit.form.formfields"],
children:g});0<h.length&&f.push({text:i18n["zc.formedit.form.formfields"],children:h});c==Constants.APPROVAL_WF&&e.push({text:i18n["zc.formedit.form.approvalvariable"],children:[{id:"${approver.submitter}",text:i18n["zc.workflowbuilder.submitter"],value:"${approver.submitter}"},{id:"${approver.next}",text:i18n["zc.workflowbuilder.nextApprover"],value:"${approver.next}"},{id:"${approver.current}",text:i18n["zc.workflowbuilder.currentApprover"],value:"${approver.current}"},{id:"${approver.all}",text:i18n["zc.workflowbuilder.allapprovers"],
value:"${approver.all}"}]});var k=[];c=$(d).find("input[elename\x3dverifiedEmails]").val();null!=c&&2<c.length&&(c=JSON.parse(c),$.each(c,function(a,c){k.push({id:c,text:c,value:c})}));"true"==$(d).find("input[elename\x3disEmailVerifyAllowed]").val()&&k.push({id:"Add New Email",text:i18n["zc.workflowbuilder.addnewmail"],value:"Add New Email"});wfActionUtil.bindSelect2forInputBox({ele:$(d).find(":input[name\x3demailTo],:input[name\x3demailCc],:input[name\x3demailBcc],:input[name\x3demailReplyTo]"),
data:e,multiselect:!0,allowUserInput:!0});wfActionUtil.bindSelect2forInputBox({ele:$(d).find(":input[name\x3dfileAttachments]"),data:f,multiselect:!0,allowUserInput:!1});0<k.length&&e.push({text:i18n["zc.workflowbuilder.verifiedemail"],children:k});wfActionUtil.bindSelect2forInputBox({showTitle:!1,ele:$(d).find(":input[name\x3demailFrom]"),data:e,multiselect:!1,allowUserInput:!1});a.data=e;var l=$(d).find("input[name\x3demailFrom]").data("preVal",this.value),q=function(c){var b=c.emailId;$.each(a.data,
function(a,c){c.text==i18n["zc.workflowbuilder.verifiedemail"]&&(c.children.pop({id:"Add New Email",text:i18n["zc.workflowbuilder.addnewmail"],value:"Add New Email"}),c.children.push({id:b,text:b,value:b}),c.children.push({id:"Add New Email",text:i18n["zc.workflowbuilder.addnewmail"],value:"Add New Email"}))});$(l).data("zcdd").destroy();$(l).val(b);$(l).data("preVal",b);wfActionUtil.bindSelect2forInputBox({ele:l,data:a.data,multiselect:!1,allowUserInput:!1})},n=function(){$(l).data("zcdd").setValue($(l).data("preVal"))};
$(l).on("change",function(){if("Add New Email"==$(l).val()){var a=appbuilder.component.APP.getAppEditUrl()+"/checkVerifiedEmailLimit";checkVerifiedEmailLimit({limitSuccessCallBk:function(a){a={popupBodyEl:$(a),otpSuccessCallback:q,failCallback:n,csrfToken:variable.csrfToken,verifyURL:appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/edit/addVerifyEmailAddress"};showVerifyEmailPopup(a)},upgradeCancelCallBk:n,limitCheckURL:a})}else $(l).data("preVal",this.value)})};this.pushNotificationEvents=
function(){if($("#pushConfig").length){this.getUserListByRange=function(c,b){a.lazyLoadingObj.filterValue=b;b={startIndex:a.lazyLoadingObj.startIndex,noOfRecords:a.lazyLoadingObj.noOfRecords,filterValue:void 0==a.lazyLoadingObj.filterValue?"":a.lazyLoadingObj.filterValue};$.ajax({url:wfActionUtil.getWorkflowUrl()+"/getUserListByRange",type:"GET",data:b,success:function(b,d,e){b&&(a.lazyLoadingObj.totalUsersCount=b.TOTAL_USERS_COUNT,a.lazyLoadingObj.startIndex=b.NEXT_START_INDEX,a.lazyLoadingObj.toIndex=
b.TO_INDEX,a.hasMore=a.lazyLoadingObj.toIndex>=a.lazyLoadingObj.totalUsersCount?!1:!0,a.pushNotificationSelect2Bind(b.USERS,c))}})};this.pushNotificationSelect2Bind=function(c,d){let e=d?$("#sendToUsers"):$("#sendToUsers").html(""),f=d?a.select2Continer[0].scrollHeight:0;for(var g=0;g<c.length;g++)if(d){var q=new Option(c[g].emailId,c[g].emailId,!1,!1);e.append(q);$("#sendToUsers").data("zcdd").open()}else q=$("\x3coption/\x3e").attr({value:c[g].emailId}).text(c[g].emailId),e.append(q);d?e.trigger("change"):
(e.data("zcdd")&&e.data("zcdd").destroy(),e.zcDropDown(),a.select2Continer=$($("#sendToUsers").data("select2").dropdown).find(".select2-results"),a.bindScrollEventForUsers());let n;e.data("select2").search.off("keyup").on("keyup",function(){clearTimeout(n);if(a.hasMore||""!=a.lazyLoadingObj.filterValue){var c=this;n=setTimeout(function(){a.lazyLoadingObj.prevSelectedValue=e.data("zcdd").getValue();var b=$(c).val().trim();a.lazyLoadingObj.filterValue&&0==b.length&&(a.lazyLoadingObj.startIndex=1,a.getUserListByRange(!1,
b),$("#sendToUsers").data("zcdd").open());1<b.length&&(a.lazyLoadingObj.startIndex=1,a.getUserListByRange(!1,b))},2E3)}});b.isEdit&&(c=$(b.wfActionEle).find("#pushConfig").find("input[name\x3dsendTo]"),"users"==$("#pushConfig").find("select[name\x3dsenderType] option:selected").val()&&(c=$(c).val().split(","),a.addOptions(e,c)));a.lazyLoadingObj.prevSelectedValue&&a.addOptions(e,a.lazyLoadingObj.prevSelectedValue);(d||""!=a.lazyLoadingObj.filterValue)&&e.data("zcdd").open();e.data("zcdd").afterOpen(function(){""!=
a.lazyLoadingObj.filterValue&&(e.data("select2").search.val(a.lazyLoadingObj.filterValue),e.data("select2").search.focus())});e.data("zcdd").change(function(){e.data("select2").search.val(a.lazyLoadingObj.filterValue)});d&&a.select2Continer.scrollTop(f)};this.addOptions=function(a,c){for(i=0;i<c.length;i++)if(!a.find("option[value\x3d'"+c[i]+"']").length){var b=new Option(c[i],c[i],!0,!0);a.append(b)}a.data("zcdd").setValue(c)};this.bindScrollEventForUsers=function(){a.select2Continer.scroll(function(){$(this)[0].scrollHeight-
$(this).scrollTop()<=$(this).outerHeight()&&!(a.lazyLoadingObj.toIndex>=a.lazyLoadingObj.totalUsersCount)&&(a.lazyLoadingObj.prevSelectedValue=$("#sendToUsers").data("zcdd").getValue(),a.getUserListByRange(!0,a.lazyLoadingObj.filterValue))})};a.getUserListByRange(!1,"");var c=$(a.alertEle).find("#pushConfig"),d=$(c).find("input[name\x3dsendTo]"),e=$(c).find("input[name\x3dtitle]");wfActionUtil.bindInsertFieldsTooltip(e,b.wfType,b.formFields);e=$(c).find("textarea[name\x3dpushMessage]");wfActionUtil.bindInsertFieldsTooltip(e,
b.wfType,b.formFields);$(c).find("select[name\x3dsenderType]").on("change",function(){$(c).find("div[elename\x3dpush-users], div[elename\x3dpush-fields]").addClass("hide");var a=$(c).find("div[elename\x3dpush-"+$(this).val()+"]");$(a).removeClass("hide");$(d).val($(a).find("select[id\x3dsendToUsers], select[id\x3dsendToFields]").val())});$(c).find("select[id\x3dsendToUsers], select[id\x3dsendToFields]").on("change",function(){$(d).val($(this).val())});$(c).find("input[id\x3dsendToUsers], select[id\x3dsendToFields]").on("change",
function(){$(d).val($(this).val())})}};this.successMsgEvents=function(){var c=$(a.alertEle).find("div[id\x3dsuccessMsg][elename\x3daction-config]");c=$(c).find("textarea[name\x3dsuccessMessage]");wfActionUtil.bindInsertFieldsTooltip(c,b.wfType,b.formFields)};this.redirectUrlEvents=function(){var c=$(a.alertEle).find("div[id\x3dredirectUrl][elename\x3daction-config]");let d=$(c).find("input[name\x3dredirectWebsite]");wfActionUtil.bindInsertFieldsTooltip(d,b.wfType,b.formFields);$(c).find("div[redirecttype\x3durl]").removeClass("hide");
$(c).find("select[name\x3dredirectType]").on("change",function(){var a=$(this).val();$(c).find("div[elename\x3dredirect-config]").addClass("hide");$(c).find("div[elename\x3dredirect-config] select").removeAttr("name");$(c).find("div[redirecttype\x3d"+a+"]").find("select").attr("name","redirectComponent");$(c).find("div[redirecttype\x3d"+a+"]").removeClass("hide");$(c).clearError()})};this.setDefaultMessages=function(){if(!b.isEdit&&b.wfType==Constants.FORM_WF){var c="",d="",e="";switch(b.eventType){case "1":c=
"${zoho.loginuserid} "+i18n["zc.workflow.defaultmsg.added"]+" "+b.formDispName;d=i18n["zc.workflow.defaulttitle.added"];e=i18n["zc.workflow.defaultsuccessmsg.added"];break;case "2":c="${zoho.loginuserid} "+i18n["zc.workflow.defaultmsg.updated"]+" "+b.formDispName;d=i18n["zc.workflow.defaulttitle.updated"];e=i18n["zc.workflow.defaultsuccessmsg.updated"];break;case "3":c="${zoho.loginuserid} "+i18n["zc.workflow.defaultmsg.deleted"]+" "+b.formDispName;d=i18n["zc.workflow.defaulttitle.deleted"];e=i18n["zc.workflow.defaultsuccessmsg.deleted"];
break;case "4":c="${zoho.loginuserid} "+i18n["zc.workflow.defaultmsg.addedorupdated"]+" "+b.formDispName,d=i18n["zc.workflow.defaulttitle.addedorupdated"],e=i18n["zc.workflow.defaultsuccessmsg.addedorupdated"]}$(a.alertEle).find("div[id\x3dSMSConfig][elename\x3daction-config]").find("textarea[name\x3dsmsMessage]").text(c);$(a.alertEle).find("#EmailConfig").find("input[name\x3demailSubject]").val(d);$(a.alertEle).find("#EmailConfig").find("textarea[name\x3demailMessage]").text(c);$(a.alertEle).find("#pushConfig").find("input[name\x3dtitle]").val(d);
$(a.alertEle).find("#pushConfig").find("textarea[name\x3dpushMessage]").text(c);$(a.alertEle).find("#successMsg").find("textarea[name\x3dsuccessMessage]").text(e)}}};
var dataAccessBind=function(b,a){_dataAccess=this;_dataAccess.actionElem=a;_dataAccess.criteriaContainer=$(_dataAccess.actionElem).find("div[elename\x3ddata-access-criteria-cont]");_dataAccess.formFields=[];_dataAccess.compSubFields={};_dataAccess.dropDownFieldsOptions={};_dataAccess.zcddMeta=[];_dataAccess.taskType=null;_dataAccess.formLinkname=null;_dataAccess.isEdit=!1;this.registerEvents=function(){$(_dataAccess.actionElem).find("select[name\x3dselectForm]").on("change",function(){var a=$(this).val(),
d=$(this).find(":selected").attr("name");$(this).find(":selected").attr("displayName");_dataAccess.formLinkname=d;_dataAccess.taskType=parseInt($(_dataAccess.actionElem).find("input[name\x3dtaskType]").val());_dataAccess.isEdit=!1;$(_dataAccess.actionElem).find("div[elename\x3dmandatorysetfields]").empty();$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]").empty();$(_dataAccess.actionElem).find("span[elename\x3ddataAccessCrit]").text("");$(_dataAccess.actionElem).find("form[name\x3ddata-access]").clearError();
d={};d.formid=a;d.baseFormLinkName=b.formLinkName;d.zccpn=b.constants.csrfToken;d.sb_tracking=!1;$.ajax({url:appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/edit/getRestrictedFormFields",type:"GET",data:d,success:function(a,c,b){_dataAccess.formFields=a.formFields;_dataAccess.compSubFields=a.compSubFields;_dataAccess.dropDownFieldsOptions=a.dropDownFieldsOptions;_dataAccess.hideUnrelatedContainers(_dataAccess.taskType,!0);20!=_dataAccess.taskType&&21!=_dataAccess.taskType||_dataAccess.constructDataAccessForm()}})});
$(_dataAccess.actionElem).find("input:radio[name\x3dupdateRecCritOption]").on("change",function(){if("criteria"===this.value){$(_dataAccess.criteriaContainer).removeClass("hide").removeAttr("style");$(_dataAccess.criteriaContainer).find("span").text(i18n["zc.workflowbuilder.updreccrit"]);$(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-setfield-header]").find("span").text(i18n["zc.workflowbuilder.updrecset"]);var a=$(_dataAccess.actionElem).find("span[elename\x3ddataAccessCrit]");
null!=$(a).text()||""!=$(a).text()?b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname,$(a),!0):b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname)}else $(_dataAccess.criteriaContainer).find("div[elename\x3dwfCriteria-dataAccess]").removeAttr("style").addClass("hide")});$(_dataAccess.actionElem).on("change","input[id\x3dsetField]",function(){var a=$(this).closest("div[elename\x3dsetFieldValRow]").find("input[name\x3dsetValue]");
$(this).closest("div[elename\x3dsetFieldValRow]").clearError();$(a).val("");void 0!=$(a).data("zcdd")&&$(a).data("zcdd").destroy();void 0!=$(a).data("dtpicker")&&$(a).data("dtpicker").destroy();var b=$(this).data("zcdd").getData();if(b.compType==Constants.NAME||b.compType==Constants.ADDRESS)_dataAccess.constructCompRow(b,!1,$(this).closest("div[elename\x3dsetFieldValRow]")),$(this).closest("div[elename\x3dsetFieldValRow]").remove();else if(b.compType==Constants.INLINE_SINGLE_SELECT||b.compType==Constants.SINGLE_SELECT||
b.compType==Constants.LINK_FIELD&&b.linkFieldType==Constants.AR_LINK_FIELD){var e=_dataAccess.dropDownFieldsOptions[b.value],f=[],g;for(g in e)b.compType==Constants.INLINE_SINGLE_SELECT||b.compType==Constants.LINK_FIELD&&b.linkFieldType==Constants.AR_LINK_FIELD?f.push({id:e[g],value:e[g],text:e[g]}):b.compType==Constants.SINGLE_SELECT&&"Current Record"==e[g]&&f.push({id:"${ID}",value:e[g],text:e[g]});$(a).zcDropDown({placeholder:"-Select-",data:f})}b.compType==Constants.DATE||b.compType==Constants.DATE_TIME||
b.compType==Constants.TIME?($(a).next().remove(),_dataAccess.bindDateTimeEvents(a,b.compType,b.timeFormat)):$(a).next().remove()});$(_dataAccess.actionElem).on("click","span[elename\x3daddField]",function(a){a=$(this);var c=$(a).attr("iscompositefield"),b=$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone();b.removeAttr("id").removeClass("hide");"true"==c?$(b).insertAfter($(a).closest("div[elename\x3dzc-wfb-otheraddr-group]")):$(b).insertAfter($(a).parent("div[elename\x3dsetFieldValRow]"));
$(b).find("input[name\x3dsetField]").zcDropDown({data:_dataAccess.zcddMeta})});$(_dataAccess.actionElem).on("click","span[elename\x3dremoveField]",function(a){a=$(this);var c=$(a).closest("div[elename\x3dothersetfields]");"true"==$(a).attr("iscompositefield")?$(a).closest("div[elename\x3dzc-wfb-otheraddr-group]").remove():$(a).parent().remove();0==$(c).find("div[elename\x3dsetFieldValRow]").length+$(c).find("div[elename\x3dzc-wfb-otheraddr-group]").length&&(rowElem=$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone(),
rowElem.removeAttr("id").removeClass("hide"),$(c).append(rowElem),$(rowElem).find("input[name\x3dsetField]").zcDropDown({data:_dataAccess.zcddMeta}))})};this.constructDataAccessForm=function(){_dataAccess.zcddMeta.length=0;if(20==_dataAccess.taskType||21==_dataAccess.taskType)if(_dataAccess.isEdit){var a=[],b=[];$.each(_dataAccess.formFields,function(c,d){if(d.isMandatory&&20==_dataAccess.taskType)a.push(d),d.isComposite?_dataAccess.constructCompRow(d,!0,void 0):_dataAccess.constructRow(d,!0);else{d.isValueSet&&
b.push(d);c={id:d.labelName,value:d.labelName,text:$.parseHTML(d.displayName)[0].data,compType:d.compType,genericType:d.genericType};if(d.compType==Constants.DATE_TIME||d.compType==Constants.TIME)c.timeFormat=d.timeFormat;d.compType==Constants.LINK_FIELD&&(c.linkFieldType=d.linkFieldType);_dataAccess.zcddMeta.push(c)}});0<b.length&&$.each(b,function(a,c){c.isComposite?_dataAccess.constructCompRow(c,!1,void 0):_dataAccess.constructRow(c,!1)});if(0<_dataAccess.formFields.length-a.length&&0==b.length){var e=
$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone();e.removeAttr("id").removeClass("hide");$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]").append(e);$(e).find("input[name\x3dsetField]").zcDropDown({showTitle:!0,data:_dataAccess.zcddMeta})}}else a=[],$.each(_dataAccess.formFields,function(c,b){if(b.isMandatory&&20==_dataAccess.taskType)a.push(b),b.isComposite?_dataAccess.constructCompRow(b,!0,void 0):_dataAccess.constructRow(b,!0);else{c=
{id:b.labelName,value:b.labelName,text:$.parseHTML(b.displayName)[0].data,compType:b.compType,genericType:b.genericType,title:b.labelName};if(b.compType==Constants.DATE_TIME||b.compType==Constants.TIME)c.timeFormat=b.timeFormat;b.compType==Constants.LINK_FIELD&&(c.linkFieldType=b.linkFieldType);_dataAccess.zcddMeta.push(c)}}),e=$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone(),e.removeAttr("id").removeClass("hide"),$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]").append(e),
$(e).find("input[name\x3dsetField]").zcDropDown({showTitle:!0,data:_dataAccess.zcddMeta});0==$(_dataAccess.actionElem).find("div[elename\x3dmandatorysetfields]").children().length?($(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-mandfield]").addClass("hide"),$(_dataAccess.actionElem).find("div[elename\x3dotherfield-header]").addClass("hide")):($(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-mandfield]").removeClass("hide"),$(_dataAccess.actionElem).find("div[elename\x3dotherfield-header]").removeClass("hide"));
0==$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]").children().length?$(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-otherfield]").addClass("hide"):$(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-otherfield]").removeClass("hide")};this.setDataAccessVariables=function(a,b,e){_dataAccess.formFields=void 0!=b?b.formFields:[];_dataAccess.compSubFields=void 0!=b?b.compSubFields:{};_dataAccess.dropDownFieldsOptions=void 0!=b?b.dropDownFieldsOptions:{};
_dataAccess.formLinkname=e;_dataAccess.taskType=parseInt(a);_dataAccess.isEdit=!0};this.constructCompRow=function(a,b,e){var c=$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]"),d="setFieldValRow";b&&20==_dataAccess.taskType&&(c=$(_dataAccess.actionElem).find("div[elename\x3dmandatorysetfields]"),d="setMandFieldValRow");var h=void 0!=e?a.text:$.parseHTML(a.displayName)[0].data,k=_dataAccess.compSubFields[void 0!=e?a.value:a.labelName],l=$("\x3cdiv/\x3e").attr("class","zc-wfb-dataaccess-field-groupfields zc-dem-clearfix");
h=b?$("\x3cspan/\x3e").text(h).append("\x3cem\x3e*\x3c/em\x3e"):$("\x3cspan/\x3e").text(h);h=$("\x3cdiv/\x3e").attr("class","zc-wfb-dataaccess-field-header").attr("elename","zc-wfb-groupfield-header").append(h);l.append(h);if(!b){l.attr("elename","zc-wfb-otheraddr-group");var q=$("\x3cspan/\x3e").attr("elename","addField").attr("class","zc-common-plus zc-em").attr("isCompositeField","true"),n=$("\x3cspan/\x3e").attr("elename","removeField").attr("class","zc-common-trash zc-em").attr("isCompositeField",
"true");q=$("\x3cdiv/\x3e").attr("class","zc-wfb-dataaccess-field-actions flt-right").append(q).append(n);h.append(q)}void 0!=e?$(l).insertAfter(e):$(c).append(l);$.each(k,function(c,e){c=$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone();$(c).removeAttr("id").removeClass("hide").attr("elename",d);$(c).find("span[elename\x3daddField]").remove();$(c).find("span[elename\x3dremoveField]").remove();$(c).find("input[name\x3dsetField]").attr("value",e.labelName).prop("readonly",
"true");l.append(c);var f=b?$.parseHTML(e.displayName)[0].data+"*":$.parseHTML(e.displayName)[0].data;$(c).find("input[name\x3dsetField]").zcDropDown({data:[{value:e.labelName,id:e.labelName,text:f}]});a.isValueSet&&$(c).find("input[name\x3dsetValue]").val(e.fieldValue);if(a.compType==Constants.ADDRESS&&29==e.compType){var g=[];$.each("Afghanistan;Albania;Algeria;American Samoa;Andorra;Angola;Anguilla;Antigua and Barbuda;Argentina;Armenia;Aruba;Australia;Austria;Azerbaijan;Bahamas;Bahrain;Bangladesh;Barbados;Belarus;Belgium;Belize;Benin;Bermuda;Bhutan;Bolivia;Bosnia and Herzegovina;Botswana;Brazil;British Indian Ocean Territory;British Virgin Islands;Brunei;Bulgaria;Burkina Faso;Burundi;Cambodia;Cameroon;Canada;Cape Verde;Caribbean Netherlands;Cayman Islands;Central African Republic;Chad;Chile;China;Christmas Island;Cocos;Colombia;Comoros;Congo;Congo;Cook Islands;Costa Rica;C\u00f4te d\u2019Ivoire;Croatia;Cuba;Cura\u00e7ao;Cyprus;Czech Republic;Denmark;Djibouti;Dominica;Dominican Republic;Ecuador;Egypt;El Salvador;Equatorial Guinea;Eritrea;Estonia;Ethiopia;Falkland Islands;Faroe Islands;Fiji;Finland;France;French Guiana;French Polynesia;Gabon;Gambia;Georgia;Germany;Ghana;Gibraltar;Greece;Greenland;Grenada;Guadeloupe;Guam;Guatemala;Guernsey;Guinea;Guinea-Bissau;Guyana;Haiti;Honduras;Hong Kong;Hungary;Iceland;India;Indonesia;Iran;Iraq;Ireland;Isle of Man;Israel;Italy;Jamaica;Japan;Jersey;Jordan;Kazakhstan;Kenya;Kiribati;Kuwait;Kyrgyzstan;Laos;Latvia;Lebanon;Lesotho;Liberia;Libya;Liechtenstein;Lithuania;Luxembourg;Macau;Macedonia;Madagascar;Malawi;Malaysia;Maldives;Mali;Malta;Marshall Islands;Martinique;Mauritania;Mauritius;Mayotte;Mexico;Micronesia;Moldova;Monaco;Mongolia;Montenegro;Montserrat;Morocco;Mozambique;Myanmar;Namibia;Nauru;Nepal;Netherlands;New Caledonia;New Zealand;Nicaragua;Niger;Nigeria;Niue;Norfolk Island;North Korea;Northern Mariana Islands;Norway;Oman;Pakistan;Palau;Palestine;Panama;Papua New Guinea;Paraguay;Peru;Philippines;Poland;Portugal;Puerto Rico;Qatar;R\u00e9union;Romania;Russia;Rwanda;Saint Barth\u00e9lemy;Saint Helena;Saint Kitts and Nevis;Saint Lucia;Saint Martin;Saint Pierre and Miquelon;Saint Vincent and the Grenadines;Samoa;San Marino;S\u00e3o Tom\u00e9 and Pr\u00edncipe;Saudi Arabia;Senegal;Serbia;Seychelles;Sierra Leone;Singapore;Sint Maarten;Slovakia;Slovenia;Solomon Islands;Somalia;South Africa;South Korea;South Sudan;Spain;Sri Lanka;Sudan;Suriname;Svalbard and Jan Mayen;Swaziland;Sweden;Switzerland;Syria;Taiwan;Tajikistan;Tanzania;Thailand;Timor-Leste;Togo;Tokelau;Tonga;Trinidad and Tobago;Tunisia;T\u00fcrkiye;Turkmenistan;Turks and Caicos Islands;Tuvalu;U.S. Virgin Islands;Uganda;Ukraine;United Arab Emirates;United Kingdom;United States;Uruguay;Uzbekistan;Vanuatu;Vatican City;Venezuela;Vietnam;Wallis and Futuna;Western Sahara;Yemen;Zambia;Zimbabwe;\u00c5land Islands".split(";"),
function(a,c){c=c.trim();g.push({value:c,id:c,text:c})});$(c).find("input[name\x3dsetValue]").zcDropDown({placeholder:"-Select-",data:g})}if(a.compType==Constants.NAME&&e.compType==Constants.INLINE_SINGLE_SELECT){e=_dataAccess.dropDownFieldsOptions[e.labelName];f=[];for(var h in e)f.push({id:e[h],value:e[h],text:e[h]});$(c).find("input[name\x3dsetValue]").zcDropDown({placeholder:"-Select-",data:f})}})};this.constructRow=function(a,b){var c=$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]"),
d="setFieldValRow";b&&20==_dataAccess.taskType&&(c=$(_dataAccess.actionElem).find("div[elename\x3dmandatorysetfields]"),d="setMandFieldValRow");var g=$(_dataAccess.actionElem).find("div[id\x3drowDivForClone][elename\x3dsetFieldValRow]").clone();$(g).removeAttr("id").removeClass("hide").attr("elename",d);$(g).find("input[name\x3dsetField]").attr("value",a.labelName);b&&($(g).find("span[elename\x3daddField]").remove(),$(g).find("span[elename\x3dremoveField]").remove(),$(g).find("input[name\x3dsetField]").prop("readonly",
"true"));$(c).append(g);b?$(g).find("input[name\x3dsetField]").zcDropDown({data:[{id:a.labelName,value:a.labelName,text:$.parseHTML(a.displayName)[0].data+"*",compType:a.compType,genericType:a.genericType}]}):$(g).find("input[name\x3dsetField]").zcDropDown({data:_dataAccess.zcddMeta});b=$(g).find("input[name\x3dsetValue]");a.isValueSet&&$(b).val(a.fieldValue);if(a.compType==Constants.DATE||a.compType==Constants.DATE_TIME||a.compType==Constants.TIME)$(b).next().remove(),_dataAccess.bindDateTimeEvents(b,
a.compType,a.timeFormat);else if(a.compType==Constants.INLINE_SINGLE_SELECT||a.compType==Constants.SINGLE_SELECT||a.compType==Constants.LINK_FIELD&&a.linkFieldType==Constants.AR_LINK_FIELD){c=_dataAccess.dropDownFieldsOptions[a.labelName];d=[];for(var h in c)a.compType==Constants.INLINE_SINGLE_SELECT||a.compType==Constants.LINK_FIELD&&a.linkFieldType==Constants.AR_LINK_FIELD?d.push({id:c[h],value:c[h],text:c[h]}):a.compType==Constants.SINGLE_SELECT&&"Current Record"==c[h]&&d.push({id:"${ID}",value:c[h],
text:c[h]});$(b).zcDropDown({placeholder:"-Select-",data:d})}};this.hideUnrelatedContainers=function(a,d){_dataAccess.taskType=a;$(_dataAccess.actionElem).find("div[elename\x3dmandatorysetfields]").empty();$(_dataAccess.actionElem).find("div[elename\x3dothersetfields]").empty();$(_dataAccess.actionElem).find("form[name\x3ddata-access]").clearError();var c=$(_dataAccess.actionElem).find("span[elename\x3ddataAccessCrit]");if(d)if(20==_dataAccess.taskType||21==_dataAccess.taskType){if($(_dataAccess.actionElem).find("div[elename\x3ddataaccess-setfield]").removeClass("hide"),
20==_dataAccess.taskType&&($(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-setfield-header]").find("span").text(i18n["zc.workflowbuilder.addrecset"]),$(_dataAccess.criteriaContainer).addClass("hide")),21==_dataAccess.taskType){$(_dataAccess.criteriaContainer).removeClass("hide").removeAttr("style");$(_dataAccess.criteriaContainer).find("span").text(i18n["zc.workflowbuilder.updreccrit"]);$(_dataAccess.actionElem).find("div[elename\x3dzc-wfb-dataaccess-setfield-header]").find("span").text(i18n["zc.workflowbuilder.updrecset"]);
a=$(_dataAccess.actionElem).find("div[elename\x3ddata-access-updaterec-criteriacont]").find("input:radio[name\x3dupdateRecCritOption]");_dataAccess.isEdit||void 0!=f||$(_dataAccess.actionElem).find("div[elename\x3ddata-access-updaterec-criteriacont]").find('input:radio[name\x3dupdateRecCritOption][value\x3d"current"]').attr("checked","true");var f=$($(_dataAccess.actionElem).find("div[elename\x3ddata-access-updaterec-criteriacont]").find("input:radio[name\x3dupdateRecCritOption]:checked")).val();
b.formLinkName==_dataAccess.formLinkname?($(_dataAccess.actionElem).find("div[elename\x3ddata-access-updaterec-criteriacont]").removeClass("hide"),$(a).removeAttr("disabled"),"current"==f?$(_dataAccess.criteriaContainer).find("div[elename\x3dwfCriteria-dataAccess]").removeAttr("style").addClass("hide"):($(_dataAccess.criteriaContainer).find("div[elename\x3dwfCriteria-dataAccess]").removeAttr("style").removeClass("hide"),null!=$(c).text()||""!=$(c).text()?b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",
_dataAccess.formLinkname,$(c),!0):b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname))):($(_dataAccess.actionElem).find("div[elename\x3ddata-access-updaterec-criteriacont]").addClass("hide"),$(a).attr("disabled","true"),null!=$(c).text()||""!=$(c).text()?b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname,$(c),!0):b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname))}}else $(_dataAccess.actionElem).find("div[elename\x3ddataaccess-setfield]").addClass("hide"),
$(_dataAccess.criteriaContainer).removeClass("hide").removeAttr("style"),$(_dataAccess.criteriaContainer).find("span").text(i18n["zc.workflowbuilder.delreccrit"]),null!=$(c).text()||""!=$(c).text()?b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname,$(c),!0):b.criteriaBuilder.loadCriteriaBuilder("wfCriteria-dataAccess",_dataAccess.formLinkname);else _dataAccess.taskType==a,$(_dataAccess.actionElem).find("#dataAccessInput").removeClass("hide"),$(_dataAccess.criteriaContainer).addClass("hide"),
$(_dataAccess.actionElem).find("div[elename\x3ddataaccess-setfield]").addClass("hide"),c=20==a?i18n["zc.workflowbuilder.addformselect"]:21==a?i18n["zc.workflowbuilder.updateformselect"]:i18n["zc.workflowbuilder.deleteformselect"],$(_dataAccess.actionElem).find("#formSelectLabel").text(c)};this.enableDtPicker=function(a,b,e){b==Constants.DATE?$(a).dtPicker({format:variable.dateformat.toUpperCase().replace("E","ddd"),keepInvalid:!0,defaultDate:!1,customInput:!0}):b==Constants.DATE_TIME?$(a).dtPicker({format:variable.dateformat.toUpperCase().replace("E",
"ddd")+" "+e,keepInvalid:!0,defaultDate:!1,customInput:!0}):b==Constants.TIME&&$(a).dtPicker({format:e,keepInvalid:!0,defaultDate:!1,customInput:!0})};this.bindDateTimeEvents=function(a,b,e){var c=$(a).parent();$(c).addClass("zc-dem-field-withicon-right");b==Constants.DATE?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-calendar"\x3e\x3c/i\x3e'):b==Constants.DATE_TIME?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon calTimeIcon flLeft zc-em zc-fb-date-Time"\x3e\x3c/i\x3e'):
b==Constants.TIME&&$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-time"\x3e\x3c/i\x3e');_dataAccess.enableDtPicker($(a),b,e);$(c).find(".zc-dem-date-picker-icon").off("click").on("click",function(){$(a).focus()});$(a).off("keyup").on("keyup",function(){void 0!=$(this).data("dtpicker")&&($(this).data("dtpicker").destroy(),$(a).focus(),b==Constants.DATE?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-calendar"\x3e\x3c/i\x3e'):
b==Constants.DATE_TIME?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon calTimeIcon flLeft zc-em zc-fb-date-Time"\x3e\x3c/i\x3e'):b==Constants.TIME&&$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-time"\x3e\x3c/i\x3e'),$(c).find(".zc-dem-date-picker-icon").off("click").on("click",function(){_dataAccess.enableDtPicker($(a),b,e);$(a).focus()}))});$(a).off("mouseup").on("mouseup",function(){void 0!=$(this).data("dtpicker")&&
($(this).data("dtpicker").destroy(),$(a).focus(),b==Constants.DATE?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-calendar"\x3e\x3c/i\x3e'):b==Constants.DATE_TIME?$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon calTimeIcon flLeft zc-em zc-fb-date-Time"\x3e\x3c/i\x3e'):b==Constants.TIME&&$(a).after('\x3ci id\x3d"zc-dtpicker-icon" class\x3d"zc-dem-date-picker-icon wb-timeicon zc-em zc-common-time"\x3e\x3c/i\x3e'),
$(c).find(".zc-dem-date-picker-icon").off("click").on("click",function(){_dataAccess.enableDtPicker($(a),b,e);$(a).focus()}))});$(c).find(".zc-dem-date-picker-icon").off("mousedown").on("mousedown",function(){_dataAccess.enableDtPicker($(a),b,e)})}};class BlueprintDashboard{constructor(b){this.config=b;this.formList=null;this.wfContainer=$("#workflowListContainer").find("div[elename\x3dwfTableContainer]");this.parentNavigationContainer=$("#workflowfilterNav .zc-dem-worlflow-filter");this.bp_formListContainer=$("#blueprintFormlist");this.wf_formListContainer=$("#worlflowFormlist");this.wf_formventContainer=$("#worlflowFormevent");this.withWorkflowFormEle=this.bp_formListContainer.find(".zc-formlist-withwf");this.withOutWorkflowFormEle=this.bp_formListContainer.find(".zc-formlist-withoutwf");
this.noResultClass=".zc-dem-formwf-noresult";this.IsInitCompleted=!1;this.tableListContainer=null;this.formSearchContainer=$("#dem-app-bp-search-field");this.noDataBwScreenEle=$("#bp-wf-nodata-screen");this.noDataFwScreenEle=$("#blueprint-workflow-nodata-screen");this.noDataFlag=!1;this.bp_TableContainer=$("#WfblurpintTable");this.bp_TableBody=$("#bp-table-body");this.ZCScrollContainer=$("#bp-table-container");this.showCreateWorkflow=!1;this.formName=void 0;this.isUpdateNeeded=this.noForms=!1;this.tableObj=
{tableContainer:$("#workflowTable"),nodata_workflowContainer:$("#no-workflow")}}init(){this.getFormList();this.IsInitCompleted=!0}getFormList(){let b=this;$.ajax({url:wfActionUtil.getWorkflowUrl()+"/getBlueprintForms",type:"GET",data:{sb_tracking:!1},beforeSend:wfActionUtil.showLoadingContainer(),success:function(a,c,d){b.formList=a;b.bind();b.getWorkflowData()},error:function(a){wfActionUtil.hideLoadingContainer()}})}bind(){let b=this;this.constructFormNameUl();b.setDefaultFormName();this.bp_formListContainer.parent().removeClass("hide");
this.parentNavigationContainer.removeClass("hide");this.parentNavigationContainer.find(".zc-dem-worlflow-leftarrow").addClass("zc-hide");this.bp_formListContainer.zcScrollPane({autoReinit:!0});this.bp_formListContainer.off("click","ul li").on("click","ul li",function(){b.bp_formListContainer.find("li").removeClass("active");$(this).addClass("active");b.formName=$(this).attr("formLinkName");b.getWorkflowData()});this.bp_formListContainer.off("click","a").on("click","a",function(){$(this).parent().find("ul").slideToggle();
$(this).parent().toggleClass("toggle")});this.formSearchContainer.on("keyup",function(){let a=$(this).val().trim().toLowerCase();b.showFormContainer();b.bp_formListContainer.find("li").filter(function(){$(this).toggle(-1<$(this).attr("formdisplayname").toLowerCase().indexOf(a))});0<b.withWorkflowFormEle.find("li:visible").length?b.withWorkflowFormEle.find(b.noResultClass).addClass("zc-hide"):b.withWorkflowFormEle.find(b.noResultClass).removeClass("zc-hide");0<b.withOutWorkflowFormEle.find("li:visible").length?
b.withOutWorkflowFormEle.find(b.noResultClass).addClass("zc-hide"):b.withOutWorkflowFormEle.find(b.noResultClass).removeClass("zc-hide")})}showFormContainer(){this.withWorkflowFormEle.addClass("toggle");this.withWorkflowFormEle.find("ul").css("display","block");this.withOutWorkflowFormEle.addClass("toggle");this.withOutWorkflowFormEle.find("ul").css("display","block")}constructFormNameUl(){let b=this.formList.FORMS_WITH_WORKFLOWS,a=this.formList.FORMS_WITHOUT_WORKFLOWS;this.withWorkflowFormEle.find("ul").html("");
this.withOutWorkflowFormEle.find("ul").html("");this.withWorkflowFormEle.addClass("zc-hide");this.withOutWorkflowFormEle.addClass("zc-hide");b&&0<b.length&&(this.bindFormAttributes(this.withWorkflowFormEle,b,"withWf"),this.withWorkflowFormEle.removeClass("zc-hide"));a&&0<a.length&&(this.bindFormAttributes(this.withOutWorkflowFormEle,a,"withOutWf"),this.withOutWorkflowFormEle.removeClass("zc-hide"))}bindFormAttributes(b,a,c){var d=b.find(this.noResultClass);b=b.find("ul").html("");0==a.length?d.removeClass("zc-hide"):
d.addClass("zc-hide");for(d=0;d<a.length;d++){let e=a[d],f=$("\x3cli/\x3e"),g=$("\x3ca/\x3e");f.attr("formDisplayName",e.formDisplayName);f.attr("formLinkName",e.formLinkName);f.attr("formStatus",c);g.text(e.formDisplayName);b.append(f);f.append(g);g.append("\x3ci class\x3d'zc-em zc-common-form'\x3e\x3c/i\x3e")}}getWorkflowData(){let b=this;this.formName&&$.ajax({url:wfActionUtil.getWorkflowUrl()+"/getBlueprintworkflowList",type:"GET",data:{formLinkName:b.formName,sb_tracking:!1},beforeSend:wfActionUtil.showLoadingContainer(),
success:function(a,c,d){wfActionUtil.hideLoadingContainer();b.noDataFlag=a&&0<a.length?!1:!0;b.workflowList=a;b.tableCreation(a);b.ZCScrollContainer.zcScrollPane().destroy();b.ZCScrollContainer.zcScrollPane({autoReinit:!0});b.bindTableAction();b.bindToggle();b.showBluePrintDashboard();b.showNoDataScreen(b.noDataFlag)},error:function(a){wfActionUtil.hideLoadingContainer();b.showNoDataScreen(!0)}})}setDefaultFormName(){if("undefined"===typeof BluePrintMeta){var b=this.withWorkflowFormEle.find("li").first().attr("formlinkname");
void 0==b&&(b=this.withOutWorkflowFormEle.find("li").first().attr("formlinkname"))}else b=BluePrintMeta.meta.formLinkName;void 0==b?this.showNoDataScreen(!0):(this.formName=b,this.setActiveFormName())}isWorklfowEmpty(){return 0==this.bp_TableBody.find("tr").length}setActiveFormName(){this.bp_formListContainer.find("li[formlinkname]").removeClass("active");this.bp_formListContainer.find("li[formlinkname\x3d"+this.formName+"]").addClass("active")}activeFilters(){return{formName:this.formName?this.formName:
$("#blueprintFormlist").find(".active").attr("formlinkname")}}tableCreation(b){this.bp_TableBody.html("");let a=$("\x3ctbody/\x3e");for(let c=0;c<b.length;c++){let d=this.rowCreation(b[c]);a.append(d)}1<this.workflowList.length&&this.tableDragAndDrop(a);this.bp_TableBody.append(a)}rowCreation(b){let a=$("#bp_ClonedRow").find("tr").clone(!0,!0);$(a).attr({formlinkName:b.formLinkName,formDispName:b.formDispName,workflowname:b.ruleDispName,ruleLinkName:b.ruleLinkName,class:"sortable-row"});let c=$(a).find("td[elename\x3ddispNameCol]");
$(c).find("i[name\x3dwfIcon]").addClass("zc-em zc-blue_print_icon");$(c).children("span[elename\x3dformDispName]").text(b.formDispName);$(c).children("p[elename\x3dwfDispName]").attr("encodedName",b.ruleLinkName).find("a").attr({href:"/appbuilder/"+variable.scopeName+"/"+variable.appLinkName+"/blueprint/"+b.ruleLinkName+"/edit"}).text(b.ruleDispName);0==b.status?$(a).find('[elname\x3d"statusBtn"]').removeAttr("checked"):$(a).find('[elname\x3d"statusBtn"]').attr("checked");$(a).find("td[elename\x3dcreatedonCol]").text(b.createdon);
return a}bindTableAction(){let b=this;this.bp_TableContainer.off("click","p[elename\x3dwfDispName]").on("click","p[elename\x3dwfDispName]",function(a){var c=$(this).closest("tr[elename\x3dworkflowRow]");b.getBlueprint({bpLinkName:$(c).attr("rulelinkname"),bpDispName:$(c).find("p[elename\x3dwfDispName]").find("a").text()});a.preventDefault();a.stopPropagation()});this.bp_TableContainer.off("click","a[elename\x3ddeleteBtn]").on("click","a[elename\x3ddeleteBtn]",function(a){var c=$(this).closest("tr[elename\x3dworkflowRow]");
b.deleteBlueprint({bpLinkName:$(c).attr("rulelinkname"),bpDispName:$(c).find("p[elename\x3dwfDispName]").find("a").text(),formLinkName:$(c).attr("formlinkName"),isLastBp:1==b.bp_TableBody.find("tr").length,successCallBK:function(){$(c).remove();if(b.isWorklfowEmpty()){var a=b.bp_formListContainer.find("li[formlinkname\x3d"+b.formName+"]");a.attr("formStatus","withOutWf");b.withOutWorkflowFormEle.removeClass("zc-hide");b.withOutWorkflowFormEle.find("ul").append(a);b.formSearchContainer.keyup();b.formName=
void 0;b.setDefaultFormName();b.getWorkflowData();0==b.withWorkflowFormEle.find("li").length&&b.withWorkflowFormEle.addClass("zc-hide")}}});a.preventDefault();a.stopPropagation()});this.bp_TableContainer.off("click","input[elname\x3dstatusBtn]").on("click","input[elname\x3dstatusBtn]",function(a){var c=$(this),d=$(this).closest("tr[elename\x3dworkflowRow]"),e=$(c).data("zctg").status();b.enableDisableWf({bpName:$(d).find("p[elename\x3dwfDispName]").find("a").text(),bpLinkName:$(d).attr("rulelinkname"),
formLinkName:$(d).attr("formlinkName"),wfType:WorkflowConstants.BLUEPRINT,status:e,successCallBK:function(){e?$(c).data("zctg").active():$(c).data("zctg").deActive()},event:a});a.stopPropagation()})}enableDisableWf(b){var a=function(){var a={};a.blueprintId=b.bpLinkName;a.blueprintLinkName=b.bpLinkName;a.formLinkName=b.formLinkName;a.zccpn=variable.csrfToken;a.status=b.status;a.sb_tracking=!0;$.ajax({url:"/appbuilder/"+variable.scopeName+"/"+variable.appLinkName+"/blueprintbuilder/edit/updateStatus",
type:"POST",data:a,beforeSend:function(){showPreloader()},success:function(a,c,f){showStatus(i18n.saved);"failure"==a.status?iAlert(a.statusMsg):b.successCallBK()}})};b.status?(b.event.preventDefault(),a()):(b.event.preventDefault(),iConfirm({title:i18n["zc.workflowbuilder.statusconfirm"],message:i18n["zc.workflow.builder.blueprint.disablebp.msg"],button:ZCButton.DISABLE,cbutton:ZCButton.CANCEL,success:function(){a()}}))}tableSearch(b){this.SearchResultCount=0;this.noSearchResultScreen=$("#no-bp-workflow-data");
let a=$("#bp-table-body").find("tr");if(0<a.length){if(""!=b)for(let c=0;c<a.length;c++){let d=a[c];-1<$(d).attr("workflowname").toLocaleLowerCase().indexOf(b.toLowerCase())?(this.SearchResultCount++,$(d).show()):$(d).hide()}else this.bp_TableBody.find("tr").show();0==this.SearchResultCount&&""!=b?this.showNoSearchDataScreen(!0):this.showNoSearchDataScreen(!1)}}tableDragAndDrop(b){let a=this;jQuery(b).sortable({items:".sortable-row",helper:function(a,b){var c=b.children();a=b.clone();a.children().each(function(a){$(this).width(c.eq(a).width())});
return a},placeholder:"zc-dem-tablerow-palceholder",forcePlaceholderSize:!0,axis:"y",cancel:"tr:first-child input",containment:b,start:function(a,b){b.item.toggleClass("zc-dem-ui-sortable-helper")},stop:function(a,b){b.item.toggleClass("zc-dem-ui-sortable-helper")},update:function(b,d){b=$(b.target).find("tr[elename\x3dworkflowRow]");for(var c=[],f=0;f<b.length;f++){var g=$(b[f]).attr("ruleLinkName");c.push(g)}$.ajax({url:"/appbuilder/"+variable.scopeName+"/"+variable.appLinkName+"/blueprintbuilder/edit/reOrderBlueprints",
type:"POST",beforeSend:showLoading(),data:{formLinkName:a.formName,blueprintIds:c.toString(),zccpn:variable.csrfToken},success:function(a,b,c){hideLoading()}});d.item.hasClass("wflow-header")&&$(this).sortable("cancel")}}).disableSelection()}bindToggle(){this.bp_TableBody.find("input[elname\x3dstatusBtn]").zcToggle({type:ZCSwitchType.LARGE,onConfig:{label:ZCSwitchLabel.ENABLED},offConfig:{label:ZCSwitchLabel.DISABLED}})}showBluePrintDashboard(){this.tableObj.nodata_workflowContainer.addClass("zc-hide");
this.tableObj.tableContainer.hide();this.parentNavigationContainer.css("display","block");this.wfContainer.addClass("zc-dem-form-workflow");this.bp_formListContainer.removeClass("zc-hide");this.bp_TableContainer.removeClass("zc-hide");this.wf_formListContainer.addClass("zc-hide");this.wf_formventContainer.addClass("zc-hide")}hideBluePrintDashboard(){this.bp_formListContainer.addClass("zc-hide");this.bp_TableContainer.addClass("zc-hide");this.noDataBwScreenEle.addClass("zc-hide");this.wf_formListContainer.removeClass("zc-hide");
this.wf_formventContainer.removeClass("zc-hide");this.tableObj.tableContainer.show()}showNoSearchDataScreen(b){b?(this.bp_TableBody.addClass("zc-hide"),this.noSearchResultScreen.removeClass("zc-hide")):(this.bp_TableBody.removeClass("zc-hide"),this.noSearchResultScreen.addClass("zc-hide"))}showNoDataScreen(b){this.noDataFlag=b;let a=this.withWorkflowFormEle.find("li").length;0<a&&this.isWorklfowEmpty()?(this.noDataBwScreenEle.removeClass("zc-hide"),this.tableObj.nodata_workflowContainer.addClass("zc-hide")):
(this.noDataBwScreenEle.addClass("zc-hide"),b?(this.tableObj.nodata_workflowContainer.find("i[elname\x3dBlueprintWf]").css("display","block"),this.tableObj.nodata_workflowContainer.find("p[elname\x3dBlueprintWf]").removeClass("hide"),this.tableObj.nodata_workflowContainer.find("i[elname!\x3dBlueprintWf]").css("display","none"),this.tableObj.nodata_workflowContainer.find("p[elname!\x3dBlueprintWf]").addClass("hide"),this.bp_TableContainer.addClass("zc-hide"),this.tableObj.nodata_workflowContainer.removeClass("zc-hide"),
0==a&&this.parentNavigationContainer.hide()):(this.bp_TableContainer.removeClass("zc-hide"),this.tableObj.nodata_workflowContainer.addClass("zc-hide")))}getBlueprint(b){WebAppearance.showBuilder(WorkflowBuilder.constants,{type:Constants.BLUEPRINT,compName:b.bpLinkName},!1);AccordionMenu.updateStaticName(b.bpDispName)}deleteBlueprint(b){let a=this;iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflow.builder.blueprint.deletebp.msg"],success:function(){var c={};c.blueprintId=
b.bpLinkName;c.blueprintLinkName=b.bpLinkName;c.formLinkName=b.formLinkName;c.zccpn=variable.csrfToken;c.sb_tracking=!0;c.isStagesRetain=!0;b.isLastBp&&(c.isStagesRetain=$(".zc-dem-dialogue-content ").find("input[type\x3dradio]:checked").attr("id"));$.ajax({url:"/appbuilder/"+variable.scopeName+"/"+variable.appLinkName+"/blueprintbuilder/edit/deleteBlueprint",type:"POST",data:c,beforeSend:showLoading(),success:function(c,e,f){hideLoading();c&&c.REFERENCES?(b.refreshReference=a.deleteBlueprint,b.buttons=
[{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_SUBMIT}],b.type="delete",Blueprint.Actions.customizeReferencePopup(c.REFERENCES,"Delete Blueprint",b)):(b.successCallBK(),AccordionMenu.reinit(WorkflowBuilder.constants))}})}});if(b.isLastBp){let a="\x3cp\x3e"+i18n["zc.workflow.builder.blueprint.deletelast"]+'\x3c/p\x3e\n\n            \x3cdiv class\x3d"zc-dem-radio zc-dem-bp-delete-radio selected"\x3e\n                \x3cinput type\x3d"radio" name\x3d"deleteStage" id\x3d"true" tabIndex\x3d"1" checked\x3e\n                    \x3clabel for\x3d"true"\x3e'+
i18n["zc.workflow.builder.blueprint.deletelast.retain"]+'                    \x3cdiv class\x3d"zc-dem-bp-radio-label"\x3e'+i18n["zc.workflow.builder.blueprint.deletelast.retain.msg"]+'\x3c/div\x3e\n\x3c/label\x3e\n            \x3c/div\x3e\n\n            \x3cdiv class\x3d"zc-dem-radio zc-dem-bp-delete-radio"\x3e\n                \x3cinput type\x3d"radio" name\x3d"deleteStage" id\x3d"false" tabIndex\x3d"1"\x3e\n                    \x3clabel for\x3d"false"\x3e'+i18n["zc.workflow.builder.blueprint.deletelast.stage"]+
'                    \x3cdiv class\x3d"zc-dem-bp-radio-label"\x3e'+i18n["zc.workflow.builder.blueprint.deletelast.stage.msg"]+"\x3c/div\x3e\n\x3c/label\x3e\n            \x3c/div\x3e";$(".zc-dem-dialogue-content ").html(a);$(".zc-dem-dialogue-content ").parent().addClass("zc-dem-bp-lastbp-warning");$(".zc-dem-dialogue-content ").find("input[type\x3dradio]").click(function(){$(".zc-dem-dialogue-content ").find(".zc-dem-bp-delete-radio").removeClass("selected");$(this).parent().addClass("selected")})}else $(".zc-dem-dialogue-content ").find("i").after('\x3cdiv class\x3d"zc-wfb-delete-label"\x3e'+
i18n["zc.workflowbuilder.wfname"]+" : "+escapeHTML(b.bpDispName)+"\x3c/div\x3e")}updateBlueprintTable(){let b=this;var a={};a.blueprintId=BluePrintMeta.meta.blueprintId;a.blueprintLinkName=BluePrintMeta.meta.blueprintLinkName;a.formLinkName=BluePrintMeta.meta.formLinkName;$.ajax({url:Blueprint.URL.getBlueprintDetailsUrl(),type:"GET",async:!1,data:a,beforeSend:showLoading(),success:function(a,d,e){hideLoading();a.hasOwnProperty("blueprintMeta")&&b.bp_formListContainer.find("li[formlinkname\x3d"+a.blueprintMeta.formLinkName+
"]").click()}})}updateFormInNav(b){this.withWorkflowFormEle.removeClass("zc-hide");let a=this.bp_formListContainer.find("li[formlinkname\x3d"+b.formLinkName+"]");0==a.length?(b="\x3cli formStatus\x3d'withWf' formDisplayName\x3d'"+b.formDispName+"' formName\x3d'"+b.formLinkName+"'\x3e\x3ca\x3e\x3ci class\x3d'zc-em zc-common-form'\x3e\x3c/i\x3e"+b.formDispName+"\x3c/a\x3e\x3c/li\x3e",this.withWorkflowFormEle.find("ul").append(b)):("withOutWf"==a.attr("formStatus")&&(a.remove(),a.attr("formStatus","withWf"),
this.withWorkflowFormEle.find("ul").append(a)),b.formLinkName&&this.withWorkflowFormEle.find("li[formName\x3d"+b.formLinkName+"]").trigger("click"));this.formSearchContainer.keyup();0==this.withOutWorkflowFormEle.find("li").length&&this.withOutWorkflowFormEle.addClass("zc-hide");this.getWorkflowData();this.setActiveFormName();this.isUpdateNeeded=!1}};function ApprovalUtil(b){var a=this;ApprovalElement.call(this,b);this.init=function(){a.initElm();this.initApproval();this.approvalSetting();this.bindEvents()};this.initApproval=function(){};this.approvalSetting=function(){};this.isSafe=function(){return"-Select-"==a.getNewFormLinkName()?(iAlert(i18n["zc.formedit.settings.approvalprocess.selectform"]),!1):""==a.getNewWorkflowName()?(iAlert(i18n["zc.formedit.settings.approvalprocess.namecannotempty"]),!1):!0};this.getNewFormLinkName=function(){return $("#approval-workflow-create").find("#wf-base-form").val()};
this.getNewWorkflowName=function(){return $("#approval-workflow-create").find("#new-workflow-name").val()};this.bindEvents=function(){$(document).click(function(){$("#zc-approval-components-cont").hide()});$("#zc-approval-comp-head").click(function(a){a.stopPropagation()});$("#zc-approval-components").find(".zc-dem-menu-action-delete").off("click").on("click",function(a){a.stopPropagation();if(1<$("#zc-approval-components").find(".approval-component-li").length){var b=$(this).parents(".approval-component-li");
b.fadeOut(function(){b.remove()})}else iAlert(i18n["zc.formedit.settings.approvalprocess.deletefieldmsg"])});$("#zc-approval-components-addnew").click(function(a){a.stopPropagation();a=$("#zc-approval-comp-hidden").html();$("#zc-approval-comp-select").html(a);$.each($("#zc-approval-components").find(".approval-component-li"),function(a,b){a=$(b).attr("formCompId");$("#zc-approval-comp-select").find("option[value\x3d"+a+"]").remove()});void 0==$("#zc-approval-comp-select").data("select2")?$("#zc-approval-comp-select").select2({containerCssClass:"zc-dem-custom-selectbox",
dropdownCssClass:"zc-dem-custom-selectbox-menu"}):$("#zc-approval-comp-select").select2("val","");$("#zc-approval-components-cont").show();$("#zc-approval-comp-select").select2("open")});$("#zc-approval-comp-select").off("change").on("change",function(a){a.stopPropagation();a=$("#zc-approval-components").find(".approval-component-li-hidden").clone();$(a).removeClass("approval-component-li-hidden").addClass("approval-component-li");var b=$(this).val();if(""!=b){var c=$(this).find("option[value\x3d"+
b+"]").text();$(a).attr("formCompId",b);$(a).find(".display-name").text(c);$("#zc-approval-components").append($(a));$("#appendApproverSettingsHere").find(".zc-dem-right-content").animate({scrollTop:$(document).height()},1E3);$("#zc-approval-components-cont").hide()}});$("#zc-auth-listing").length&&ConnectionContext.initHandlebars();$("#zc-auth-listing").off("click").on("click",function(){ComponentBuilder.getConnectionsList(a.getURL()+a.getLinkName()+"/connection/references")});a.approvalComponentSortable()};
this.approvalComponentSortable=function(){$("#zc-approval-components").sortable();$("#zc-approval-components").disableSelection()};this.getNewStep=function(){return $("#approvalStep").find(".zc-dem-approval-level").clone()};this.getApprovalSteps=function(){return $(b).find(".wb-approval-builder").find(".zc-dem-approval-level")};this.getSettings=function(){return $("#ApprovalSettingConfigurations \x3e div")};this.showProcessWindow=function(){$("#appbuilder-popup").html(b);$("#appbuilder-popup").show();
$("#appbuilder-main-head").addClass("zc-compbuilder-hdr").removeClass("zc-compappearance-hdr").removeClass("zc-newcomp-hdr")}}ApprovalUtil.prototype=Object.create(ApprovalElement.prototype);ApprovalUtil.prototype.constructor=ApprovalUtil;
function ApprovalElement(b){var a=this;this.initElm=function(){this.config();this.approver();this.step()};this.config=function(){a.configE=$(b).find("#approval-heading-settings")};this.approver=function(){a.approverE=$(b).find("#approverEditSettings")};this.step=function(){a.stepE=$(b).find("#wb-blockList")};this.getName=function(){return $(a.configE).find("span[class\x3dwb-title]").text().trim()};this.setName=function(b){$(a.configE).find("span[class\x3dwb-title]").text(b)};this.setDescription=function(b){$(a.configE).find("span[id\x3dwb-tempTypeInfo] \x3e i").text(b)};
this.getDescription=function(){return $(a.configE).find("span[id\x3dwb-tempTypeInfo] \x3e i").text().trim()};this.setLinkName=function(b){$(a.configE).find("span[class\x3dwb-title]").attr("approvalLinkName",b)};this.getLinkName=function(){return $(a.configE).find("span[class\x3dwb-title]").attr("approvalLinkName")};this.setFormLinkName=function(b){a.formLinkName=b};this.getFormLinkName=function(){return void 0!=$("#approvalFormLinkName").attr("name")?$("#approvalFormLinkName").attr("name"):a.formLinkName};
this.getStepsUL=function(){return a.stepE};this.hasStep=function(){return 0==a.getStepsUL().has("li[class\x3dwb-action]").length?!1:!0};this.getStepHints=function(){return $(a.stepE).find(".wb-approval-hint-block")};this.getSteps=function(){return $(a.stepE).find(".zc-dem-approval-level")};this.getStepsLength=function(){return a.getSteps().length};this.showLevelHeader=function(){$(b).find(".wb-levels-header").parent().removeClass("wb-hide-imp")};this.hideLevelHeader=function(){$(b).find(".wb-levels-header").parent().addClass("wb-hide-imp")};
this.getHintElement=function(){return $(b).find("#wb-approval-hint-block \x3e span")};this.arrangeHints=function(){this.getSteps().each(function(a){var b=a+1;$(this).attr("id","zc-approval-level-"+b);$(this).find(".wb-approver-header").text("Level "+(a+1)+" Approver")})};this.updateEventPane=function(){$("#approval-events-pane").find(".zc-approval-event-cont[stepno!\x3d0]").remove();$("#wb-blockList").find(".zc-dem-approval-level").each(function(a,b){var c=a+1;a=i18n["zc.formedit.settings.approvalprocess.level"]+
" "+c+" "+i18n["zc.formedit.settings.approvalprocess.approver"];var d=$("#approval-events-pane").find(".zc-approval-event-hidden").clone();d.attr("stepno",c);d.removeClass("zc-approval-event-hidden").removeClass("hide").addClass("zc-approval-event-cont");c=$(b).find(".wb-approved-title").text().trim();b=$(b).find(".wb-denied-title").text().trim();d.find("a[elname\x3dlevel-name]").text(a);d.find("a[elname\x3dapprove-label]").text(c);d.find("a[elname\x3ddenied-label]").text(b);$(".zc-dem-wfb-sidebar-inner").append(d)});
a.registerApprovalEvents()};this.registerApprovalEvents=function(){$("#approval-events-pane").find(".zc-approval-event-cont").find("a").off("click").on("click",function(){var a=$("#approvalConfig"),b=$(this).closest(".zc-approval-event-cont").attr("stepno");if(0==b)a.animate({scrollTop:0},500);else{var e=$(this).attr("elname");b=$("#zc-approval-level-"+b);"approve-label"==e?b=b.find(".action-approve"):"denied-label"==e&&(b=b.find(".action-denied"));e=b.position().top+90;a.animate({scrollTop:e},500)}})};
this.handleNameChange=function(){$("#zc-dem-comp-name").text(a.getName());if(void 0!=$.approvalObj._variables.accordianMenu.pageCompsJSON.workflows&&void 0!=$.approvalObj._variables.accordianMenu.pageCompsJSON.workflows[a.getFormLinkName()]){var b=$.approvalObj._variables.accordianMenu.pageCompsJSON.workflows[a.getFormLinkName()].ApprovalList;void 0!=b&&$.each(b,function(b,c){c.approvalLinkName==a.getLinkName()&&(c.ApprovalName=a.getName())})}};this.saveProcess=function(b,d,e,f){b="zccpn\x3d"+$.approvalObj._variables.csrfToken+
"\x26approvalDisplayName\x3d"+a.getName()+"\x26approvalLinkName\x3d"+a.getLinkName()+a.saveProcessConfiguration()+"\x26isNew\x3d"+b+"\x26isNewStep\x3d"+d+"\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL;b+=a.saveStep();b+=a.saveCriteria();b+=a.saveApprovalComponent();$.ajax({type:"POST",data:b,url:a.getURL()+"saveProcess",beforeSend:function(){$.approvalObj.getShowLoading(e)},success:function(b,c,k){$.approvalObj.getHideLoading(e);history.pushState({},"",$.approvalObj.getURL()+b.AP_LINK_NAME+
"/edit");$.approvalObj.setLinkName(b.AP_LINK_NAME);WorkflowBuilder.wfMeta.wfLinkName=b.AP_LINK_NAME;d&&(c=b.TASKS[0],$.approvalObj._newTask.find("#stepId").attr("value",b.STEP_ID),$.approvalObj._newTask.attr("id","zc-approval-level-"+b.STEP_NO),$.approvalObj._newTask.find("#ap_approval_send_email").attr("groupName",c[1].GROUP_NAME),$.approvalObj._newTask.find("#ap_approval_send_email").attr("actionname",c[1].LINK_NAME),$.approvalObj._newTask.find("#ap_approval_send_email").attr("wflinkname",c[1].WF_LINK_NAME),
$.approvalObj._newTask.find("#ap_approval_send_email").attr("id",c[1].WF_LINK_NAME),$.approvalObj._newTask.find(".action-approve").find(".wb-add-new").attr("wflinkname",c[1].WF_LINK_NAME),$.approvalObj._newTask.find(".action-approve").find(".wb-action").attr("wflinkname",c[1].WF_LINK_NAME),$.approvalObj._newTask.find(".action-approve").find(".wb-action").attr("groupName",c[1].GROUP_NAME),c=b.TASKS[1],$.approvalObj._newTask.find("#ap_denied_send_email").attr("groupName",c[2].GROUP_NAME),$.approvalObj._newTask.find("#ap_denied_send_email").attr("actionname",
c[2].LINK_NAME),$.approvalObj._newTask.find("#ap_denied_send_email").attr("wflinkname",c[2].WF_LINK_NAME),$.approvalObj._newTask.find("#ap_denied_send_email").attr("id",c[2].WF_LINK_NAME),$.approvalObj._newTask.find(".action-denied").find(".wb-add-new").attr("wflinkname",c[2].WF_LINK_NAME),$.approvalObj._newTask.find(".action-denied").find(".wb-action").attr("wflinkname",c[2].WF_LINK_NAME),$.approvalObj._newTask.find(".action-denied").find(".wb-action").attr("groupName",c[2].GROUP_NAME));a.setApprovalDescriptionHeader(b.STEPCOUNT);
void 0!=f&&f()}})};this.deleteApprovalStep=function(b,d){b="zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26approvalLinkName\x3d"+a.getLinkName()+"\x26stepId\x3d"+b+"\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL;$.ajax({type:"POST",data:b,url:a.getURL()+"deleteApprovalStep",beforeSend:function(){$.approvalObj.getShowLoading(d)},success:function(b,c,g){a.setApprovalDescriptionHeader(b.STEPCOUNT);$.approvalObj.getHideLoading(d)}})};this.getShowLoading=function(a){void 0==a?showLoading():a==
Constants.APPROVAL_CREATE_EDIT?$(".zc-wfb-approval-right-popup.active").find("#saveButton").showTextLoading(i18n["zc.workflow.savingaction"]):a==Constants.APPROVAL_SETTINGS?$("#appendApproverSettingsHere").find("#saveButton").showTextLoading(i18n["zc.workflow.savingaction"]):a==Constants.APPROVAL_REARRANGE&&showPreloader()};this.getHideLoading=function(a){void 0==a?hideLoading():a==Constants.APPROVAL_CREATE_EDIT?$(".zc-wfb-approval-right-popup.active").find("#saveButton").hideTextLoading(i18n["zc.formedit.settings.approvalprocess.saveapprover"]):
a==Constants.APPROVAL_SETTINGS?$("#appendApproverSettingsHere").find("#saveButton").hideTextLoading(i18n["zc.formedit.settings.approvalprocess.savesettings"]):a==Constants.APPROVAL_REARRANGE&&showStatus(i18n.saved)};this.setApprovalDescriptionHeader=function(b){var c=$("#approverConfiguration").find("div[elename\x3dwfHeader]"),e=$(c).find("a");b=1<=b?i18n["zc.formedit.settings.approvalprocess.approverdesc"]:i18n["zc.formedit.settings.approvalprocess.addapproverdesc"];e.length||(e=$("\x3ca\x3e\x3c/a\x3e").attr("target",
"_blank").attr("href",appbuilder.component.APP.getAppEditUrl()+"/formbuilder/"+a.getFormLinkName()+"/edit").html(a.getFormLinkName()));$(c).html("");$(c).append(b).append(e)};this.setApprovalMeta=function(){WorkflowBuilder.wfMeta.wfLinkName=WorkflowBuilder.wfMeta.oldWfLinkName=a.getLinkName();WorkflowBuilder.wfMeta.formLinkName=a.getFormLinkName();WorkflowBuilder.wfMeta.wfType=Constants.APPROVAL_WF;WorkflowBuilder.wfState=WorkflowConstants.APPROVAL_WF};this.saveProcessConfiguration=function(){return"\x26autoSubmitForApproval\x3dtrue\x26recallable\x3d"+
$(":input[name\x3drecallable]:checked").val()};this.saveCriteria=function(){var a="\x26approvalCondition\x3d";a=$(":input[id\x3dapproverCriteria2]").is(":checked")?a+2:$(":input[id\x3dapproverCriteria1]").is(":checked")?a+0:a+1;var b=$("#approvalBuilderConfiguration").find("div[elename\x3dapprovalCriteria]").find("a").text();return a+"\x26criteriaStr\x3d"+encodeURIComponent(b)};this.saveStep=function(){var b={};$("#wb-blockList").find(".zc-dem-approval-level").each(function(c){var d=[],f=$(this).find("#approverType").attr("value"),
g=$(this).find("#stepId").attr("value");4==f?$(this).find(".wb-approver-name").each(function(a,b){d.push($(b).attr("value"))}):d.push($(this).find(".wb-approver-name").attr("value"));var h=$(this).find(".wb-approved-title").text().trim(),k=$(this).find(".wb-denied-title").text().trim(),l=a.saveStepTask(this);b[c+1]={stepId:g,approverType:f,approverId:d,approveLabel:h,denialLabel:k,stepTask:l}});return"\x26approvalSteps\x3d"+JSON.stringify(b)};this.saveStepTask=function(a){var b=[],c={},f={};$(a).find(".action-approve").find(".wb-actionList \x3e li").not("#no-task-associated").each(function(){c.WF_LINK_NAME=
$(this).attr("id").trim();b.push({1:c})});$(a).find(".action-denied").find(".wb-actionList \x3e li").not("#no-task-associated").each(function(){f.WF_LINK_NAME=$(this).attr("id").trim();b.push({2:f})});return JSON.stringify(b)};this.saveApprovalComponent=function(){var a=$("#zc-approval-components").find(".approval-component-li"),b={};$.each(a,function(a,c){b[a+1]=$(c).attr("formCompId")});return"\x26approvalComps\x3d"+JSON.stringify(b)};this.getURL=function(){return appbuilder.component.APP.getAppEditUrl()+
"/"+a.getFormLinkName()+"/approvalWorkFlow/"};this.geWorkflowBuilderURL=function(){return appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/"};this.getApprovalList=function(){return $(a.APconfig).find("tr[elename\x3dworkflowRow]").find("span[elename\x3dapprovalName]")};this.getApprovalActionList=function(){return $(a.APconfig).find("tr[elename\x3dworkflowRow]").find("li[elename\x3dapprovalAction]")};this.getStatusButton=function(){return $(a.APconfig).find("div[elename\x3dapprovalStatus]")};
this.getDeleteButton=function(){return $(a.APconfig).find("div[name\x3dapprovalName]").find(".wl-del")};this.activateProcess=function(b){a.request(a.getURL()+"activateProcess","approvalLinkName\x3d"+a.approvalLinkName+"\x26active\x3dfalse\x26deleteRecord\x3dfalse",b);$(b).toggleClass("active")};this.deActivateProcess=function(b){iConfirm({title:i18n["zc.workflowbuilder.statusconfirm"],message:i18n["zc.workflowbuilder.confirmdisableworkflow"],button:ZCButton.DISABLE,cbutton:ZCButton.CANCEL,success:function(){a.request(a.getURL()+
"activateProcess","approvalLinkName\x3d"+a.approvalLinkName+"\x26active\x3dtrue\x26deleteRecord\x3dtrue",b);$(b).toggleClass("active")}})};this.request=function(a,b,e){$.ajax({beforeSend:function(){showPreloader()},url:a,type:"POST",data:b,success:function(a){showStatus(i18n.saved)}})};this.processSave=function(){var b=$.approvalObj.getLinkName(),d=$.approvalObj.getName().bold();$.approvalObj._variables.componentType="4";$.approvalObj._variables.moduleName="workflowbuilder";$("#newWorkflowBuilderDiv").find("div[approvalLinkName\x3d"+
b+"]").each(function(){if("approvalStatus"==$(this).attr("name")){var c=$(this).find("a");"false"==c.attr("status")&&a.hasStep()&&iConfirm({message:i18n["zc.formedit.settings.approvalprocess.wanttoactivate"]+", "+d,success:function(){var d=appbuilder.component.APP.getAppEditUrl()+"/"+$.approvalObj.getFormLinkName()+"/approvalWorkFlow/activateProcess";a.request(d,"approvalLinkName\x3d"+b+"\x26active\x3dfalse\x26deleteRecord\x3dfalse");$(c).removeClass("wl-disable");$(c).addClass("wl-enablebtn");$(c).attr("status",
"true")},failure:function(){}})}})}}
function StepElements(b){var a=this,c="";this.init=function(){};this.getStep=function(){return $(b)};this.getEditButton=function(){return $(b).find(".zc-dem-approval-parent-title").find(".wb-edit-icon")};this.registerApprovalEvents=function(){$("#approval-events-pane").find(".zc-approval-event-cont").find("a").off("click").on("click",function(){var a=$("#approvalConfig"),b=$(this).closest(".zc-approval-event-cont").attr("stepno");if(0==b)a.animate({scrollTop:0},500);else{var c=$(this).attr("elname");
b=$("#zc-approval-level-"+b);"approve-label"==c?b=b.find(".action-approve"):"denied-label"==c&&(b=b.find(".action-denied"));c=b.position().top+90;a.animate({scrollTop:c},500)}})};this.getActionEl=function(){return $(b).find(".wb-action")};this.initNoTaskEl=function(){var b=0;$.each(a.getActionEl(),function(a,c){b=$(c).find(".ui-state-default:not(#no-task-associated)").length;0==b&&$(c).find("#no-task-associated").removeClass("hide")})};this.getDeleteButton=function(){return $(b).find(".zc-dem-approval-parent-title").find(".wb-del-icon")};
this.getDuplicateButton=function(){return $(b).find(".wb-approver-header").find(".wb-dup-icon")};this.initStep=function(){$("#approverEditSettings").append($("#ApprovalStepConfigurations").find(".zc-wfb-approval-right-popup").clone());c=$("#approverEditSettings");c.find(".zc-approver-config-heading").text(i18n["zc.formedit.settings.approvalprocess.editapprover"]);StepEdit.call(this,c);a.editStep()};this.addNewStep=function(){$("#approverEditSettings").append($("#ApprovalStepConfigurations").find(".zc-wfb-approval-right-popup").clone());
c=$("#approverEditSettings");StepEdit.call(this,c);$.approvalObj.getStepsUL().css("display","block");a.addStep()};this.getEditElm=function(){return c};this.getApproverIntType=function(){return $(b).find("#approverType").attr("value")};this.getApproverStrType=function(){return $(b).find("#approverType").text()};this.setApproverIntType=function(a){$(b).find("#approverType").attr("value",a)};this.setApproverStrType=function(a){$(b).find("#approverType").text(a)};this.getApproverName=function(){return $(b).find(".wb-approver-name")};
this.getApproverHeader=function(){return $(b).find(".wb-approver-header")};this.getApproverCont=function(){return $(b).find(".wb-approver-cont")};this.getApprovers=function(){return $(b).find(".wb-approver-header \x3e .wb-approver-name")};this.removeApprover=function(){$(b).find(".wb-approver-cont \x3e .wb-approver-name").remove()};this.getApprovedLabel=function(){return $(b).find(".wb-approved-title").text().trim()};this.getDeniedLabel=function(){return $(b).find(".wb-denied-title").text().trim()};
this.setApprovedLabel=function(a){$(b).find(".wb-approved-title").text(a)};this.setDeniedLabel=function(a){$(b).find(".wb-denied-title").text(a)};this.getTasks=function(){return $(b).find(".ui-state-default")};this.getActionNameElm=function(){return $(b).find(".ui-state-default").find(".wb-action-name")};this.getZeroActionAddButton=function(){return $("#wb-blockList0").find(".wb-add-action-block")};this.getApprovalActionTitle=function(){return $(b).find(".zc-dem-approval-subparent-title")};this.getActionAddButton=
function(){return $(b).find(".wb-add-new")};this.getTaskAddButton=function(){return $(b).find(".ui-state-default").find(".wb-addaction")};this.getCriteriaEditButton=function(){return $(b).find(".zc-wb-action-head").find("span[elename\x3deditCriteria]")};this.getCriteriaDeleteButton=function(){return $(b).find(".zc-wb-action-head").find("span[elename\x3ddelCriteria]")};this.getTaskEle=function(){return $(b).find(".ui-state-default:not(#no-task-associated)")};this.getTaskEditButton=function(){return $(b).find(".ui-state-default").find(".wb-edit-icon")};
this.getTaskDeleteButton=function(){return $(b).find(".ui-state-default").find(".wb-del-icon")};this.editCriteria=function(b){var c="zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26formlinkname\x3d"+$.approvalObj.getFormLinkName();if(void 0!=b){var d=$(b).find(".zc-wfb-condition-chk").text().trim();d=d.replace(/ && /g," ZC_AND ");c=c+"\x26criteria\x3d"+d}$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"edit/loadCriteriaBuilder",type:"POST",data:c,beforeSend:showLoading(),success:function(c,d,
e){hideLoading();iCustomizePopup({title:i18n["zc.workflowbuilder.editcriteria"],body:c,buttons:[{name:ZCButton.SAVECRITERIA,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",success:function(c){return a.saveActionCriteria(b,$(c.container))},failure:function(){}});CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"))}})};this.deleteCriteria=
function(b){var c=$(b).closest("li");iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeletecriteria"],success:function(){$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"/edit/deleteCriteria",type:"POST",data:"zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26workflowName\x3d"+c.attr("wfLinkName")+"\x26groupName\x3d"+c.attr("groupname")+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName(),
beforeSend:showLoading(),success:function(d,e,h){hideLoading();0==$(c).find(".ui-state-default:not(#no-task-associated)").length?$(c).remove():(d=$(b).closest(".zc-wb-action-head").attr("elename","nocriteria"),e=$("\x3cstrong\x3e\x3c/strong\x3e").html(i18n["zc.workflowbuilder.executewithoutcondition"]),h=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus"),$(h).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename",
"editCriteria")),$(d).html("").append(e).append(h),a.registerCriteriaEvents(d))}})}})};this.saveActionCriteria=function(b,c){var d=a.getCriteriaData(c);if(0==d)return!1;var e=!0,h=$(b).closest("li");d=d+"\x26workflowName\x3d"+h.attr("wfLinkName")+"\x26groupName\x3d"+h.attr("groupname")+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL;$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"/edit/saveCriteria",type:"POST",async:!1,data:"zccpn\x3d"+$.approvalObj._variables.csrfToken+
"\x26"+d,beforeSend:showLoading(),success:function(d,f,g){hideLoading();"error"==d.status?($(c).showErrorBanner(d.errorMsg),e=!1):($(b).attr("elename","criteria").html(""),$(b).html($("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+"  ")),$(b).append($("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(d.criteriaString)),d=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus"),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename",
"editCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename","delCriteria")),$(d).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-drag-icon zc-em zc-wb-rearrange")),$(b).append(d),$(b).closest("li[elename\x3dgroupele]").attr("class","wb-condition"),a.registerCriteriaEvents(b))}});return e};this.getCriteriaData=function(a){a=CriteriaBuilderNew.updateInput($(a).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?
a+"\x26isCriteria\x3dtrue":!1};this.registerCriteriaEvents=function(b){$(b).find(".wb-action-menus").find("span[elename\x3deditCriteria]").click(function(){a.editCriteria($(this).closest(".zc-wb-action-head"))});$(b).find(".wb-action-menus").find("span[elename\x3ddelCriteria]").click(function(){a.deleteCriteria($(this).closest(".zc-wb-action-head"))})}}StepElements.prototype=Object.create(StepEdit.prototype);StepElements.prototype.constructor=StepElements;
function StepEdit(b){var a=this,c=a.getEditElm();this.ApproverConst={ROLE_BASED:2,USER_BASED:4,FIELD_BASED:6};this.editStep=function(){a.openEdit();a.bindWithSelect2();a.setEditApprover();a.setEditApproverType();a.setEditLabel();a.registerEdit();a.registerCommon();a.movePopupOutSide()};this.addStep=function(){a.openEdit();a.bindWithSelect2();a.registerAdd();a.registerCommon();a.movePopupOutSide()};this.changeButtonName=function(){c.find(".wb-save-button").text(ZCButton.UPDATEAPPROVER)};this.setEditApprover=
function(){c.find("#approverTypeSel").select2("val",a.getApproverIntType())};this.getEditUserBasedApprovers=function(){return c.find("#userSelectAndRemove #userSelect2").data("zcdd").getData()};this.getEditApprover=function(){return c.find("#approverTypeSel").find(":selected")};this.getEditApproverStrType=function(){return a.getEditApprover().text()};this.getEditApproverList=function(){return $("#"+a.getEditApproverStrType().trim())};this.getEditApproverIntType=function(){return a.getEditApprover().attr("value")};
this.getUserSelector=function(){return c.find("#userSelectAndRemove")};this.getUserSelectorInput=function(){return c.find("#user-based-approver-input")};this.getApproverSelector=function(){return c.find("#approver-select-div")};this.getEditApprovedLabel=function(){return c.find("#approvalLable")};this.getEditDenialLabel=function(){return c.find("#denialLable")};this.getSaveButton=function(){return c.find("#saveButton")};this.getCancelButton=function(){return c.find("#cancelButton")};this.appendNewStep=
function(){$.approvalObj._newTask=a.getStep();$.approvalObj.getStepsUL().append(a.getStep())};this.getUsers=function(){return $("#Users")};this.getFields=function(){return $("#Fields")};this.getRoles=function(){return $("#Roles")};this.getNewStep=function(){return $("div[id\x3dapproverConfig]").find("#approvalStep \x3e li").clone()};this.getApproverOption=function(){if(a.getEditApproverIntType()==a.ApproverConst.ROLE_BASED)return c.find("#roleselectDiv \x3e select").find(":selected");if(a.getEditApproverIntType()==
a.ApproverConst.FIELD_BASED)return c.find("#fieldSelectDiv \x3e select").find(":selected")};this.getSpanElm=function(){var b=$(document.createElement("span"));b.addClass("wb-approver-name wb-label");b.attr("value",a.getApproverOption().val());return b};this.createSpanElement=function(a,b){var c=$(document.createElement("span"));c.addClass("wb-approver-name wb-label");c.attr("value",a);c.text(b);return c};this.setEditApproverType=function(){if(a.getApproverIntType()==a.ApproverConst.USER_BASED){c.find("#userSelectAndRemove").css("display",
"block");c.find("#roleselectDiv").css("display","none");c.find("#fieldSelectDiv").css("display","none");a.getUserSelector().find("span").remove();a.getUserSelector().find(".ap-disp-approver").append(a.getApproverName());var b="";a.getApproverName().each(function(){b+=$(this).attr("value")+","});c.find("#userSelectAndRemove \x3e input").val(b).trigger("change");b=[];a.getUserSelector().find("span").not(".ui-helper-hidden-accessible").each(function(){b.push($(this).attr("value"))});a.getUserSelector().find("select").val(b)}a.getApproverIntType()==
a.ApproverConst.ROLE_BASED&&(c.find("#userSelectAndRemove").css("display","none"),c.find("#roleselectDiv").css("display","block"),c.find("#fieldSelectDiv").css("display","none"),c.find("#roleselectDiv \x3e select").select2("val",a.getApproverName().attr("value")));a.getApproverIntType()==a.ApproverConst.FIELD_BASED&&(c.find("#userSelectAndRemove").css("display","none"),c.find("#roleselectDiv").css("display","none"),c.find("#fieldSelectDiv").css("display","block"),c.find("#fieldSelectDiv \x3e select").select2("val",
a.getApproverName().attr("value")))};this.setEditLabel=function(){a.approvedEditLabel();a.deniedEditLabel()};this.approvedEditLabel=function(){var b=a.getApprovedLabel();a.getEditApprovedLabel().val(b)};this.deniedEditLabel=function(){var b=a.getDeniedLabel();a.getEditDenialLabel().val(b)};this.openEdit=function(){var a=$(c).find(".zc-wfb-approval-right-popup");c=$(a).iSlide({afterOpen:function(){$(a).find("#add-edit-approver-configurations").zcScrollPane()},afterClose:function(a){$(a.slider).remove()},
select2Focus:!0}).container};this.movePopupOutSide=function(){$("#zc-dem-container").append(b)};this.addStepInEvents=function(){var b=$("#approval-events-pane").find(".zc-approval-event-cont").length,c=i18n["zc.formedit.settings.approvalprocess.level"]+" "+b+" "+i18n["zc.formedit.settings.approvalprocess.approver"],f=$("#approval-events-pane").find(".zc-approval-event-hidden").clone();f.attr("stepno",b);f.removeClass("zc-approval-event-hidden").removeClass("hide").addClass("zc-approval-event-cont");
f.find("a[elname\x3dlevel-name]").text(c);f.find("a[elname\x3dapprove-label]").text(a.getEditApprovedLabel().val());f.find("a[elname\x3ddenied-label]").text(a.getEditDenialLabel().val());$(".zc-dem-wfb-sidebar-inner").append(f);a.registerApprovalEvents()};this.registerAdd=function(){c.find("#userSelectAndRemove").removeClass("wb-hide-imp");c.find("#user-based-approver-input").removeClass("wb-hide-imp");c.find("#approver-select-div").addClass("wb-hide-imp");a.getSaveButton().click(function(){var b=
function(){if(APValidation.validateApprover(c)){$.approvalObj.getStepsUL().removeClass("wb-hide-imp");a.setApproverIntType(a.getEditApproverIntType());a.setApproverStrType(a.getEditApproverStrType());a.setApprovedLabel(a.getEditApprovedLabel().val());a.setDeniedLabel(a.getEditDenialLabel().val());if(a.getEditApproverIntType()==a.ApproverConst.USER_BASED)for(var b=a.getEditUserBasedApprovers(),d=0;d<b.length;d++){var g=b[d];a.getApproverCont().append(a.createSpanElement(g.id,g.text))}else a.getApproverCont().append(a.getSpanElm().text(a.getApproverOption().text()));
a.appendNewStep();a.addStepInEvents();$.approvalObj.arrangeHints();$.approvalObj.bindEvents();$.approvalObj.saveProcess(!1,!0,Constants.APPROVAL_CREATE_EDIT,function(){a.getCancelButton().trigger("click")});1<=$("#wb-blockList").find("li.wb-action").length&&($("#wb-blockList0").show(),$("#approval-events-pane").show())}};c.find("#approverTypeSel").val()==a.ApproverConst.USER_BASED?a.addUser(b):b()})};this.registerEdit=function(){a.getSaveButton().click(function(){var b=function(){if(APValidation.validateApprover(c)){a.setApproverIntType(a.getEditApproverIntType());
a.setApproverStrType(a.getEditApproverStrType());a.setApprovedLabel(a.getEditApprovedLabel().val());a.setDeniedLabel(a.getEditDenialLabel().val());a.removeApprover();if(a.getEditApproverIntType()==a.ApproverConst.USER_BASED)for(var b=a.getEditUserBasedApprovers(),d=0;d<b.length;d++){var g=b[d];a.getApproverCont().append(a.createSpanElement(g.id,g.text))}else a.getApproverCont().append(a.getSpanElm().text(a.getApproverOption().text()));$.approvalObj.saveProcess(!1,!1,Constants.APPROVAL_CREATE_EDIT,
function(){a.getCancelButton().trigger("click")})}};c.find("#approverTypeSel").val()==a.ApproverConst.USER_BASED?a.addUser(b):b()})};this.registerCommon=function(){a.getCancelButton().click(function(){$(c).find(".zc-dem-right-close").trigger("click")});c.find("#approverTypeSel").on("change",function(){c.find(".zc-approval-restrictmsg").addClass("hide");$(this).val()==a.ApproverConst.FIELD_BASED?(c.find(".zc-approval-restrictmsg").removeClass("hide"),0==$("#fieldSelectDiv").find("select \x3e option").length?
($(this).showError(i18n["zc.formedit.settings.approvalprocess.approve.nouserfield"]),c.find("#userSelectAndRemove").css("display","block"),c.find("#roleselectDiv").css("display","none"),c.find("#fieldSelectDiv").css("display","none"),c.find("#approverTypeSel").find("option[name\x3dUsers]").trigger("click"),c.find("#approverTypeSel").find("option[name\x3dUsers]").prop("selected",!0)):(c.find("#userSelectAndRemove").css("display","none"),c.find("#roleselectDiv").css("display","none"),c.find("#fieldSelectDiv").css("display",
"block"))):$(this).val()==a.ApproverConst.USER_BASED?(c.find("#userSelectAndRemove").css("display","block"),c.find("#roleselectDiv").css("display","none"),c.find("#fieldSelectDiv").css("display","none")):$(this).val()==a.ApproverConst.ROLE_BASED&&(c.find("#userSelectAndRemove").css("display","none"),c.find("#roleselectDiv").css("display","block"),c.find("#fieldSelectDiv").css("display","none"))});$(c).find("#main-approver-list \x3e li").click(function(){$(c).find("#selected-approver").attr("value",
$(this).attr("id"));$(c).find("#selected-approver").addClass("wb-approver-name");$(c).find("#selected-approver").text($(this).text())});c.find("input[id\x3duserBasedApprover]").completeapprovers({minLength:0,source:function(a,b){var d=[];c.find("#userSelectAndRemove").find("select").find("option:not(:selected)").each(function(a,b){d.push({label:$(b).text(),value:$(b).text(),fval:$(b).val(),category:$(b).attr("category")})});b($.ui.autocomplete.filter(d,a.term))},delay:0,autoFocus:!0,open:function(){$(this).completeapprovers("widget").css({"z-index":9999,
width:"320px"});return!1},select:function(a,b){a=document.createElement("span");$(a).addClass("approver_sel_box_rm");$(a).text(b.item.label).attr("value",b.item.fval);c.find("#userSelectAndRemove").find(".ap-disp-approver").append(a);a=c.find("#userSelectAndRemove").find("select").val();a=null==a?[]:a;a.push(b.item.fval);c.find("#userSelectAndRemove").find("select").val(a);b.item.value=""}}).on("focus dblclick",function(){$(this).completeapprovers("search")}).on("keydown",function(a){a.keyCode==$.ui.keyCode.TAB&&
a.preventDefault()});c.find("#userSelectAndRemove").on("hover","span",function(a){"mouseenter"==a.type?$(this).width($(this).width()).data("pname",$(this).text()).text("Remove"):$(this).text($(this).data("pname")).width("")}).on("click","span",function(){$(this).remove();var a=c.find("#userSelectAndRemove").find("select").val();a.splice(a.indexOf($(this).attr("value")),1);c.find("#userSelectAndRemove").find("select").val(a)})};this.bindWithSelect2=function(){var b=a.getUserList();c.find("#userSelectAndRemove").find("#userSelect2").zcDropDown({createSearchChoice:function(a,
b){if(0===$(b).filter(function(){return 0===this.text.localeCompare(a)}).length)return{id:a,text:a,value:a}},multiple:!0,data:b});c.find("#roleSelect").zcDropDown({});c.find("#fieldSelect").zcDropDown({});c.find("#approverTypeSel").zcDropDown()};this.getUserList=function(){var a=[];c.find("#userSelectAndRemove \x3e select").find("option").each(function(){data={};data.text=$(this).text();data.id=$(this).attr("value");a.push(data)});a.sort(function(a,b){a=a.text.toLowerCase();b=b.text.toLowerCase();
return a<b?-1:a>b?1:0});return a};this.addUser=function(b){var d=a.getApproverDetails();if(d.isUpdateNeeded)if(d.newMailIds.length){var f=!0;$.each(d.newMailIds,function(a,b){a=/^.+@.+\..{2,15}$/;var d=/[\(\)<>,;:\\\/"\[\]]/;if(""==b||!a.test(b)||b.match(d))return c.find("#userSelectAndRemove #userSelect2").showError(i18n["zc.formedit.settings.verifyemailaddr.entervalidemailid"]+" '"+escapeHTML(b)+"'"),f=!1});f&&iCustomizePopup({title:1<d.newMailIds.length?i18n["zc.workflow.builder.approval.headertext.multipleapprovers"]:
i18n["zc.workflow.builder.approval.headertext.singleapprover"],body:a.createUserListEle(d.newMailIds),buttons:[{name:ZCButton.ADD,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],success:function(e){dataMap={role:4,action:"addUsers",fromapproveradd:!0};dataMap.emailIds=d.newMailIds.toString();dataMap.zccpn=$.approvalObj._variables.csrfToken;$.ajax({beforeSend:showLoading(),url:"/userhome/"+$.approvalObj._variables.scopeName+"/setup/addUsers",type:"POST",
data:dataMap,success:function(e,f,g){hideLoading();if(e.limitExceeded)$.upgrade.create({zcFeatureName:"USERS",featureType:"ZC_LIMIT",zccpn:$.approvalObj._variables.csrfToken,sharedBy:$.approvalObj._variables.scopeName});else if(void 0!=e.addedUserDetails){var h=$(".zc-wfb-approval-right-popup").find("#userSeletList");$.each(e.addedUserDetails,function(a,b){d.finalApprover.push(b.userId);$("\x3coption /\x3e",{category:"Users",text:b.userName,value:b.userId,email:b.mailId}).appendTo(h)});c.find("#userSelectAndRemove #userSelect2").data("zcdd").destroy();
a.bindWithSelect2();c.find("#userSelectAndRemove #userSelect2").data("zcdd").setValue(d.finalApprover);b()}else f=$(e).find("#addSecEmail").attr("value"),e=$(e).find("#addSecEmailErrors").attr("value"),f&&iAlert(e)}});return!0},failure:function(){},containerClass:"zc-wfb-approver-adduser-popup"})}else c.find("#userSelectAndRemove #userSelect2").data("zcdd").setValue(d.finalApprover),b();else b()};this.getApproverDetails=function(){var a={};c.find("#userSelectAndRemove \x3e select").find("option").each(function(){a[$(this).attr("email")]=
$(this).attr("value")});var b={},f=[],g=[],h=c.find("#userSelectAndRemove #userSelect2").data("zcdd").getData(),k=!1;$.each(h,function(b,c){void 0!=c.value?(k=!0,a.hasOwnProperty(c.text)?f.push(a[c.text]):g.push(c.text)):f.push(c.id)});b.newMailIds=g;b.finalApprover=f;b.isUpdateNeeded=k;return b};this.createUserListEle=function(a){var b="\x3cp\x3e"+(1<a.length?i18n["zc.workflow.builder.approval.multipleapprover.newuseralert1"]:i18n["zc.workflow.builder.approval.singleapprover.newuseralert1"])+"\x3c/p\x3e\x3cp\x3e"+
(1<a.length?i18n["zc.workflow.builder.approval.multipleapprover.newuseralert2"]:i18n["zc.workflow.builder.approval.singleapprover.newuseralert2"])+"\x3c/p\x3e\x3cul\x3e";$.each(a,function(a,c){b+="\x3cli\x3e"+c+"\x3c/li\x3e"});return b+"\x3c/ul\x3e"}}
function APStepTask(b){var a=this,c="",d=null;this.isNewGroup=!1;this.init=function(){a.setup();a.loadEmailConfig()};this.setup=function(){a.wf_Link_Name=$(b).attr("wfLinkName");a.linkName=$(b).attr("actionname");a.dispName=$(b).find("span[class\x3dwb-action-name]").text();a.URL=appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/edit/"};this.addStepTask=function(){$.ajax({beforeSend:function(){showLoading()},url:a.URL+"getAction",type:"POST",data:{zccpn:$.approvalObj._variables.csrfToken,
wfLinkName:a.wf_Link_Name},success:function(b){a.setupTaskBuilder(b,a.TaskOperation.ADD_TASK);hideLoading()}})};this.loadEmailConfig=function(){WorkflowBuilder.setEmailVariables()};this.editStepTask=function(){var b={eventType:6};b.zccpn=$.approvalObj._variables.csrfToken;b.wfLinkName=a.wf_Link_Name;b.linkName=a.linkName;b.formlinkname=$.approvalObj.getFormLinkName();$.ajax({beforeSend:showLoading(),url:a.URL+"getAction",type:"POST",data:b,success:function(b,c,d){a.setupTaskBuilder(b,a.TaskOperation.EDIT_TASK);
hideLoading()}})};this.deleteStepTask=function(){var c={};c.workflowName=a.wf_Link_Name;c.actionName=a.linkName;c.zccpn=$.approvalObj._variables.csrfToken;c.sb_tracking=!0;c.sb_compCategory=WorkflowConstants.APPROVAL;c.approvalLinkName=$.approvalObj.getLinkName();iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeleteaction"],success:function(){var d=$(b).closest(".wb-action"),e=$(d).find(".ui-state-default:not(#no-task-associated)").length,h=$(d).find("div[elename\x3dcriteria]").length,
k=!1;1==e&&0==h?k=!0:$(d).find("#no-task-associated").removeClass("hide");c.deleteGrp=k;"ap_approval_send_email"!=a.linkName&&"ap_denied_send_email"!=a.linkName&&$.ajax({beforeSend:showLoading(),data:c,url:a.URL+"deleteAction",type:"POST",success:function(a){$.approvalObj.saveProcess(!1,!1);hideLoading()}});k?$(d).remove():$(b).remove()}})};this.setupTaskBuilder=function(b,c){a.builderSetup(b,c);a.hideOtherTask();a.registerBuilder(c,b);a.registerButton(c)};this.builderSetup=function(a,b){$("#wfAction").html(a);
$("#wfAction").find(".wb-cond-header").remove();$("#wfAction").css("display","block");a=$("#wfAction").find("#wf-slider").iSlide({afterClose:function(a){$(a.slider).remove()}});c=$(a.container)};this.hideOtherTask=function(){c.find(".wb-field-action-icon").css("display","none");c.find(".wb-custom-process-icon").css("display","none");a.isNewGroup||c.find("div[elename\x3dconditionBlock]").addClass("hide");c.find(".zc-wfb-action-type").addClass("zc-wfb-wl-newaction")};this.registerBuilder=function(b,
c){d=new WorkflowActionSlider({wfEle:$("#wf-slider"),wfLinkName:a.wf_Link_Name,wfType:Constants.APPROVAL_WF,formLinkName:$.approvalObj.getFormLinkName(),taskLinkName:b==a.TaskOperation.EDIT_TASK?a.linkName:void 0,formFields:a.getFormFields()});WorkflowBuilder.constants=$.approvalObj._variables;d.init()};this.getFormFields=function(){let a=0!=$("#wf-action-container").find("input[name\x3dwfFormFields]").length?JSON.parse($("#wf-action-container").find("input[name\x3dwfFormFields]").val()):[];a&&a.unshift({dispName:i18n["zc.workflowbuilder.loginuserid"],
linkName:"zoho.loginuserid",category:"Zoho Variables"},{dispName:i18n["zc.workflowbuilder.adminuserid"],linkName:"zoho.adminuserid",category:"Zoho Variables"});return a};this.addTaskName=function(b){var d=c.find("form").find(".wb-mail-filling").first().clone();$(d).empty();d.append($("\x3cspan class\x3d'wb-title flt-left'\x3e").text("Task Name:"));$("\x3cinput\x3e").attr({type:"text",id:"name",name:"name"}).prependTo(d);b==a.TaskOperation.EDIT_TASK?$(d).find(":input").val(a.dispName):(b=c.find("input[name\x3dtypeOfTask]").val(),
b=c.find(".wb-selectlist").find("li[value\x3d"+b+"]").text(),$(d).find(":input").val(b));c.find("form").find(".wb-mail-filling").each(function(){$(this).prepend($(d).clone())})};this.registerButton=function(b){b==a.TaskOperation.EDIT_TASK&&a.registerEditTaskButton();b==a.TaskOperation.ADD_TASK&&a.registerAddTaskButton();c.find(".wb-cancel-button").click(function(){a.closeTaskBuilder()})};this.registerEditTaskButton=function(){c.find(".wb-popup-buttons").find(".wb-save-button").text(ZCButton.UPDATETASK);
c.find(".wb-save-button").click(function(){var e=c.find("form:visible"),f=$(e).find("input:radio[name\x3dupdateRecCritOption]:checked").not(":disabled").val(),g=$(e).find("input[name\x3dtaskType]").val();"7"==$(e).find("input[name\x3dtaskType]").val()&&$(e).find("textarea[name\x3demailMessage]").val(d.messageBox.getContent());if(d.validateFields(e)){var h=$(e).find("select:disabled").removeAttr("disabled");e=$(e).serialize();h.attr("disabled","true");if("21"==g||"22"==g)if("22"==g||"21"==g&&"current"!=
f){if(0==WorkflowBuilder.getDataAccessCriteria()){$(_wfAction.wfActionEle).find(".wb-save-button").prop("disabled",!1);return}e+="\x26dataAccessCritMap\x3d"+JSON.stringify(WorkflowBuilder.getDataAccessCriteria());e+="\x26isDataAccessCriteria\x3dtrue"}else e+="\x26isDataAccessCriteria\x3dfalse";f=e+"\x26actionName\x3d"+a.linkName+"\x26workflowName\x3d"+a.wf_Link_Name+"\x26workflowString\x3d"+encodeURIComponent(d.delugeEditor.getEditorValue())+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+
"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName();$.ajax({beforeSend:function(){$(c).find(".wb-save-button").showTextLoading(i18n["zc.workflow.updatingaction"])},url:a.URL+"updateAction",type:"POST",data:f,success:function(e,f,g){$(c).find(".wb-save-button").hideTextLoading(i18n["zc.workflow.updateaction"]);"failure"!=e.status||d.isDelugeTask()?d.delugeEditor.handleResponse(e,function(){a.displayName=e.TASK_DESC.subStr1+""+e.TASK_DESC.subStr2;$(b).find(".wb-action-name").text(e.TASK_DESC.subStr1);
$(b).find(".wb-action-name").append($("\x3cspan/\x3e").text(e.TASK_DESC.subStr2));a.closeTaskBuilder()},function(){$(d.wfActionEle).find(".wb-save-button").prop("disabled",!1)}):iAlert(e.errorMessage)}})}else $(d.wfActionEle).find(".wb-save-button").prop("disabled",!1)})};this.registerAddTaskButton=function(){c.find(".wb-save-button").click(function(){var b=c.find("form:visible"),f=$(b).find("input[name\x3dtaskType]").val(),g=$(b).find("input:radio[name\x3dupdateRecCritOption]:checked").not(":disabled").val();
"7"==f&&$(b).find("textarea[name\x3demailMessage]").val(d.messageBox.getContent());if(d.validateFields(b)){var h=null;"onCriteria"==c.find("input:radio[name\x3dcriteriaOption]:checked").val()&&(h=WorkflowBuilder.getCriteriaData(c.find("div[elename\x3dwfCriteria]")));var k=$(b).find("select:disabled").removeAttr("disabled");b=$(b).serialize();k.attr("disabled","true");null!=h&&(b+="\x26"+h);if("21"==f||"22"==f)if("22"==f||"21"==f&&"current"!=g){if(0==WorkflowBuilder.getDataAccessCriteria()){$(_wfAction.wfActionEle).find(".wb-save-button").prop("disabled",
!1);return}b+="\x26dataAccessCritMap\x3d"+JSON.stringify(WorkflowBuilder.getDataAccessCriteria());b+="\x26isDataAccessCriteria\x3dtrue"}else b+="\x26isDataAccessCriteria\x3dfalse";$.ajax({beforeSend:function(){$(c).find(".wb-save-button").showTextLoading(i18n["zc.workflow.savingaction"])},url:a.URL+"saveAction",type:"POST",data:b+"\x26workflowName\x3d"+a.APSTask.attr("wfLinkName")+"\x26isNewGroup\x3d"+a.isNewGroup+"\x26groupName\x3d"+a.APSTask.attr("groupname")+"\x26workflowString\x3d"+encodeURIComponent(d.delugeEditor.getEditorValue())+
"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName(),success:function(b,e,f){$(c).find(".wb-save-button").hideTextLoading(i18n["zc.workflow.saveaction"]);"failure"!=b.status||d.isDelugeTask()?d.delugeEditor.handleResponse(b,function(){a.setupNewTaskTab(b);a.closeTaskBuilder()},function(){$(d.wfActionEle).find(".wb-save-button").prop("disabled",!1)}):iAlert(b.errorMessage)}})}else $(d.wfActionEle).find(".wb-save-button").prop("disabled",
!1)})};this.setupNewTaskTab=function(c){var d=$("#approvalStep").find("#no-task-associated").first().clone();$(d).find(".wb-action-menus").removeClass("wb-hide-imp");$(d).find(".wb-action-name").text(c.TASK_DESC.subStr1);$(d).find(".wb-action-name").append($("\x3cspan/\x3e").text(c.TASK_DESC.subStr2));$(d).attr("wflinkname",c.WF_LINK_NAME);$(d).attr("id",c.WF_LINK_NAME);$(d).attr("groupname",c.GROUP_NAME);$(d).attr("actionname",c.LINK_NAME);$(d).removeClass("hide").removeClass("wb-hide-imp");$(d).find(".wb-action-menus").removeClass("wb-hide-imp");
var e=$('\x3cspan class\x3d"wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow" elename\x3d"editAction"\x3e\x3c/span\x3e\x3cspan class\x3d"wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow" elename\x3d"delActionIcon"\x3e\x3c/span\x3e');$(d).find(".wb-action-menus").append(e);if(a.isNewGroup){e=$("#approvalStep").find("#no-task-associated").first().parents(".wb-action").clone();e.attr("wflinkname",c.WF_LINK_NAME);e.attr("groupname",c.GROUP_NAME);e.find(".wb-actionList").find(".ui-state-default:not(#no-task-associated)").remove();
e.find("#no-task-associated").attr("wflinkname",c.WF_LINK_NAME);e.find("#no-task-associated").attr("groupname",c.GROUP_NAME);e.find(".wb-actionList").append(d);if(null!=c.criteria){var h=e.find(".zc-wb-action-head");$(h).attr("elename","criteria").html("");$(h).html($("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+"  "));$(h).append($("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(c.criteria));c=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus");
$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria"));$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename","delCriteria"));$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-drag-icon zc-em zc-wb-rearrange"));$(h).append(c);$(h).closest("li[elename\x3dgroupele]").attr("class","wb-condition");a.registerCriteriaEvents(h)}$(b).before(e)}else $(b).closest("ul").find("#no-task-associated").addClass("hide"),
$(b).closest("ul").append(d);a.registerNewTask(a.isNewGroup,d)};this.registerNewTask=function(b,c){$(c).click(function(){var a=new StepTasks($(this));a.init();a.editStepTask()});$(c).find(".wb-addaction").click(function(a){a.stopPropagation();a=new StepTasks($(this).closest("li"));a.init();a.addStepTask()});$(c).find(".wb-edit-icon").click(function(a){a.stopPropagation();a=new StepTasks($(this).closest("li"));a.init();a.editStepTask()});$(c).find(".wb-del-icon").click(function(a){a.stopPropagation();
a=new StepTasks($(this).closest("li"));a.init();a.deleteStepTask()});b&&(b=$(c).closest(".wb-action"),$(b).find("#no-task-associated").find(".wb-addaction").click(function(){var a=new StepTasks($(this).closest("li"));a.init();a.addStepTask()}),$(b).find(".zc-wb-action-head").find("span[elename\x3deditCriteria]").off("click").on("click",function(){a.editCriteria($(this).closest(".zc-wb-action-head"))}),$(b).find(".zc-wb-action-head").find("span[elename\x3ddelCriteria]").off("click").on("click",function(){a.deleteCriteria($(this).closest(".zc-wb-action-head"))}))};
this.editCriteria=function(b){var c="zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26formlinkname\x3d"+$.approvalObj.getFormLinkName();if(void 0!=b){var d=$(b).find(".zc-wfb-condition-chk").text().trim();d=d.replace(/ && /g," ZC_AND ");c=c+"\x26criteria\x3d"+d}$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"edit/loadCriteriaBuilder",type:"POST",data:c,beforeSend:showLoading(),success:function(c,d,e){hideLoading();iCustomizePopup({title:i18n["zc.workflowbuilder.editcriteria"],body:c,buttons:[{name:ZCButton.SAVECRITERIA,
type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",success:function(){return 0==a.saveActionCriteria(b,$(".zc-wfb-criteria-popup"))?!1:!0},failure:function(){}});CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"))}})};this.deleteCriteria=function(b){var c=$(b).closest("li");iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.workflowbuilder.confirmdeletecriteria"],success:function(){$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+
"/edit/deleteCriteria",type:"POST",data:"zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26workflowName\x3d"+c.attr("wfLinkName")+"\x26groupName\x3d"+c.attr("groupname")+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName(),beforeSend:showLoading(),success:function(d,e,f){hideLoading();0==$(c).find(".ui-state-default:not(#no-task-associated)").length?$(c).remove():(d=$(b).closest(".zc-wb-action-head").attr("elename","nocriteria"),
e=$("\x3cstrong\x3e\x3c/strong\x3e").html(i18n["zc.workflowbuilder.executewithoutcondition"]),f=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus"),$(f).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria")),$(d).html("").append(e).append(f),a.registerCriteriaEvents(d))}})}})};this.saveActionCriteria=function(b,c){c=a.getCriteriaData(c);if(0==c)return!1;var d=$(b).closest("li");c=c+"\x26workflowName\x3d"+
d.attr("wfLinkName")+"\x26groupName\x3d"+d.attr("groupname");$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"/edit/saveCriteria",type:"POST",data:"zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26"+c+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName(),beforeSend:showLoading(),success:function(c,d,e){hideLoading();$(b).attr("elename","criteria").html("");$(b).html($("\x3cstrong/\x3e").html(i18n["zc.workflowbuilder.executeonlyif"]+
"  "));$(b).append($("\x3cspan/\x3e").attr("class","zc-wfb-condition-chk").text(c.criteriaString));c=$("\x3cspan\x3e\x3c/span\x3e").attr("class","flt-right wb-action-menus");$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-edit-icon zc-em zc-wb-edit-workflow").attr("elename","editCriteria"));$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class","wb-action-icon wb-del-icon zc-em zc-wb-delete-workflow").attr("elename","delCriteria"));$(c).append($("\x3cspan\x3e\x3c/span\x3e").attr("class",
"wb-action-icon wb-drag-icon zc-em zc-wb-rearrange"));$(b).append(c);$(b).closest("li[elename\x3dgroupele]").attr("class","wb-condition");a.registerCriteriaEvents(b)}})};this.getCriteriaData=function(a){a=CriteriaBuilderNew.updateInput($(a).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?a+"\x26isCriteria\x3dtrue":!1};this.registerCriteriaEvents=function(b){$(b).find(".wb-action-menus").find("span[elename\x3deditCriteria]").click(function(){a.editCriteria($(this).closest(".zc-wb-action-head"))});
$(b).find(".wb-action-menus").find("span[elename\x3ddelCriteria]").click(function(){a.deleteCriteria($(this).closest(".zc-wb-action-head"))})};this.closeTaskBuilder=function(){$("#wf-slider").find(".zc-dem-right-close").trigger("click");$("#wfAction").deActive();unfreeze();$("#wfAction").find(".wb-sectionright").empty();$("#wfAction").css("display","none")}}
function ApprovalConfig(b){var a=this;this.init=function(){a.setName();a.setDescription();a.open();a.movePopupOutSide()};this.movePopupOutSide=function(){1<$(".appendApproverSettingsHere").length&&$(".appendApproverSettingsHere").eq(1).remove();$("#zc-dem-container").append($("#appendApproverSettingsHere").removeClass("zc-hide"))};this.getTempSettings=function(){return $("#appendApproverSettingsHere")};this.getNameElm=function(){return $(b).find("input[name\x3dworkflowname]")};this.getDescriptionElm=
function(){return $(b).find("textarea[name\x3dworkflowdesc]")};this.setName=function(){a.getNameElm().val($.approvalObj.getName())};this.setDescription=function(){a.getDescriptionElm().val($.approvalObj.getDescription())};this.getCritConfElm=function(){return $("#approvalBuilderConfiguration \x3e #approvalBuilderConfiguration-without-button")};this.appendCriteria=function(){$(b).find(".wb-popup-innerContainer").append(a.getCritConfElm())};this.moveBackCrit=function(){$("#zc-dem-container").find("#ApprovalSettingConfigurations").find("#approvalBuilderConfiguration").append(a.getTempSettings().find("#approvalBuilderConfiguration-without-button"))};
this.moveBackSettings=function(){$("#ApprovalSettingConfigurations").append(a.getTempSettings().find(".zc-wfb-workflow-settings-right-popup"))};this.open=function(){var c=$("#approval-settings-container");$("#approvalConfig").find(".wb-popup-overlay").removeClass("wb-hide-imp");$(b).removeClass("wb-hide-imp");$(b).addClass("wb-fromLeft");$(b).iSlide({afterClose:function(){a.moveBackSettings();$("#approval-settings-container").clearError()},afterOpen:function(){$("input[name\x3dworkflowname]").focus()}});
a.getTempSettings().append($(b));$(c).zcScrollPane({autoReinit:!0})};this.cancel=function(){a.moveBackSettings();$(b).deActive();unfreeze()};this.getCriteriaRadio=function(){return $(b).find("input[name\x3dapproverCriteria]")};this.saveSettings=function(){APValidation.validateProcess()&&($.approvalObj.setName(a.getNameElm().val().trim()),$.approvalObj.setDescription(a.getDescriptionElm().val()),$.approvalObj.handleNameChange(),$.approvalObj.saveProcess(!1,!1,Constants.APPROVAL_SETTINGS,function(){a.cancel()}))};
this.loadCriteriaBuilderPopup=function(b,d){var c="zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26formlinkname\x3d"+$.approvalObj.getFormLinkName();void 0!=b&&"true"==$(b).attr("criteria")&&(b=$(b).text().trim(),b=b.replace(/ && /g," ZC_AND "),c=c+"\x26criteria\x3d"+b);$.ajax({url:$.approvalObj.geWorkflowBuilderURL()+"edit/loadCriteriaBuilder",type:"POST",data:c,beforeSend:$("#approval-settings-container").showLoading(),success:function(b,c,e){$("#approval-settings-container").hideLoading();iCustomizePopup({title:i18n["zc.workflowbuilder.editcriteria"],
body:b,buttons:[{name:ZCButton.SAVECRITERIA,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",success:function(b){var c=CriteriaBuilderNew.updateInput($(b.container).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?a.updateCriteria(c,$(b.container)):!1},failure:function(){d&&d()}});CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"))}})};
this.updateCriteria=function(b,d){var c=!0;$.ajax({beforeSend:showLoading(),type:"POST",dataType:"json",async:!1,data:"zccpn\x3d"+$.approvalObj._variables.csrfToken+"\x26"+b,url:$.approvalObj.getURL()+"getCriteriaString",success:function(b,d,e){hideLoading();b.hasOwnProperty("CRITERIA_ERROR")?c=!1:(d=$("\x3cdiv\x3e\x3c/div\x3e").attr("class","zc-dem-clearfix zc-approval-criteria-add-edit").attr("elename","approvalCriteria").attr("criteria","true"),b=$("\x3ca\x3e\x3c/a\x3e").text(b.criteriaStr),$(d).append(b),
$(d).off("click").on("click",function(){a.loadCriteriaBuilderPopup(this)}),$("#load-approvalBuilderConfiguration").find("div[elename\x3dapprovalCriteria]").replaceWith(d))}});return c};this.viewCriteria=function(){APValidation.isFormSelected()&&$.ajax({beforeSend:showLoading(),type:"POST",url:$.approvalObj.getURL()+"criteriaBuilder",success:function(a,d,e){$(b).find("form[id\x3dupdateCriteria]").html(a);$(b).find("form[id\x3dupdateCriteria]").smoothShow(300,function(){});CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});
CriteriaBuilderNew.init($(b).find("form[id\x3dupdateCriteria]").find(".zc-rule-main"));hideLoading()}})};this.removeCriteria=function(){$(b).find("#updateCriteria").smoothHide(300,function(){})}};$(function(){$.widget("custom.completeapprovers",$.ui.autocomplete,{_renderMenu:function(b,a){var c=this,d="";$.each(a,function(a,f){f.category!=d&&(b.append("\x3cli class\x3d'ui-autocomplete-category'\x3e"+f.category+"\x3c/li\x3e"),d=f.category);c._renderItemData(b,f)})}})}());$.fn.approvalPopupEscape=function(b){return this.each(function(){$(document).on("keydown",this,function(a){27===("undefined"!=typeof a.keyCode&&a.keyCode?a.keyCode:a.which)&&b.call(this,a)})})};
function AProcessConfig(b,a){ApprovalUtil.call(this,b);this.approvalLinkName=this.formLinkName="";this.APconfig=b;this.setupElements(a)}AProcessConfig.prototype=Object.create(ApprovalUtil.prototype);AProcessConfig.prototype.constructor=AProcessConfig;function ATSettings(b){this.approvalLinkName="";this.APTitle=$(b);this.setupElements();this.registerEvents()}function APSettings(b){ApprovalConfig.call(this,b);this.APSetting=b;this.registerEvents()}APSettings.prototype=Object.create(ApprovalConfig.prototype);
APSettings.prototype.constuctor=APSettings;function AStep(b){StepElements.call(this,b);this.APStep=b;this.setupElements();this.registerEvents()}AStep.prototype=Object.create(StepElements.prototype);AStep.prototype.constructor=AStep;function AASettings(b){this.APPopup=b;this.selectedApproverElm="";this.setupElements();this.registerEvents()}function LoadProcess(b){this.LAP=b;this.setupElements();this.registerEvents()}
function StepTasks(b){APStepTask.call(this,b);this.TaskOperation={EDIT_TASK:1,ADD_TASK:2};this.APSTask=b;this.setupElements()}StepTasks.prototype=Object.create(APStepTask.prototype);StepTasks.prototype.constructor=StepTasks;
AProcessConfig.prototype.setupElements=function(b){this.init();$.approvalObj=this;$.approvalObj._variables=b;this.getApprovalSteps().each(function(a){new AStep(this)});new ATSettings(this.APconfig);b=$("#wb-blockList0");var a=$("#wb-blockList");0==$(b).find(".wb-action").length&&1>$(a).find(".zc-dem-approval-level").length&&($(b).hide(),$("#approval-events-pane").hide());$.approvalObj.setApprovalDescriptionHeader($.approvalObj.getSteps().length);$.approvalObj.setApprovalMeta()};
AProcessConfig.prototype.registerEvents=function(){var b=this,a=function(a){$("#appbuilder-popup").html(a);$("#appbuilder-popup").addClass("active");$("#appbuilder-main-head").addClass("zc-dem-workflow-header");appbuilder.updateModule(Modules.APPROVALBUILDER);hideLoading();$.approvalObj._variables.componentType="5";$.approvalObj._variables.moduleName="approvalbuilder";0==$.approvalObj.getSteps().length&&$.approvalObj.getStepsUL().css("display","none")};b.getApprovalList().click(function(){var c=$(this).closest("tr[elename\x3dworkflowRow]");
b.formLinkName=$(c).attr("formlinkName");b.approvalLinkName=$(c).attr("workflowname");$.approvalObj._variables.updateComponent(Constants.APPROVALWF,b.approvalLinkName);c=appbuilder.component.APP.getAppEditUrl()+"/"+b.formLinkName+"/approvalWorkFlow/loadProcess";history.pushState({},"",appbuilder.component.APP.getAppEditUrl()+"/"+b.formLinkName+"/approvalWorkFlow/"+b.approvalLinkName+"/edit");$.ajax({beforeSend:showLoading(),url:c,type:"POST",data:"approvalLinkName\x3d"+b.approvalLinkName+"\x26sb_tracking\x3dfalse",
success:function(b){a(b)}})});b.getApprovalActionList().click(function(){var c=$(this).closest("tr[elename\x3dworkflowRow]");b.formLinkName=$(c).attr("formlinkName");b.approvalLinkName=$(c).attr("workflowname");b.approvalWfName=$(c).attr("workflowname");var d=$(this).attr("wfLinkName"),e=$(this).attr("actionLinkName");$.approvalObj._variables.updateComponent(Constants.APPROVALWF,b.approvalLinkName);c=appbuilder.component.APP.getAppEditUrl()+"/"+b.formLinkName+"/approvalWorkFlow/loadProcess";history.pushState({},
"",appbuilder.component.APP.getAppEditUrl()+"/"+b.formLinkName+"/approvalWorkFlow/"+b.approvalLinkName+"/edit");$.ajax({beforeSend:showLoading(),url:c,type:"POST",data:"approvalLinkName\x3d"+b.approvalLinkName+"\x26sb_tracking\x3dfalse",success:function(b){a(b);setTimeout(function(){""!=e&&$("#wf-action-container").find("li[wflinkname\x3d"+d+"][actionname\x3d"+e+"]").find(".wb-edit-icon").trigger("click")},300)}})});CriteriaBuilder.bindAllFunction(!0,$("#updateCriteria"))};
ATSettings.prototype.setupElements=function(){$(this.APTitle).find(".title-form-name").text($.approvalObj.getFormLinkName());$("div[id\x3dapproverConfig]").removeClass("wb-hide");$("div[id\x3daddNewApprover]").css("display","block");$(".wb-zcrtheader").addClass("wb-hide");$(".wb-zcheading").removeClass("wb-hide");$(".wb-content-wraper").hide();$(this.APTitle).find(".wb-zcheading").removeClass("wb-hide-imp");void 0==$.approvalObj.getName()||""==$.approvalObj.getName()?$("#zc-dem-comp-name").text("Workflow"):
$("#zc-dem-comp-name").text($.approvalObj.getName())};
ATSettings.prototype.registerEvents=function(){$(this.APTitle).find("div[class\x3dwb-lefttitle]").click(function(){(new APSettings($.approvalObj.getSettings())).init()});$("#appbuilder-header").find("#zc-comp-settings").unbind("click").bind("click",function(){(new APSettings($.approvalObj.getSettings())).init();$("input[name\x3dworkflowname]").focus()});$(this.APTitle).find("li[class\x3dwb-add-new]").click(function(){$(this).addClass("wb-active");(new AStep($.approvalObj.getNewStep())).addNewStep()})};
APSettings.prototype.registerEvents=function(){var b=this;b.getCriteriaRadio().click(function(){"onCriteria"==$(b.APSetting).find(":input[name\x3dapproverCriteria]:checked").val()?""==$(b.APSetting).find("div[elename\x3dapprovalCriteria]").text().trim()?b.loadCriteriaBuilderPopup(this,failureCallBk):$(b.APSetting).find("div[elename\x3dapprovalCriteria]").smoothShow(300,function(){}):$(b.APSetting).find("div[elename\x3dapprovalCriteria]").smoothHide(300,function(){})});$(b.APSetting).find("div[elename\x3dapprovalCriteria]").unbind("click").bind("click",
function(){b.loadCriteriaBuilderPopup(this,failureCallBk)});$(b.APSetting).find("#saveButton").unbind("click").bind("click",function(){b.saveSettings()});$(b.APSetting).find("#cancelButton").click(function(){b.cancel()});failureCallBk=function(){""==$(b.APSetting).find("div[elename\x3dapprovalCriteria]").text().trim()&&$(b.APSetting).find("#approverCriteria1").prop("checked","true")}};
AStep.prototype.setupElements=function(){$.approvalObj.getStepsLength()?$.approvalObj.showLevelHeader():$.approvalObj.hideLevelHeader();$.approvalObj.arrangeHints()};
AStep.prototype.registerEvents=function(){var b=this;b.getEditButton().click(function(){b.initStep()});b.registerApprovalEvents();b.initNoTaskEl();b.getDeleteButton().click(function(){var a=this;iWarning({title:i18n["zc.workflowbuilder.deleteconfirm"],message:i18n["zc.formedit.settings.approvalprocess.wanttoremoveapprover"],success:function(){var b=$(a).closest(".zc-dem-approval-parent-title"),d=b.find("#stepId").attr("value");$(b).closest(".zc-dem-approval-level").remove();b=$("#wb-blockList0");
var e=$("#wb-blockList");1>$(b).find("li.wb-action").length&&1>$(e).find(".zc-dem-approval-level").length&&($(b).hide(),$("#approval-events-pane").hide());$.approvalObj.arrangeHints();$.approvalObj.updateEventPane();$.approvalObj.deleteApprovalStep(d)}})});b.getDuplicateButton().click(function(){var a=$(this).closest("li").clone(),b=this;iConfirm({message:i18n["zc.formedit.settings.approvalprocess.approve.clone"],success:function(){new AStep(a);$(b).closest("#wb-blockList").append(a);$.approvalObj.arrangeHints();
$.approvalObj.saveProcess(!1,!1)},failure:function(){}})});b.getActionNameElm().click(function(){var a=$(this).parents(".ui-state-default");"no-task-associated"==a.attr("id")&&a.find(".wb-addaction").trigger("click")});b.getApprovalActionTitle().click(function(){var a=$(this).closest(".zc-dem-approval-subparent");a.hasClass("expand")?a.removeClass("expand"):a.addClass("expand")});b.getActionAddButton().click(function(){var a=new StepTasks($(this).closest("li"));a.isNewGroup=!0;a.init();a.addStepTask()});
b.getTaskEle().click(function(){var a=new StepTasks($(this));a.init();a.editStepTask()});b.getTaskAddButton().click(function(a){a.stopPropagation();a=new StepTasks($(this).closest("li"));a.init();a.addStepTask()});b.getTaskEditButton().click(function(a){a.stopPropagation();a=new StepTasks($(this).closest("li"));a.init();a.editStepTask()});b.getTaskDeleteButton().click(function(a){a.stopPropagation();a=new StepTasks($(this).closest("li"));a.init();a.deleteStepTask()});b.getCriteriaEditButton().click(function(){b.editCriteria($(this).closest(".zc-wb-action-head"))});
b.getCriteriaDeleteButton().click(function(){b.deleteCriteria($(this).closest(".zc-wb-action-head"))})};StepTasks.prototype.setupElements=function(){this.taskLinkName=$(this.APSTask).attr("id");this.taskDisplayName=$(this.APSTask).find(".wb-action-name").text();this.URL="../../../workflowbuilder/edit/"};
StepTasks.prototype.editTask=function(){var b=this;$.ajax({beforeSend:APResource.showLoading(),url:b.URL+"getAction",type:"POST",data:{eventType:1,zccpn:$.approvalObj._variables.csrfToken,isApprovalTask:!0,linkName:b.taskLinkName,formlinkname:APResource.getFormLinkName()},success:function(a,c,d){b.popup(a,b.TaskOperation.EDIT_TASK);APResource.hideLoading()}})};
StepTasks.prototype.addTask=function(){var b=this;$.ajax({beforeSend:APResource.showLoading(),url:b.URL+"getAction",type:"POST",data:{eventType:1,zccpn:$.approvalObj._variables.csrfToken,isApprovalTask:!0,formlinkname:APResource.getFormLinkName()},success:function(a){b.popup(a,b.TaskOperation.ADD_TASK);APResource.hideLoading()}})};
StepTasks.prototype.deleteTask=function(){var b=this;iConfirm({message:i18n["zc.formedit.settings.approvalprocess.task.delete"],success:function(){1==$(b.APSTask).closest("ul").find("li").not("#no-task-associated").length&&$(b.APSTask).closest("ul").find("#no-task-associated").removeClass("wb-hide-imp");"ap_approval_send_email"!=b.taskLinkName&&b.taskLinkName!=ap_denied_send_email&&$.ajax({beforeSend:APResource.showLoading(),data:"taskName\x3d"+b.taskLinkName+"\x26zccpn\x3d"+$.approvalObj._variables.csrfToken+
"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL,url:"../form/"+APResource.getFormLinkName()+"/settings/edit/deleteTask",type:"POST",success:function(a){APResource.hideLoading()}});$(b.APSTask).remove()},failure:function(){}})};
StepTasks.prototype.popup=function(b,a){$("#wfAction").html(b);$("#wfAction").css("display","block");$("#wfAction").removeClass("wb-hide-imp");WorkflowBuilder.commonEvents($("#actionDetail"));b=new WorkflowAction($("#wfAction"),APResource.getFormLinkName());a==this.TaskOperation.EDIT_TASK?b.registerEvents(!0,!0):b.registerEvents(!1,!0);this.addInputName(a);$("#wfAction").find(".wb-cond-header").remove();$("#approvalConfig").find(".wb-popup-overlay").removeClass("wb-hide-imp");$("#wfAction1").css("display",
"block");$("#wfAction").find(".wb-sectionright").removeClass("wb-hide-imp");$("#wfAction1").find(".wb-sectionright").addClass("active");$("#wfAction").addClass("wb-fromLeft");$("#wfAction").find(".wb-action-type").find("*").not(".wb-alert-icon").remove();this.registerEvents(a);$("#zc-dem-container").append($("#wfAction"))};
StepTasks.prototype.taskPopUpClose=function(){$("#wfAction").find(".wb-sectionright").empty();$("#approvalConfig").find(".wb-popup-overlay").addClass("wb-hide-imp");$("#wfAction").css("display","none")};
StepTasks.prototype.addInputName=function(b){var a=$("#wfAction").find("form").find(".wb-mail-filling").find(".wb-input-group").first().clone();$(a).empty();a.append($("\x3clabel\x3e").text("Task Name:"));$("\x3cinput\x3e").attr({type:"text",id:"name",name:"name"}).appendTo(a);b==this.TaskOperation.EDIT_TASK?$(a).find(":input").val(this.taskDisplayName):"";$("#wfAction").find("form").find(".wb-mail-filling").each(function(){$(this).prepend($(a).clone())})};
StepTasks.prototype.registerEvents=function(b){var a=this;b==a.TaskOperation.EDIT_TASK&&($("#wfAction").find(".wb-popup-buttons").find(".wb-save-button").text(ZCButton.UPDATETASK),$("#wfAction").find(".wb-save-button").click(function(){"7"==$("#wfAction").find("form:visible").find("input[name\x3dtaskType]").val()&&$("#wfAction").find("form:visible").find("textarea[name\x3demailMessage]").val(messageBox.getContent());var b=$("#wfAction").find("form:visible").serialize()+"\x26taskName\x3d"+a.taskLinkName+
"\x26isApprovalTask\x3dtrue\x26formlinkname\x3d"+APResource.getFormLinkName()+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL;b=b+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName();$.ajax({beforeSend:APResource.showLoading(),url:a.URL+"updateAction",type:"POST",data:b,success:function(b,c,f){b=JSON.parse(b);a.taskDisplayName=b.TASK_DISP_NAME;$("div[id\x3dapproverConfig]").find(".wb-sectionmiddle \x3eul").find("li[id\x3d"+a.taskLinkName+"]").each(function(b){$(this).find(".wb-action-name").text(a.taskDisplayName)});
$.approvalObj.saveProcess(!1,!1);a.taskPopUpClose();APResource.hideLoading()}})}));b==a.TaskOperation.ADD_TASK&&($("#wfAction").find(".wb-popup-buttons").find(".wb-save-button").text(ZCButton.SAVETASK),$("#wfAction").find(".wb-save-button").click(function(){"7"==$("#wfAction").find("form:visible").find("input[name\x3dtaskType]").val()&&$("#wfAction").find("form:visible").find("textarea[name\x3demailMessage]").val(messageBox.getContent());$("#wfAction").find("form:visible").serialize();$.ajax({beforeSend:APResource.showLoading(),
url:"../../../workflowbuilder/edit/saveAction",type:"POST",data:$("#wfAction").find("form:visible").serialize()+"\x26isApprovalTask\x3dtrue\x26formlinkname\x3d"+APResource.getFormLinkName()+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.APPROVAL+"\x26approvalLinkName\x3d"+$.approvalObj.getLinkName(),success:function(b,d,e){d=$(a.APSTask).closest("ul").find("#no-task-associated").clone();$(a.APSTask).closest("ul").find("#no-task-associated").hide();$(d).find(".wb-action-menus").removeClass("wb-hide-imp");
$(d).find(".wb-action-name").text(b.TASK_DISP_NAME);$(d).attr("id",b.TASK_NAME);$(d).css("display","block");$(d).removeClass("wb-hide-imp");$(d).find(".wb-action-menus").removeClass("wb-hide-imp");$(a.APSTask).closest("ul").append(d);$(d).find(".wb-addaction").click(function(){(new StepTasks($(this).closest("li"))).addTask()});$(d).find(".wb-edit-icon").click(function(){(new StepTasks($(this).closest("li"))).editTask()});$(d).find(".wb-del-icon").click(function(){(new StepTasks($(this).closest("li"))).deleteTask()});
$.approvalObj.saveProcess(!1);a.taskPopUpClose();APResource.hideLoading()}})}));$("#wfAction").find(".wb-cancel-button").click(function(){a.taskPopUpClose()})};AASettings.prototype.setupElements=function(){};AASettings.prototype.registerEvents=function(){};AASettings.prototype.cancel=function(){};AASettings.prototype.validate=function(){};AASettings.prototype.loadFormField=function(){};AASettings.prototype.setupApproverList=function(){};AASettings.prototype.getApproverList=function(){};
LoadProcess.prototype.setupElements=function(){var b=new AProcessConfig(this.LAP);b.init();$.approvalObj=b;b.getApprovalSteps().each(function(a){new AStep(this)});new ATSettings(this.LAP)};LoadProcess.prototype.registerEvents=function(){};
var APValidation=new function(){this.isFormSelected=function(){return"-Select-"==APResource.getFormLinkName()?(iAlert(i18n["zc.formedit.settings.approvalprocess.selectform"]),$(":input[id\x3dapproverCriteria1]").prop("checked",!0),!1):!0};this.isValidCriteria=function(b){b=CriteriaBuilder.criteriaBuilderSubmit(b);return 1!=b?(iAlert("Approval Criteria: "+b),!1):!0};this.validateProcess=function(){var b=$(".zc-wfb-workflow-settings-right-popup.active").find("input[name\x3dworkflowname]");return""==
$(b).val()?($(b).showError(i18n["zc.formedit.settings.approvalprocess.namecannotempty"]),!1):0==$("#wb-blockList").find("li[class\x3dwb-action]").length?($(b).showError(i18n["zc.formedit.settings.approvalprocess.approve.create"]),!1):!0};this.validateApprover=function(b){var a=!0;""==$(b).find("#approvalLable").val()&&($(b).find("#approvalLable").showError(i18n["zc.formedit.settings.approvalprocess.emptyapprovallabel"]),a=!1);""==$(b).find("#denialLable").val()&&($(b).find("#denialLable").showError(i18n["zc.formedit.settings.approvalprocess.emptydeniallabel"]),
a=!1);4!=$(b).find("#approverTypeSel").val()||$(b).find("#userSelectAndRemove #userSelect2").data("zcdd").getData().length||($(b).find("#userSelect2").showError(i18n["zc.formedit.settings.approvalprocess.approve.select"]),a=!1);return a}},APResource=new function(){this.getURL=function(){return"../../../"+APResource.getFormLinkName()+"/approvalWorkFlow/"};this.getFormLinkName=function(){return void 0==$("div[id\x3dbaseFormLinkNameSelect]").find("span").attr("value")?$("div[elename\x3dformTitle]").attr("formLinkName"):
$("div[id\x3dbaseFormLinkNameSelect]").find("span").attr("value")};this.getFormDisplayName=function(){return $("div[id\x3dbaseFormLinkNameSelect]").find("span").text()};this.removeUnwantedTasks=function(b){$(b).find(":input[name\x3dtaskType]").find('optgroup[label\x3d"Field Tasks"]').find("option").each(function(){14!=$(this).val()&&$(this).remove()});$(b).find(":input[name\x3dtaskType]").find('optgroup[label\x3d"Subform Tasks"]').remove();$(b).find(":input[name\x3dtaskType]").find('optgroup[label\x3d"Form Tasks"]').attr("label",
"")};this.getInputsObj=function(b){var a="",c="";$(b).find(":input").each(function(b,e){c=$(e).attr("name");void 0!=c&&""!==c&&(a+=c+"\x3d"+encodeURIComponent($(e).val())+"\x26")});return a};this.showLoading=function(){$("#loadingDiv").addClass("loadingspinner")};this.hideLoading=function(){$("#loadingDiv").removeClass("loadingspinner")}};function PaymentConfig(b,a,c){var d=this;d.variables=b;d.pmtElem=a;d.formName=c;PaymentURL.init(b);this.registerEvents=function(){$(d.pmtElem).find("input[name\x3dpaymentCriteria]").on("change",function(){"onCondition"==$(this).val()?""==$(d.pmtElem).find("div[elename\x3dpaymentCriteria]").text().trim()?d.loadCriteriaBuilderPopup($(this).closest("div[elename\x3dpaymentCriteria]"),failureCallBk):$(d.pmtElem).find("div[elename\x3dpaymentCriteria]").removeClass("zc-hide"):$(d.pmtElem).find("div[elename\x3dpaymentCriteria]").addClass("zc-hide")});
$(d.pmtElem).find("input[name\x3dpaymentType]").on("change",function(){var a=$(this).val();$(d.pmtElem).find("div[eletype\x3drecurringOptions]").addClass("zc-hide");"recurring"==a&&$(d.pmtElem).find("div[eletype\x3drecurringOptions]").removeClass("zc-hide")});$(d.pmtElem).find("select[name\x3dpaymentFrequency]").on("change",function(){$(d.pmtElem).find("div[elename\x3dpaymentWeekDay], div[elename\x3dpaymentMonthDay]").addClass("zc-hide");if("specific_day"==$(d.pmtElem).find("select[name\x3dpaymentDayType]").val()){var a=
$(this).val();"week"==a?$(d.pmtElem).find("div[elename\x3dpaymentWeekDay]").removeClass("zc-hide"):"month"==a&&$(d.pmtElem).find("div[elename\x3dpaymentMonthDay]").removeClass("zc-hide")}});$(d.pmtElem).find("select[name\x3dpaymentDayType]").on("change",function(){var a=$(this).val(),b=$(this).closest("div[elename\x3dpaymentDay]");"same_day"==a?($(b).removeClass("zc-dem-double-selectbox"),$(d.pmtElem).find("div[elename\x3dpaymentWeekDay]").addClass("zc-hide"),$(d.pmtElem).find("div[elename\x3dpaymentMonthDay]").addClass("zc-hide")):
($(b).addClass("zc-dem-double-selectbox"),a=$(d.pmtElem).find("select[name\x3dpaymentFrequency]").val(),$(b).find("div[eletype\x3dpaymentDayTypeUnit]").addClass("zc-hide"),"week"==a?$(b).find("div[elename\x3dpaymentWeekDay]").removeClass("zc-hide"):$(b).find("div[elename\x3dpaymentMonthDay]").removeClass("zc-hide"))});$(d.pmtElem).find("select[name\x3dpaymentDurationType]").on("change",function(){"forever"==$(this).val()?($(this).closest("div[elename\x3dpaymentDuration]").removeClass("zc-dem-double-selectbox"),
$(d.pmtElem).find("input[name\x3dpaymentCycles]").addClass("zc-hide")):($(this).closest("div[elename\x3dpaymentDuration]").addClass("zc-dem-double-selectbox"),$(d.pmtElem).find("input[name\x3dpaymentCycles]").removeClass("zc-hide"))});$(d.pmtElem).find("div[elename\x3dpaymentCriteria]").off("click").on("click",function(){d.loadCriteriaBuilderPopup($(this).closest("div[elename\x3dpaymentCriteria]"),failureCallBk)});$(d.pmtElem).find("input[eletype\x3dpmtInput], select[eletype\x3dpmtInput]").on("change",
function(){d.saveSettings()});failureCallBk=function(){""==$(d.pmtElem).find("div[elename\x3dpaymentCriteria]").text().trim()&&$(d.pmtElem).find("#always").prop("checked","true")}};this.loadCriteriaBuilderPopup=function(a,b){var c="zccpn\x3d"+d.variables.csrfToken+"\x26formlinkname\x3d"+d.formName;void 0!=a&&"true"==$(a).attr("criteria")&&(a=$(a).find("a").text().trim(),a=a.replace(/ && /g," ZC_AND "),c=c+"\x26criteria\x3d"+a);$.ajax({url:PaymentURL.appURL()+"/workflowbuilder/edit/loadCriteriaBuilder",
type:"POST",data:c,beforeSend:$("#workflow-settings-popup").showLoading(),success:function(a,c,e){$("#workflow-settings-popup").hideLoading();iCustomizePopup({title:i18n["zc.workflowbuilder.editcriteria"],body:a,buttons:[{name:ZCButton.SAVECRITERIA,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_CANCEL}],containerClass:"zc-wfb-criteria-popup",success:function(a){var b=CriteriaBuilderNew.updateInput($(a.container).find(".zc-rule-main"));return CriteriaBuilderNew.frmSubmit?
d.saveCriteria(b,$(a.container)):!1},failure:function(){b&&b()}});CriteriaBuilderNew.initConfig({context:Constants.WORKFLOW});CriteriaBuilderNew.init($(".zc-wfb-criteria-popup").find(".zc-rule-main"))}})};this.saveSettings=function(){var a=$(d.pmtElem).find("form[name\x3dworkflowprops]");$.ajax({url:PaymentURL.saveSettingsURL(),dataType:"json",type:"POST",data:$(a).serialize()+"\x26zccpn\x3d"+d.variables.csrfToken+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.PAYMENT,beforeSend:function(){showStatus(i18n.saving)},
success:function(a,b,c){a.hasOwnProperty("PMT_ERROR")&&$(d.pmtElem).showErrorBanner(a.PMT_ERROR)}})};this.saveCriteria=function(a,b){var c=!0;$.ajax({url:PaymentURL.saveCriteriaURL(),type:"POST",async:!1,dataType:"json",data:a+"\x26wfName\x3d"+$(d.pmtElem).find("input[name\x3dwfName]").val()+"\x26zccpn\x3d"+d.variables.csrfToken+"\x26sb_tracking\x3dtrue\x26sb_compCategory\x3d"+WorkflowConstants.PAYMENT,beforeSend:showLoading(),success:function(a,e,f){a.hasOwnProperty("CRITERIA_ERROR")?($(b).showErrorBanner(ZSEC.Encoder.encodeForHTML(a.CRITERIA_ERROR)),
c=!1):(e=$(d.pmtElem).find("div[elename\x3dpaymentCriteria]"),$(e).attr("criteria","true"),$(e).find("a").text(a.criteriaStr),$(e).removeClass("zc-hide"),c=!0);hideLoading()}});return c}}
var PaymentURL=new function(){var b=this;b.variables={};this.init=function(a){b.variables=a};this.appURL=function(){return appbuilder.component.APP.getAppEditUrl()};this.getPaymentURL=function(){return b.appURL()+"/payment"};this.saveSettingsURL=function(){return b.getPaymentURL()+"/saveSettings"};this.saveCriteriaURL=function(){return b.getPaymentURL()+"/saveCriteria"}};function WorkflowPopup(b){_self=this;_self.container;_self.wfLinkName=b.wfLinkName;_self.constants=b.component;_self.openCallBK=void 0==b.openCallBK?function(){}:b.openCallBK;_self.closeCallBK=void 0==b.closeCallBK?function(){}:b.closeCallBK;this.init=function(){""!=_self.wfLinkName&&void 0!=_self.wfLinkName&&$.ajax({url:appbuilder.component.APP.getAppEditUrl()+"/workflowbuilder/"+_self.wfLinkName+"/edit",type:"GET",data:{xajazc:!0},beforeSend:function(){showLoading()},success:function(a,b,d){hideLoading();
_self.initSetup(a)},error:function(a,b,d){hideLoading();iAlert("Uncaught Error : "+d)}})};this.initSetup=function(a){this.setup(a);this.bind();this.initKeyboardShortcuts()};this.setup=function(a){_self.container=$("\x3cdiv/\x3e").attr({id:"wf-Popup","class":"zc-dem-fullscreen-popup"}).append($("\x3cdiv/\x3e").attr("id","popupHeader")).append($("\x3cdiv/\x3e").attr({id:"popupBody","class":"zc-dem-wfb-popup"}));$("#zc-dem-container").append(_self.container);var b=$("#appbuilder-main-head").clone();
$(_self.container).addClass("zc-dem-custom-action-builder");$(_self.container).find("#popupHeader").append(b);$(_self.container).find("#popupBody").append(a);$(_self.container).addClass("zc-dem-compnt-builder").active();$(_self.container).find("#appbuilder-main-head").addClass("zc-compbuilder-hdr slideDown").removeClass("zc-compappearance-hdr zc-newcomp-hdr").css({display:"block"});$(_self.container).find(".zc-dem-left-navigation").css({display:"none"});$(_self.container).find(".zc-dem-left-menu-container").attr("style",
"width: calc(100% - 350px)");$(_self.container).find(".zc-builder-icon-hdr").attr("class","zc-builder-icon-hdr zc-workflow-icon");$(_self.container).find("#appbuilder-main-head").addClass("zc-dem-workflow-header");$(_self.container).find("#appbuilder-main-nav").css({display:"none"});$(_self.container).find(".zc-accordion-title .zc-common-angle-down").addClass("hide");$(_self.container).find("#zc-dem-comp-name").text($("#wf-action-container").attr("workflowdispname"));_self.openCallBK();_self.initBuilder()};
this.bind=function(){$(_self.container).find("#builder-close").off("click").on("click",function(){$(_self.container).css("z-index",9992);$(_self.container).deActive();_self.closeCallBK();WorkflowBuilder.isBuilder=!0;setTimeout(function(){$(_self.container).remove()},300)})};this.initBuilder=function(){WorkflowBuilder.init(_self.constants);WorkflowBuilder.isBuilder=!1;WorkflowBuilder.registerEvents()};this.initKeyboardShortcuts=function(){}};