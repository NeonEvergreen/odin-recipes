window.DRE=window.DRE||{};DRE.initComplete=!1;DRE.Constants={version:2,baseUrl:"{BASEURL}",staticUrl:{js:"https://js.zohostatic.com/dre",css:"https://js.zohostatic.com/dre"},buildLabel:"##BUILDLABEL##"};var DREInjector={},DREInitializer={};DRE.Theme=new function(){function a(a,b){var c=DRE.Constants.staticUrl.css+"/"+DRE.Constants.buildLabel+"/css/"+a.file+".css",d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=c;d.onload=function(){a.loaded=!0;b()};document.getElementsByTagName("head")[0].appendChild(d)}function b(){if(e.loaded)if(f.loaded){document.documentElement.setAttribute("deluge-theme",e.name);document.documentElement.setAttribute("deluge-editor-theme",f.name);delugeEditor&&delugeEditor.editor.setOption("theme",
f.name);var c=DelugeExpressionBuilder.getInstance();c&&c.exprEditor&&c.exprEditor.editor.setOption("theme",f.name)}else a(f,function(){b()});else a(e,function(){b()})}var c={"default":{loaded:!0,name:"default"},dark:{loaded:!1,name:"dark",file:"dark-theme"},night:{loaded:!1,name:"night",file:"night-theme"},"legacy-dark":{loaded:!1,name:"dark",file:"dark-theme"}},d={"default":{name:"default",loaded:!0},dark:{loaded:!1,name:"monokai",file:"monokai"},night:{loaded:!1,name:"midnight",file:"midnight"},
"legacy-dark":{loaded:!1,name:"material-darker",file:"material-darker"}},e=c["default"],f=d["default"];this.getEditorTheme=function(){return f.name};this.getBuilderTheme=function(){return e.name};this.set=function(a,b){a&&(e=c[a]||c["default"]);f=d[b||a]||d["default"]};this.load=function(a,c){this.set(a,c);b()};this.initialize=function(){var a="default",b="default";document.documentElement.hasAttribute("deluge-theme")&&(b=a=document.documentElement.getAttribute("deluge-theme"),document.documentElement.hasAttribute("deluge-editor-theme")&&
(b=document.documentElement.getAttribute("deluge-editor-theme")));this.set(a,b);a=DRE.Constants.staticUrl.css+"/"+DRE.Constants.buildLabel+"/css/";e.loaded||DRE.Constants.Editor.urls.css.push(a+e.file+".css");f.loaded||DRE.Constants.Editor.urls.css.push(a+f.file+".css")};this.bindEvent=function(a){var b=this;a.addEventListener("click",function(){document.documentElement.hasAttribute("deluge-theme")&&"dark"===document.documentElement.getAttribute("deluge-theme")?(b.load("default"),localStorage.setItem("dre.theme",
"default")):(b.load("dark"),localStorage.setItem("dre.theme","dark"))})}};DRE.Theme.initialize();(function(a){a(CodeMirror)})(function(a){function b(b,c){var d=b.getCursor(),e=a.Pos(d.line,d.ch);if(e=b.findMatchingBracket(e)){a:{var f=b.getTokenAt(d);var l=b.getTokenAt({line:d.line,ch:d.ch+1});if("brackets"!=f.type)if(l&&"brackets"==l.type){f=1;break a}else if((f=b.getTokenAt({line:d.line,ch:d.ch-1}))&&"brackets"==f.type){f=-1;break a}f=0}c?b.setSelection(d,{line:e.to.line,ch:e.to.ch+f}):b.setCursor({line:e.to.line,ch:e.to.ch+f})}}var c=a.keyMap.delugeKeys={fallthrough:"default"},d=a.commands,
e=a.keyMap["default"]===a.keyMap.pcDefault?"Ctrl-":"Cmd-";c[e+"/"]="toggleComment";d[c[e+"Alt-/"]="toggleBlockComment"]=function(a){toggleBlockComment(a)};c["Ctrl-Space"]="autocomplete";d[c[e+"."]="gotoNextTag"]=function(a){jumpToNextTag(a,!0)};d[c[e+","]="gotoPreviousTag"]=function(a){jumpToPreviousTag(a,!0)};d[c["Ctrl-M"]="findMatchingBrackets"]=function(a){b(a)};d[c["Ctrl-Alt-M"]="selectWithinBrackets1"]=function(a){b(a,!0)};d[c.Esc="exitFullscreen"]=function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",
!1);a=document.getElementById("compress-editor");null!=a&&(a.style.display="none")};d[c.F5="fullScreen"]=function(a){document.querySelector(".deluge-left-pane")?document.getElementById("delugeEditorHideBtn").click():a.setOption("fullScreen",!a.getOption("fullScreen"))};d[c["Ctrl-3"]="jumpToDeclaration"]=function(a){getVarDec(a);a};d[c["."]="triggerCompletions"]=function(b){setTimeout(function(){b.execCommand("autocomplete")},100);return a.Pass};d[c[e+"S"]="saveScript"]=function(a){a.hasOwnProperty("saveScript")&&
a.saveScript()};d[c[e+"E"]="executeScript"]=function(a){a.hasOwnProperty("executeScript")&&a.executeScript()};d[c[e+"L"]="goToAnything"]=function(a){a.execCommand("goToLine")};d[c[e+"F"]="persistentSearch"]=function(a){a.execCommand("findPersistent")};d[c[e+"Alt-F"]="persistentReplace"]=function(a){a.execCommand("replace")};d[c[e+"G"]="findNextCmd"]=function(a){a.execCommand("findNext")};d[c[e+"Shift-G"]="findPrevCmd"]=function(a){a.execCommand("findPrev")};d[c.Tab="nextArg"]=function(b){tabBehavior(b,
!0)||b.execCommand(a.keyMap.basic.Tab)};d[c["Shift-Tab"]="prevArg"]=function(b){tabBehavior(b,!1)||b.execCommand(a.keyMap.basic["Shift-Tab"])};d[c[e+"Alt-E"]="saveAndExecute"]=function(a){a.state.isShiftorMousemove=!1;a.hasOwnProperty("saveAndExecute")&&a.saveAndExecute()};d[c.F3="showFuncDef"]=function(a){DelugeEditorUtil.showFunctionDefinition(a)};d[c.Esc="closeDialogs"]=function(a){DelugeEditorUtil.functionDefinition.close();a.execCommand("closeNotification")}});var DelugeUtil=function(){};
DelugeUtil.renderScript=function(a,b,c){var d=c||DRE.Theme.getEditorTheme()||"default";c=document.createElement("div");c.innerHTML="\x3cdiv class\x3d'cm-s-"+d+" CodeMirror ro-deluge-script'\x3e\x3cpre\x3e\x3c/pre\x3e\x3c/div\x3e";CodeMirror.runMode(a,"text/deluge",c.querySelector("pre"));if(b){a=c.childNodes[0].childNodes[0];b="\x3cspan class\x3d'ro-deluge-ln'\x3e${LINE}\x3c/span\x3e"+a.innerHTML.replace(/\n(.*)/g,"\n\x3cspan class\x3d'ro-deluge-ln'\x3e${LINE}\x3c/span\x3e$1");d=null;for(var e=0;(d=
b.match(/>(\$\{LINE\})</))&&d;)b=b.replace("${LINE}",++e);a.innerHTML=b}return c.childNodes[0]};DelugeUtil.diff=function(a,b,c){return DRE.diff.show(a,b,c)};DelugeUtil.getDomain=function(){if("undefined"!=typeof i18n&&i18n.hasOwnProperty("deluge.service"))return i18n["deluge.service"];var a=DRE?DRE.Constants.baseUrl:null;return-1<a.indexOf("skydesk.jp")?"skydesk":-1<a.indexOf("zoho.com.cn")?"cn":-1<a.indexOf("zoho.eu")?"eu":-1<a.indexOf("zoho.in")?"in":"zoho"};
DelugeUtil.getLeftPaneDomainName=function(){var a=DelugeUtil.getDomain();switch(a){case "skydesk":return"skydesk";case "eu":return"eu";case "cn":return"cn";case "in":return"in";case "zoho":return"zoho";default:return a}};DelugeUtil.getDivElement=function(a,b){var c=document.createElement("div");c.innerHTML=a;b&&c.setAttribute("class",b);return c};DelugeUtil.appendAll=function(a,b){for(;0!=b.length;)a.appendChild(b[0])};DelugeUtil.attachEvent=function(a,b,c){a&&a.addEventListener(b,c)};
DelugeUtil.attachEventForAll=function(a,b,c){if(a)for(var d=0;d<a.length;d++){var e=a[d];e&&e.addEventListener(b,c)}};DelugeUtil.mergeMaps=function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c};
DelugeUtil.insertAtCaret=function(a,b){if(a){var c=a.scrollTop,d=0,e=a.selectionStart||"0"==a.selectionStart?"ff":document.selection?"ie":!1;"ie"==e?(a.focus(),d=document.selection.createRange(),d.moveStart("character",-a.value.length),d=d.text.length):"ff"==e&&(d=a.selectionStart);var f=a.value.substring(0,d),k=a.value.substring(d,a.value.length);a.value=f+b+k;d+=b.length;"ie"==e?(a.focus(),b=document.selection.createRange(),b.moveStart("character",-a.value.length),b.moveStart("character",d),b.moveEnd("character",
0),b.select()):"ff"==e&&(a.selectionStart=d,a.selectionEnd=d,a.focus());a.scrollTop=c}};DelugeUtil.arrayContains=function(a,b,c){if(a&&b){b=b.toLowerCase();for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];c&&(e=d);e=e.toLowerCase();if(e===b)return e}}return null};
DelugeUtil.getUserDataType=function(a){if("string"==typeof a){a=a?a.toLowerCase():a;var b={datetime:"date-time",timestamp:"date-time",string:"text",bigint:"number",decimal:"decimal",bool:"bool","boolean":"bool",constants:"constants",list:"list",map:"key-value",collection:"collection",aggregate:"aggregate"};return a=b.hasOwnProperty(a)?b[a]:null}};DelugeUtil.getWindowTypes=function(){for(var a=[],b=0;b<Window_Types.length;b++)a.push(Window_Types[b].elemName);return a};
DelugeUtil.getAllowedFieldTypesForAggregateFunction=function(a){var b=null,c=!0;if(a&&"string"==typeof a)switch(a=a.toLowerCase(),a){case "distinct":case "count":c=!1;break;case "minimum":case "maximum":b=["DECIMAL","BIGINT","TIMESTAMP"];break;case "sum":case "median":case "avg":c=!1,b=["DECIMAL","BIGINT"]}return{types:b,allowSystemFields:c}};DelugeUtil.getDelugeDataTypes=function(){return"string decimal datetime bool int collection".split(" ")};
DelugeUtil.getDelugeDataType=function(a){if(a)switch(a=a.toLowerCase(),a){case "timestamp":case "datetime":return"timestamp"}return a};DelugeUtil.sortList=function(a,b){a&&0<a.length&&a.sort(function(a,d){return a[b]>d[b]?1:a[b]<d[b]?-1:0});return a};DelugeUtil.convertMapToList=function(a){var b=[];if(a)for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b};
DelugeUtil.intersect=function(a,b){var c=[];a=a.map(function(a){return a.toLowerCase()});b=b.map(function(a){return a.toLowerCase()});for(var d in a)a.hasOwnProperty(d)&&-1<b.indexOf(a[d])&&c.push(a[d]);return c};
DelugeUtil.stringify=function(a){function b(a){return"object"!==typeof a||null===a||a instanceof Array?c(a):"{"+Object.keys(a).map(function(b){return"function"===typeof a[b]?null:'"'+b+'":'+c(a[b])}).filter(function(a){return a})+"}"}function c(a){switch(typeof a){case "string":return'"'+a.replace(/\\/g,"\\\\").replace('"','\\"')+'"';case "number":case "boolean":return""+a;case "function":return"null";case "object":return a instanceof Date?'"'+a.toISOString()+'"':a instanceof Array?"["+a.map(c).join(",")+
"]":null===a?"null":b(a)}}return b(a)};DelugeUtil.getParamDataTypes=function(){return"string int date decimal collection boolean".split(" ")};DelugeUtil.getReturnTypes=function(){return["void"].concat(DelugeUtil.getParamDataTypes())};DelugeUtil.setCookie=function(a,b,c,d,e){var f=new Date;c?f.setTime(f.getTime()+864E5*c):f.setTime(f.getTime()+31536E6);a=a+"\x3d"+escape(b)+";expires\x3d"+f.toGMTString()+";";d&&(a=a+"domain\x3d"+escape(d)+";");e&&(a=a+"path\x3d"+escape(e)+";");document.cookie=a};var DelugeShortKeys=function(){for(var a=CodeMirror.keyMap["default"]===CodeMirror.keyMap.pcDefault?!0:!1,b,c={COMMAND:{code:91,label:a?"Ctrl":"\x26#8984;"},CTRL:{code:17,label:a?"Ctrl":"^"},SHIFT:{code:16,label:a?"Shift":"\x26#8679;"},ALT:{code:18,label:a?"Alt":"\x26#8997;"},SPACE:{code:32,label:"Space"},F3:{code:114,label:"F3"},SLASH:{code:191,label:"/"},DOT:{code:190,label:"."},COMMA:{code:188,label:","}},d=["S","E","F","L","Z"],e=0;e<d.length;e++)c[d[e]]={code:d[e].charCodeAt(0),label:d[e]};var f=
function(a,d){var e=CodeMirror.keyMap["default"]===CodeMirror.keyMap.pcDefault?!0:!1;var m='\x3cdiv class\x3d"deluge-shortcut-heading"\x3eKeyboard Shortcuts\x3c/div\x3e\x3cdiv class\x3d"deluge-shortcut-keys"\x3e\x3ctable\x3e';var f=[[{desc:b["deluge.editor.shortcuts.script.save"],keyCode:[c.COMMAND,c.S]},{desc:b["deluge.editor.shortcuts.script.execute"],keyCode:[c.COMMAND,c.E],isAllowedForAll:!1},{desc:b["deluge.editor.shortcuts.script.saveandexecute"],keyCode:[c.COMMAND,c.ALT,c.E],isAllowedForAll:!1}],
[{desc:b["deluge.editor.shortcuts.comment.toggle"],keyCode:[c.COMMAND,c.SLASH]},{desc:b["deluge.editor.shortcuts.blockcomment.toggle"],keyCode:[c.COMMAND,c.ALT,c.SLASH]}],[{desc:b["deluge.editor.shortcuts.showhint"],keyCode:[c.CTRL,c.SPACE]},{desc:b["deluge.editor.shortcuts.childvariables"],keyCode:[c.DOT]},{desc:b["deluge.editor.shortcuts.showfunctiondefinition"],keyCode:[c.F3]},{desc:b["deluge.editor.shortcuts.hint.next"],keyCode:[c.COMMAND,c.DOT]},{desc:b["deluge.editor.shortcuts.hint.previous"],
keyCode:[c.COMMAND,c.COMMA]}],[{desc:b["deluge.editor.shortcuts.find"],keyCode:[c.COMMAND,c.F]},{desc:b["deluge.editor.shortcuts.findandreplace"],keyCode:[c.ALT,c.COMMAND,c.F]},{desc:b["deluge.editor.shortcuts.gotoline"],keyCode:[c.COMMAND,c.L]}],[{desc:b["deluge.editor.shortcuts.undo"],keyCode:[c.COMMAND,c.Z]},{desc:b["deluge.editor.shortcuts.redo"],keyCode:[c.COMMAND,c.SHIFT,c.Z]}]];for(var q in f)if(f.hasOwnProperty(q)){var k=f[q],p;for(p in k)if(k.hasOwnProperty(p)){var x=k[p];if(!arrayContains(d,
x.desc.toLowerCase())){var g="\x3ctr\x3e";if(e){var y=x.keyCode;g+='\x3ctd style\x3d"text-align:center"\x3e';for(var G in y)y.hasOwnProperty(G)&&(g=g+'\x3ckbd class\x3d"light"\x3e'+y[G].label+"\x3c/kbd\x3e",g+="\x3cspan\x3e + \x3c/span\x3e");g=g.slice(0,g.length-16);g+="\x3c/td\x3e"}else{g+='\x3ctd style\x3d"text-align:center"\x3e\x3ckbd class\x3d"light"\x3e';y=x.keyCode;for(var r="",A=0;A<y.length;A++){var u=y[A];u.label&&(r+=" "+u.label)}g=g+r+"\x3c/kbd\x3e\x3c/td\x3e"}g=g+'\x3ctd style\x3d"padding-left:10px;padding-right:10px;"\x3e-\x3c/td\x3e\x3ctd\x3e\x3cdiv class\x3d"deluge-keytitle"\x3e '+
x.desc;x.hasOwnProperty("isAllowedForAll")&&!a&&(g+="\x3cspan\x3e *\x3c/span\x3e");g+="\x3c/div\x3e\x3c/td\x3e";g+="\x3c/tr\x3e";m+=g}}m+="\x3c/tr\x3e"}return DelugeUtil.getDivElement(m+"\x3c/table\x3e\x3c/div\x3e","deluge-shortcut-content")},k=function(a){a.style.display="block"},r=function(a){a.style.display="none"};return{bind:function(c,d,e,m){function l(a){if(a){var b=a.querySelector(".deluge-shortcut-content");b&&"block"!=b.style.display&&(b.style.display="block",a.className+=" deluge-shortkeys-active",
b.style.opacity=0)}}function k(a){a.querySelector(".deluge-shortcut-content").style.display="none";a.className="deluge-shortkeys"}b=m;c.appendChild(f(d,e));d||(d=document.createElement("div"),d.innerHTML='\x3cdiv class\x3d"deluge-key-disclaimer"\x3e\x3cspan style\x3d"color:red"\x3e* \x3c/span\x3eWorks only in functions \x26 schedules\x3c/div\x3e',c.querySelector(".deluge-shortcut-content").appendChild(d.children[0]));a&&(c.querySelector(".deluge-shortkeys-icon").className+=" shortkeys-windows",c.querySelector(".deluge-shortcut-content").style.minWidth=
"338px");c.querySelector(".deluge-shortkeys-icon")&&c.querySelector(".deluge-shortkeys-icon").addEventListener("click",function(){"none"!=c.querySelector(".deluge-shortcut-content").style.display?k(c):l(c)});c.addEventListener("mouseenter",function(){l(this)});c.addEventListener("mouseleave",function(){k(this)})},getContentDiv:f,addToAction:function(a,b,c){b&&(b=f(!1,c),b.className+=" deluge-action-shortkeys",DelugeEditorUtil.addToActionTool(a,b))},toggle:function(a,b){(a=a.querySelector(".deluge-action-shortkeys"))&&
("block"==a.style.display||b?r(a):k(a))},show:k,hide:r}}();Object.keys||(Object.keys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b});
var GLOBAL_KEYWORDS=["zoho","thisapp","input","old","row"],PANEL_GROUPS={hide:["hide","show"],enable:["enable","disable"],addAll:["addAll","removeAll"],add:["add","append"],selectAll:["selectAll","deselectAll"],select:["select","deselect"],share:["share","unshare"]},PANEL_GROUPS_KEYS=function(){var a=[],b;for(b in PANEL_GROUPS)PANEL_GROUPS.hasOwnProperty(b)&&(a=a.concat(PANEL_GROUPS[b]));return a}(),PANEL_GROUPS_SEARCH_PATTERN=new RegExp(PANEL_GROUPS_KEYS.join("|"),"i"),LINT_DELAY=1E3,GUTTER_DELUGE_MARKER=
"CodeMirror-foldgutter",GUTTER_LINT_MARKER="CodeMirror-lint-markers",TAGS={STRING:"\x3cstring\x3e",BIGINT:"\x3cbigint\x3e",DECIMAL:"\x3cdecimal\x3e",BOOLEAN:"\x3cboolean\x3e",TIMESTAMP:"\x3ctimestamp\x3e",LIST:"\x3clist\x3e",MAP:"\x3cmap\x3e",VARIABLE:"\x3cvariable\x3e",OPR:"\x3copr\x3e",EXPRESSION:"\x3cexpression\x3e",FIELD:"\x3cfield\x3e",FORM:"\x3cform\x3e",COLLECTION_VARIABLE:"\x3ccollection_variable\x3e",AGGREGATE_FUNCTION:"\x3caggregate_function\x3e",VALUE:"\x3cvalue\x3e",VALUE1:"\x3cvalue1\x3e",
VALUE2:"\x3cvalue2\x3e",BASIC_OPR:"\x3cbasic_opr\x3e",SERVICE:"\x3cservice\x3e",ACTION:"\x3caction\x3e",PROVIDER:"\x3cprovider\x3e",PARAMS:"\x3cparams\x3e",ADD:"\x3cadd\x3e",UPDATE:"\x3cupdate\x3e",GET:"\x3cget\x3e",WRITE_HTML_CODE:"\x3cwrite_your_html_content_here\x3e",URL:"\x3curl\x3e",OBJECT:"\x3cobject\x3e",COMPONENTS:"\x3ccomponent\x3e",WINDOW_TYPE:"\x3cwindow_type\x3e",CONNECTION:"\x3cconnection\x3e",REQUEST_TYPE:"\x3crequest_type\x3e"},DATATYPE_TAGS="void int float string list map bool date collection nullable".split(" "),
DEFINITION_KEYWORDS=["to","as","on","actions"],CLIENT_FUNCTION_TAGS=["select"],UD_TAGS=["update","variable"],REQUEST_TYPE=["GET","POST","PUT","DELETE","PATCH"],TAGS_VALUES=Object.keys(TAGS).map(function(a){return TAGS[a].slice(1,-1)}),ALL_DELUGE_TAGS=TAGS_VALUES.concat("MYVARIABLE"),TAGS_SEARCH_PATTERN=/<[A-Za-z0-9_-]+>/,TAGS_SEARCH_PATTERN_GREEDY=/<[A-Za-z0-9_-]+>/g,TAGS_TEST_PATTERN=/^<[A-Za-z0-9_-]+>/i,TAGS_TEST_PATTERN_BACK=/<[A-Za-z0-9_-]+>$/,COMMA_SEPARATOR_PATTERN=/,(?![^(]*\))/m,LOGICAL_OPERATORS=
/&&|\|\|/,BASE_OPERATORS={PLUS:{text:"+",desc:"Plus / Concatenate"},MINUS:{text:"-",desc:"Minus / Subtracts "},MULTIPLY:{text:"*",desc:"Multiply"},DIVIDE:{text:"/",desc:"Divide"},PERCENTAGE:{text:"%",desc:"Percentage / Module"}},BASIC_OPERATORS=Object.keys(BASE_OPERATORS).map(function(a){return BASE_OPERATORS[a].text}),REL_OPERATORS={EQUALS:{text:"\x3d\x3d",desc:"Equals to"},NOT_EQUALS:{text:"!\x3d",desc:"Not Equals to"},GREATER:{text:"\x3e",desc:"Greater than"},GREATER_EQUAL:{text:"\x3e\x3d",desc:"Greater than equals"},
LESSER:{text:"\x3c",desc:"Lesser than"},LESSER_EQUAL:{text:"\x3c\x3d",desc:"Lesser than equals"},IS:{text:"is",desc:"is"},IN:{text:"in",desc:"in"},NOT_IN:{text:"not in",desc:"not in"}},RELATIONAL_OPERATORS=Object.keys(REL_OPERATORS).map(function(a){return REL_OPERATORS[a].text}),REL_OPR_PATTERN=new RegExp(RELATIONAL_OPERATORS.join("|").replace(" ","[\\s]"),"i"),BASIC_OPR_PATTERN=new RegExp("\\"+BASIC_OPERATORS.join("|\\")),OPERATOR_PATTERN=new RegExp(LOGICAL_OPERATORS.source+"|"+REL_OPR_PATTERN.source),
condition=TAGS.VARIABLE+" "+TAGS.OPR+" "+TAGS.EXPRESSION,condition2=TAGS.FIELD+" "+TAGS.OPR+" "+TAGS.EXPRESSION,formEmbed="\x3cdiv elName\x3d'zc-component' formLinkName\x3d'"+TAGS.FORM+"' \x3e\x3c/div\x3e",widgetCode="\x3ciframe name\x3d'zohoview' height\x3d'400' width\x3d'100%' frameborder\x3d'0' scrolling\x3d'Auto' src\x3d'"+TAGS.URL+"' \x3e\x3c/iframe\x3e",tagMsg="Tags are something enclosed within angular brackets which are not part of deluge script. Example: \x3cexpression\x3e",keysList=[{key:"Ctrl / Cmd + E",
action:"Execute Script"},{key:"Ctrl / Cmd + S",action:"Save Script"},{key:"Ctrl / Cmd + /",action:"Toggle Line Comments"},{key:"Ctrl / Cmd + Shift + /",action:"Toggle Block Comments"},{key:"Ctrl / Cmd + Space",action:"AutoCompletion / Suggestions"},{key:"Ctrl / Cmd + .",action:"Jump to Next Tag \x3ci class\x3d'fa fa-question-circle' data-toggle\x3d'tooltip' title\x3d'"+tagMsg+"' data-placement\x3d'right'\x3e\x3c/i\x3e"},{key:"Ctrl / Cmd + ,",action:"Jump to Previous Tag \x3ci class\x3d'fa fa-question-circle' data-toggle\x3d'tooltip' title\x3d'"+
tagMsg+"' data-placement\x3d'right'\x3e\x3c/i\x3e"},{key:"Tab",action:"Switch to Next argument in a function"},{key:"Shift + Tab",action:"Switch to Previous argument in a function"},{key:"F5",action:"Full Screen (Press Esc to exit Full Screen)"}],panelJson=[{groupName:"Notifications",elements:[{elemName:"push_notification",displayName:"push notification",displayCode:"push notification\n[\n\tto: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\n]",description:"push notification mail",key:["push notification"]},
{elemName:"send_mail_with_attachments",displayName:"send mail",displayCode:DRE.serviceFlags.isEnabled("syntax-assist")?"sendmail\n[\n\tfrom: \x3cexpression\x3e\n\tto: \x3cexpression\x3e\n\tsubject: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\n\tattachments:\x3ccomponent\x3e \x3cname\x3e as PDF\n]":"sendmail\n[\n\tfrom: \x3cexpression\x3e\n\tto: \x3cexpression\x3e\n\tsubject: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\n]",description:"Sends mail",key:["sendmail"]},{elemName:"send_sms",
displayName:"send sms",displayCode:"sendsms\n[\n\tto: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\n]",description:"Sends sms",key:["sendsms"]},{elemName:"post_to_chat",displayName:"post to chat",displayCode:"zoho.cliq.postToChat(\x3cchatid\x3e, \x3cmessage\x3e);",description:"Post to the given chat id",key:["postToChat"]},{elemName:"send_report",displayName:"send report",displayCode:"sendmail\n[\n\tfrom: \x3cexpression\x3e\n\tto: \x3cexpression\x3e\n\tsubject: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\nattachments:\x3ccomponent\x3e \x3cname\x3e as PDF\n]",
description:"Sends mail",key:["sendreport"]}]},{groupName:"Data access",elements:[{elemName:"add_record",displayName:"add record",displayCode:"\x3cvariable\x3e \x3d insert into \x3cform\x3e\n[\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n];",expressionCode:"insert into \x3cform\x3e\n[\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n];",description:"Creates a new record in mentioned form with the value given",
key:["insert record","add record"]},{elemName:"fetch_records",displayName:"fetch records",displayCode:"\x3cvariable\x3e \x3d \x3cform\x3e [ "+condition2+" ];",expressionCode:" \x3cform\x3e [ "+condition2+" ];",description:"Fetch records from mentioned form based on criteria",key:["fetch records"]},{elemName:"aggregate_records",displayName:"aggregate records",displayCode:"\x3cvariable\x3e \x3d \x3cform\x3e [ "+condition2+" ].\x3caggregate_function\x3e ;",description:"Fetch records from mentioned form based on criteria and applies aggregate function to that field",
key:["aggregate records"]},{elemName:"update_records",displayName:"update records",displayCode:"\x3ccollection_variable\x3e.\x3cfield\x3e \x3d \x3cexpression\x3e ;",description:"Updates the mentioned field with the given value",key:["update records"]},{elemName:"for_each_record",displayName:"for each record",displayCode:"for each \x3cmyvariable\x3e in \x3cform\x3e [ "+condition2+" ]\n{\n} ",description:"Iterate through records of mentioned form based on criteria",key:["for each record"]},{elemName:"delete_records",
displayName:"delete records",displayCode:"delete from \x3cform\x3e [ "+condition2+" ];",description:"Deletes record from mentioned form based on criteria",key:["delete records"]}]},{groupName:"Data Within Zoho",elements:[{elemName:"fetch_record",displayName:"fetch",displayCode:"\x3cvariable\x3e \x3d \x3cform\x3e [ "+condition2+" ];",expressionCode:" \x3cform\x3e [ "+condition2+" ];",description:"Fetch records from mentioned form based on criteria",key:["fetch records"]},{elemName:"insert_into_form",
displayName:"insert into form",displayCode:"insert into \x3cform\x3e\n[\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n];",expressionCode:"insert into \x3cform\x3e\n[\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n\t\x3cfield\x3e \x3d \x3cexpression\x3e\n];",description:"Creates a new record in mentioned form with the value given",key:["insert record","add record"]},{elemName:"update_record",
displayName:"update record",displayCode:"\x3ccollection_variable\x3e.\x3cfield\x3e \x3d \x3cexpression\x3e ;",description:"Updates the mentioned field with the given value",key:["update records"]},{elemName:"for_each_record",displayName:"for each",displayCode:"for each \x3cmyvariable\x3e in \x3cform\x3e [ "+condition2+" ]\n{\n} ",description:"Iterate through records of mentioned form based on criteria",key:["for each record"]},{elemName:"delete_record",displayName:"delete",displayCode:"delete from \x3cform\x3e [ "+
condition2+" ];",description:"Deletes record from mentioned form based on criteria",key:["delete records"]}]},{groupName:"Client functions",elements:[{elemName:"hide | show",displayCode:"hide \x3cfield\x3e ;",description:"Show/Hide field in the form's UI ",key:["hide","show"],definition:{hide:"Hides the specified field in the form's UI. This task doesn't affect the user's access permission.",show:"Shows the specified field in the form's UI. This task doesn't affect the user's access permission."}},
{elemName:"enable | disable",displayCode:"enable \x3cfield\x3e ;",description:"Enable/Disable the form field",key:["enable","disable"]},{elemName:"add | append item",displayCode:"\x3cfield\x3e:ui.add(\x3cexpression\x3e); ",description:"Add/Append options to the given field",key:["add","append"]},{elemName:"select | deselect",displayCode:"\x3cfield\x3e.select(\x3cexpression\x3e);",description:"Select/Deselect option in the mentioned field",key:["select","deselect"]},{elemName:"selectAll | deselectAll",
displayCode:"\x3cfield\x3e.selectAll(\x3cexpression\x3e);",description:"Select/Deselect option in the mentioned field",key:["selectAll","deselectAll"]},{elemName:"clear_items",displayName:"clear items",displayCode:"clear \x3cfield\x3e ;",description:"Clear options from the field",key:["clear"]},{elemName:"alert_box",displayName:"alert box",displayCode:"alert \x3cexpression\x3e ;",description:"Prompt the user with given value",key:["alert"]},{elemName:"reload_form",displayName:"reload form",displayCode:"reload;",
description:"Reloads the page",key:["reload"]}]},{groupName:"Basic",elements:[{elemName:"set_variable",displayName:"set variable",displayCode:"\x3cvariable\x3e \x3d \x3cexpression\x3e ;",description:"Creates a local variable with the given value will be accessibile within that action",key:["set variable"]},{elemName:"call_function",displayName:"call function",displayCode:"thisapp.\x3cfunctionName\x3e();",description:"To invoke a user defined function",key:["call function","function"]},{elemName:"send_mail",
displayName:"send mail",displayCode:"sendmail\n[\n\tfrom: \x3cexpression\x3e\n\tto: \x3cexpression\x3e\n\tsubject: \x3cexpression\x3e\n\tmessage: \x3cexpression\x3e\n]",description:"Sends mail",key:["sendmail"]},{elemName:"share | unshare",displayCode:"share \x3ccomponent\x3e(\x3cname\x3e, \x3cemail\x3e);",description:"Share/UnShare component to the given user",key:["share","unshare"]},{elemName:"cancel_submit",displayName:"cancel submit",displayCode:"cancel submit;",description:"Cancel submission of form",
key:["cancel submit"]},{elemName:"cancel_delete",displayName:"cancel delete",displayCode:"cancel delete;",description:"Cancel deletion of record",key:["cancel delete"]},{elemName:"success_message",displayName:"success message",displayCode:"success message \x3cexpression\x3e;",description:"Shows success message after form submission",key:["success message"]},{elemName:"add_comment",displayName:"add comment",displayCode:"// ",description:"Add comment to make your code more understandable"},{elemName:"return_statement",
displayName:"return",displayCode:"return \x3cexpression\x3e ;",description:"returns the value in function",key:["return"]},{elemName:"info_statement",displayName:"info",displayCode:"info \x3cexpression\x3e ;",description:"Adds debugger statement to your workflow",key:["info"]}]},{groupName:"Condition",elements:[{elemName:"if",displayCode:"if ( "+condition+" ) \n{\n}",description:"\t\tThis statement validates criteria and if satisfies executes the statement in block sequentially",hoverDescription:" This statement validates criteria and if satisfies executes the statement in block sequentially",
example:'if(mark \x3c 39) \n{\n\tinfo "Reappear";\n}',exampleDescription:'Above script will print as "Reappear" if mark is less than 39',key:["if"]},{elemName:"else_if",displayName:"else if",displayCode:"else if ( "+condition+" ) \n{\n}",description:"\t\tThis statement will be executed on failure of 'if' statement and success on its criteria",key:["else","else if"]},{elemName:"else",displayCode:"else \n{\n}",description:"This will be executed on failure of 'if' and 'else if' statement",key:["else"]},
{elemName:"conditional_if",displayName:"conditional if",displayCode:"\x3cvariable\x3e \x3d if ( "+condition+" , \x3csuccess_value\x3e , \x3cfailure_value\x3e ); ",description:"Conditional if will return 'value1' on successful criteria else 'value2'",key:["conditional if"]}]},{groupName:"Debug",elements:[{elemName:"alert",displayCode:"alert \x3cexpression\x3e ;",description:"Prompt the user with given value",key:["alert"]},{elemName:"info",displayCode:"info \x3cexpression\x3e ;",description:"Adds debugger statement to your workflow",
key:["info"]},{elemName:"try_catch",displayName:"try catch",displayCode:"try\n{\n}\ncatch(e)\n{\n}",description:"try catch block helps you to suppress error statements",key:["try"]},{elemName:"break",displayCode:"break;",description:"",key:["break"]},{elemName:"continue",displayCode:"continue;",description:"Will continue for next element in the loop without proceeding",key:["continue"]}]},{groupName:"List manipulation",elements:[{elemName:"create_list",displayName:"create list",displayCode:"\x3cvariable\x3e \x3d List();",
expressionCode:"List();",description:"To create a list",key:["create list"]},{elemName:"add_to_list",displayName:"add",displayCode:"\x3clist\x3e.add(\x3cexpression\x3e);",description:"Add element to list",key:["add element to list"]},{elemName:"remove_index_from_list",displayName:"remove index",displayCode:"\x3clist\x3e.remove( \x3cexpression\x3e );",description:"Remove from list based on index",key:["remove index from list"]},{elemName:"remove_list_element",displayName:"remove element",displayCode:"\x3clist\x3e.removeElement( \x3cexpression\x3e );",
description:"Remove given element from list",key:["remove element from list"]},{elemName:"add all | remove all",displayCode:"\x3clist\x3e.addAll( \x3clist\x3e );",description:"Add/Remove all elements to the list",key:["add all elements to list","addAll","removeAll"]},{elemName:"clear_list",displayName:"clear list",displayCode:"\x3clist\x3e.clear();",description:"Clears item from list",key:["clear list"]},{elemName:"sort_list",displayName:"sort",displayCode:"\x3clist\x3e.sort( \x3cboolean\x3e ) ;",
description:"Sort elements in list based on boolean",key:["sort list"]},{elemName:"for_each_list_element",displayName:"for each element",displayCode:"for each \x3cmyvariable\x3e in \x3clist\x3e\n{\n}",description:"Iterates element from list",key:["for each element"]},{elemName:"for_each_list_index",displayName:"for each index",displayCode:"for each index \x3cmyvariable\x3e in \x3clist\x3e\n{\n}",description:"Iterates list based on index",key:["for each index"]}]},{groupName:"Map manipulation",elements:[{elemName:"create_map",
displayName:"create map",displayCode:"\x3cvariable\x3e \x3d Map();",description:"To create a Map",expressionCode:"Map();",key:["create map"]},{elemName:"put_to_map",displayName:"put",displayCode:"\x3cmap\x3e.put(\x3cexpression\x3e,\x3cexpression\x3e) ;",description:"To add key and values to map",key:["put to map"]},{elemName:"put_all_keys",displayName:"put all keys",displayCode:"\x3cmap\x3e.put( \x3cmap\x3e ) ;",description:"To add all elements from given map",key:["put all elements to map"]},{elemName:"remove_key",
displayName:"remove key",displayCode:"\x3cmap\x3e.remove( \x3cexpression\x3e ) ;",description:"Removes given key from the map",key:["remove key from map"]},{elemName:"clear_map",displayName:"clear map",displayCode:"\x3cmap\x3e.clear() ;",description:"Clears all items from map",key:["clear map"]}]},{groupName:"Collection",elements:[{elemName:"create_collection",displayName:"create collection",displayCode:"\x3cvariable\x3e \x3d Collection();",description:"To create a Collection",expressionCode:"Collection();",
key:["create collection","collection"]},{elemName:"insert_into_collection",displayName:"insert",displayCode:"\x3ccollection\x3e.insert(\x3cexpression\x3e);",description:"To insert to collection",key:["insert values into collection"]},{elemName:"get_from_collection",displayName:"get",displayCode:"\x3ccollection\x3e.get(\x3cexpression\x3e);",description:"To get value for the specified key",key:["get value from collection"]},{elemName:"insert_all_into_collection",displayName:"insertAll",displayCode:"\x3ccollection\x3e.insertAll(\x3cexpression\x3e);",
description:"To insert all values to collection",key:["insert all to collection"]},{elemName:"update_into_collection",displayName:"update",displayCode:"\x3ccollection\x3e.update(\x3ckey/index\x3e,\x3cexpression\x3e);",description:"To update values in collection",key:["update values in collection"]},{elemName:"delete_collection",displayName:"delete",displayCode:"\x3ccollection\x3e.delete(\x3cexpression\x3e);",description:"To delete value in collection",key:["delete value from collection"]},{elemName:"for_each_collection_element",
displayName:"for each element",displayCode:"for each \x3cmyvariable\x3e in \x3ccollection\x3e\n{\n}",description:"Iterates element from collection",key:["for each element"]},{elemName:"collection_keys",displayName:"keys",displayCode:"\x3ccollection\x3e.keys();",description:"Returns a list of all the keys present in the collection",key:["get all keys from collection"]},{elemName:"collection_values",displayName:"values",displayCode:"\x3ccollection\x3e.values();",description:"Returns a list of all the values present in the collection",
key:["get all values from collection"]},{elemName:"contains_key",displayName:"contains key",displayCode:"\x3ccollection\x3e.containsKey(\x3ctext\x3e);",description:"Checks for a specific key in collection",key:["check key in collection"]},{elemName:"contains_value",displayName:"contains value",displayCode:"\x3ccollection\x3e.containsValue(\x3ctext\x3e);",description:"Checks for a specific value in collection",key:["check value in collection"]},{elemName:"clear_collection",displayName:"clear",displayCode:"\x3ccollection\x3e.clear();",
description:"Removes all values in collection",key:["clear collection"]},{elemName:"sort_value",displayName:"sort value",displayCode:"\x3ccollection\x3e.sort();",description:"To sort collection based on value",key:["sort collection based on value"]},{elemName:"is_collection_empty",displayName:"is empty",displayCode:"\x3ccollection\x3e.isEmpty();",description:"Check whether the Collection variable is empty or not",key:["check if collection is empty"]},{elemName:"collection_size",displayName:"size",
displayCode:"\x3ccollection\x3e.size();",description:"Returns the number of values present in the variable",key:["gets collection total value"]}]},{groupName:"Web data",elements:[{elemName:"zoho_integration",displayName:"zoho integration",displayCode:"\x3cvariable\x3e \x3d zoho.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",expressionCode:"zoho.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",description:"Invoke other Zoho service API",key:["zoho integration"]},{elemName:"other_integration",displayName:"other integration",
displayCode:"\x3cvariable\x3e \x3d \x3cprovider\x3e.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",expressionCode:"\x3cprovider\x3e.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",description:"Invoke in built third party support",key:["other integration"]},{elemName:"get_url",displayName:"get url",displayCode:"\x3cvariable\x3e \x3d getUrl( \x3cstring\x3e);",description:"Retrive response from third party service",key:["getUrl"]},{elemName:"post_url",displayName:"post url",displayCode:"\x3cvariable\x3e \x3d postUrl( \x3cstring\x3e, \x3cmap\x3e);",
description:"Retrive response from third party service and params will be sent POST",key:["postUrl"]},{elemName:"invokeurl",displayName:"invoke url",displayCode:"\x3cvariable\x3e \x3d invokeUrl\n[\n\turl: \x3cexpression\x3e\n\ttype: \x3crequest_type\x3e\n\tparameters: \x3cexpression\x3e\n\theaders: \x3cexpression\x3e\n\tconnection: \x3cconnection\x3e\n];",expressionCode:"invokeUrl\n[\n\turl: \x3cexpression\x3e\n\ttype: \x3crequest_type\x3e\n\tparameters: \x3cexpression\x3e\n\theaders: \x3cexpression\x3e\n\tconnection: \x3cconnection\x3e\n]",
description:"Invoke URL",key:["invokeurl"]},{elemName:"open_url",displayName:"open url",displayCode:"openUrl( \x3cstring\x3e, \x3cwindow_type\x3e);",description:"Given URL will be opened in the based on window type mentioned",key:["openUrl"]}]},{groupName:"Integrations",elements:[{elemName:"webhook",displayCode:"\x3cvariable\x3e \x3d invokeurl\n[\n\turl: \x3cexpression\x3e\n\ttype: \x3crequest_type\x3e\n\tparameters: \x3cexpression\x3e\n\theaders: \x3cexpression\x3e\n];",description:"Invoke URL",
key:["invokeurl","webhook"]},{elemName:"zoho_integration",displayName:"zoho integration",displayCode:"\x3cvariable\x3e \x3d zoho.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",description:"Invoke other Zoho service API",key:["zoho integration"]},{elemName:"encryption",displayCode:"\x3cvariable\x3e \x3d zoho.encryption.\x3caction\x3e(\x3cparams\x3e);",description:"Encrypt the user data",key:["encryption","secuity","sha","aes"]},{elemName:"parse_XML_JSON",displayName:"parse XML/JSON",displayCode:"\x3cvariable\x3e \x3d \x3cprovider\x3e.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",
description:"Invoke in built third party support",key:["other integration"]},{elemName:"other_integration",displayName:"other integration",displayCode:"\x3cvariable\x3e \x3d \x3cprovider\x3e.\x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);",description:"Invoke in built third party support",key:["other integration"]},{elemName:"get_url",displayName:"get url",displayCode:"\x3cvariable\x3e \x3d getUrl( \x3cstring\x3e);",description:"Retrive response from third party service",key:["getUrl"]},{elemName:"post_url",
displayName:"post url",displayCode:"\x3cvariable\x3e \x3d postUrl( \x3cstring\x3e, \x3cmap\x3e);",description:"Retrive response from third party service and params will be sent POST",key:["postUrl"]},{elemName:"open_url",displayName:"open url",displayCode:"openUrl( \x3cstring\x3e, \x3cwindow_type\x3e);",description:"Given URL will be opened in the based on window type mentioned",key:["openUrl"]}]},{groupName:"Xml manipulation",elements:[{elemName:"execute_XPath",displayName:"execute XPath",displayCode:"\x3cvariable\x3e \x3d \x3cexpression\x3e.executeXPath(\x3cXpath\x3e);",
description:"Applies path over the given expression and result will be retruned as STRING",key:["executeXPath","xpath"]}]}];panelJson.refreshGroups=function(){for(var a={},b=0;b<panelJson.length;b++)if(panelJson.hasOwnProperty(b)){var c=panelJson[b];if(c.groupName){var d=c.elements,e=[],f;for(f in d)d.hasOwnProperty(f)&&(e=e.concat(d[f].elemName));a[c.groupName]=e}}return panelJson.groups=a};panelJson.refreshGroups();
var RESTRICT_FIELDS={INSERT:["PLAIN_TEXT","SCRIPT","AUTO_NUMBER","MULTI_SELECT"],FETCH:["PLAIN_TEXT"],UPDATE:["PLAIN_TEXT","SCRIPT","AUTO_NUMBER"]},COMPONENTS=["application","section","form","view"],Window_Types=[{elemName:"same window",displayCode:'"same window"'},{elemName:"new window",displayCode:'"new window"'},{elemName:"parent window",displayCode:'"parent window"'},{elemName:"popup window",displayCode:'"popup window", "height\x3d\x3cheight\x3e,width\x3d\x3cwidth\x3e"'},{elemName:"iframe",displayCode:'"iframe","\x3cframeName\x3e"'}];function jumpToNextTag(a,b,c){function d(a){return a?(a=a.match(TAGS_SEARCH_PATTERN))?a.index:-1:-1}var e=a.getCursor(),f=e.line;e=e.ch+1;var k=a.lineCount(),r="";!b&&c&&(e=a.getLine(f).indexOf(c)+1);r=a.getRange({line:f,ch:e},{line:f});c=d(r);if(e>=a.getLine(f).length&&-1!=c)a.setCursor({line:f,ch:0}),jumpToNextTag(a);else{for(;b&&-1===c&&f<=k-1;)f+=1,r=a.getLine(f),c=d(r),e=-1!==c?0:e;-1!==c&&a.setCursor({line:f,ch:c+e+1})}}
function jumpToPreviousTag(a,b){function c(a){for(var b=-1;null!=(match=TAGS_SEARCH_PATTERN_GREEDY.exec(a));)b=match.index;return b}var d=a.getCursor(),e=d.line;d=d.ch-1;a.lineCount();d=a.getRange({line:e,ch:0},{line:e,ch:d});d=c(d);for(a.state.isShiftorMousemove=!1;b&&-1===d&&0<e;)--e,d=a.getLine(e),d=c(d);-1!==d&&a.setCursor({line:e,ch:d+1})}
function checkForTagsSubstitution(a,b,c){var d={line:b.line,ch:b.ch},e=a.getTokenAt({line:b.line,ch:b.ch+1});if(e&&null==e.type)for(;null!=e.type&&e.end<k.length;)e=a.getTokenAt({line:b.line,ch:e.end+1});if("tag"==e.type){k=a.getTokenAt({line:b.line,ch:e.end+1});var f=a.getTokenAt({line:b.line,ch:k.end+1});TAGS_SEARCH_PATTERN.test(e.string+k.string+f.string)&&(d.ch=f.end)}var k=a.getLine(b.line);switch(c){case "subform":if(a=k.match(/<form>[\s*]*\[[\s*]*<field>[\s*]*<opr>[\s*]*<expression>[\s*]*\]/i))b=
k.indexOf(a[0]),d.ch=b+a[0].length;case "namespace":if(a=k.match(/<functionName>[\s*]*\([\s*]*\)[\s*]*;/i))b=k.indexOf(a[0]),d.ch=b+a[0].length}return d}function getVarDec(a){var b=a.getSelection(),c=a.getCursor();return a.getRange({line:0,ch:0},{line:c.line,ch:c.ch-b.length}).match("/"+b+"s\x3d/")}
function getLastFName(a){var b=[],c=a.length;b.push(")");for(c-=2;0<=c;c--)if(")"===a[c]?b.push(")"):"("===a[c]&&b.pop(),0===b.length){var d=c;break}b=a.slice(0,a.slice(0,d).lastIndexOf("."));return a&&b.match(TAGS_SEARCH_PATTERN_GREEDY)?null:a.slice(a.slice(0,d).lastIndexOf(".")+1,d)}function dreReplaceAll(a,b,c){return c&&c.replace(new RegExp(a,"g"),b)}
function arrayContains(a,b,c){if(a&&b){b=b.toLowerCase();for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];c&&(e=d);e=e.toLowerCase();if(e===b)return e}}return null}function isShowHint(a){return""!==a?!0:!1}function isJsonEmpty(a){for(key in a)if(a.hasOwnProperty(key))return!1;return!0}function getVariableDataType(a,b){for(;a;a=a.next)if(a.name===b)return a.dType;return null}
function myDataType(a,b,c,d){var e=a.replace(/\s/g,"");if(e){if(e.match(/"[^"]*"/)==a)return{datatype:"String"};if(a.match(/\d*/)==a)return{datatype:"Bigint"};if(a.match(/(true|false)/))return{datatype:"Boolean"};if("zoho.currentdate"===e||"zoho.currenttime"===e||e.match(/['].*[']/))return{datatype:"TimeStamp"};if(a.match(/{((\w*|"\w*")(,(\w*|"\w*"))*)?}/)||e.match(/^List\(.*\)$/i)||e.match(/^\[.*\]$/))return{datatype:"List"};if(a.match(/{(\w*|"\w*"):(\w*|"\w*"|\d*)((,\s*(\w*|"\w*"):(\w*|"\w*"|\d*))*)}/)||
a.match(/map\(.*\)/i))return{datatype:"Map"};if(e.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\s*\[.*\]$/))return{datatype:"NView",formName:k[1],appLinkName:d.getDelugeAppLinkName()};if(b){var f,k=a.match(/^\w+$/);if(k){if(null!==(b=getVariableDataType(b.globalVars,a)))return{datatype:b};if(d&&null!==(f=d.isFormfield(a,c)))return{datatype:f}}}}return null}function getServiceProviders(){var a=DelugeBuiltInFunction.getPackageFunctions();return a?Object.keys(a):null}
function getServiceNames(a){var b=DelugeBuiltInFunction.getPackageFunctions();return b&&b.hasOwnProperty(a)?Object.keys(b[a]):null}function getActions(a,b){var c=DelugeBuiltInFunction.getPackageFunctions(),d=[];c&&c.hasOwnProperty(a)&&c[a].hasOwnProperty(b)&&d.push(c[a][b]);return d}function getNameSpace(a,b){for(var c="",d=b.getCursor();"."===a.string[0];)c=a.string+c,a=b.getTokenAt({line:d.line,ch:a.start});return c=a.string+c}
function getZohoVariables(){for(var a=DelugeBuiltInFunction.getConstantFunctions(),b=[],c=0;a&&c<a.length;c++)b.push(a[c].name);return a}function getZohoVariableType(a){for(var b=DelugeBuiltInFunction.getConstantFunctions(),c=0;b&&c<b.length;c++){var d=b[c];if(d.name===a)return d.type}return null}function generateElt(a,b){var c=document.createElement(a);b&&(c.className=b);for(var d="",e=2;e<arguments.length;++e)d+=arguments[e];c.innerHTML=d;return c}
function getPanelElementDetails(a,b){var c="Data Within Zoho"==b&&checkCrudOperation(a);if(c)return c;c=0;for(var d=panelJson.length;c<d;c++)for(var e=panelJson[c].elements,f=0,k=e.length;f<k;f++){var r=e[f];if(r.elemName===a&&(!b||panelJson[c].groupName==b))return r}return null}
function getPanelDetails(a,b,c,d,e,f){var k=b;d&&"key"===d.toLowerCase()&&(b=a[b]&&a[b].elemName||b);return(a="object"==typeof b?b:getPanelElementDetails(b,f))?(d=a.displayCode,e&&a.expressionCode&&(d=a.expressionCode),c=c&&"description"===c.toLowerCase()?a.description:d,-1!=b.indexOf(" | ")&&(b=b.split(" | "),0<b.length&&b[0]!=k&&-1==k.indexOf(" | ")&&(c=c.replace(b[0],k))),c):null}
function getWindowType(a){for(var b in Window_Types)if(Window_Types.hasOwnProperty(b)){var c=Window_Types[b];if(c.elemName==a)return c.displayCode}}function removeClassName(a,b){a&&(a.className=a.className.split(" ").filter(function(a){return a!=b}).join(" "))}function getPanelKeywords(a){return Object.keys(a)}function getBoundries(a){var b=0,c=0;a&&(b=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top+window.scrollY);return{leftPos:b,topPos:c,elem:a}}
function getFunctionArgumentBlock(a,b){var c,d,e=[],f=b;")"===a[f]&&f--;for(e.push(")");0!==e.length&&0<=f;)")"===a[f]?e.push(")"):"("===a[f]&&e.pop(),f--;0===e.length&&(c=f+1);e=[];f=b;e.push("(");for(b=a.length;0!==e.length&&f<b;)"("===a[f]?e.push("("):")"===a[f]&&e.pop(),f++;0===e.length&&(d=f-1);return"undefined"===typeof c||"undefined"===typeof d?null:{lpos:c,rpos:d}}
function tabBehavior(a,b){var c=a.getCursor(),d=a.getTokenAt(c);if("string"===d.type){var e=d.end;if(c.ch>=d.start+1&&c.ch<=e-1)return!1}return DelugeEditorUtil.switchArgs(a,b)}function setIndentation(a,b,c){b=c.getTokenAt({line:b.line});c=b.state.indented;isElectricChar(b.string)&&(c+=DelugeEditorConfig.indentUnit);b=Array(c+1).join(" ");return a=a?a.replace(/(\r\n|\n|\r)/gm,"$1"+b):null}
function toggleBlockComment(a){var b=a.listSelections();if(b&&0<b.length){var c=b[0];b=c.from();c=c.to();a.uncomment(b,c)||(a.blockComment(b,c),b=CodeMirror.Pos(b.line,b.ch+3),a.setSelection(b,c))}}function isDelugeDataType(a){var b="string bigint date datetime decimal bool map null list obj nview object timestamp boolean subform".split(" ").concat("text collection number date-time list key-value true/false time nullable".split(" "));return a&&-1!==b.indexOf(a.toLowerCase())?!0:!1}
function getInternalServiceFunctions(){var a=DelugeBuiltInFunction.getPackageFunctions();return a.hasOwnProperty("zoho")?a.zoho:null}
function getCrudOperations(a,b){var c={add:[],update:[],get:[]},d=getInternalServiceFunctions();b=b.getDelugeServiceName();if(d=d&&d.hasOwnProperty(b)&&d[b])for(b=0;d&&b<d.length;b++){var e=d[b],f=e.hasOwnProperty("operation")&&e.operation;!f||a&&a!==f||c.hasOwnProperty(f)&&c[f].push({name:e.functionName,definition:e.definition,description:e.description})}return a&&c.hasOwnProperty(a)?c[a]:c}
function checkCrudOperation(a){var b="",c=getDelugeServiceName(),d={"add record":"add","fetch records":"get","update record":"update"};c&&d.hasOwnProperty(a)&&(b="\x3cvariable\x3e \x3d zoho."+c+".\x3c"+d[a]+"\x3e;");return b}function checkPanelPattern(a,b){if(b){var c=a[b.index-1];a=a[b.index+b[0].length];"undefined"===typeof c&&(c=" ");"undefined"===typeof a&&(a=" ");if(/[ _\.\)]/.test(c)&&/[ _\.\(]/.test(a))return!0}return!1}function isElectricChar(a){return/^[{\(\[]$/.test(a)?!0:!1}
function rightTrim(a){return a.replace(/\s+$/,"")}function bindEditorFullScreen(){delugeEditor.editor.setOption("fullScreen",!delugeEditor.editor.getOption("fullScreen"));delugeEditor.editor.getOption("fullScreen")?delugeEditor.editor.deluge.positionType="fixed":delugeEditor.editor.deluge.positionType="static";delugeEditor.editor.focus()}
function getDelugeDataType(a){switch(a){case "int":a="bigint";break;case "float":a="decimal";break;case "date":a="datetime";break;case "bool":a="boolean";break;case "xml":a="object"}return a}function delugeVarInList(a,b,c){for(;a;a=a.next)if(a.name===b&&a.dType===c)return a;return!1}function adjustTooltipLeftForCreator(a,b,c){0<a.getBoundingClientRect().right-b.right-20?(a.style.left="auto",a.style.maxWidth="250px",a.style.right=c.width+(b.right-c.right)+10+"px"):a.style.maxWidth=""}
function adjustTooltipLeftForDRE(a,b,c){if(0<a.getBoundingClientRect().right-b.right){var d=d+10;c&&(d+=b.right-c.left);a.style.left="auto";a.style.right=d+"px"}}function adjustTooltipLeft(a,b,c){adjustTooltipLeftForCreator(a,b,c)}
function adjustTooltipTopForDRE(a,b,c,d){var e=a.getBoundingClientRect(),f=c.top-b.top-window.scrollY;0<e.bottom-b.bottom?(f=c.bottom-e.height-b.top,d.delugeTooltipLastPos=f,a.style.top=f+"px"):(d.delugeTooltipLastPos=null,a.className+=" deluge-cm-hints-transit-top",a.style.top=f)}
function adjustTooltipTopForCreator(a,b,c,d){var e=a.getBoundingClientRect(),f=c.top,k=c.top-e.height+c.height;0<c.top+e.height-b.bottom?(f=k-b.top,d.delugeTooltipLastPos=k,a.style.top=f+"px"):(d.delugeTooltipLastPos=null,a.className+=" deluge-cm-hints-transit-top",a.style.top=f-b.top+"px")}function adjustTooltipTop(a,b,c,d){adjustTooltipTopForCreator(a,b,c,d)}function getEditorValue(){return delugeEditor.getEditorValue()}
function constructHelpContainer(){for(var a,b,c="",d=0;helpJSON&&d<helpJSON.length;d++){var e=helpJSON[d],f=e.groupName,k=f.replace(" ","_"),r=e.elements,A='style\x3d"display:none;"';0===parseInt(d)&&(A="");c=c+'\x3cdiv class\x3d"help-subheader" id\x3d"header-'+k+"\" onclick\x3dshowSubTopics('header-sub-"+k+"')\x3e"+f+'\x3c/div\x3e\x3cdiv class\x3d"help-subheadercont" '+A+' id\x3d"header-sub-'+k+'"\x3e';for(k=0;r&&k<r.length;k++)A=r[k],0===parseInt(d)&&0===parseInt(k)?(b=A,a=e):0===parseInt(d)&&1===
parseInt(k)&&($("#nextGroup").val(e.groupName),$("#nextTopic").val(A.Topic)),c=c+"\x3cdiv onclick\x3d\"fillHelpContainer('"+f+"', '"+A.Topic+"')\"\x3e"+A.Topic+"\x3c/div\x3e";c+="\x3c/div\x3e"}$("#helpSubContainer").html(c);a=contentToFillHelpContainer(a,b,1);focusEle(b);return a}function proceedToNextTopic(){$("#successPane").animate({marginTop:"34px"});fillHelpContainer($("#nextGroup").val(),$("#nextTopic").val())}
function showSubTopics(a){$("div[id^\x3d'header-sub']").each(function(a,c){$(c).slideUp()});a.replace("sub-","");$("#"+a).slideDown()}
function fillHelpContainer(a,b){for(var c=0,d=0;helpJSON&&d<helpJSON.length;d++){var e=helpJSON[d];if(e.groupName===a){a.replace(" ","_");for(var f=e.elements,k=0;f&&k<f.length;k++){c+=1;var r=f[k];if(r.Topic===b){a=contentToFillHelpContainer(e,r,c);$("#instructionContainer").html(a);bindTotalClick();focusEle(r);r=f[parseInt(parseInt(k)+1)];parseInt(k)===parseInt(f.length-1)&&(e=helpJSON[parseInt(d+1)],r=e.elements[0]);$("#nextGroup").val(e.groupName);$("#nextTopic").val(r.Topic);return}}}else c+=
e.elements.length}}function bindTotalClick(){$("#headerStrip").click(function(a){"none"===$("#helpSubContainer").css("display")?($("#header-main-content").css("opacity","0.3"),$("#helpSubContainer").slideDown()):($("#helpSubContainer").slideUp(),$("#header-main-content").removeAttr("style"))})}function hideHelpHeaderStrip(){$("#helpSubContainer").slideUp();$("#header-main-content").removeAttr("style")}
function focusEle(a){$("#helpOuter").css("height",parseInt($("#editorContainer").css("height").replace("px",""))-150+"px");$("#helpSubContainer").slideUp();var b=a.TaskEle;a=a.Sample_Code;a=a.replace(/;/g,";\n");delugeEditor.setEditorContent(a);jumpToNextTag(editor,!0);isUndef(b)||($("div[class\x3dblock]").each(function(a,d){$(d).attr("id")!==b&&$(d).css("opacity","0.4")}),$("#"+b).removeAttr("style"),$("#"+b).removeAttr("class"),$("#"+b).attr("class","block"),$("#"+b).addClass("helpLeftEleSelect"),
setTimeout(afterSelectionAnimateEffect(b),1200));delugeEditor.focusEditor()}function afterSelectionAnimateEffect(a){$("div[class\x3dblock]").each(function(b,c){$(c).attr("id")!==a&&$(c).css("opacity","")});$("#"+a).animate({"border-radius":"0px"},"slow");$("#"+a).animate({"background-color":"#F4F4F4"},"slow")}
function contentToFillHelpContainer(a,b,c){a='\x3cdiv id\x3d"headerStrip" class\x3d"help-headerStrip"\x3e'+a.groupName+'\x3cdiv id\x3d"help-totalPage" class\x3d"help-totalPage"\x3e\x26nbsp;'+c+"/26\x26nbsp;\x3c/div\x3e\x3c/div\x3e";a=a+'\x3cdiv id\x3d"header-main-content" class\x3d"help-main-content"\x3e\x3cdiv style\x3d"font-weight:bold;font-size:13px;margin:10px;margin-left:15px;"\x3e'+b.Topic+"\x3c/div\x3e";c=b.Syntax;if(!isUndef(c)){c=DelugeUtil.delugify(c);var d=document.createElement("div");
d.appendChild(c);c=d.innerHTML;a=a+'\x3cdiv style\x3d"font-size:14px;margin:10px;margin-left:20px;"\x3eSyntax\x3c/div\x3e\x3cdiv class\x3d"help-sample-code"\x3e'+c+"\x3c/div\x3e"}a=a+'\x3cdiv class\x3d"help-description" id\x3d"help-description"\x3e'+b.Description+"\x3c/div\x3e";return a+"\x3cdiv id\x3d'help-link' class\x3d'help-link' style\x3d\"display:none;\"\x3eRefer \x3ca href\x3d''\x3eHelp Doc\x3c/a\x3e for more examples and detailed explanations\x3c/div\x3e\x3c/div\x3e"}
function fillHelpKeyBindings(){for(var a="",b=0;keysList&&b<keysList.length;b++){var c=keysList[b];a=a+'\x3cdiv\x3e\x3cdiv id\x3d"help_key" class\x3d"help_key"\x3e'+c.key+'\x3c/div\x3e\x3cdiv class\x3d"help_action" id\x3d"help_action"\x3e'+c.action+"\x3c/div\x3e\x3c/div\x3e"}$("#help_key_container").html(a)};var PegUtil=function(a){function b(a){function l(a){var b="";"DO"===a.type&&(b=a.id.form,a.id.service&&(b=a.id.form+"."+a.id.service));return b}if(a.hasOwnProperty("type")){var t=a.type;if("BinaryExpression"===t){t=a.hasOwnProperty("operator")?a.operator:"";var q=b(a.left);a=b(a.right);return d(t,q,a)}if("Literal"===t)return a.datatype;if("FETCHSTATEMENT"===t)return a.formObj.id.service?{datatype:"nview",formName:l(a.formObj),appLinkName:a.formObj.id.form}:{datatype:"nview",formName:l(a.formObj)};
if("FETCHFIELDDATA"===t)return q=l(a.formObj),a=a.hasOwnProperty("id")?a.id:"",p&&p.etFormfieldReturnType(q,a);if("FETCH_ENDLESS_VALUE"===t)return e(a.fetState,a.fieldName);if("AGGREGATERECORD"===t)return t=a.aggrFunc,q=l(a.formObjOptCrit),a=a.arg,a=p&&p.getFormfieldReturnType(q,a),f(t,a);if("BC"===t)return k(a.bst);if("ListExpr"===t)return a.construct.indexOf(":"),"list";if("Collection"===t)return"collection";if("MAP_DECL"===t||"JSON"===t)return"map";if("INSERTTASK"===t)return"bigint";if("FUNCTION"===
t)return r(a.value);if("FUNCTIONNODE"===t)return r(a)}else return c(a)}function c(a){var b;a:{for(b=A;b;b=b.next)if(b.name===a){if(b.hasOwnProperty("formName"))break a;b=b.dType;break a}b=null}if(!b)b=p&&p.getFormfieldReturnType(null,a);else if("object"==typeof b)return{datatype:"nview",formName:b.formName,appLinkName:b.appLinkName};return b}function d(a,b,c){if(!c)return b;if(b&&"string"==typeof b&&"string"==typeof c){if("text"===b.toLowerCase()||"text"===c.toLowerCase()&&"+"===a)return"text";if("string"===
b||"string"===c&&"+"===a)return"string";if("datetime"!==b||"datetime"!==c||"+"!==a&&"-"!==a)if("decimal"!==b&&"bigint"!==b||"decimal"!==c&&"bigint"!==c){if(b="\x3d\x3d !\x3d \x3d \x3e \x3c \x3e\x3d \x3c\x3d".split(" ").concat(["||","\x26\x26"]),a&&-1!==b.indexOf(a))return"bool"}else return"/"!==a?"bigint":"decimal";else return"datetime"}else return"unknown"}function e(a,b){if("zoho"===a.toLowerCase())return{loginuser:"string",adminuser:"string",loginuserid:"string",adminuserid:"string",currentdate:"datetime",
currenttime:"datetime",appname:"string",ipaddress:"string",appuri:"string"}.hasOwnProperty(name.toLowerCase())?list[name]:null;var d=a,e;for(e in b)if(b.hasOwnProperty(e)){a=b[e];var l=p&&p.getFormfieldReturnType(d,a);0!=e||l||(d=(l=c(d))&&l.formName,l=p&&p.getFormfieldReturnType(d,a))}return l}function f(a,b){a=a.toLowerCase();if("count"===a)return"bigint";if("avg"===a)return"decimal";if("sum"===a||"min"===a||"max"===a)return b;if("distinct"===a)return{LIST:b}}function k(a){if(a&&0<a.length)return"list"}
function r(a){var c=null;if(!a)return null;if("RECURSIVEFUNC"===a.type){var d=b(a.applied);a=a.fname;for(var e in a)a.hasOwnProperty(e)&&(c=a[e].funcName.value,d=c=DelugeBuiltInFunction.getBuiltInFunctionRT(d,c))}else if("FUNCTIONNODE"===a.type){c=a.fName;d=a.nSpace&&a.nSpace.value;e="thisapp"===a.appName&&p?p.getDelugeAppLinkName():a.appName;if("if"===c.toLowerCase()){a:{if((c=(a=a.arg)&&a.value)&&3===c.length&&(a=b(c[1]),c=b(c[2]),a===c))break a;a=null}return a}a=c;c=DelugeBuiltInFunction.getFunctionDetailsByName(a);
c||(c=e,c=null!=d?c+"."+d:c,(c=DelugeBuiltInFunction.getFunctionDetailsFromAppliedTypes(null!=a?c+"."+a:c))||(c=p&&p.getUserDefinedFunctions(e,d,a)));c=(a=c)&&a.returnType&&a.returnType.toLowerCase()}return c}var A,p;return{init:function(a,c,d){A=c;p=d;return a&&a.hasOwnProperty("setVarExpr")?b(a.setVarExpr):null}}}();var VARIABLE_PATTERN=/[a-zA-Z0-9_][a-zA-Z0-9_]*/i,LOOKUP_PATTERN=/[a-zA-Z0-9_.][a-zA-Z0-9_.]*/i,FORMNAME_PATTERN=/^[a-zA-Z0-9][a-zA-Z0-9_]*[^_]$/i,INSERT_INTO_PATTERN=new RegExp("^([\\s*]*("+VARIABLE_PATTERN.source+"|\x3cvariable\x3e)[\\s*]*\x3d)?[\\s*]*insert[\\s*]*into[\\s*]*("+LOOKUP_PATTERN.source+"|\x3cform\x3e)*","i"),CRITERIA_PATTERN=new RegExp("[\\s*]*("+LOOKUP_PATTERN.source+"|\x3cform\x3e)?[\\s*]*\\[(.*)\\]","i"),FETCH_REC_PATTERN=new RegExp("("+LOOKUP_PATTERN.source+"|\x3cform\x3e)([\\s*]*\\[[\\s*]*(.*)[\\s*]*\\](?:\\.([a-zA-Z0-9_.]+))?)?",
"i"),FETCH_REC_PATTERN_CMPL=new RegExp("("+LOOKUP_PATTERN.source+"|\x3cform\x3e)[\\s*]*\\[[\\s*]*(.*)[\\s*]*\\](?:\\.([a-zA-Z0-9_.]+))?","i"),FORM_CRITERIA_ORIGINAL_PATTERN=new RegExp("("+LOOKUP_PATTERN.source+"|\x3cform\x3e)\\s*\\[\\s*(\x3cfield\x3e\\s*\x3copr\x3e\\s*\x3cexpression\x3e)\\s*]","i"),FETCH_REC_ORIGINAL_PATTERN=new RegExp("("+VARIABLE_PATTERN.source+"|\x3cvariable\x3e)\\s*\x3d\\s*"+FORM_CRITERIA_ORIGINAL_PATTERN.source,"i"),FETCH_REC_AGGREGATE_PATTERN=new RegExp("("+LOOKUP_PATTERN.source+
"|\x3cform\x3e)[\\s*]*\\[[\\s*]*(.*)\\](?:\\.([a-zA-Z0-9_.]+))?","i"),FETCH_REC_PATTERN_WITH_VAR=new RegExp("("+VARIABLE_PATTERN.source+")\\s*\x3d\\s*"+FETCH_REC_PATTERN_CMPL.source,"i"),DELUGE_PATTERN=function(){var a=/([a-zA-Z][a-zA-Z0-9_.]*|<form>)[\s]*\[[\s]*(.*)[\s]*\]/i,b=new RegExp(a.source+"(?:\\.([a-zA-Z][a-zA-Z0-9_]*(?:\\.(?:(?!getAll)[a-zA-Z][a-zA-Z0-9_]*))?))?","i"),c=new RegExp(b.source+/[\s]*(?:sort[\s]*by[\s]*([\s]*[a-zA-Z][a-zA-Z0-9_]*[\s]*(?:desc)?(?:[\s]*,[\s]*[a-zA-Z][a-zA-Z0-9_]*[\s]*(?:desc)?)*)[\s]*)?/i.source+
/[\s]*(?:range[\s]*from[\s]*(\d+|[a-zA-Z][a-zA-Z0-9_]*)[\s]*to[\s]*(\d+|[a-zA-Z][a-zA-Z0-9_]*)[\s]*)?/i.source,"i"),d=new RegExp("([a-zA-Z][a-zA-Z0-9_]*|\x3cvariable\x3e)[\\s]*\x3d[\\s]*"+c.source,"i");b=new RegExp("([a-zA-Z][a-zA-Z0-9_]*|\x3cvariable\x3e)[\\s]*\x3d[\\s]*"+(new RegExp(b.source+"\\.(getAll)\\(\\)","i")).source,"i");c=new RegExp("([a-zA-Z][a-zA-Z0-9_]*|\x3cvariable\x3e)[\\s]*\x3d[\\s]*"+(new RegExp("\\("+c.source+"\\)\\.(getAll)\\(\\)","i")).source,"i");a=new RegExp("([a-zA-Z][a-zA-Z0-9_]*|\x3cvariable\x3e)[\\s]*\x3d[\\s]*"+
a.source+"\\.(?:(?!getAll)(?:([a-zA-Z][a-zA-Z0-9_]*)\\((.*)\\)|(\x3caggregate_function\x3e))+)");var e=new RegExp("([a-zA-Z][a-zA-Z0-9_]*|\x3cvariable\x3e)[\\s]*\x3d[\\s]*(list|map)(:("+DATATYPE_TAGS.join("|")+"))?\\((\\{.*\\})?\\);?","i");return{FETCH_STATEMENT:d,FETCH_STATEMENT_GETALL:b,FETCH_STATEMENT_GETALL_WSR:c,AGGREGATE_STATEMENT:a,CONDITIONAL_IF:/([a-zA-Z][a-zA-Z0-9_]*|<variable>)[\s]*=[\s]*if[\s]*\((.*),(.*),(.*)\);?/i,INLINE_STATEMENT:/^[\s]*(alert|info|return)[\s]*(.*);$/,LIST_MAP_DECL:e,
EXECUTE_XPATH:/([a-zA-Z][a-zA-Z0-9_]*|<variable>)[\s]*=[\s]*((.*)|<expression>)\.executeXPath\((.*)\);?/i,GET_URL:/([a-zA-Z][a-zA-Z0-9_]*|<variable>)[\s]*=[\s]*getUrl\((.*)\);?/i,POST_URL:/([a-zA-Z][a-zA-Z0-9_]*|<variable>)[\s]*=[\s]*postUrl\((.*)\);?/i,EXPRESSION_PATTERN:/^[\s*]*([a-zA-Z][a-zA-Z0-9_.]*|<field>|<variable>)[\s*]*=[\s*]*(.*)(?:;?)/i}}(),AGGREGATE_PATTERN=new RegExp("("+VARIABLE_PATTERN.source+"|\x3cvariable\x3e)\\s*\x3d\\s*("+LOOKUP_PATTERN.source+"|\x3cform\x3e)[\\s*]*\\[[\\s*]*(.*)\\](?:\\.(?:(?:([a-zA-Z0-9_]+)\\((.*)\\))|(\x3caggregate_function\x3e)))+",
"i"),DELETE_REC_PATTERN=new RegExp("[\\s]*delete\\s*from\\s*"+FETCH_REC_PATTERN_CMPL.source,"i"),DELETE_REC_ORIGINAL_PATTERN=new RegExp("[\\s]*delete\\s*from\\s*"+FORM_CRITERIA_ORIGINAL_PATTERN.source,"i"),EXPRESSION_PATTERN=new RegExp("[\\s*]*("+LOOKUP_PATTERN.source+"|\x3cfield\x3e|\x3cvariable\x3e)[\\s*]*\x3d[\\s*]*(.*)(?:;?)","i"),FOR_EACH_REC_PATTERN=new RegExp("[\\s*]*for[\\s*]*each[\\s*]*("+VARIABLE_PATTERN.source+")[\\s*]*in[\\s*]*((?:input.)?"+FETCH_REC_PATTERN.source+")","i"),FOR_EACH_REC_ORIGINAL_PATTERN=
new RegExp("\\s*for\\s*each\\s*(\x3cmyvariable\x3e)\\s*in\\s*"+FORM_CRITERIA_ORIGINAL_PATTERN.source,"i"),FOR_EACH_PATTERN=new RegExp("[\\s*]*for[\\s*]*each[\\s*]*(index)*[\\s*]*("+VARIABLE_PATTERN.source+")[\\s*]*in[\\s*]*("+LOOKUP_PATTERN.source+")","i"),UPDATE_REC_PATTERN=new RegExp("[\\s*]*(\x3ccollection_variable\x3e|"+VARIABLE_PATTERN.source+")\\.(\x3cfield\x3e|"+LOOKUP_PATTERN.source+")\\s*\x3d\\s*(\x3cexpression\x3e|.*)\\s*;","i");
(function(){function a(a,b){if(!Array.prototype.indexOf){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return a&&-1!==a.indexOf(b)}function b(a,b,e,f){var l=a.getCursor(),m=e(a,l),t=m;if(!/\b(?:string|comment|deprecated)\b/.test(m.type)){m.state=CodeMirror.innerMode(a.getMode(),m.state).state;if(!/^[\w $_]*$/.test(m.string))"."===m.string?m=t={start:l.ch,end:l.ch,string:"",state:m.state,type:"property"}:0===m.string.indexOf(".")?(m={start:m.start+1,end:l.ch+1,string:m.string.slice(1),state:m.state,
type:"property"},t={start:l.ch,end:l.ch+m.string.length-1,string:m.string.slice(1),state:m.state,type:"property"}):m=t={start:l.ch,end:l.ch,string:"",state:m.state,type:"."===m.string?"property":null};else if(/^[\s]*$/.test(m.string)){m=t={start:l.ch,end:l.ch,string:"",state:m.state,type:"."===m.string?"property":null};var q=a.getTokenAt({line:l.line,ch:l.ch+1});m.state.nextToken=q.string}for(;"property"===t.type;){t=e(a,d(l.line,t.start));if(0===t.string.indexOf("."))m.state.hintStart=t.string.slice(1);
else if("."!==t.string)return;t=e(a,d(l.line,t.start));if(")"===t.string){e=a.getRange({line:l.line,ch:0},{line:l.line,ch:t.end});e=getLastFName(e);m.state.hintFName=e;break}if(!k)var k=[];k.push(t)}a.somethingSelected()&&(e=a.getSelection().match(/\s*<([A-Za-z0-9_-]+)?>\s*/),null!==e&&void 0!==e[1]&&(m.state.selection=e[1]));a.state.currentForm&&(m.state.currentForm=a.state.currentForm);return{list:c(m,k,b,f,a),from:d(l.line,m.start),to:d(l.line,m.end)}}}function c(b,c,d,f,l){function m(a){var b=
[],c=l.sharedVars;a.state=l.metadata.addFuncParamsToGlobalVar(a.state);a=a.state.globalVars;var h=a;if(c&&h){for(a=c;null!=a.next;)null!=h&&h.name===a.name&&h.dType===a.dType&&(h=h.next),a=a.next;null!=h&&h.name===a.name&&h.dType===a.dType&&(h=h.next);a.next=h;a=c}else a=h?h:c;for(c=a;c;c=c.next){a=!1;h=0;for(var d=b.length;h<d;h++)if(b[h].name===c.name&&-1===b[h].type.indexOf(c.dType)){"nullable"!==c.dType&&b[h].type.push(c.dType);a=!0;break}a||(a={name:c.name,type:[c.dType]},c.hasOwnProperty("isForEachVar")&&
(a.isForEachVar=c.isForEachVar),"undefined"!==typeof c.formName&&(a.formName=[c.formName]),"undefined"!==typeof c.fieldName&&(a.fieldName=c.fieldName),b.push(a))}return b}function t(a){Qa=Qa.toLowerCase();return a&&"string"==typeof a&&(a=a.toLowerCase(),0===a.lastIndexOf(Qa,0))?!0:!1}function q(b,c,h){var d=[],e=[];Y=m(b);for(var v=0;v<Y.length;v++){var g=Y[v].name,E=1===Y[v].type.length?Y[v].type[0]:"Object";E=E.toLowerCase();if((!h||!a(h,E))&&t(g)&&b.string!=g){var x={text:Y[v].name,dType:E,type:"variable"};
Y[v].hasOwnProperty("isForEachVar")&&(x.isForEachVar=Y[v].isForEachVar);if("undefined"!==typeof c&&null!==c&&E!==c)e.push(x);else if(x.isForEachVar&&!l.sharedVars){a:{var F=l.getCursor().line;for(E=l.getLine(F);!FOR_EACH_PATTERN.test(E)&&void 0!=E&&-1==E.indexOf("}")&&0<F;)F--,E=l.getLine(F);if(E)if((F=E.match(FOR_EACH_REC_PATTERN))&&F[1]==g){g=!0;break a}else if((F=E.match(FOR_EACH_PATTERN))&&F&&"index"==F[1]&&F[2]==g){g=!0;break a}g=!1}g&&d.push(x)}else L.getSubformAutocompleteStatus()&&"subform"==
E&&(x.displayType="row of "+Y[v].fieldName),d.push(x)}}return d=d.concat(e)}function k(a){if(FORMNAME_PATTERN.test(a))return L.getFormfieldsByFormname(a,l.execCompletion)}function r(a,b){var c=L.getAppMeta();var h=L.getDelugeAppLinkName();var d=b.split(".");2==d.length&&d[0]&&d[1]&&(b=d[1],h=d[0]);if(h&&c&&c[h].forms.hasOwnProperty(b)&&(b=c[h].forms[b],b.hasOwnProperty("fields")&&(b=b.fields,b[a])))return b[a].type||"object"}function x(){var a=null,b=l.getCursor().line,c;for(c=l.getLine(b);!INSERT_INTO_PATTERN.test(c)&&
void 0!=c&&-1==c.indexOf("]");)b--,c=l.getLine(b);void 0!=c&&-1!==c.toLowerCase().indexOf("insert into")?(a=c.slice(c.indexOf("insert into")+12,c.length),a=L.getFormNameFromVariable(a),e=!0):e=!1;return a}function g(){if(l.hasOwnProperty("hintPreset")){var a=l.hintPreset;if(a&&(a=a.formLinkName))return a}return null}function y(b,c,h,d){var e=[];var v=k(b);if(!v)a:{v=n();for(var g in v)if(v.hasOwnProperty(g)){var E=v[g];if(E&&E.hasOwnProperty("refFormLinkName")&&E.refFormLinkName==b){v=E.subformFields;
break a}}v=null}c="undefined"!==typeof c&&null!=c?c.toLowerCase():null;h=(b=L.hintFieldRestriction)?h&&h.concat(b)||b:h;if(!isJsonEmpty(v))for(key in v)if(v.hasOwnProperty(key)){E=key;b=v[key];var x=b.type||"object",F=b.componentType;g=b.isSystemField;null!==c&&x.toLowerCase()!==c||d&&d.string==E||h&&a(h,F)&&"STRINGLIST"!=x&&"BIGINTLIST"!=x||!t(E)||(E={text:E,dType:x,desc:!1,type:"formfield"},1==b.isSubform&&(b.hasOwnProperty("subformFields")?E.dType="subform":E.dType="subform -\x3e"+b.refFormLinkName),
g?(E.isSystemField=g,e.push(E)):e.unshift(E))}return e}function G(b,c,h){var d=[],v=l.getCursor(),g=l.getLine(v.line);v=g.substring(0,v.ch);g.match(CRITERIA_PATTERN)&&g.match(/\[([^)]+)\]/)&&(h=h?h.concat(RESTRICT_FIELDS.FETCH):RESTRICT_FIELDS.FETCH);g=c;var E=h,F=[],f;"expression"!=b.state.selection&&(f=x());var m=l.getCursor(),y=l.getLine(m.line);if(null!=f||e)EXPRESSION_PATTERN.test(y)&&(f=null,e=!1);else{e=!1;var I=y.match(CRITERIA_PATTERN);I&&L.getDelugeFormLinkName()&&m.ch>y.indexOf("]")&&(f=
I[1])}f=k(f);g="undefined"!==typeof g&&null!=g?g.toLowerCase():null;E=(m=L.hintFieldRestriction)?E&&E.concat(m)||m:E;if(!isJsonEmpty(f))for(key in f)if(f.hasOwnProperty(key)){I=key;m=f[key];var J=m.type||"object",u=m.componentType;y=m.isSystemField;if(null!==g&&J.toLowerCase()!==g||E&&a(E,u)&&"STRINGLIST"!=J&&"BIGINTLIST"!=J)if(null==g||"list"==g&&-1==J.toLowerCase().indexOf(g))continue;t(I)&&(I={text:I,dType:J,desc:!1,type:"formfield"},1==m.isSubform&&(m.hasOwnProperty("subformFields")?I.dType="subform":
I.dType="subform -\x3e"+m.refFormLinkName),y?(I.isSystemField=y,F.push(I)):F.unshift(I))}g=F;e||(d=q(b,c,h));EXPRESSION_PATTERN.test(v)||(g=A(g));d&&0<d.length&&g&&0<g.length&&d.push({text:"------------------",type:"separator"});return d.concat(g)}function p(a,b){a&&b&&(0<a.length&&0<b.length&&a.push({text:"------------------",type:"separator"}),a=a.concat(b));return a}function A(a,b){var c=[];if(!isJsonEmpty(a))for(key in a)if(a.hasOwnProperty(key)){var h=a[key],d=h.dType,e=h.text,v=!1,g=h.type;
h.hasOwnProperty("isSystemField")&&(v=h.isSystemField);v&&e!=b||c.push({text:e,dType:d,desc:!1,type:g})}return c}function u(a,b){b=n(b);for(var c in b)if(b.hasOwnProperty(c)){var h=b[c];if(h.linkName==a)return h.refFormLinkName}return null}function n(a){a||(a=L.getDelugeFormLinkName());a=k(a);var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var h=a[c];h.hasOwnProperty("isSubform")&&1==h.isSubform&&(h.linkName=c,b.push(h))}return b}function N(a,b,c){b=n(b);var h=[],d="";a&&(d=a.string.toLowerCase().trim());
for(var e in b)if(b.hasOwnProperty(e)&&(a=b[e],a.hasOwnProperty("isSubform")&&1==a.isSubform&&a.hasOwnProperty("linkName")&&0==a.linkName.toLowerCase().indexOf(d))){var v={text:c?a.linkName+"()":a.linkName,type:"subform",dType:"subform",displayText:a.linkName};a.hasOwnProperty("subformFields")?v.dType="subform":v.dType="subform -\x3e"+a.refFormLinkName;h.push(v)}return h}function w(a,b){var c=[];var h=b&&L.getFormsAndFieldsByServices(b)||L.getFormNames();b=b?b:L.getDelugeAppLinkName();var d="";a&&
(d=a.string.toLowerCase().trim());if(null!==h)for(var e=0;h&&e<h.length;e++)0==h[e].toLowerCase().indexOf(d)&&c.push({text:h[e],type:"form",dType:"form",appName:b});h=l.getCursor();h=l.getLine(h.line);/[\s*]*for[\s*]*each[\s*]*(index)*[\s*]*([a-zA-Z_][a-zA-Z0-9_]*)[\s*]*in[\s*]/.test(h)&&(h=N(a),c=p(c,h));if(!b&&L.isDREService()){a=a.string.toLowerCase().trim();b=L.getAppList();h=[];for(var v in b)b.hasOwnProperty(v)&&(d=b[v],0==d.toLowerCase().indexOf(a)&&h.push({text:d,type:"keyword"}));c=p(c,h)}return c}
function C(a){a=a.string.toLowerCase().trim();var b=[],c=l.getPanelReturnFunctions(),h;for(h in c)if(c.hasOwnProperty(h))for(var d=c[h],e=d.key,v=0;v<e.length;v++)-1<e[v].indexOf(a)&&b.push({text:d.displayName,linkName:d.elemName,type:"keyword",isExpression:!0});return b}function B(a){var b=[];if((a=DelugeBuiltInFunction.getFunctionsByAppliedTypes(a))&&0<a.length)for(var c=0;a&&c<a.length;c++)if(null!==a[c]){var h=a[c],d=h.functionName,e=h.returnType,v=h.definition,g=h.description;example=h.example;
showDefinition=null!=h.showDefinition?h.showDefinition:!0;t(d)&&b.push({text:d,dType:e,desc:g,def:v,type:"function",example,showDefinition})}return b}function V(a,b){a=y(a,null,null,b);(b=B(["NVIEW"]))&&0<b.length&&a&&0<a.length&&b.push({text:"------------------",type:"separator"});return b.concat(a)}function ba(b,c,h,d,e){var v=[];if(!e||e&&!a(b,"NView"))v=B(b);b=v;"undefined"!==typeof c&&(c=y(c,null,h),d&&(c=A(c)),v&&0<v.length&&c&&0<c.length&&b.push({text:"------------------",type:"separator"}),
b=b.concat(c));return b}function O(a,b,c,d){return b&&(b=L.getFormFieldDetails(b,c,d))&&b.hasOwnProperty("compositeFields")?h(a,b.compositeFields):null}function h(a,b){var c=[];a=a.string;a=0==a.indexOf(".")?a.slice(1):a;for(var h in b)if(b.hasOwnProperty(h)){var d=h,e=b[h],v=e.isSystemField;0==e.linkName.toLowerCase().indexOf(a)&&c.push({text:d,dType:ja,desc:!1,type:"formfield",isSystemField:v,isCompositeGroupField:!0})}return c}function v(b,c,h,d){if(c){if((d=L.getFormFieldDetails(c,h,d))&&d.hasOwnProperty("compositeFields"))return d.compositeFields;
h=cb(h,b);var e;if(h){var g=h.type;h.hasOwnProperty("formName")&&(e=h.formName[0]);L.getSubformAutocompleteStatus()&&a(h.type,"subform")&&(e=u(h.fieldName,e))}if(g&&(a(g,"NView")||L.getSubformAutocompleteStatus()&&a(g,"subform"))&&null!=e)return v(b,c,e)}return null}function F(b,c){var h=[],d=[];if(b)if("global"===b)d=L.getGlobalKeywords();else if("panel"===b){d={};for(var e in ta)ta.hasOwnProperty(e)&&(d[e]=ta[e])}else if("sentence"===b){e=getPanelKeywords(ta);var v=0;for(b=e.length;v<b;v++)-1!==
e[v].indexOf(" ")&&d.push(e[v])}else"specific"===b&&(d=c);else d=L.getDelugeKeywords();for(v in d)b=e=d[v],"object"===typeof e&&(b=v),t(b)&&!a(L.hintRestrictionMap,b)&&(b={text:b,type:"keyword"},"object"===typeof e&&(b.linkName=e.elemName,e.hasOwnProperty("hoverDescription")&&(b.desc=e.hoverDescription),e.hasOwnProperty("example")&&(b.example=e.example)),h.push(b));return h}function E(b){var c=[],h=L.integrationTasks;if(h.isHideAll())return[];var d=h.getAllowedServices();h=h.getRestrictedTasks();
var e=b&&b.toLowerCase().split(".")||[];h=DelugeBuiltInFunction.getIntegrationFunctions(e,d,h);if("undefined"===typeof b){if(h)var v=Object.keys(h);for(var g in v)v.hasOwnProperty(g)&&t(v[g])&&d&&d.hasOwnProperty(v[g])&&c.push({text:v[g],type:"provider"});return c}if(1===e.length){if(h)var E=Object.keys(h);for(g in E)E.hasOwnProperty(g)&&t(E[g])&&d&&d.hasOwnProperty(e[0])&&a(d[e[0]],E[g])&&c.push({text:E[g],type:"service"})}else if(2===e.length&&e[1]&&h)for(var x in h)h.hasOwnProperty(x)&&h[x].hasOwnProperty("functionName")&&
(b=x,E=h[x],d=E.definition,v=E.description,g=E.returnType,E=E.example,t(b)&&c.push({text:b,dType:g,desc:v,def:d,type:"function",example:E}));return c}function I(a,b){if(null!==b)for(var c=0;b&&c<b.length;c++)a.push({text:b[c],type:"connection",dType:"connection",type:"connection"})}function J(){var a=[];if(DRE.serviceFlags.isCreator()){var b=L.getConnectionNames();I(a,b)}else b=DRE.ConnectionsList.get(),I(a,b),a.push({text:"Manage...",type:"button",bindEvent:(a)=>DRE.ConnectionInteg.bindEvent(a),
className:"hint-manage-button"});b=l.getCursor();l.getLine(b.line);return a}function ua(){var a=[],b=L.systemFields.restrict(DelugeBuiltInFunction.getConstantFunctions()),c;for(c in b)if(b.hasOwnProperty(c)&&b[c].name){var h=b[c].name;t(h)&&a.push({text:h,dType:b[c].dType,type:"sysfield"})}return a}function za(a,b){var c=[];if("default"===b){b=L.getUserDefinedFunctions(a,"default",null,l.execCompletion);a=L.getUserDefinedNameSpaces(a,l.execCompletion);for(var h in a)a.hasOwnProperty(h)&&t(a[h])&&
c.push({text:a[h],type:"namespace",dType:"namespace"})}else b=b.slice(b.indexOf(".")+1),b=L.getUserDefinedFunctions(a,b,null,l.execCompletion);for(h in b)b.hasOwnProperty(h)&&(a=b[h],t(a.functionName)&&c.push({text:a.functionName,dType:a.returnType,desc:a.description,def:a.definition,type:"user-function"}));return c}function Ra(a){var b=[];a=getCrudOperations(a,L);for(var c=0,h=a.length;c<h;c++){var d=a[c].name,e=a[c].definition,v=a[c].description;d=d.slice(d.lastIndexOf(".")+1);t(d)&&b.push({text:d,
desc:v,def:e,type:"function"})}return b}function xb(a){a=a.concat();for(var b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b].text===a[c].text&&"separator"!=a[b].type&&a.splice(c--,1);return a}function yb(a,b){if(a&&b&&0<a.length&&0<b.length)for(var c=0;c<b.length;c++){for(var h=!1,d=b[c],e=0;e<a.length;e++){var v=a[e];v.text==d.text&&"panel-group"==v.type&&(h=!0)}h||(0==c&&a&&0<a.length&&a&&0<a.length&&a.push({text:"------------------",type:"separator"}),a.push(d))}}function db(){var b=l.getCursor();
var c=l.getTokenAt(b);var h=b.line;b=b.ch;for(l.getLine(h);("variable"==c.type||"syntax"==c.type&&a(["input","row"],c.string.toLowerCase()))&&0<b;)c=l.getTokenAt({line:h,ch:b}),b=c.start;"variable"!=c.type&&(b=c.end);return{token:c,index:b}}function cb(a,b){Y=m(b);return Y.filter(function(b){return b.name===a})[0]}function zb(a,b){a=l.getCursor();var c=l.getTokenAt(a);for(var h=a.line,d=a.ch,e=l.getLine(h);" "!==c.string[0]&&0<d;)d--,c=l.getTokenAt({line:h,ch:d});a=(a=e.slice(d,a.ch))&&a.trim();a=
a.split(".");return L.getFormNameFromVariable(a[a.length-3],b.state.globalVars)}function eb(a){var b=[],c=-1!==a.indexOf(".")?a.split(".")[0]:"",h=L.getAppList();h&&("thisapp"===a||-1!==h.indexOf(a)?(b="thisapp"===a?L.getDelugeAppLinkName():a,b=za(b,"default")):!c||"thisapp"!==c&&-1===h.indexOf(c)||(b="thisapp"===c?L.getDelugeAppLinkName():c,b=za(b,a)));return b}function Sa(a,b,c){var h=[];if(null!==b&&("object"!=b||"object"==b&&""!=c)&&(b=DelugeBuiltInFunction.getFunctionsByAppliedTypes([b]))&&0<
b.length)for(c=0;b&&c<b.length;c++)if(null!==b[c]){var d=b[c],e=d.functionName,v=d.returnType,g=d.definition,E=d.description;example=d.example;t(e)&&h.push({text:e,dType:v,desc:E,def:g,type:"function",example})}return a=p(a,h)}function Ia(b,c,d){var e=l.getCursor(),g=l.getTokenAt(e),E=l.getLine(e.line),x;var F=l.getCursor(),f=l.getLine(F.line);f.substring(0,P.ch);var m=db();F=f.slice(m.index,F.ch).split(".");f=5;c&&(x=c);"input"==F[0]&&(f+=1);if(F.length<=f)for(f=0;f<F.length-1;f++){if(0!=f||"input"!=
F[f])if(0==f&&"row"==F[f])x=L.getDelugeSubForm(L.getCurrentDelugeFieldId());else{var q=F[f],I;if(!L.isFormfield(q,x)){var J=cb(q,m.token);if(J){var z=J.type;var n=J.hasOwnProperty("isForEachVar")?!0:!1;J.hasOwnProperty("formName")&&(I=J.formName[0]);L.getSubformAutocompleteStatus()&&a(J.type,"subform")&&(q=J.fieldName)}z&&(null!=I&&(a(z,"NView")&&(x=I),L.getSubformAutocompleteStatus()&&a(z,"subform")&&(x=I)),z=null)}I=x;J=q;Q=k(x);x=isJsonEmpty(Q)||null==Q[J]||!Q[J].isLookup||Q[J].isSubform?void 0:
Q[J].refFormLinkName;x||(q=n?u(I):u(q,I))&&(x=q)}}else x=null;m=u(b,c);f=db();n=v(f.token,b,x||c);z=E.substring(0,e.ch);F=e.ch;I=!0;f=f.index;null==f&&(f=0);if(FOR_EACH_REC_PATTERN.test(E)||CRITERIA_PATTERN.test(E)){for(;0<F&&" "!=z[F]&&"["!=z[F];)F--;z.substring(F+1);(e=E.substring(f,e.ch))&&1<e.split(".").length-1&&(I=!1)}else z=E.substring(0,e.ch),e=E.substring(f,e.ch),EXPRESSION_PATTERN.test(E)&&(EXPRESSION_PATTERN.test(z)||n||e&&1<e.split(".").length-1&&(I=!1));if((x||m)&&!n){if((g=x)?!g&&Z.constructor==
Array&&Z[0]&&(g=Z[0]):g=m,I&&g){d=y(g,null,d);if(0==d.length&&m)if(c=L.getFormFieldDetails(b,c),b=[],c.isSubform){c=c.subformFields;if(!isJsonEmpty(c))for(key in c)c.hasOwnProperty(key)&&(e=key,d=c[key],m=d.type||"object",g=d.isSystemField,t(e)&&(e={text:e,dType:m,desc:!1,type:"formfield"},1==d.isSubform&&(d.hasOwnProperty("subformFields")?e.dType="subform":e.dType="subform -\x3e"+d.refFormLinkName),g?(e.isSystemField=g,b.push(e)):b.unshift(e)));d=b}else d=null;b=d;EXPRESSION_PATTERN.test(E)||CRITERIA_PATTERN.test(E)||
(b=A(d));return b}}else if(I&&n)return h(g,n);return null}function Ab(b,c){b=b.trim().split(".").filter(function(a){return""!=a});if(a(L.getAppList(),b[0]))return null;if(b&&1==b.length)return w(c,b[0]);if(2==b.length)return c=L.getFormsAndFieldsByServices(b[0],b[1],c),L.processFormFieldsJson(c)}function fb(c,h){var d=l.getCursor(),e=l.getLine(d.line);c=c.toLowerCase();c="\x3c"+c+"\x3e";h=!h&&D;switch(c){case TAGS.VARIABLE:h=G(b);break;case TAGS.STRING:h=G(b,"string");break;case TAGS.DECIMAL:h=G(b,
"decimal");break;case TAGS.BOOLEAN:h=G(b,"boolean");break;case TAGS.BIGINT:h=G(b,"bigint");break;case TAGS.TIMESTAMP:h=G(b,"timestamp");break;case TAGS.LIST:h=G(b,"list");break;case TAGS.MAP:h=G(b,"map");break;case TAGS.FIELD:var v=[];d=null;var x=e.match(CRITERIA_PATTERN),f=[];h=!1;var m=g();if(m)h=!0,d=m,f=RESTRICT_FIELDS.FETCH;else if(x){d=x[1];if(x=e.match(/\s*([a-zA-Z_][a-zA-Z0-9_]*)\s*\[.*\].([a-zA-Z_][a-zA-Z0-9_]*)/i))var y=DelugeUtil.getAllowedFieldTypesForAggregateFunction(x[2]).types;e.match(/\[([^)]+)\]/)&&
(h=!0,f=RESTRICT_FIELDS.FETCH)}else{m=l.getCursor();x=l.getTokenAt(m);e=m.line;for(m=m.ch;"."!==x.string[0]&&0<m;)m--,x=prevToken=l.getTokenAt({line:e,ch:m});"."===x.string[0]&&(m=x.string.substring(1),d=l.getTokenAt({line:e,ch:x.start}),d=L.getFormNameFromVariable(d.string,d.state.globalVars))&&(y=DelugeUtil.getAllowedFieldTypesForAggregateFunction(m).types);if(null==d){for(x=l.getLine(e);!INSERT_INTO_PATTERN.test(x)&&void 0!=x&&-1==x.indexOf("]");)e--,x=l.getLine(e);void 0!=x&&-1!==x.toLowerCase().indexOf("insert into")&&
(d=x.slice(x.indexOf("insert into")+12,x.length),f=RESTRICT_FIELDS.INSERT,d=L.getFormNameFromVariable(d))}}d=k(d);if(!isJsonEmpty(d))for(key in d)if(d.hasOwnProperty(key)){m=key;e=d[key];var I=e.type||"object",z=e.isLookup,u=e.componentType;x=e.isSystemField;y&&(!a(y,I)||a(y,I)&&z)||f&&a(f,u)&&"STRINGLIST"!=I||!t(m)||(m={text:m,dType:I,desc:!1,type:"formfield"},1==e.isSubform&&(e.hasOwnProperty("subformFields")?m.dType="subform":m.dType="subform -\x3e"+e.refFormLinkName),x?(m.isSystemField=x,v.push(m)):
v.unshift(m))}h||(v=A(v));h=v;break;case TAGS.OPR:y=[];h=l.getCursor();v=l.getTokenAt({line:h.line,ch:h.ch-1});f=v.string;h=l.getLine(h.line).match(CRITERIA_PATTERN);v=myDataType(f,v.state,h&&h[1]?h[1]:null);null!==v?(v=v.datatype.toLowerCase(),operators="string"===v?[REL_OPERATORS.EQUALS,REL_OPERATORS.NOT_EQUALS,REL_OPERATORS.IS]:"decimal"===v||"bigint"===v?[REL_OPERATORS.EQUALS,REL_OPERATORS.NOT_EQUALS,REL_OPERATORS.LESSER,REL_OPERATORS.GREATER,REL_OPERATORS.LESSER_EQUAL,REL_OPERATORS.GREATER_EQUAL]:
"list"===v?[REL_OPERATORS.IN,REL_OPERATORS.NOT_IN]:[REL_OPERATORS.EQUALS,REL_OPERATORS.NOT_EQUALS,REL_OPERATORS.LESSER,REL_OPERATORS.GREATER,REL_OPERATORS.LESSER_EQUAL,REL_OPERATORS.GREATER_EQUAL]):operators=[REL_OPERATORS.EQUALS,REL_OPERATORS.NOT_EQUALS,REL_OPERATORS.LESSER,REL_OPERATORS.GREATER,REL_OPERATORS.LESSER_EQUAL,REL_OPERATORS.GREATER_EQUAL];v=DelugeBuiltInFunction.getBuiltInFunctions(v,"boolean");for(f=0;operators&&f<operators.length;f++)y.push({text:operators[f].text,type:"operator",desc:operators[f].desc});
if(v&&0<v.length)for(f=0;v&&f<v.length;f++)null!==v[f]&&(x=v[f],h=x.functionName,d=x.returnType,e=x.definition,x=x.description,t(h)&&y.push({text:h,dType:d,desc:x,def:e,type:"stick-function"}));h=y;break;case TAGS.OBJECT:h=G(b,null,["list","map"]);break;case TAGS.EXPRESSION:h=G(b);break;case TAGS.REQUEST_TYPE:y=[];for(fa of REQUEST_TYPE)y.push({text:fa});h=y;break;case TAGS.VALUE:h=G(b);break;case TAGS.VALUE1:h=G(b);break;case TAGS.VALUE2:h=G(b);break;case TAGS.FORM:h=w(b);break;case TAGS.AGGREGATE_FUNCTION:h=
B(["NVIEW"]);break;case TAGS.COLLECTION_VARIABLE:h=q(b,"nview");break;case TAGS.BASIC_OPR:y=[];for(v=0;BASIC_OPERATORS&&v<BASIC_OPERATORS.length;v++)y.push({text:BASIC_OPERATORS[v],type:"operator"});h=y;break;case TAGS.SERVICE:y=l.getCursor();y=l.getTokenAt({line:y.line,ch:y.ch-1});h=E(getNameSpace(y,l));break;case TAGS.ACTION:y=l.getCursor();y=l.getTokenAt({line:y.line,ch:y.ch-1});h=E(getNameSpace(y,l));break;case TAGS.PROVIDER:h=E();break;case TAGS.ADD:h=Ra("add");break;case TAGS.UPDATE:h=Ra("update");
break;case TAGS.GET:h=Ra("get");break;case TAGS.COMPONENTS:y=b.string.toLowerCase().trim();v=[];for(f in COMPONENTS)COMPONENTS.hasOwnProperty(f)&&0==COMPONENTS[f].toLowerCase().indexOf(y)&&v.push({text:COMPONENTS[f],type:"keyword",actualType:"COMPONENT"});h=v;break;case TAGS.WINDOW_TYPE:y=b.string.toLowerCase().trim();f=[];for(v in Window_Types)Window_Types.hasOwnProperty(v)&&(h=Window_Types[v],0==h.elemName.toLowerCase().indexOf(y)&&f.push({text:h.elemName,type:"window_types"}));h=f;break;case TAGS.CONNECTION:h=
J(b)}a([TAGS.STRING,TAGS.DECIMAL,TAGS.BOOLEAN,TAGS.BIGINT,TAGS.TIMESTAMP,TAGS.LIST,TAGS.MAP,TAGS.OBJECT],c)&&(c=F("global"),h=p(h,c));return h}function gb(a,b,c){var h=[];a=c?c:DelugeBuiltInFunction.getFunctionDetailsFromAppliedTypes(a);if(null!=a&&a.hasOwnProperty("args")&&(b=a.args[b],null!=b&&b.hasOwnProperty("module")&&(b=b.module,null!=b&&0<b.length)))for(aa=0;aa<b.length;aa++)h.push({text:b[aa],dType:"module",type:"module",substitutionType:"string"});return h}var Y=[],L=l.metadata,ta=l.getPanelMap(),
D=[],Qa=b.string,va=l.options.deluge,ca;b.state.selection&&(ca=b.state.selection.toLowerCase());var P=l.getCursor(),hb=!1;if(!ca&&b.string&&a(PANEL_GROUPS_KEYS,b.string)){var ib=b.string,jb=l.getSelection();if(ta.hasOwnProperty(ib)){for(var Ja=DelugeLeftPane.checkForPanelGroup(ib),X=0;Ja&&X<Ja.length;X++)hb=!0,D.push({text:Ja[X],type:"panel-group",linkName:Ja[X]});if(l.somethingSelected()&&jb&&ta.hasOwnProperty(jb))return D}}if(0==systemFields.length){var Ta=ua();for(X in Ta)Ta.hasOwnProperty(X)&&
systemFields.push(Ta[X].text)}if(c&&c.length&&!ca){var Aa=c.pop(),U=Aa.string;U&&"."===U[0]&&(U=U.slice(1));if(/^[\s*]?([a-zA-Z_][a-zA-Z0-9_]*)$/.test(U)){var T=l.getLine(P.line),Ua=T.substring(0,P.ch);if("row"!==U||a(L.hintRestrictionMap,U))if("old"!==U&&"input"!==U||a(L.hintRestrictionMap,U)){var ja;Y=m(Aa);var Ka=x(),Bb=Aa.string,da=Y.filter(function(a){return a.name===Bb})[0],R,na=g();EXPRESSION_PATTERN.test(Ua)&&(na=null);if(da){var Z=da.type;var Cb=da.hasOwnProperty("isForEachVar")?!0:!1;da.hasOwnProperty("formName")&&
(R=da.formName[0])}else if(null!==(ja=L.isFormfield(U))){l.getCursor();for(var wa=l.getTokenAt({line:P.line,ch:P.ch-1}),Db=P.line,Va=P.ch,kb;null!=wa.type&&(!a(["brackets"],wa.type)||""!==wa.string)&&0<Va;)Va=wa.start,kb=wa,wa=l.getTokenAt({line:Db,ch:Va});"thisapp"==kb.string?Z="":(L.getSubformAutocompleteStatus()&&u(U)&&(D=p(D,B(["subform"]))),Z=[ja])}else!Ka&&!na||EXPRESSION_PATTERN.test(Ua)?Z="":ja=L.isFormfield(U,Ka||na);L.getSubformAutocompleteStatus()&&a(L.getFormNames(),U)&&(D=p(D,N(b,U,!0)));
if(""!==Z){var Wa=!1,lb=R;Ka&&!EXPRESSION_PATTERN.test(Ua)&&(lb=Ka);var Eb=O(b,U,lb);D=p(D,Eb);if(a(Z,"NView")&&/^[\s*]*([a-zA-Z_][a-zA-Z0-9_]*).$/.test(T)){var oa=RESTRICT_FIELDS.UPDATE;Wa=!0}if(da&&da.fieldName&&L.getSubformAutocompleteStatus()&&a(Z,"subform")){var Fb=u(da.fieldName,R);D=p(D,y(Fb))}else if((collectionVarHints=ba(Z,R,oa,Wa,Cb))&&0<collectionVarHints.length)D=p(D,collectionVarHints);else{var pa=Ia(R,na,oa);D=p(D,pa)}}else{var ha=getNameSpace(Aa,l),Gb=-1!==ha.indexOf(".")?ha.split(".")[0]:
"";functionsFound=eb(ha);D=p(D,functionsFound);var mb=Ab(ha,b);mb&&(D=p(D,mb));L.getSubformAutocompleteStatus()&&u(U)&&(D=p(D,B(["subform"])));var La=E(ha);if("zoho"===ha.toLowerCase()){var Hb=ua();D=p(D,Hb);D=p(D,La)}else if("zoho"===Gb.toLowerCase()){var Xa;if(0===La.length){var fa=getZohoVariableType(ha);null!==fa&&(Xa=B([fa]))}else Xa=La;D=p(D,Xa)}else D=p(D,La);var Ba=P.line,Ib=T=l.getLine(Ba),nb=!1;if(!FOR_EACH_REC_PATTERN.test(T)){pa=[];if(CRITERIA_PATTERN.test(T)){var W=T.match(CRITERIA_PATTERN);
if(W){var ka=R;ka||(ka=W[2].substring(0,P.ch-T.indexOf(W[2])),ka.indexOf(".")==ka.length-1&&(ka=ka.substring(0,ka.length-1)));pa=Ia(ka.trim(),W[1])}}else{var Ca=null,ea=null;if(!R)if(nb=!0,-1<ha.indexOf(".")){var Da=ha.split("."),Ea=0;if(1<Da.length)for(Ca=L.getFormNameFromVariable(Da[Ea],b.state.globalVars),ea=Da[++Ea];Ea+1<Da.length&&null!=Ca&&null!=ea;){var ob=L.getFormFieldDetails(ea,Ca);if(ob)Ca=ob.refFormLinkName,ea=Da[Ea+1];else break;Ea++}}else ea=x();ea=ea?ea.trim():ea;pa=Ia(ea,Ca)}D=p(D,
pa)}for(;!FOR_EACH_PATTERN.test(T)&&void 0!=T&&-1==T.indexOf("}")&&0<Ba;)Ba--,T=l.getLine(Ba);if(T&&!nb)if(W=T.match(FOR_EACH_REC_PATTERN))if(R=W[3],/\[.*\]/.test(T)||(R=L.getFormNameFromVariable(R,b.state.globalVars)),R&&U==W[1]){Wa=!1;/^[\s*]*([a-zA-Z_][a-zA-Z0-9_]*).$/.test(Ib)&&(oa=RESTRICT_FIELDS.UPDATE);var Q=y(R,null,oa,b);D=p(D,Q)}else{var pb=l.getTokenAt(CodeMirror.Pos(Ba,T.indexOf(W[2])+1));Y=m(pb);(da=Y.filter(function(a){return a.name===pb.string})[0])&&(Z=da.type)&&"list"==Z[0]&&(D=Sa(D,
"object",b.string));pa=Ia(U,R);D=p(D,pa)}else(W=T.match(FOR_EACH_PATTERN))&&"index"==W[1]&&(D=Sa(D,"bigint",b.string));var qb=zb(U,b);if(qb){ja=r(U,qb);var rb=[];rb.push(ja);var Jb=B(rb);D=p(D,Jb)}}}else{if(Q=y(L.getDelugeFormLinkName()),l.getLine(P.line)&&0==l.getLine(P.line).indexOf(U)&&(Q=A(Q)),D=p(D,Q),"input"===U){var Kb=q(b);D=p(D,Kb)}}else{var sb=L.getDelugeSubForm(L.getCurrentDelugeFieldId());sb&&(subformFields=y(sb),l.getLine(P.line)&&0==l.getLine(P.line).indexOf(U)&&(subformFields=A(subformFields)),
D=p(D,subformFields))}}else{var la=l.getCursor();T=l.getLine(la.line);var tb=Aa.string;if("]"!==tb){if(fa=myDataType(tb,null,null,L),null!==fa){ja=fa.datatype;R=fa.hasOwnProperty("formName")?fa.formName:null;var xa=DelugeBuiltInFunction.getFunctionsByAppliedTypes([ja]);if(xa&&0<xa.length)for(var Ma=0;xa&&Ma<xa.length;Ma++)if(null!==xa[Ma]){var Fa=xa[Ma],qa=Fa.functionName,Lb=Fa.returnType,Mb=Fa.definition,Nb=Fa.description;example=Fa.example;t(qa)&&D.push({text:qa,dType:Lb,desc:Nb,def:Mb,type:"function",
example})}}}else{if(W=T.match(CRITERIA_PATTERN))R=W[1],Q=V(R,b);EXPRESSION_PATTERN.test(T)||(Q=A(Q));D=p(D,Q)}}}else if(b.state.hintFName){var Ob=b.string,Pb=DelugeBuiltInFunction.getFunctionReturnType(b.state.hintFName);D=Sa(D,Pb,Ob)}else if(void 0!==ca)if(a(TAGS_VALUES,ca))D=p(D,fb(ca,[]));else if("name"==ca){var S=l.getLine(P.line);(W=S.match(/^[\s*]*share[\s*]*([a-zA-Z0-9_][a-zA-Z0-9_]*|<component>)[\s*]*\(.*\)/i))&&("application"==W[1]?D=L.getAppList():"form"==W[1]&&(D=w(b)))}else if("functionname"==
ca){P=l.getCursor();var ya=P.line,Na=P.ch;S=l.getLine(P.line);S=S.slice(0,P.ch-1);D=eb(S)}else if("module"==ca){P=l.getCursor();ya=P.line;Na=P.ch;S=l.getLine(P.line);if((S=S.slice(0,P.ch))&&-1<S.indexOf("(")){qa=null;T=S.substring(0,S.indexOf("("));X=T.length;for(var ub=0;0<X&&"\x3d"!=T[X]&&!/\s/.test(T[X])&&3>ub;)X--,"."==T[X]&&ub++;(/\s/.test(T[X])||"\x3d"==T[X])&&X++;qa=T.substring(X);var vb=0,Ya=S.split(",");Ya&&0<Ya.length&&(vb=Ya.length-1)}D=gb(qa,vb)}else"myvariable"!=ca&&(D=G(b));else{P=l.getCursor();
ya=P.line;Na=P.ch;S=l.getLine(P.line);var Oa=S.substring(0,P.ch);la=getFunctionArgumentBlock(S,P.ch);if(null===la||/\s*if\s*\(.*\)/g.test(S)){b=l.getTokenAt(P);x();if("constant"===b.type)D=[];else if(S=l.getLine(P.line),W=S.match(FETCH_REC_PATTERN_CMPL)){R=W[1];var Za=L.checkForServices(R);if(a(L.getFormNames(),R)||Za){Q=[];oa=[];if(S.match(/\[([^)]+)\]/))if("relop"==b.type)R=null,D=G(b);else if("logicalOpr"==b.type)R=null;else if("variable"==b.type||null==b.type){var $a=l.getTokenAt(CodeMirror.Pos(P.line,
b.start-1));l.getTokenAt(CodeMirror.Pos(P.line,b.end+1));"relop"==$a.type&&(R=null,D=G(b))}oa=RESTRICT_FIELDS.FETCH;P.ch>S.indexOf("]")&&(R=null);Q=(Q=Za?R&&L.processFormFieldsJson(Za,b):y(R,null,oa,b))?Q:[];D=p(D,Q);if(null==R){var ia=F("global");D=p(D,ia)}}else{var Ga=w(b);var Qb=q(b);D=p(D,Qb);D=p(D,Ga)}}else if(!e)if(!va||va.hasOwnProperty("zohoVar")&&!0!==va.zohoVar||(D=D.concat(ua())),/^[\s*]([a-zA-Z0-9_][a-zA-Z0-9_]*[\\\s*]*=)?[\s*]*insert\sinto\s/i.test(S))D=w(b);else{if(/^[\s*]?[a-zA-Z]*$/.test(S))if(d=
F("panel"),R=x(),na=g(),R){Q=y(R,null,RESTRICT_FIELDS.INSERT,b);var Rb=A(Q,"Added_User");D=p(D,Rb)}else na?(Q=y(na,null,RESTRICT_FIELDS.FETCH,b),D=p(D,Q)):(formfieldsAndVariables=G(b),D=p(D,formfieldsAndVariables),hb?yb(D,d):D=p(D,d),ia=F("global"),D=p(D,ia));else if(EXPRESSION_PATTERN.test(Oa)){Q=G(b);D=p(D,Q);-1!==S.indexOf("\x3d")&&P.ch>S.indexOf("\x3d")&&(Ga=w(b),D=p(D,Ga));if(/^[\s*]*[a-zA-Z0-9_]*[\s*]*/.test(Oa)){var Sb=C(b);D=p(D,Sb)}ia=F("global");D=p(D,ia);D=xb(D);0==D.length&&D.push({text:'"'+
b.string+'"',type:"constant"})}else if(/^[\s*]*for\seach\s([a-zA-Z_][a-zA-Z0-9_]*)\sin\s/i.test(S))P.ch>S.indexOf("in")&&(D=q(b,"nview"),Ga=w(b),D=p(D,Ga));else{if(/connection\s*:\s*/.test(Oa)){var Tb=J(b);D=p(D,Tb)}if(b&&"."!=b.string){Q=G(b);D=p(D,Q);ia=F("global");D=p(D,ia);var Ub=F("panel");D=p(D,Ub)}}!va||va.hasOwnProperty("globalKeywords")&&!0!==va.globalKeywords||(D=D.concat(F("global")))}else if(e&&(/^[\s*]*([a-zA-Z0-9_][a-zA-Z0-9_]*[\s*]*=)?[\s*]*insert\sinto\s/i.test(S)&&(D=w(b)),R=x()))if(EXPRESSION_PATTERN.test(Oa)){Q=
G(b);D=p(D,Q);if(-1!==S.indexOf("\x3d")&&P.ch>=S.indexOf("\x3d")){var Vb=w(b);D=p(D,Vb)}ia=F("global");D=p(D,ia)}else{Q=y(R,null,RESTRICT_FIELDS.INSERT);var Wb=A(Q,"Added_User");D=p(D,Wb)}if(null===b.type||"variable"===b.type||"relop"===b.type)if($a=l.getTokenAt(CodeMirror.Pos(P.line,b.start-1)),"for each"===$a.string){var Xb=F("specific",["index"]);D=p(D,Xb)}}else{qa=l.getTokenAt(CodeMirror.Pos(ya,la.lpos-1)).string;var Yb="."!==qa[0]?!0:!1;b=l.getTokenAt({line:ya,ch:la.lpos});var ma=DelugeBuiltInFunction.getFunctionDefinitionByToken(b,
Yb,l),ab="";ma&&(ab=ma.tooltipDefinition);for(var ra=(W=ab?ab.match(/\((.*)\)/):null)?W[1]?W[1].split(","):null:null,bb=[],aa=0;ra&&aa<ra.length;aa++){var Ha=ra[aa];Ha=Ha.match(/\s*\??\s*([^\s]+)/);bb.push(Ha[1])}ra=l.getRange({line:ya,ch:la.lpos},{line:ya,ch:la.rpos+1}).slice(1,-1).split(COMMA_SEPARATOR_PATTERN);var Pa=la.lpos,sa;for(aa=0;ra&&aa<ra.length;aa++){Ha=ra[aa];var wb=Ha.length,Zb=Pa+wb+1;Na>=Pa+1&&Na<=Zb&&(sa=parseInt(aa));Pa=Pa+wb+1}ma?-1<sa&&ma.hasOwnProperty("args")&&ma.args[sa]&&ma.args[sa].hasOwnProperty("module")&&
(D=gb(ma.functionName,sa,ma)):bb[sa]&&(D=fb(bb[sa]));b.type&&"syntax"==b.type.toLowerCase()&&(D=G(b))}}return"undefined"!==typeof D&&null!==D?D:[]}var d=CodeMirror.Pos,e=!1;CodeMirror.registerHelper("hint","deluge",function(a,c){return b(a,f,function(a,b){return a.getTokenAt(b)},c)});var f="hide show add delete update"})();(function(){function a(a,c,d){if(!a.getOption("readOnly")){d=b(this,d);if(void 0===c){if(d&&d.async)return;c=CodeMirror.hint.auto}a.state.completionActive&&a.state.completionActive.close();var e=a.state.completionActive=new A(a,c,d||{});CodeMirror.signal(a,"startCompletion",a);if(e.options.async)c(a,function(a){e.showHints(a)},e.options);else return e.showHints(c(a,e.options))}}function b(a,b){a={};var c={},d;for(d in H)c[d]=H[d];if(a)for(d in a)void 0!==a[d]&&(c[d]=a[d]);if(b)for(d in b)void 0!==
b[d]&&(c[d]=b[d]);return c}function c(a,b){var c=document.createElement(a);b&&(c.className=b);for(var d=2;d<arguments.length;++d){var e=arguments[d];"string"===typeof e&&(e=document.createTextNode(e));e&&c.appendChild(e)}return c}function d(a,b,d,e){d=c("div","CodeMirror-Tern-tooltip",d);d.style.left=a+"px";d.style.top=b+"px";""!==d.innerHTML&&e.elem.appendChild(d);return d}function e(a,b){a&&-1==a.className.split(" ").indexOf(b)&&(a.className+=" "+b)}function f(a,b){var c=document.createElement("span");
c.className="dataType";c.appendChild(document.createTextNode(a));b.appendChild(c)}function k(a,b){if(a){a=a.replace(/\\n/gi,"\n");a=a.replace("/// Returns: ","\n// Returns \n");var c=/[\s]\/\/\/[\s]value[\s]of[\s](.*?):[\s]*/i;if(c.test(a)){var d=a.match(c);a=a.replace(c,"\n// Value of "+d[1]+"\n")}c=DelugeUtil.renderScript(a);a=document.createElement("div");a.setAttribute("class","deluge-fn-example-div");d=document.createElement("div");d.setAttribute("class","deluge-fn-example-title");d.textContent=
"Example:";a.appendChild(d);d=document.createElement("div");d.setAttribute("class","deluge-fn-example");d.appendChild(c);a.appendChild(d);c=b.textContent;c=c.replace(/&lt;/g,"\x3c");c=c.replace(/&gt;/g,"\x3e");d=document.createElement("div");d.setAttribute("class","deluge-fn-desc");d.textContent=c;b.textContent="";b.appendChild(d);b.appendChild(a);e(z,"deluge-tooltip-example")}}function r(a){var b=a&&a.parentNode;b&&b.removeChild(a)}function A(a,b,c){this.cm=a;this.getHints=b;this.options=c;this.widget=
this.onClose=null}function p(a){return"string"===typeof a?a:a.text}function l(a,b,c){function d(a,c){var d="string"!==typeof c?function(a){return c(a,b)}:e.hasOwnProperty(c)?e[c]:c;g[a]=d}var e={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:function(){jumpToNextTag(c)},"Shift-Tab":function(){jumpToPreviousTag(c)},
Esc:b.close},g=a.customKeys?{}:e;if(a.customKeys)for(var f in a.customKeys)a.customKeys.hasOwnProperty(f)&&d(f,a.customKeys[f]);if(a.extraKeys)for(f in a.extraKeys)a.extraKeys.hasOwnProperty(f)&&d(f,a.extraKeys[f]);return g}function m(a,b){for(;b&&b!==a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode===a)return b;b=b.parentNode}}function t(a,b){this.completion=a;this.data=b;var c=this,g=a.cm,x=a.options,t=this.hints=document.createElement("ul");t.className="CodeMirror-hints";this.selectedHint=
x.getDefaultSelection?x.getDefaultSelection(g,x,b):0;for(var q=b.list,n=0;n<q.length;++n){var r=t.appendChild(document.createElement("li")),w=q[n],C="CodeMirror-hint"+(n!==this.selectedHint?"":" CodeMirror-hint-active");w.className&&(C=w.className+" "+C);r.className=C;if(w.render)w.render(r,b,w);else{var B=document.createElement("abbr"),A={formfield:{letter:"FF",className:"notation-formfield"},variable:{letter:"V",className:"notation-variable"},"function":{letter:"FN",className:"notation-function"},
"stick-function":{letter:"FN",className:"notation-function"},keyword:{letter:"KW",className:"notation-keyword"},"panel-group":{letter:"KW",className:"notation-panel-group"},form:{letter:"FM",className:"notation-form"},operator:{letter:"OP",className:"notation-operator"},service:{letter:"SR",className:"notation-service"},provider:{letter:"SP",className:"notation-provider"},sysfield:{letter:"SF",className:"notation-sysfield"},"user-function":{letter:"UD",className:"notation-user-function"},namespace:{letter:"NS",
className:"notation-namespace"}},H="string"===typeof w?null:w.type?w.type:null;null!==H&&A.hasOwnProperty(H)?(C=document.createElement("span"),C.className="hint-notation "+A[H].className,C.appendChild(document.createTextNode(A[H].letter)),B.appendChild(C)):"separator"===H&&(B.className="hint-divider");33<w.text.length&&("variable"===w.type||"formfield"===w.type)&&(w.desc=w.text);C=g.getCursor();C=g.getTokenAt(C);A="";var O=A.length,h=p(w);if(C=C.string.match(/\.?([a-zA-Z0-9_ ]*)/)){A=C[1];O=A.length;
C=document.createElement("span");C.className="partial-hint";var v=h.slice(0,O);A.toLowerCase()===v.toLowerCase()?(C.appendChild(document.createTextNode(h.slice(0,O))),B.appendChild(C)):O=0}B.appendChild(document.createTextNode(w.displayText||h.slice(O)));C="string"===typeof w?null:w.dType;"undefined"!==typeof C&&null!==C&&(C=C.toUpperCase(),C="NVIEW"===C?"COLLECTION":C,C=C.toLowerCase(),w.displayType&&(C=w.displayType),"object"!=C.toLowerCase()&&"nullable"!=C.toLowerCase()&&f(C,B));r.appendChild(B);
"button"==w.type&&w.bindEvent(r);"hint-divider"==B.className&&(r.className+=" hint-divider-parent");"function"==H&&(r.className+=" function")}r.hintId=n}C=g.cursorCoords(!1!==x.alignWithWord?b.from:null);var F=C.left,E=C.bottom,I=!0;w=g.getContainerDetails();r=g.deluge&&g.deluge.positionType;E-=window.scrollY;r&&"fixed"!==r&&(F-=w.left,E-=w.top);n=F;t.style.left=F+"px";t.style.top=E+"px";n=w.elem;H=w.left+w.width||window.innerWidth||Math.max(n.offsetWidth,document.documentElement.offsetWidth);B=window.innerHeight||
Math.max(n.offsetHeight,document.documentElement.offsetHeight);t.style.visibility="hidden";"fixed"==r&&(t.style.position="fixed");(x.container||n).appendChild(t);n=t.querySelector("span.partial-hint");O=0;n&&(A=n.innerHTML);n&&A&&0!=A.substring(0,A.length-1).trim().length&&(g.state.lastPartialHint&&g.state.lastPartialHint!=A||!g.state.lastPartialHint)&&(n.innerHTML=A.substring(0,A.length-1),O=n.offsetWidth,n.innerHTML=A,t.style.left=F+O+"px");O=0;n&&(O=n.offsetWidth);n=F+O;t.style.fontFamily="lato,arial";
g.state.lastPartialHint&&g.state.lastPartialHint==A&&(t.style.left=n+"px");t.style.visibility="visible";O=t.getBoundingClientRect();h=!1;var J=O.right-H;v=O.bottom-B;0<J&&(O.right-O.left>H&&(t.style.width=H-5+"px",J-=O.right-O.left-H),F=C.left-J-10,h=!0,F-=10,r&&"fixed"!==r&&(F-=w.left),t.style.left=F+"px");0<v&&(H=O.bottom-O.top,0<O.top-(C.bottom-C.top)-H?(v=H+(C.bottom-C.top),I=!1):H>B&&(t.style.height=B-5+"px",v-=H-B),E=C.bottom-v-window.scrollY,r&&"fixed"!==r&&(E-=w.top),t.style.top=E+"px");!h&&
g.state.isAnimateTime&&(g.state.isAnimateTime=!1,g.state.lastPartialHint=A,e(t,"deluge-cm-hints-transit-left"),t.style.left=n);A=this.data.list[0].desc;r="variable"===this.data.list[0].type||"formfield"===this.data.list[0].type;w=g.getCursor();C=g.getTokenAt(w);g.cursorCoords({line:w.line,ch:C.start});C=t.getBoundingClientRect();DelugeEditorConfig.showDescription&&A&&(z=d(C.width+n+5,E,A,g.getContainerDetails()),k(this.data.list[0].example,z),r&&f(this.data.list[0].dType,z),e(z,"CodeMirror-Tern-hint-doc"),
A=g.getContainerDetails(),C=t.getBoundingClientRect(),adjustTooltipLeft(z,A,C));g.addKeyMap(this.keyMap=l(x,{moveFocus:function(a,b){c.hints.childNodes[c.selectedHint+a]&&"hint-divider"==c.hints.childNodes[c.selectedHint+a].childNodes[0].className&&(a=0<a?++a:--a);c.changeActive(c.selectedHint+a,b)},setFocus:function(a){c.changeActive(a)},menuSize:function(){return c.screenAmount()},length:q.length,close:function(){a.close()},pick:function(){c.pick()}},g));if(!1!==x.closeOnUnfocus){var ua;g.on("blur",
this.onBlur=function(){ua=setTimeout(function(){a.close()},100)});g.on("focus",this.onFocus=function(){clearTimeout(ua)})}var za=g.getScrollInfo();g.on("scroll",this.onScroll=function(){var b=g.getScrollInfo(),c=g.getWrapperElement().getBoundingClientRect(),h=E+za.top-b.top,d=h-(window.pageYOffset||(document.documentElement||document.body).scrollTop);I||(d+=t.offsetHeight);if(d<=c.top||d>=c.bottom)return a.close();t.style.top=h+"px";t.style.left=F+za.left-b.left+"px"});CodeMirror.on(t,"click",function(a){if((a=
m(t,a.target||a.srcElement))&&"hint-divider"==a.childNodes[0].className)return!1;a&&null!==a.hintId&&(c.changeActive(a.hintId),c.pick())});CodeMirror.on(t,"mouseover",function(a){(a=m(t,a.target||a.srcElement))&&null!==a.hintId&&(c.changeActive(a.hintId),x.completeOnSingleClick&&c.pick())});CodeMirror.on(t,"mousedown",function(){setTimeout(function(){g.focus()},20)});CodeMirror.signal(b,"select",q[0],t.firstChild);return!0}var q=function(b,c,d){c=b.getDoc().getCursor();c=CodeMirror.innerMode(b.getMode(),
b.getTokenAt(c).state).mode.name;"xml"==c?a(b,CodeMirror.hint.xml,d):"deluge"==c&&a(b,CodeMirror.hint.deluge,d)};CodeMirror.showHint=q;var z;A.prototype={close:function(){if(this.active()){this.cm.state.completionActive=null;this.widget&&this.widget.close();if(this.onClose)this.onClose();CodeMirror.signal(this.cm,"endCompletion",this.cm)}},active:function(){return this.cm.state.completionActive===this},pick:function(a,b){var c=this.cm.getCursor();b=a.list[b];if("button"!=b.type)if(b.hint)b.hint(this.cm,
a,b);else{var d="string"===typeof b?null:b.def?b.def:null;var e=0;d=p(b)+(null===d?"":d);var g="string"===typeof b?null:b.type?b.type:null;if("form"===g){var f=p(b),t=f,m=this.cm;m.metadata.isDREService()&&(f=b.appName+"."+f);var x=t,l=m.getCursor();t=l.line;var q=m.getLine(t),k=!1;if(m.somethingSelected())m.replaceSelection(x);else{var z=m.getTokenAt({line:l.line,ch:l.ch});var r=z.start+1;("variable"==z.type&&0==x.toLowerCase().indexOf(z.string.toLowerCase())||"syntax"==z.type)&&--r;k&&(x+="\n");
l=checkForTagsSubstitution(m,l);m.replaceRange(x,{line:t,ch:r},l)}if(INSERT_INTO_PATTERN.test(q)){k=m.metadata.getMandatoryFields(x);r="";x=q.search(/\S/);for(l=0;l<x;l++)r+="\t";x=r+"[\n";for(l in k)k.hasOwnProperty(l)&&(x+=r+"\t"+k[l]+" \x3d "+TAGS.EXPRESSION+"\n");x=m.metadata.isDREService()?x:x+r+"\tAdded_User \x3d zoho.loginuser\n";x+=r+"\t\x3cfield\x3e \x3d \x3cexpression\x3e\n"+r+"];";k=t;if((r=m.getLine(k+1))&&-1<r.indexOf("[")){for(;q&&-1==q.indexOf("]");)k++,q=m.getLine(k),q=q.replace(/"(.*)"/,
"");r=q.indexOf("]")+1;r=-1</][\s]*;/.test(q)?r+1:r;m.replaceRange(x,{line:t+1,ch:0},{line:k,ch:r})}else m.replaceRange(x+"\n",{line:t+1,ch:0});k=!0}else/[\s*]?(share|unshare)[\s*]([a-zA-Z_][a-zA-Z0-9_]*)/.test(q);jumpToNextTag(m,k);m.metadata.getFormfieldsByFormname(f,m.execCompletion)}else"stick-function"===g&&(f={line:c.line,ch:c.ch-1},"\x3e"!==this.cm.getTokenAt(f).string&&(m=this.cm.getRange(c,{line:c.line}).match(/<opr> <expression>/),t=c,m&&(t={line:c.line,ch:c.ch+m[0].length+1}),this.cm.replaceRange(".",
f),a.from=c,a.to=t,this.cm.setCursor(c)));"function"===g&&this.cm.getRange(CodeMirror.Pos(c.line,c.ch),CodeMirror.Pos(c.line,c.ch+TAGS.ACTION.length+TAGS.PARAMS.length+2))===TAGS.ACTION+"("+TAGS.PARAMS+")"&&this.cm.replaceRange("",{line:c.line,ch:c.ch+TAGS.ACTION.length},{line:c.line,ch:c.ch+TAGS.ACTION.length+TAGS.PARAMS.length+2});if("keyword"===g||"panel-group"===g)if(m=b.linkName){m=-1<m.indexOf(" | ")?b.text:m;(t=getPanelDetails(this.cm.getPanelMap(),m,"displayCode","key",b.isExpression))&&1<
t.split("\n").length&&(e=t.split("\n").length-1);f=this.cm.getLine(c.line);if(0==f.slice(c.ch).length||b.isExpression)d=t||m;(f=getPanelElementDetails(b.linkName))&&f.definition&&(f={functionName:m,description:f.definition[m],returnType:f.returnType||"void"},DelugeEditorUtil.showCustomFunctionDefinition(this.cm,f))}"window_types"==g&&(m=p(b),d=getWindowType(m));if("form"!==g){if(this.cm.somethingSelected()){if("user-function"==g||"namespace"==g){var h=this.cm.getSelection();f=this.cm.getLine(c.line);
/<functionname>/i.test(h)&&/^\(\);/.test(f.slice(c.ch+h.length))&&this.cm.setSelection({line:c.line,ch:c.ch},{line:c.line,ch:c.ch+h.length+3})}if(b.hasOwnProperty("actualType")&&"COMPONENT"==b.actualType)if("application"==b.text){f=this.cm.getLine(c.line);h=f.length;for(m=a.to.ch;")"!=f[m]&&m<h;)m++;")"==f[m]&&(f=f.substring(a.to.ch,m+1));if(m=f.match(/[\s]?\([\s]?<name>[\s]?,[\s]?<email>[\s]?\)/))d+="(\x3cemail\x3e)",h=CodeMirror.Pos(c.line,a.to.ch),f=CodeMirror.Pos(c.line,a.to.ch+f.indexOf(m[0])+
m[0].length),this.cm.replaceRange(d,h,f)}else this.cm.replaceSelection(d),this.cm.setCursor({line:c.line,ch:c.ch+d.length});else if("subform"===g){if(f=this.cm.getLine(c.line),m=f.match(/<form>[\s*]*\[[\s*]*<field>[\s*]*<opr>[\s*]*<expression>[\s*]*\]/))f=f.indexOf(m[0]),h=CodeMirror.Pos(c.line,f),f=CodeMirror.Pos(c.line,f+m[0].length),this.cm.replaceRange(d,h,f)}else{if("module"==g||"connection"==g)d='"'+d+'"';"constant"==g&&(d+="");this.cm.replaceSelection(d);this.cm.setCursor({line:c.line,ch:c.ch+
d.length})}}else this.cm.getLine(a.from.line),"module"==g&&(d='"'+d+'"'),d=setIndentation(d,a.from,this.cm),this.cm.getTokenAt(a.to),f=a.to,a.from.ch!=a.to.ch?(f=CodeMirror.Pos(a.to.line,f.ch),c.ch!=a.to.ch&&(f=CodeMirror.Pos(a.to.line,c.ch)),this.cm.replaceRange(d,a.from,f)):(h=checkForTagsSubstitution(this.cm,a.from,g),this.cm.replaceRange(d,a.from,h));a=a.from;h={};if("function"===g||"user-function"===g){g=d.indexOf("(");m=d.indexOf(")");var v=d.slice(0,g);f=this.cm.getTokenAt({line:a.line,ch:a.ch+
g});f=DelugeBuiltInFunction.getFunctionDefinitionByToken(f,!1,this.cm);t=this.cm.charCoords({line:a.line,ch:a.ch+g});h.start=a.ch+g;h.end=a.ch+m;h.line=a.line;DelugeEditorUtil.tooltip.remove();f.argToolTip&&2<f.argToolTip.length&&DelugeEditorUtil.tooltip.create(t,f.argToolTip,0,{lpos:a.ch+g,rpos:a.ch+m,lno:c.line},this.cm.getContainerDetails(),this.cm)}f=this.cm.getLine(c.line);c=f.substring(null!=a.ch?a.ch:c.ch,f.length).match(TAGS_SEARCH_PATTERN);m=f.replace(/"(.*)"/,"").match(TAGS_SEARCH_PATTERN);
c?this.cm.setCursor({line:a.line,ch:f.indexOf(c)+1}):m?this.cm.setCursor({line:a.line,ch:m.index+1}):jumpToNextTag(this.cm,e,d)}DRE.serviceFlags.isEnabled("show-function-definition")&&(null!=b.showDefinition?b.showDefinition:1)&&this.cm.deluge&&!this.cm.deluge.plainMode&&DelugeEditorUtil.showFunctionDefinitionByFunctionName(this.cm,v,h)}this.close()},showHints:function(a){if(!a||!a.list.length||!this.active())return this.close();this.showWidget(a)},showWidget:function(a){function b(){x||(x=!0,m.close(),
m.cm.off("cursorActivity",e),a&&CodeMirror.signal(a,"close"))}function c(){x||(CodeMirror.signal(a,"update"),m.options.async?m.getHints(m.cm,d,m.options):d(m.getHints(m.cm,m.options)))}function d(c){a=c;if(!x){if(!a||!a.list.length)return b();m.widget=new t(m,a)}}function e(){f&&(p(f),f=0);var a=m.cm.getCursor(),b=m.cm.getLine(a.line),h=/[<]/;a.line!==q.line||b.length-a.ch!==k-q.ch||a.ch<q.ch||a.ch&&l.test(b.charAt(a.ch-1))&&!h.test(b.charAt(a.ch))?m.close():(f=z(c),m.widget&&m.widget.close())}this.widget=
new t(this,a);CodeMirror.signal(a,"shown");var f=0,m=this,x,l=this.options.closeCharacters||/[\s()\\\/\[\]{};:>,]/,q=this.cm.getCursor(),k=this.cm.getLine(q.line).length,z=window.requestAnimationFrame||function(a){return setTimeout(a,1E3/60)},p=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",e);this.onClose=b}};t.prototype={close:function(){r(z);if(this.completion.widget===this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);
var a=this.completion.cm;!1!==this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus));a.off("scroll",this.onScroll)}},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(a,b){a>=this.data.list.length?a=b?this.data.list.length-1:0:0>a&&(a=b?0:this.data.list.length-1);if(this.selectedHint!==a&&!(-1<this.hints.childNodes[a].className.indexOf("hint-divider-parent"))){var c=this.hints.childNodes[this.selectedHint];c.className=
c.className.replace(" CodeMirror-hint-active","");b=this.hints.offsetTop+c.offsetTop;c=this.hints.childNodes[this.selectedHint=a];e(c,"CodeMirror-hint-active");c.offsetTop<this.hints.scrollTop?this.hints.scrollTop=c.offsetTop-3:c.offsetTop+c.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=c.offsetTop+c.offsetHeight-this.hints.clientHeight+3);CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],c);r(z);var g=this.data.list[a].desc,m="variable"===this.data.list[a].type||
"formfield"===this.data.list[a].type,t=this.hints.getBoundingClientRect();DelugeEditorConfig.showDescription&&null!==g&&g&&(b=(c=this.completion.cm.delugeTooltipLastPos)?c:b,c=this.completion.cm.getContainerDetails(),z=d(t.width+this.hints.offsetLeft+5,b,g,c),k(this.data.list[a].example,z),m&&f(this.data.list[a].dType,z),e(z,"CodeMirror-Tern-hint-doc"),a=this.hints.getBoundingClientRect(),adjustTooltipLeft(z,c,a),a=this.hints.querySelector(".CodeMirror-hint-active").getBoundingClientRect(),adjustTooltipTop(z,
c,a,this.completion.cm))}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};CodeMirror.registerHelper("hint","auto",function(a,b){var c=a.getHelpers(a.getCursor(),"hint");if(c.length)for(var d=0;d<c.length;d++){var e=c[d](a,b);if(e&&e.list.length)return e}else if(b=a.getHelper(a.getCursor(),"hintWords"))return CodeMirror.hint.fromList(a,{words:b})});CodeMirror.commands.autocomplete=q;CodeMirror.commands.clearAutoComplete=function(a){(a=a.state.completionActive)&&
a.close()};var H={hint:CodeMirror.hint.auto,completeSingle:!1,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};CodeMirror.defineOption("hintOptions",null)})();var DelugeSettings=function(a,b,c){function d(a){a.querySelector("input[name\x3d'deluge-expr-builder-switch-cb']").addEventListener("change",function(a){a=e("delugeBuilder");k.setBuilderMode(!a)})}function e(a){a=getCookie(a);return""==a?null:!a||"true"!=a&&1!=a?!1:!0}var f="",k=this;this.builder={};this.init=function(){c.hasOwnProperty("sharedBy")&&(f=c.sharedBy||variable.scopeName,f+="_editormode");if(c.hasOwnProperty("advancedFeatures")&&c.advancedFeatures){var r=c.hasOwnProperty("syntaxAssist")&&
c.syntaxAssist.hasOwnProperty("value")&&"boolean"===typeof c.syntaxAssist.value?c.syntaxAssist.value:e("delugeBuilder");null==r&&(r=getCookie(f),r=null!=r&&""!=r?"scriptBuilder"==r?!0:!1:null,r=null==r?!0:r);var A=DelugeUtil.getDivElement("\x3cdiv class\x3d'de-toggle-btn deluge-actions-menu-icon'\x3e\x3cdiv class\x3d'deluge-actions-menu-text'\x3e"+b["deluge.editor.builder.syntaxassist"]+"\x3c/div\x3e\x3cdiv class\x3d'de-dem-switch-container'\x3e\x3cinput name\x3d'deluge-expr-builder-switch-cb' "+
(1==r?" checked\x3d'true' ":"")+" type\x3d'checkbox' elname\x3d'statusBtn' id\x3d'on'\x3e\x3clabel for\x3d'on' class\x3d'de-dem-switch'\x3e\x3cspan class\x3d'de-dem-switch-inner zc-dem-clearfix'\x3e\x3cspan class\x3d'de-dem-switch-enable'\x3eOn\x3c/span\x3e\x3cspan class\x3d'de-dem-switch-button'\x3e\x26nbsp;\x3c/span\x3e\x3cspan class\x3d'de-dem-switch-disable'\x3eOff\x3c/span\x3e\x3c/span\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e","deluge-actions-menu dre-actions-menu");A.setAttribute("hmid",a.hmid);
A.setAttribute("name",a.label);a.hasOwnProperty("type")&&A.setAttribute("type",a.type);c.hasOwnProperty("loadingfrom")&&"serviceHandler"==c.loadingfrom||d(A);k.setBuilderMode(r);r=A}else r=void 0;return r};this.isBuilderEnabled=function(){return this.builder.enabled};this.setBuilderMode=function(a){this.builder.enabled=a;DelugeUtil.setCookie("delugeBuilder",a,null,document.domain)}};var DRETopBar=function(){function a(){switch(DelugeUtil.getDomain()){case "skydesk":return"https://www.skydesk.jp/apps/deluge/help";case "eu":return"https://www.zoho.com/deluge/help/";case "cn":return"https://www.zoho.com.cn/creator/help/script/";case "zoho":return"https://delugelang.com/help/"}}function b(b,c,d){g=[];DRE.serviceFlags.isEnabled("syntax-assist")&&g.push({type:"syntaxassist",label:y["deluge.editor.builder.syntaxassist"]});DRE.serviceFlags.isEnabled("versions")&&g.push({type:"versions",
label:y["deluge.editor.builder.version"],image:"\x3ci class\x3d'zc-li-outline files-single-copies'\x3e\x3c/i\x3e"});b.isConnectionEnabled(d)&&g.push({type:"connections",label:"connections",bindEvent:(a)=>{DRE.ConnectionInteg.bindEvent(a)}});DRE.serviceFlags.isEnabled("help-menu")&&g.push({type:"menu",label:y["deluge.editor.menu.help"],image:"\x3ci class\x3d'de de-help' \x3e\x3c/i\x3e",submenu:[{type:"link",label:y["deluge.editor.menu.help.guide"],url:a(),allowRemove:!1},{type:"click",label:y["deluge.editor.menu.help.support"],
clickAction:function(){N.show()}}]})}function c(a,b){var c=g,l;for(l in a)if(a.hasOwnProperty(l)){var q=a[l],p=k(q.label,M);switch(q.action){case "changeLabel":if(-1<p){var h=q,v=c[p],F=b,E=p;if(h&&h.hasOwnProperty("newLabel")){v.label=h.newLabel;var I=M,J=h.newLabel,y=I.indexOf(h.label);-1<y&&(I[y]=J);u.hasOwnProperty(h.newLabel)||(u[h.newLabel]=u[h.label],delete u[h.label]);F&&(K.querySelector("div[hmid\x3d'"+E+"'] ."+x.MENU_TITLE).textContent=v.label)}}break;case "changeUrl":-1<p&&f(q,c[p],b);
break;case "changeAction":h=q;v=c[p];b&&h&&h.hasOwnProperty("attachEvent")&&(v&&v.hasOwnProperty("attachEvent")&&(F=K.querySelector("div[hmid\x3d'"+v.hmid+"']"),F.replaceWith(F.cloneNode(!0)),v.attachEvent=h.attachEvent),z(K.querySelector("div[hmid\x3d'"+v.hmid+"']"),h.attachEvent.action,h.attachEvent.event));break;case "add":h=q;v=c;F=b;if(E=h)E=h.label.trim(),E=!(-1<M.indexOf(E));if(E){E=null;h.hasOwnProperty("before")?(E=k(h.before,M),delete h.before):h.hasOwnProperty("after")&&(E=k(h.after,M),
E=-1==E?E:E+1,delete h.after);if(null==E||-1==E)E=v.length;delete h.action;I=h;J=E;y=v.length;I.hasOwnProperty("hmid")&&I.hasOwnProperty("index")||(I.hmid=y,I.index=J);v.splice(E,0,h);r(h);F&&(h=A(h,E),K.insertBefore(h,K.childNodes[E-1]))}break;case "hide":d(c[p],b);break;case "show":e(c[p],b)}if(q.hasOwnProperty("submenu")&&(h=void 0,v=q.submenu,p=c[p],q=q.newLabel||q.label,F=b,p))for(h in E=p.submenu,v)if(v.hasOwnProperty(h)){var n=v[h];switch(n.action){case "changeLabel":J=k(n.label,u[q]);if(-1<
J&&(I=n,J=E[J],y=F,n=q,I&&I.hasOwnProperty("newLabel"))){J.label=I.newLabel;n=u[n];var w=I.newLabel,C=n.indexOf(I.label);-1<C&&(n[C]=w);y&&(I=I.newLabel,J=K.querySelector("div[hmid\x3d'"+J.hmid+"']"))&&(J.querySelector("."+x.MENU_TITLE).textContent=I)}break;case "changeUrl":J=k(n.label,u[q]);-1<J&&f(n,E[J],F);break;case "add":J=n;y=q;I=p;n=F;if(w=J)w=J.label.trim(),w=u.hasOwnProperty(y)&&-1<u[y].indexOf(w)?!0:!1,w=!w;if(w){C=null;J.hasOwnProperty("before")?(C=k(J.before,u[y]),delete J.before):J.hasOwnProperty("after")&&
(C=k(J.after,u[y]),C=-1==C?C:C+1,delete J.after);if(null==C||-1==C)C=I.submenu&&I.submenu.length||0;delete J.action;I.submenu=I.submenu||[];J.index=C;J.hmid=I.hmid+""+I.submenu.length;I.submenu.splice(C,0,J);w=J.label;u.hasOwnProperty(y)&&u[y].splice(C,0,w);n&&I&&J&&(n=I.hmid,w=K.querySelector("div[hmid\x3d'"+n+"']"),(y=w.querySelector("."+x.SUBMENU_ITEM_WRAPPER))?(n=t(J,J.hmid),I.submenu.length==J.index?y.parentElement.appendChild(n):y.parentElement.insertBefore(n,y.parentElement.childNodes[0==J.index?
0:J.index-1])):(w.appendChild(m([J],n)),w.className+=" "+x.MENU))}break;case "remove":I=q;J=p;y=F;n&&(n=k(n.label,u[I]),(w=J.submenu[n])&&(w.hasOwnProperty("allowRemove")?w.allowRemove:1)&&(J.submenu.splice(n,1),u.hasOwnProperty(I)&&u[I].splice(n),y&&w&&(I=K.querySelector("div[hmid\x3d'"+w.hmid+"']"))&&I.parentElement.removeChild(I)));break;case "hide":J=k(n.label,u[q]);d(E[J],F);break;case "show":J=k(n.label,u[q]),e(E[J],F)}}}return c}function d(a,b){b&&(b=K.querySelector("div[hmid\x3d'"+a.hmid+
"']"))&&(a.display=b.style.display,b.style.display="none")}function e(a,b){b&&(b=K.querySelector("div[hmid\x3d'"+a.hmid+"']"),a=a.hasOwnProperty("submenu")?a.display:"",b&&(b.style.display=a))}function f(a,b,c){a&&a.hasOwnProperty("url")&&(b.url=a.url,c&&K.querySelector("div[hmid\x3d'"+b.hmid+"'] ."+x.MENU_TITLE).setAttribute("href",a.url))}function k(a,b){if(a)return b.indexOf(a.trim())}function r(a){var b=a.label.trim();if(!u.hasOwnProperty(b)){var c=u;if(a.hasOwnProperty("submenu")){var d=a.submenu;
var e=[],g;for(g in d)d.hasOwnProperty(g)&&!e.hasOwnProperty(d[g].label)&&e.push(d[g].label.trim());d=e}else d=null;c[b]=d||[]}-1==M.indexOf(b)&&(M[a.index]=b)}function A(a,b,c,d){switch(a.type){case "syntaxassist":if(!0!==c.plainMode)return n=a=new DelugeSettings(a,d,c),a.init();break;default:c=document.createElement("div");c.setAttribute("class",(x.MENU+" "+p(a)+" "+l(a)).trim());c.setAttribute("hmid",a.hmid);c.setAttribute("name",a.label);a.hasOwnProperty("type")&&c.setAttribute("type",a.type);
d=a.image||"";var e=x.MENU_ICON;e=a&&a.hasOwnProperty("customChildClass")?a.customChildClass+" "+e:x[a.label.toUpperCase()]?x[a.label.toUpperCase()]+" "+e:e;c.innerHTML="\x3cdiv class\x3d'"+e+"'\x3e"+d+"\x3cspan class\x3d'"+x.MENU_TITLE+"'\x3e"+a.label+"\x3c/span\x3e\x3c/div\x3e";a.hasOwnProperty("clickAction")&&z(c,a.clickAction,"click");a.hasOwnProperty("attachEvent")&&a.attachEvent.hasOwnProperty("event")&&a.attachEvent.hasOwnProperty("action")&&z(c,a.attachEvent.action,a.attachEvent.event);a.hasOwnProperty("submenu")&&
c.appendChild(m(a.submenu,b));a.hasOwnProperty("bindEvent")&&a.bindEvent(c);return c}}function p(a){if(a.hasOwnProperty("align"))switch(a.align){case "left":return"deluge-actions-align-left";case "right":return"deluge-actions-align-right"}return""}function l(a){return a&&a.hasOwnProperty("customClass")?a.customClass:""}function m(a,b){b=document.createElement("div");b.setAttribute("class",x.SUBMENU);for(var c in a)a.hasOwnProperty(c)&&b.appendChild(t(a[c],a[c].hmid));return b}function t(a,b){if(a){var c=
document.createElement("div");c.setAttribute("class",x.SUBMENU_ITEM_WRAPPER+" "+l(a));c.setAttribute("hmid",b);switch(a.type){case "link":c.appendChild(H(a));break;case "click":c.appendChild(q(a))}return c}}function q(a){var b=document.createElement("div");b.setAttribute("class",x.SUBMENU_ITEM+" "+x.MENU_TITLE);b.textContent=a.label;z(b,a.clickAction,"click");return b}function z(a,b,c){a.addEventListener(c,function(a){b(a)})}function H(a){var b=document.createElement("a");b.setAttribute("class",x.MENU_TITLE);
b.setAttribute("target","_blank");b.setAttribute("href",a.url);b.textContent=a.label;return b}var x={WRAPPER:"deluge-header-actions dre-deluge-actions",MENU:"deluge-actions-menu dre-actions-menu",SUBMENU:"deluge-actions-submenu",SUBMENU_ITEM_WRAPPER:"deluge-submenu-item-wrapper",SUBMENU_ITEM:"deluge-submenu-item",MENU_TITLE:"deluge-actions-menu-text",MENU_ICON:"deluge-actions-menu-icon"},g=null,y=null,G={},K=null,M=[],u={},n,N=function(){function a(a){if(a){var c=a.data;"close"==c&&b();"submitted"==
c&&(c=document.getElementById("dreSupportIframe"))&&c.setAttribute("submitted","true");a.stopPropagation()}}function b(){DelugePopup.hide();window.removeEventListener("message",a,!1)}function c(){var a="https://"+document.domain;"true"==this.getAttribute("submitted")?(DelugePopup.addClass("deluge-support-success"),this.src=e+"/supportRequestSuccess?frameorigin\x3d"+a,this.removeEventListener("load",c,!0),setTimeout(function(){b()},2E3)):(a={},0<g.length&&(a.serviceName=g),0<h.length&&(a.featureCategory=
h),this.contentWindow.postMessage(JSON.stringify(a),"*"))}var d=null,e="",g="",h="";return{show:function(){var b=d.querySelector("#dreSupportIframe");b||(b=document.createElement("iframe"),b.className="dreSupportIframe",b.id="dreSupportIframe",b.addEventListener("load",c,!0));b.src=e+"/supportRequestForm?frameorigin\x3d"+("https://"+document.domain);b.setAttribute("submitted","false");DelugePopup.show(d,b,{className:"deluge-support-iframe",esc:!0});window.addEventListener("message",a,!1)},init:function(a,
b){g=b.hasOwnProperty("supportServiceName")?b.supportServiceName:"";h=b.hasOwnProperty("featureCategory")?b.featureCategory:"";e=b.constants?b.constants.baseUrl:"";d=a},hide:b}}();return{init:function(a,b,d,e,f){M=[];u={};for(var m in g)if(g.hasOwnProperty(m)){g[m].index=m;g[m].hmid=m;r(g[m]);var h=g[m].hasOwnProperty("submenu")&&g[m].submenu;if(h)for(var v in h)h.hasOwnProperty(v)&&(h[v].index=v,h[v].hmid=m+""+v)}switch(DelugeUtil.getDomain()){case "skydesk":G=c([{label:"Help",submenu:[{action:"remove",
label:"Support"}]}],!1);break;case "cn":G=c([{label:"\u5e2e\u52a9",submenu:[{action:"remove",label:"\u652f\u6301"}]}],!1)}G=c(b&&b.config);N.init(d,e);b=document.createElement("div");b.setAttribute("class",x.WRAPPER);for(var F in G)G.hasOwnProperty(F)&&(d=A(G[F],F,e,f))&&b.appendChild(d);a.appendChild(b)},push:function(a,b){(K=a.delugeArea.querySelector("."+x.WRAPPER.replace(" ",".")))&&(G=c(b,!0))},setI18n:function(a,c,d){y=c;b(a,c,d)},getSyntaxAssist:function(){return n},supportForm:N}}();var delugeEditor,Editor,DelugeEditorWrapper=function(a,b,c){function d(a,b){var c=a.delugeArea,d=null!=b.shortkeyExceptions?b.shortkeyExceptions:p(b),e=c.querySelector(".deluge-shortkeys");e&&DelugeShortKeys.bind(e,b.fromDRE,d,a.getI18N());DelugeLeftPane.bindShowHideAction(a);b.hasOwnProperty("version")&&(c=c.querySelector(".deluge-top-bar .deluge-actions-menu[name\x3dVersions]"),DelugeUtil.attachEvent(c,"click",function(){(new b.version.actionClass(a,l.options.version,l.options.workflow)).show()}))}
function e(a){function b(a){return{get:function(){return a}}}for(var c=a.helpers||[],d=0;d<c.length;d++){var e=c[d];if(e){var h=e[0],v=e[1];e=e[2];e||(e=new v.get,v=b(e));a.defineProperty(a,h,v,e)}}}function f(){var a=document.createElement("div");a.setAttribute("class","deluge-left-pane-wrapper");a.setAttribute("id","delugeLeftPane");var b=document.createElement("div");b.setAttribute("class","deluge-left-pane deluge-scroll");a.appendChild(b);b=document.createElement("div");b.setAttribute("class",
"deluge-left-pane-hide-btn");b.innerHTML="\x3cdiv class\x3d'deluge-show-hide-icon '\x3e\x3cdiv class\x3d'deluge-show-hide-icon-line'\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-show-hide-msg' style\x3d'display: none;'\x3eShow/hide deluge tasks pane\x3c/div\x3e\x3c/div\x3e";z||(b.style.display="none");a.appendChild(b);return a}function k(a){var b=document.createElement("div");b.setAttribute("class","deluge-editor-layer dre-editor-layer");a.showLeftPane&&b.appendChild(f());var c=document.createElement("div");
c.setAttribute("class","deluge-editor-container");c.setAttribute("id","delugeEditorCont");var d=document.createElement("div");d.setAttribute("class","deluge-main-container");var e=document.createElement("textarea");e.setAttribute("class","deluge-code-area");e.setAttribute("id","delugeCodeArea");e.setAttribute("name","deluge-code-area");d.appendChild(e);c.appendChild(d);a.footer&&c.appendChild(DRE.BottomBar.get(a,w));d=a.isExecute;e=a.isSaveAndExecute;var h=a.output;(a.isSave||d||e)&&h&&(a=document.createElement("div"),
a.setAttribute("id","newstatusmessage"),a.setAttribute("name","newstatusmessage"),a.setAttribute("class","script-status-success"),a.innerText="Script generated",a.setAttribute("style","visibility:hidden;"),c.appendChild(a));(d||e)&&h&&(a=document.createElement("div"),a.setAttribute("id","output-container"),a.setAttribute("style","visibility:hidden;"),a.innerHTML='\x3ch2 id\x3d"output-header"\x3eOutput\x3c/h2\x3e\x3cpre id\x3d"output"\x3e\x3c/pre\x3e',c.appendChild(a));b.appendChild(c);return b}function r(a){window.ZE_Init.init();
setTimeout(function(){window.dreZE_Init=window.ZE_Init;window.tempZE_Init&&(window.ZE_Init=window.tempZE_Init);window.tempZE&&(window.ZE=window.tempZE)},3E3);a.options.ZEConfig&&"function"==typeof a.options.ZEConfig&&a.options.ZEConfig()}function A(a,b){DRE.serviceFlags.isEnabled("ze-init")&&(b=b.constants.staticUrl.js+"/"+b.constants.buildLabel+"/js/ze_init.js",(new DRE.Loader).require([b],function(){r(a)},!0))}function p(a){var b=[];a&&(a.hasOwnProperty("save")||b.push("save script"),a.hasOwnProperty("execute")||
b.push("execute script"),a.hasOwnProperty("saveAndExecute")||b.push("save and execute script"));return b}var l=this;this.delugeArea=a;this.options=b;this.functionId=null;this.initComplete=!1;this.sharedBy=this.customResize=null;this.isExprBuilderEnabled=!1;this.mode="default";this.internalBanner=!1;var m=null,t="static",q=!1,z=!1,H=null,x=!0,g=!1,y="",G=!0,K=[{type:"versions",title:"Version"},{type:"help",title:"Help"},{type:"syntaxassist",title:"Syntax Assist"}];if(b){b.advancedFeatures=b.hasOwnProperty("advancedFeatures")?
b.advancedFeatures:!0;b.advancedFeatures&&(b.builder=DelugeBuilderParser);b.hasOwnProperty("mode")&&"plain"==b.mode&&(b.topBar||(b.topBar={}),b.topBar.isDisabled=!0,b.footer=!1,b.leftPane=!1,b.lineNumbers=!1,g=!0,this.mode="plain");b.hasOwnProperty("headerMenus")&&(K=b.headerMenus?b.headerMenus:K);b.hasOwnProperty("leftPane")&&(G=1==b.leftPane?!0:!1,b.leftPane=G);b.hasOwnProperty("position")&&(t=b.position);b.hasOwnProperty("syntaxAssist")&&DRE.serviceFlags.setFlag("syntax-assist","boolean"===typeof b.syntaxAssist?
b.syntaxAssist:b.syntaxAssist.hasOwnProperty("isEnabled")&&b.syntaxAssist.isEnabled);if(b.hasOwnProperty("service")||b.hasOwnProperty("serviceName"))y=b.serviceName||b.service,y=null!=y?y:"",DRE.serviceFlags.init(y);b.hasOwnProperty("advancedFeatures")&&(q=b.advancedFeatures);b.hasOwnProperty("showLeftPaneHideBtn")&&(z=b.showLeftPaneHideBtn);b.hasOwnProperty("lineNumbers")&&(x=null!=b.lineNumbers?b.lineNumbers:x);b.hasOwnProperty("builder")&&(H=b.builder);(b.theme||b.editorTheme)&&DRE.Theme.set(b.theme,
b.editorTheme);b.hasOwnProperty("isExprBuilderEnabled")&&(this.isExprBuilderEnabled=b.isExprBuilderEnabled)}!/^http[s]?:\/\/([a-zA-Z0-9-.]*).(localzoho|localmanageengine|localzohositesbuilder).com/.test(document.location.href)||b.hasOwnProperty("serviceName")||b.hasOwnProperty("service")||this.isExprBuilderEnabled||(this.internalBanner=!0);var M={people:"People",mail:"Mail",books:"Books",invoice:"Invoice",recruit:"Recruit",cliq:"Cliq",inventory:"Inventory",projects:"Projects",connect:"Connect",chat:"Cliq"},
u=DelugeLeftPane.getSettings(b),n=u.restriction,N=u.hideTasks;u=u.tasksOrder;var w=DelugeEditorI18N.validate(b.constants?b.constants.Editor.i18n:null);this.createBanner=function(){var a=document.createElement("div");a.className="dre-internal-banner";var b=a.appendChild(document.createElement("div"));b.innerHTML="ServiceName is mandatory!";b.className="dre-banner-text";return a};this.getI18N=function(){return w};DRETopBar.setI18n(l,w,b);DelugeLeftPane.setI18n(w);b.showLeftPaneHideBtn=z;b.headerMenus=
K;(function(a,b,c){if(a){m=a;a.classList.add("delugeEditorArea");var d={header:!0,footer:!0,showLeftPane:!0,showShortcutKeys:!0,showTheme:!1};b&&(d.footer=b.hasOwnProperty("footer")?b.footer:d.footer,b.hasOwnProperty("bottomBar")&&(d.bottomBar=b.bottomBar,b.bottomBar.isDisabled&&(d.footer=!1)),d.header=b.hasOwnProperty("header")?b.header:d.header,b.hasOwnProperty("topBar")&&b.topBar.isDisabled&&(d.header=!1),d.showLeftPane=b.hasOwnProperty("leftPane")?b.leftPane:d.showLeftPane,d.showShortcutKeys=
b.hasOwnProperty("shortcutKeys")?b.shortcutKeys:d.showShortcutKeys,d.showTheme=b.hasOwnProperty("settings")&&!0===b.settings.theme?!0:!1,d.connections=b.hasOwnProperty("connections")?b.connections:d.connections);d.isSave="true"===a.getAttribute("save")?!0:!1;d.isExecute="true"===a.getAttribute("execute")?!0:!1;d.isSaveAndExecute="true"===a.getAttribute("saveandexecute")?!0:!1;var e=a.getAttribute("output");d.output=e?"true"===e?!0:!1:!0;e=document.createElement("div");e.setAttribute("class","deluge-mc-editor-layer");
if(d.header){DelugeUtil.getDomain();if(!b.hasOwnProperty("serviceName")){var h=document.location.href.match(/^http[s]?:\/\/([a-zA-Z0-9-]*).(?:localzoho|zoho).com/);null!=h&&(h=M[h[1]]||"",b.supportServiceName=h)}if(m.querySelector("deluge-top-bar"))h=void 0;else{h=b.hasOwnProperty("labels")&&b.labels.header?b.labels.header:w["deluge.editor.deluge.title"];h="\x3cdiv class\x3d'deluge-task-header dre-deluge-task-header'\x3e"+(b.hasOwnProperty("topBar")&&!1===b.topBar.logo?"":'\x3cdiv class\x3d"dre-logo"\x3e\x3c/div\x3e')+
h+"\x3c/div\x3e";var v=document.createElement("div");v.setAttribute("class","deluge-top-bar dre-top-bar");v.innerHTML=h;DRETopBar.init(v,b.topBar,a,b,w,l);v.setAttribute("id","dreTopBar");h=v}h&&e.appendChild(h)}e.appendChild(k(d));c.isConnectionEnabled(b)&&DRE.ConnectionInteg.initialize(b,e);a.appendChild(e);b&&c.initializeVersion(b.sharedBy,b.functionId,b.serviceName,b.isAdmin)}})(a,b,this);K=this.options.hasOwnProperty("labels")?this.options.labels.leftPaneTitle:"";this.editor=createDelugeEditor({elem:a,
leftPane:G,leftPaneTitle:K,leftPaneTasks:this.options.leftPaneTasks,restriction:n,hideTasks:N,tasksOrder:u,fromDRE:!1,service:y,positionType:t,advancedFeatures:q,lineNumbers:x,plainMode:g,existingMeta:b.existingMeta,editorOnChange:b.editorOnChange,editorBeforeChange:b.editorBeforeChange,subformAutocomplete:b.subformAutocomplete,theme:DRE.Theme.getEditorTheme()},this,c);!0!==g&&l.setSyntaxAssist();this.editor.resize=function(){DelugeEditorUtil.resizeEditor(l.delugeArea)};this.supportForm=DRETopBar.supportForm;
this.resize();this.setOptions(b);window.attachEvent?window.attachEvent("onresize",function(){l&&l.resize()}):window.addEventListener&&window.addEventListener("resize",function(){l&&l.resize()});g||(this.bindSEEvents(),d(this,b),A(this,b),e(this));q&&(this.builder=H);this.initComplete=!0};DelugeEditorWrapper.prototype.helpers=[];DelugeEditorWrapper.registerHelper=function(a,b,c){DelugeEditorWrapper.prototype.helpers.push([a,b,c])};
DelugeEditorWrapper.prototype.defineProperty=function(a,b,c,d){d&&(d.editorWrapper=a);Object.defineProperty(a,b,c)};DelugeEditorWrapper.prototype.addWidget=function(a){this.delugeArea.querySelector(".deluge-editor-container").appendChild(a)};DelugeEditorWrapper.prototype.removeWidget=function(a){this.delugeArea.querySelector(".deluge-editor-container").removeChild(a)};
DelugeEditorWrapper.prototype.initializeVersion=function(a,b,c,d){if(DRE.serviceFlags.isCreator()){var e=this.delugeArea.querySelector(".deluge-version-div");if(a&&b){var f=this.delugeArea.querySelector(".deluge-editor-footer");e.style.display="inline-block";null==this.functionId&&"undefined"!=typeof dreVersion&&dreVersion.bindEvent(e,f,a,this);this.functionId=b}else e&&(e.style.display="none")}else if(a&&b){var k=this;DRETopBar.push(k,[{action:"add",type:"click",label:"Version",image:'\x3cdiv class\x3d\'dre-version-img\'\x3e\x3csvg viewBox\x3d"0 0 50 50"\x3e\x3cpath style\x3d"text-indent:0;text-align:start;line-height:normal;text-transform:none;block-progression:tb;-inkscape-font-specification:Sans" d\x3d"M 20.90625 3 A 1.0001 1.0001 0 0 0 20 4 L 20 46 A 1.0001 1.0001 0 0 0 21 47 L 47 47 A 1.0001 1.0001 0 0 0 48 46 L 48 4 A 1.0001 1.0001 0 0 0 48 3.90625 A 1.0001 1.0001 0 0 0 47 3 L 21 3 A 1.0001 1.0001 0 0 0 20.90625 3 z M 22 5 L 46 5 L 46 45 L 22 45 L 22 5 z M 10.8125 7 A 1.0001 1.0001 0 0 0 10 8 L 10 42 A 1.0001 1.0001 0 0 0 11 43 L 18 43 L 18 41 L 12 41 L 12 9 L 18 9 L 18 7 L 11 7 A 1.0001 1.0001 0 0 0 10.90625 7 A 1.0001 1.0001 0 0 0 10.8125 7 z M 2.8125 11 A 1.0001 1.0001 0 0 0 2 12 L 2 38 A 1.0001 1.0001 0 0 0 3 39 L 8 39 L 8 37 L 4 37 L 4 13 L 8 13 L 8 11 L 3 11 A 1.0001 1.0001 0 0 0 2.90625 11 A 1.0001 1.0001 0 0 0 2.8125 11 z" color\x3d"#000" overflow\x3d"visible" font-family\x3d"Sans"\x3e\x3c/path\x3e\x3c/svg\x3e\x3c/div\x3e',
clickAction:function(){null!=k.functionId&&"undefined"!=typeof dreVersion&&dreVersion.trigger(k,a,c,d)}}]);"undefined"!=typeof dreVersion&&dreVersion.bindDocumentEvent();k.functionId=b}};DelugeEditorWrapper.prototype.hideVersion=function(){this.delugeArea.querySelector(".deluge-version-div").style.display="none"};
DelugeEditorWrapper.prototype.bindSEEvents=function(){function a(a,b){a&&a.addEventListener("click",b)}var b=this,c=b.editor;if(c){c.saveScript=function(){null!=b.delugeEditorContent&&(b.editorPreviousContent=b.delugeEditorContent);b.delugeEditorContent=b.getEditorValue();b.saveScript&&b.saveScript()};c.executeScript=function(){b.executeScript&&b.executeScript()};c.saveAndExecute=function(){b.delugeEditorContent=b.getEditorValue();b.saveAndExecute&&b.saveAndExecute()};var d=this.delugeArea;a(d.querySelector(".deluge-save-btn"),
c.saveScript);a(d.querySelector(".deluge-execute-btn"),c.executeScript);a(d.querySelector(".deluge-save-execute-btn"),c.saveAndExecute)}};DelugeEditorWrapper.prototype.setAutoComplete=function(a){a?CodeMirror.autoCompleteHandler&&(CodeMirror.registerHelper("hint","deluge",CodeMirror.autoCompleteHandler),CodeMirror.autoCompleteHandler=null):(CodeMirror.autoCompleteHandler=CodeMirror.helpers.hint.deluge,CodeMirror.registerHelper("hint","deluge",function(){}))};
DelugeEditorWrapper.prototype.setOptions=function(a,b){if(a){a.hasOwnProperty("isExprBuilderEnabled")&&(this.isExprBuilderEnabled=a.isExprBuilderEnabled);a.hasOwnProperty("readOnly")&&this.editor&&this.editor.setOption("readOnly",a.readOnly);a.hasOwnProperty("sharedBy")&&(this.sharedBy=a.sharedBy);a.save&&"function"==typeof a.save&&(this.saveScript=a.save);a.execute&&"function"==typeof a.execute&&(this.executeScript=a.execute);a.saveAndExecute&&"function"==typeof a.saveAndExecute&&(this.saveAndExecute=
a.saveAndExecute);if(a.metadata){var c=a.metadata,d=c.hasOwnProperty("appLinkName")&&c.appLinkName,e=c.hasOwnProperty("formLinkName")&&c.formLinkName;c=c.hasOwnProperty("subformFieldLinkName")&&c.subformFieldLinkName;d&&this.editor.metadata.setDelugeAppLinkName(d);e&&this.editor.metadata.setDelugeFormLinkName(e);c&&this.editor.metadata.setDelugeSubFormFieldLinkName(c)}a.hintRestrictionMap&&this.editor.metadata.setHintRestrictionMap(a.hintRestrictionMap);a.module&&"string"==typeof a.module&&this.editor.metadata.setDelugeFormLinkName(a.module);
a.scopeID&&this.editor.metadata.fetchServiceForms(a.scopeID);a.serviceName&&(this.editor.metadata.setDelugeAppLinkName(a.serviceName),this.editor.metadata.setDelugeServiceName(a.serviceName));a.functionId&&(this.functionId=a.functionId);a.integrationTasks&&this.handleIntegrationTasks(a.integrationTasks);a.topBar&&a.topBar.config&&this.initComplete&&DRETopBar.push(this,a.topBar.config);a.bottomBar&&a.bottomBar.config&&this.initComplete&&DRE.BottomBar.update(a.bottomBar.config,this.delugeArea);a.systemFields&&
a.systemFields.restrictions&&(this.editor.metadata.systemFields.setRestrictions(a.systemFields.restrictions),a.systemFields.hasOwnProperty("hideAll")&&this.editor.metadata.systemFields.setHideAll(a.systemFields.hideAll));a.restriction&&b&&(a.service&&""!=a.service||(a.service=this.options.service),DelugeLeftPane.updateLeftPane(this,a));a.hasOwnProperty("customResize")?this.customResize=a.customResize:this.customResize=null;a.hasOwnProperty("customScroll")&&(this.customScroll=a.customScroll);a.hasOwnProperty("autocomplete")?
this.setAutoComplete(a.autocomplete):this.setAutoComplete(!0);if(DRE.serviceFlags.isCreator())if(a.hasOwnProperty("workflow")||this.options.hasOwnProperty("workflow")){if(b=this.delugeArea.querySelector(".deluge-top-bar .deluge-actions-menu[name\x3dVersions]"))b.style.display="inline-block";a.workflow&&(this.options.workflow=a.workflow)}else if(b=this.delugeArea.querySelector(".deluge-top-bar .deluge-actions-menu[name\x3dVersions]"))b.style.display="none";(DRE.serviceFlags.isCreator()?null!==a.script:
null!==a.script&&""!==a.script)&&this.setEditorContent(a.script,DRE.serviceFlags.isEnabled("storeInHistory"));(a.theme||a.editorTheme)&&DRE.Theme.load(a.theme,a.editorTheme);a.ZE&&(a.ZE.create&&"function"==typeof a.ZE.create&&(this.ZECreate=a.ZE.create),a.ZE.changeobj&&typeof("object"==a.ZE.changeobj)&&(this.ZEChangeobj=a.ZE.changeobj));this.handleRTLEditor(a.rtl)}};
DelugeEditorWrapper.prototype.handleIntegrationTasks=function(a){a.hasOwnProperty("hideAll")&&a.hideAll?this.editor.metadata.integrationTasks.setHideAll(a.hideAll):this.editor.metadata.integrationTasks.setHideAll(!1);a.hasOwnProperty("overrideRestrictions")&&this.editor.metadata.integrationTasks.setOverrideRestrictions(a.override);a.hasOwnProperty("restrict")&&this.editor.metadata.integrationTasks.handleRestrictions(a.restrict)};
DelugeEditorWrapper.prototype.handleRTLEditor=function(a){var b=this.delugeArea;a?(b.className+=" deluge-rtl-editor",this.editor.setOption("direction","rtl"),document.querySelector(".deluge-shortcut-content").style.left=0,document.querySelector(".deluge-shortcut-content").style.right="unset"):this.editor.setOption("direction","ltr")};DelugeEditorWrapper.prototype.setReadOnly=function(a){this.setOptions({readOnly:a})};DelugeEditorWrapper.prototype.getInitialContent=function(){return this.initialContent};
DelugeEditorWrapper.prototype.setInitialContent=function(a){this.initialContent=a};DelugeEditorWrapper.prototype.showLeftPane=function(){var a=this.delugeArea.querySelector(".deluge-left-pane-wrapper");a&&(a.style.display="inline-block");(a=this.delugeArea.querySelector(".deluge-task-header"))&&(a.style.display="inline-block");"function"==typeof this.resize&&(this.resize(),this.customResize&&this.customResize())};
DelugeEditorWrapper.prototype.hideLeftPane=function(){var a=this.delugeArea.querySelector(".deluge-left-pane-wrapper");a&&(a.style.display="none");(a=this.delugeArea.querySelector(".deluge-task-header"))&&(a.style.display="none");"function"==typeof this.resize&&this.resize()};
DelugeEditorWrapper.prototype.setEditorContent=function(a,b){if(null!=a){"undefined"!==typeof DelugeBuilderPopup&&0<DelugeBuilderPopup.layers.length&&!this.isExprBuilderEnabled&&DelugeBuilderPopup.hide();"undefined"!==typeof DelugePanePopup&&0<DelugePanePopup.layers.length&&!this.isExprBuilderEnabled&&(DelugePanePopup.hide(),this.deActivateBuilderMode(),DelugeBuilderParser.removeLineSelection(this.editor),this.setReadOnly(!1));this.initialContent=a;this.editor.markClean();this.editor.setValue(a);
if(null!=b?b:1)this.delugeEditorContent=a,this.clearLocalHistory();this.internalBanner&&this.editor.addLineWidget(0,this.createBanner(),{coverGutter:!0,above:!0})}};DelugeEditorWrapper.prototype.renderScript=function(a,b,c){return DelugeUtil.renderScript(a,b,c)};DelugeEditorWrapper.prototype.diff=function(a,b,c){return DelugeUtil.diff(a,b,c)};DelugeEditorWrapper.prototype.setCustomOptions=function(a){this.editor.options.deluge=a};DelugeEditorWrapper.prototype.focusEditor=function(){this.editor.focus()};
DelugeEditorWrapper.prototype.getValue=function(){return this.editor.getValue()};DelugeEditorWrapper.prototype.clearLocalHistory=function(){this.editor.clearHistory()};DelugeEditorWrapper.prototype.gotoLine=function(a,b){a=isNaN(a)?0:a;b=isNaN(b)?0:b-1;this.editor.setCursor({line:a-1,ch:b});this.editor.focus()};
DelugeEditorWrapper.prototype.addFuncParamsToEditor=function(a,b){if("string"==typeof a){var c=this.editor.metadata;a=a.substring(1,a.length-1).split(/\s*,\s*/);for(var d in a)if(a.hasOwnProperty(d)&&(b=a[d])){var e=b.split(":");e&&e[0]&&e[1]&&(b=e[1],e=e[0],e=getDelugeDataType(e),c.delugeFunctionArgs.push({name:b,type:e}))}}else for(c in b||(this.editor.metadata.delugeFunctionArgs=[]),a)a.hasOwnProperty(c)&&(b=a[c],d=b.paramName,b=b.paramType,b=getDelugeDataType(b),this.editor.metadata.delugeFunctionArgs.push({name:d,
type:b}))};DelugeEditorWrapper.prototype.getEditorValue=function(){return this.editor.getValue()};DelugeEditorWrapper.prototype.refreshEditor=function(){return this.editor.refresh()};DelugeEditorWrapper.prototype.isEditorContentModified=function(){return null!=this.delugeEditorContent&&this.delugeEditorContent!=this.getEditorValue()?!0:!1};DelugeEditorWrapper.prototype.resize=function(){DelugeEditorUtil.resizeEditor(this.delugeArea);this.customScroll&&this.customScroll("leftpane");this.refreshEditor()};
DelugeEditorWrapper.prototype.setSharedVariables=function(a){this.editor.sharedVars=a};DelugeEditorWrapper.prototype.clearSharedVariables=function(){this.editor.sharedVars=null};DelugeEditorWrapper.prototype.setHintPreset=function(a){this.editor.hintPreset=a};DelugeEditorWrapper.prototype.setHintFieldRestriction=function(a){this.editor.metadata.setHintFieldRestriction(a)};DelugeEditorWrapper.prototype.getTopBar=function(){return this.delugeArea.querySelector(".deluge-top-bar")};
DelugeEditorWrapper.prototype.pushToTopBar=function(a,b){var c=this.getTopBar();c&&a&&(c=c.querySelector(".deluge-header-actions"),null!=b&&-1<b&&b<c.childNodes.length?c.insertBefore(a,c.childNodes[b]):c&&c.appendChild(a))};DelugeEditorWrapper.prototype.updateTopBarMenu=function(a){return DRETopBar.push(this,a)};DelugeEditorWrapper.prototype.setSyntaxAssist=function(){this.editor&&DRETopBar.getSyntaxAssist&&(this.editor.deluge||(this.editor.deluge={}),this.editor.deluge.settings=DRETopBar.getSyntaxAssist())};
DelugeEditorWrapper.prototype.clear=function(){this.getI18N=this.createBanner=this.destroy=this.sharedBy=this.options=this.initialContent=this.functionId=this.editor=this.delugeEditorContent=this.delugeArea=null};DelugeEditorWrapper.prototype.getMode=function(){return this.mode};DelugeEditorWrapper.prototype.rollbackContent=function(){null!=this.editorPreviousContent&&(this.delugeEditorContent=this.editorPreviousContent)};DelugeEditorWrapper.prototype.getHistory=function(){return this.editor.getHistory()};
DelugeEditorWrapper.prototype.setHistory=function(a){this.editor.setHistory(a)};DelugeEditorWrapper.prototype.updateCRMModules=function(a){DelugeBuiltInFunction.updateCRMModules(a)};DelugeEditorWrapper.prototype.updateCustomModules=function(a,b){DelugeBuiltInFunction.updateCustomModules(a,b)};DelugeEditorWrapper.prototype.activateBuilderMode=function(){var a=this.delugeArea;a&&a.classList.add("deluge-builder-active")};
DelugeEditorWrapper.prototype.deActivateBuilderMode=function(){var a=this.delugeArea;a&&a.classList.remove("deluge-builder-active");this.resize();this.refreshEditor()};
DelugeEditorWrapper.prototype.showErrorMessage=function(a,b){function c(){e=DelugeUtil.getDivElement('\x3ci class\x3d"zc-common-alert zc-em zc-toast-icon"\x3e\x3c/i\x3e\x3cspan class\x3d"deluge-error-message"\x3e\x3c/span\x3e\x3ci class\x3d"zc-toast-close-icon zc-common-close zc-em"\x3e\x3c/i\x3e',"zc-dem-toast zc-error-toast zc-ctr-toast deluge-error-msg-container");e.querySelector(".zc-toast-close-icon").addEventListener("click",function(){d.hideErrorMessage()});d.delugeArea.querySelector(".deluge-main-container").appendChild(e);
return e}var d=this,e=d.delugeArea.querySelector(".deluge-error-msg-container");null==e&&(e=c());e.classList.remove("zc-error-toast","zc-warning-toast","deluge-error-msg-ref");"warning"==b?e.classList.add("zc-warning-toast"):e.classList.add("zc-error-toast");a=a.replace(/<br>/g,"\n");b=a.indexOf("\n");0<b&&(a="\x3cspan\x3e"+a.slice(0,b)+"\x3c/span\x3e"+a.slice(b+1));e.querySelector(".deluge-error-message").innerHTML=a;e.style.display="block";(a=e.querySelector(".deluge-error-message \x3e span \x3e span")||
e.querySelector(".zc-warning-toast .deluge-error-message \x3e span:last-child"))&&a.addEventListener("click",function(){d.gotoLine(this.innerText)});(e=d.delugeArea.querySelector(".deluge-error-msg-container"))&&(DelugeReferFields&&DelugeReferFields.isVisible(d.delugeArea)?e.classList.add("deluge-error-msg-ref"):e.classList.remove("deluge-error-msg-ref"))};
DelugeEditorWrapper.prototype.hideErrorMessage=function(){var a=this.delugeArea.querySelector(".deluge-error-msg-container");a&&(a.style.display="none")};DelugeEditorWrapper.prototype.isConnectionEnabled=function(a){Window.connection_test_variables&&(a.serviceName=Window.connection_test_variables.serviceName,a.zuid=Window.connection_test_variables.zuid,a.sharedBy=Window.connection_test_variables.sharedBy);var {service:a,serviceName:b,zuid:c,sharedBy:d}=a;return(b||a)&&c&&d};Editor=DelugeEditorWrapper;var DelugeLeftPane=new function(){};
DelugeLeftPane.createPanel=function(a,b,c,d){function e(a,b){for(var c=0;b&&c<b.length;c++)if(void 0!==b[c]&&b[c].groupName.toLowerCase()===a.toLowerCase())return b[c].hasOwnProperty("elements")?b[c].elements:"block";return"cont"}var f="";d&&(f+='\x3cdiv class\x3d"deluge-leftpane-header"\x3e'+d+"\x3c/div\x3e");d={};var k=[];c||(c=DelugeLeftPane.orderLeftPaneBySerivce());for(var r in c)if(c.hasOwnProperty(r))for(var A=0;A<panelJson.length;A++){var p=panelJson[A].groupName,l=DelugeLeftPane.getDisplayName(p),
m="deluge.editor.leftpane.tasks.groupname."+l.toLowerCase();if(c[r].toLowerCase()==l.toLowerCase()){var t=e(l,a);if("block"!==t){var q=e(l,b),z=panelJson[A].elements,H="",x=0;if("block"!==q||"cont"===q)H+="\x3cdiv class\x3d'deluge-task-group group'\x3e"+(void 0===this.i18n[m]?l:this.i18n[m])+"\x3c/div\x3e";for(l=0;l<z.length;l++){var g=z[l].elemName,y=z[l].displayName;y=y?y:g;if("cont"===t||null===arrayContains(t,y)){var G=z[l].isNewElement?"new-block":"",K=z[l].displayCode,M=z[l].description;m=z[l].expressionCode;
K=dreReplaceAll("\x3c","\x26lt",K);K=dreReplaceAll("\x3e","\x26gt",K);if(g&&(null==arrayContains(q,g)&&"block"!==q&&(block="\x3cdiv draggable\x3d'true'  class\x3d'deluge-task-block block"+G+"' task-name\x3d'"+g+"' group-name\x3d'"+p.replace(/\s/gi,"_")+"'\x3e\x3cdiv class\x3d'deluge-task-block-element-name'\x3e"+y+"\x3c/div\x3e\x3cdiv class\x3d'deluge-task-block-data'\x3e"+K+"\x3c/div\x3e\x3cdiv class\x3d'deluge-task-block-description'\x3e"+M+"\x3c/div\x3e\x3cdiv class\x3d'deluge-task-block-task-drag'\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-task-block-help'\x3e\x3c/div\x3e\x3c/div\x3e",
H+=block,x++),g=z[l].key))for(y=0;y<g.length;y++)d[g[y]]=z[l],m&&!k.hasOwnProperty(g[y])&&(k[g[y]]=z[l])}}0<x&&(f+=H)}}}return{taskGroups:f,panelGroupMap:d,returnFunctions:k}};
DelugeLeftPane.updateLeftPane=function(a,b){b||(b=a.options);var c=DelugeLeftPane.getSettings(b);c=DelugeLeftPane.createPanel(c.restriction,c.hideTasks,c.tasksOrder);b=b.hasOwnProperty("leftPane")?b.leftPane:!0;a.editor.setPanelMap(c.panelGroupMap);a.editor.setPanelReturnFunctions(c.returnFunctions);a.editor.delugeModeHelpers.init(c.panelGroupMap);!isUndef(b)&&b&&(a.delugeArea.querySelector(".deluge-left-pane").innerHTML=c.taskGroups,DelugeLeftPane.bindLeftPane(a),a.customScroll&&a.customScroll("leftpane"))};
DelugeLeftPane.handleLeftPaneTasks=function(a){if(a)for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];"add"==b&&this.pushTask(c)}return this.getTasksOrder()};DelugeLeftPane.addTasks=function(a){a=DelugeLeftPane.pushTask(a);DelugeLeftPane.updateLeftPane(DelugeLeftPane.restrictionByService(),DelugeLeftPane.hideTasksByService(),a)};DelugeLeftPane.setTasksOrder=function(a){this.tasksOrder=a};DelugeLeftPane.getTasksOrder=function(){return this.tasksOrder};DelugeLeftPane.setI18n=function(a){this.i18n=a};
DelugeLeftPane.getI18n=function(){return this.i18n};
DelugeLeftPane.pushTask=function(a,b,c){var d=panelJson.groups,e=Object.keys(d);b=b?b:this.getTasksOrder();b=b.map(function(a){return a.toLowerCase()});for(var f in a)if(a.hasOwnProperty(f)){var k=a[f];if(k&&arrayContains(e,k.groupName))for(var r in panelJson){if(panelJson.hasOwnProperty(r)){var A=panelJson[r];if(A&&A.groupName==k.groupName){for(var p in k.elements)k.elements.hasOwnProperty(p)&&(arrayContains(d[A.groupName],k.elements[p].elemName)||A.elements.push(p));break}}}else c||(k.hasOwnProperty("after")?
(A=b.indexOf(k.after.toLowerCase()),A<b.length-1?b.splice(A+1,0,k.groupName):b.push(k.groupName),delete k.after):k.hasOwnProperty("before")?(A=b.indexOf(k.before.toLowerCase()),0<A?b.splice(A,0,k.groupName):b.unshift(k.groupName),delete k.before):b.push(k.groupName)),panelJson.push(k)}DelugeLeftPane.setTasksOrder(b);panelJson.refreshGroups();return b};
DelugeLeftPane.bindLeftPane=function(a){function b(){a.editor.taskDrag.markEnd(!0);DelugeEditorUtil.delugeMarker.clear(a.editor);var b=document.getElementById("delugeLPTaskDescription");b&&b.parentElement.removeChild(b)}function c(a){this.className+=" deluge-task-block-hover"}function d(a){removeClassName(this,"deluge-task-block-hover")}function e(b){var c=a.editor;b=this.getAttribute("task-name");var d=this.getAttribute("group-name");d=getPanelDetails(c.getPanelMap(),b,null,null,null,d.replace(/_/gi,
" "));var e=c.getCursor(),f=e.line;c.getLine(f);var k=!1;c.deluge.settings&&(k=c.deluge.settings.isBuilderEnabled());DelugeEditorUtil.dropCode(e,d,b,c,k);k&&setTimeout(function(){a.builder.trigger(c,f)},301)}function f(b){var c=a.editor;DelugeLeftPane.clearDelugeTaskInfo();b.dataTransfer.dropEffect="move";var d=b.target,e=d.getAttribute("task-name"),f=d.getAttribute("group-name");d.querySelector(".deluge-task-block-data");d=d.querySelector(".deluge-task-block-description").textContent;b.dataTransfer.setData("text",
JSON.stringify({element:e,group:f}));f=document.createElement("div");f.style.position="absolute";f.style.zIndex=-999;f.setAttribute("id","delugeLPTaskDescription");f.setAttribute("class","dragTip-description");f.setAttribute("style","top:-1000px;position:absolute");var k=document.createElement("div");k.appendChild(document.createTextNode(e));k.setAttribute("class","deluge-dragEle");f.appendChild(k);e=document.createElement("div");e.appendChild(document.createTextNode(d));f.appendChild(e);document.body.appendChild(f);
try{b.dataTransfer.setDragImage(f,-20,0)}catch(H){}c.taskDrag.markStart()}for(var k=document.querySelectorAll(".deluge-task-block"),r=0,A=k.length;r<A;r++)k[r].addEventListener("dblclick",e),k[r].addEventListener("mouseover",c),k[r].addEventListener("mouseout",d),k[r].addEventListener("dragstart",f,!0),k[r].addEventListener("dragend",b,!0)};DelugeLeftPane.clearDelugeTaskInfo=function(){var a=document.getElementById("delugeTasksInfo");a&&a.parentElement.removeChild(a)};
DelugeLeftPane.getSettings=function(a){var b=a.hasOwnProperty("service")?a.service:"",c=DelugeLeftPane.restrictionByService(b),d=DelugeLeftPane.hideTasksByService(b);if(a){var e=a.hasOwnProperty("tasksOrder")?a.tasksOrder:DelugeLeftPane.orderLeftPaneBySerivce(b);c=a.restrictAllTasks||a.hasOwnProperty("mode")&&"plain"==a.mode?this.getAllTasks():a.hasOwnProperty("restriction")?DelugeLeftPane.combineTasks(a.restriction,c):c;d=a.hasOwnProperty("hideTasks")?DelugeLeftPane.combineTasks(d,a.hideTasks,!0):
d}else e=DelugeLeftPane.orderLeftPaneBySerivce(b),c=DelugeLeftPane.restrictionByService(b),d=DelugeLeftPane.hideTasksByService(b);a&&a.hasOwnProperty("addTasks")&&(e=DelugeLeftPane.pushTask(a.addTasks,e,a.hasOwnProperty("tasksOrder")));return{restriction:c,hideTasks:d,tasksOrder:e}};
DelugeLeftPane.getAllTasks=function(){var a=[],b;for(b in panelJson)if(panelJson.hasOwnProperty(b)){var c=panelJson[b],d={};if(c&&c.groupName){var e=c.elements,f=[],k;for(k in e)e.hasOwnProperty(k)&&f.push(e[k].displayName||e[k].elemName);d.groupName=c.groupName;d.elements=f;a.push(d)}}return a};
DelugeLeftPane.combineTasks=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];if(e){var f=!1,k;for(k in a)if(a.hasOwnProperty(k)){var r=a[k];e.groupName.toLowerCase()==r.groupName.toLowerCase()&&(e.hasOwnProperty("elements")&&(r.hasOwnProperty("elements")?r.elements=a[k].elements.concat(e.elements):r.elements=e.elements),f=!0)}c&&!f&&a.push(e)}}return a};
DelugeLeftPane.restrictionByService=function(a){var b=[];if("skydesk"==DelugeUtil.getDomain())return[{groupName:"Notifications",elements:["send report","send mail","send sms","push notification"]},{groupName:"Data Within Zoho"},{groupName:"Client Functions"},{groupName:"Condition",elements:["conditional if"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Debug \x26 Branching"},{groupName:"Basic",elements:"share | unshare;send mail;call function;cancel submit;cancel delete;success message;return".split(";")},
{groupName:"Map manipulation"},{groupName:"Xml manipulation"},{groupName:"Integrations",elements:"get url;post url;other integration;open url;encryption;parse XML/JSON".split(";")},{groupName:"Collection",elements:"insertAll;sort value;keys;values;contains key;contains value;clear;is empty;size".split(";")}];switch(a){case "ZohoCreator":break;case "SDPOnDemand":b=[{groupName:"Notifications"},{groupName:"Data Within Zoho"},{groupName:"Client Functions"},{groupName:"Condition",elements:["conditional if"]},
{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Debug \x26 Branching"},{groupName:"Basic",elements:"share | unshare;send mail;call function;cancel submit;cancel delete;success message;return".split(";")},{groupName:"Map manipulation"},{groupName:"Xml manipulation"},{groupName:"Integrations",elements:"get url;post url;other integration;open url;encryption;parse XML/JSON".split(";")},{groupName:"Collection",elements:"insertAll;sort value;keys;values;contains key;contains value;clear;is empty;size".split(";")},
,{groupName:"Web data"}];break;case "ZohoCRM":b=[{groupName:"Notifications",elements:["send report","send sms","push notification","post to chat"]},{groupName:"Data Within Zoho"},{groupName:"Client Functions"},{groupName:"Condition",elements:["conditional if"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Debug \x26 Branching"},{groupName:"Basic",elements:"share | unshare;send mail;call function;cancel submit;cancel delete;success message;return".split(";")},{groupName:"Map manipulation"},
{groupName:"Xml manipulation"},{groupName:"Integrations",elements:["get url","post url","other integration","encryption","parse XML/JSON"]},{groupName:"Collection",elements:"insertAll;sort value;keys;values;contains key;contains value;clear;is empty;size".split(";")},,{groupName:"Web data"}];break;case "tryout":b=[{groupName:"Notifications",elements:["send report","send sms","push notification"]},{groupName:"Data Within Zoho"},{groupName:"Client Functions"},{groupName:"Condition",elements:["conditional if"]},
{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Debug \x26 Branching"},{groupName:"Basic",elements:"share | unshare;send mail;call function;cancel submit;cancel delete;success message;return".split(";")},{groupName:"Map manipulation"},{groupName:"Xml manipulation"},{groupName:"Integrations",elements:"get url;post url;other integration;open url;encryption;parse XML/JSON".split(";")},{groupName:"Collection",elements:["insertAll"]},{groupName:"Web data"}];break;default:b=[{groupName:"Notifications",
elements:["send report","send sms","push notification"]},{groupName:"Data Within Zoho"},{groupName:"Client Functions"},{groupName:"Condition",elements:["conditional if"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Debug \x26 Branching"},{groupName:"Basic",elements:"share | unshare;send mail;call function;cancel submit;cancel delete;success message;return".split(";")},{groupName:"Map manipulation"},{groupName:"Xml manipulation"},{groupName:"Integrations",elements:"get url;post url;other integration;open url;encryption;parse XML/JSON".split(";")},
{groupName:"Collection",elements:"insertAll;sort value;keys;values;contains key;contains value;clear;is empty;size".split(";")},{groupName:"Web data"}]}return b};DelugeLeftPane.getDisplayName=function(a){var b={Basic:{ZohoCreator:"Miscellaneous"}};return b[a]?b[a][DRE.serviceFlags.getServiceName()]||a:a};DelugeLeftPane.hideTasksByService=function(a){switch(a){case "ZohoCreator":a=[{groupName:"Collection",elements:["for_each_collection_element"]}];break;default:a=[{groupName:"Condition",elements:["else if"]}]}return a};
DelugeLeftPane.orderLeftPaneBySerivce=function(a){if(!this.tasksOrder){switch(a){case "ZohoCreator":a="Notifications;Condition;Data access;Client functions;Miscellaneous;Debug;List manipulation;Map manipulation;Collection;Web data;Xml manipulation".split(";");break;default:a="Basic;Condition;Notifications;Data Within Zoho;Client functions;Debug \x26 Branching;Integrations;Collection;Web data;Xml manipulation".split(";")}this.tasksOrder=a}return this.tasksOrder};
DelugeLeftPane.checkForPanelGroup=function(a){for(var b in PANEL_GROUPS)if(PANEL_GROUPS.hasOwnProperty(b)){var c=PANEL_GROUPS[b];if(arrayContains(c,a))return c}return null};
DelugeLeftPane.bindShowHideAction=function(a){var b=a.delugeArea,c=b.querySelector(".deluge-left-pane-wrapper"),d=b.querySelector(".deluge-left-pane"),e=b.querySelector(".deluge-left-pane-hide-btn");c&&(e.addEventListener("click",function(){c&&(e.querySelector(".deluge-show-hide-msg").style.display="none","none"!=d.style.display?DelugeLeftPane.show(a,d,!1):DelugeLeftPane.show(a,d,!0))}),e.querySelector(".deluge-show-hide-icon").addEventListener("mouseover",function(){c.querySelector(".deluge-show-hide-msg").style.display=
"block"}),e.querySelector(".deluge-show-hide-icon").addEventListener("mouseout",function(){c.querySelector(".deluge-show-hide-msg").style.display="none"}),DelugeLeftPane.show(a,d,DelugeEditorUtil.cookie.set("showEditorLeftPane")))};DelugeLeftPane.show=function(a,b,c){c=null==c||"true"==c?!0:c;DelugeEditorUtil.cookie.get("showEditorLeftPane",c);1==c?b&&(b.style.display="block"):b&&(b.style.display="none");a.resize();(a=a.options.customResize)&&a()};var DelugeEditorUtil=function(){function a(a,d,e,f,l){f.getLine(a.line);a=c(a,f);var m=a.lno,g=a.hasOwnProperty("isBlank")?a.isBlank:!1;a={line:m};d=g?d:"\n"+d;d=setIndentation(d,a,f);f.replaceRange(d,a);l||setTimeout(function(){f.refresh();b(m,d,g,f)},0)}function b(a,b,c,d){l.clear(d);var e=b&&!c?b.slice(1):b,f=e.match(PANEL_GROUPS_SEARCH_PATTERN);checkPanelPattern(e,f)?d.setSelection(c?CodeMirror.Pos(a,f.index):CodeMirror.Pos(a+1,f.index),c?CodeMirror.Pos(a,f.index+f[0].length):CodeMirror.Pos(a+
1,f.index+f[0].length)):(f=b.match(/<(.*?)>/))?d.setCursor(c?CodeMirror.Pos(a,f.index+1):CodeMirror.Pos(a+1,f.index)):d.setCursor(c?CodeMirror.Pos(a,0):CodeMirror.Pos(a+1));d.focus()}function c(a,b){var c=a.line,d=b.getLine(c),e=0;d&&(d=rightTrim(d),e=d.length);b.getTokenAt(CodeMirror.Pos(a.line,e));if(/^[\s\n]*$/.test(d))return{lno:c,isBlank:!0};0!=c&&--c;return{lno:c}}function d(){var a=document.createElement("div");a.className="deluge-drag-marker";a.innerHTML="\x3e";return a}function e(a,b,c){c=
c.left-b.left;c+a.offsetWidth>b.right-b.left?(a.style.right="10px",a.style.left="auto"):(a.style.left=c+"px",a.style.right="auto")}function f(a,b,c,d){var e=a.getCursor();var f=a.getTokenAt(c);c=[];for(c.push(b);null!=f.type&&0<=f.start;)b=0==f.string.indexOf(".")?f.string.slice(1):f.string,c.push(b),f=a.getTokenAt({line:e.line,ch:f.start});e=f;b=a.getCursor();if(functionDetails=DelugeBuiltInFunction.getAppliedFunctionDetails(c))d=null!=d?a.charCoords({line:b.line,ch:e.start}):null,r.show(functionDetails,
d,a.getContainerDetails())}var k=function(){var a=null;return{create:function(b,c,d,f,m,g){if(!c||"()"===c||"("==c)return null;var l=c.slice(1,-1).split(",");c=document.createElement("p");c.appendChild(document.createTextNode("( "));for(var t=0;l&&t<l.length;t++){if(t===d.toString()){var q=document.createElement("b");q.appendChild(document.createTextNode(l[t]));c.appendChild(q)}else c.appendChild(document.createTextNode(l[t]));c.appendChild(document.createTextNode(", "))}c.removeChild(c.childNodes[c.childNodes.length-
1]);c.appendChild(document.createTextNode(" )"));d=document.createElement("div");d.className="argTooltip deluge-cm-script";d.appendChild(c);d.style.left="0px";m.elem.appendChild(d);c=b.top-m.top;d.style.top=c+"px";e(d,m,b);d.style.top=c-d.offsetHeight-11+"px";d.style.display="none";d.className+=" argTooltip-anim";d.style.display="block";d.style.opacity=1;g.state.argumentTooltip=f;a=d},remove:function(){a&&(a.style.opacity=0,a.parentNode.removeChild(a),a=null)}}}(),r=new function(){var a=this;this.show=
function(b,c,d,f){a.argPos=f;a.shown=!1;(f=document.getElementById("delugeFunctionDef"))&&f.parentElement.removeChild(f);f=document.createElement("div");f.setAttribute("id","delugeFunctionDef");f.setAttribute("class","deluge-function-def");var m="object";b.returnType&&(m=b.returnType.toLowerCase());var g=b.args,l="";if(g&&0<g.length)for(var t in g)if(g.hasOwnProperty(t)){var q=g[t],k=q.mandatory;l=l+'\x3cspan class\x3d"fd-data-type"\x3e'+q.dataType.toLowerCase()+"\x3c/span\x3e ";l+=q.name;k||(l+=
'\x3cspan class\x3d"fd-optional deluge-cm-script"\x3eoptional\x3c/span\x3e');l+=",\x3cbr/\x3e"}g=t="";b.deprecated&&(t='\x3cspan class\x3d"fd-deprecated"\x3e Deprecated \x3c/span\x3e');"void"!==m&&(g='\x3cdiv class\x3d"fd-return-type"\x3e\x3cspan class\x3d"fd-dtitle"\x3eReturns: \x3c/span\x3e'+m+"\x3c/div\x3e");m='\x3cdiv class\x3d"fd-header"\x3e\x3cdiv class\x3d"fd-title"\x3e'+b.functionName+t+"\x3c/div\x3e"+g+'\x3cdiv class\x3d"fd-close"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"fd-details"\x3e';
0<l.length&&(m=m+'\x3cdiv class\x3d"fd-params"\x3e\x3cspan class\x3d"fd-dtitle"\x3eParams: \x3c/span\x3e\x3cbr/\x3e'+l.substring(0,l.length-6)+"\x3c/div\x3e");b.description&&(m=m+'\x3cdiv class\x3d"fd-description"\x3e'+b.description+"\x3c/div\x3e");b.example&&(m=m+'\x3cdiv class\x3d"fd-example"\x3e\x3cdiv class\x3d"fd-title"\x3eExample:\x3c/div\x3e\x3cdiv class\x3d"fd-script deluge-cm-script"\x3e'+b.example+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");f.innerHTML=m;c?(f.style.left="0px",editorTop=d.top,
"fixed"!=d.elem.style.position&&(editorTop=0),f.style.top=c.top-editorTop-window.scrollY+20+"px"):f.className+=" deluge-function-def-fr";a.shown=!0;f.querySelector(".fd-header .fd-close").addEventListener("click",function(b){a.close();b.stopPropagation()});d.elem.appendChild(f);b=f.getBoundingClientRect();c||(l=d.elem.querySelector(".deluge-editor-container").getBoundingClientRect(),f.style.left=l.left+l.width-b.width-50+"px",f.style.top=l.top+l.height-b.height-40+"px",f.style.bottom="auto");c&&e(f,
d,c);document.addEventListener("keydown.closeFunctionDefinition",function(b){27==b.keyCode&&(a.close(),document.removeEventListener("closeFunctionDefinition"))})};this.close=function(){var b=document.getElementById("delugeFunctionDef");b&&(a.shown=!1,a.argPos=null,b.className+=" deluge-function-def-close",setTimeout(function(){b.parentElement.removeChild(b)},120))};this.closeOnBlur=function(b){a.shown&&a.argPos&&(b.line!=a.argPos.line||b.ch<a.argPos.start||b.ch>a.argPos.end+1)&&a.close()}},A=function(){function b(a){var b=
getPanelElementDetails(a);a="";var c=!1;null==document.getElementById("delugeSuggestionArea")&&(a='\x3cdiv id\x3d"delugeSuggestionArea" class\x3d"deluge-suggestionArea"\x3e\x3cdiv class\x3d"deluge-suggestion-txt"\x3eSuggestion : \x3c/div\x3e',c=!0);if(b&&(b=b.related,"undefined"!==typeof b)){a+='\x3cdiv class\x3d"deluge-suggestion-elem"\x3e';for(var d in b)b.hasOwnProperty(d)&&(a=a+'\x3cdiv class\x3d""\x3e'+b[d]+"\x3c/div\x3e");a+="\x3c/div\x3e";c&&(a+="\x3c/div\x3e");return a}return null}return{show:function(a){if(a.state.suggestionSet){var b=
document.getElementById("delugeSuggestionArea");b.className="deluge-suggestionArea";b.querySelector(".deluge-suggestion-txt").style.display="none";setTimeout(function(){b.className+=" deluge-suggestionAnim"},200)}},close:function(){var a=document.getElementById("delugeSuggestionArea");a&&(a.className="deluge-suggestionArea")},displaySuggestionArea:function(c,d,e,f){var m=b(c);if(null!=m){c=function(){var a=getPanelElementDetails(this.innerHTML);if(a.hasOwnProperty("example")){var b=document.createElement("div");
b.setAttribute("class","deluge-suggestion-example");var c=generateElt("div","deluge-fn-desc",a.description);b.appendChild(c);c=generateElt("div","deluge-fn-example-div");var d=generateElt("div","deluge-fn-example-title","Example : ");c.appendChild(d);a=generateElt("div","deluge-fn-example",a.example);c.appendChild(a);b.appendChild(c)}else b=null;a=document.querySelector(".deluge-suggestion-example");null!=b?a?(c=a.parentNode,c.removeChild(a),c.appendChild(b)):this.parentNode.appendChild(b):a.parentElement.removeChild(a)};
var g=document.createElement("div");g.innerHTML=m;if(null==document.getElementById("delugeSuggestionArea"))document.getElementById("main").appendChild(g.querySelector(".deluge-suggestionArea"));else{m=document.getElementById("delugeSuggestionArea");m.className="deluge-suggestionArea";var l=m.querySelector(".deluge-suggestion-elem");l.parentNode.removeChild(l);m.appendChild(g.querySelector(".deluge-suggestion-elem"))}g=document.getElementById("delugeSuggestionArea");g.removeEventListener("mouseover",
c);g.querySelector(".deluge-suggestion-elem div").addEventListener("mouseover",c);g.querySelector(".deluge-suggestion-elem div").addEventListener("dblclick click",function(){var b=this.textContent;b=getPanelDetails(f.getPanelMap(),b);var c=f.getCursor();f.getLine(c.line);a(c,b)});m=f.cursorCoords(null!==d?CodeMirror.Pos(d+e,0):null);c=m.left;m=m.bottom;l=getParentEditorDiv();c=c-l.left+40;m-=l.top;f.state.suggestionSet={ready:!0,line:d+e};g.style.left=c+"px";g.style.top=m+"px"}else m=document.getElementById("delugeSuggestionArea"),
null!=m&&m.parentNode.removeChild(m)}}}(),p={},l={create:function(a,b){b.setGutterMarker(a,GUTTER_DELUGE_MARKER,d())},clear:function(a){a.clearGutter(GUTTER_DELUGE_MARKER)}};return{tooltip:k,suggestions:A,functionDefinition:r,switchArgs:function(a,b){DelugeEditorUtil.tooltip.remove();var c=a.getCursor(),d=c.line,e=c.ch;c=a.getLine(d);c=getFunctionArgumentBlock(c,e);if(null!==c){var f=a.getTokenAt(CodeMirror.Pos(d,c.lpos-1)).string,g="."!==f[0]?!0:!1;"."===f[0]&&f.slice(1);f=a.getTokenAt({line:d,ch:c.lpos});
f=DelugeBuiltInFunction.getFunctionDefinitionByToken(f,g,a);g="";f&&(g=f.argTooltip);var m=a.getRange({line:d,ch:c.lpos},{line:d,ch:c.rpos+1}).slice(1,-1).split(COMMA_SEPARATOR_PATTERN);f=[];for(var l=c.lpos,t=0,k=0;m&&k<m.length;k++){var p=m[k].length,n=l+1,r=l+p+1;e>=n&&e<=r&&(t=parseInt(k));f.push({start:n,end:r});l=l+p+1}e=t+1;m=t-1;e>=f.length&&(e=0);-1>=m&&(m=f.length-1);c.lno=d;b="undefined"!==b?b?e:m:t;e=CodeMirror.Pos(d,f[b].start);f=CodeMirror.Pos(d,f[b].end);a.getRange(e,f);a.setSelection(f,
e);d=a.charCoords({line:d,ch:c.lpos});DelugeEditorUtil.tooltip.createToolTip(d,g,b,c,a);return!0}return!1},peg_start:function(a,b,c){if(p.node&&p.node!==a||!p.node){try{p.node=a;var d=Parser.parse(a,{startRule:"defineVar"})}catch(H){p.node=a}a=PegUtil.init(d,b,c);return p.returnType=a}return p.returnType},delugeMarker:l,dropCode:a,insertCode:function(a,b){var c=a.getCursor();a.replaceRange(b,c)},setCursorAfterDrop:b,validateCodeDrop:c,showFunctionDefinition:function(a,b){var c=a.getCursor(),d=a.getTokenAt(c);
b=0==d.string.indexOf(".")?d.string.slice(1):d.string;var e=a.getTokenAt({line:c.line,ch:d.start-1}),l=DelugeBuiltInFunction.getFunctionDetailsByName(b);l&&(e&&-1==e.string.indexOf(".")||!e)?(b=a.charCoords({line:c.line,ch:d.start}),r.show(l,b,a.getContainerDetails())):f(a,b,{line:c.line,ch:d.start-1},!0)},showFunctionDefinitionByFunctionName:function(a,b,c){if(b){var d=DelugeBuiltInFunction.getFunctionDetailsByName(b);if(d)r.show(d,null,a.getContainerDetails(),c);else{c=a.getCursor();for(d=a.getTokenAt(c);d.string.substring(1,
d.string.length)!=b&&0<d.start;)d=a.getTokenAt({line:c.line,ch:d.start-1});f(a,b,{line:c.line,ch:d.start-1})}}},showCustomFunctionDefinition:function(a,b){r.show(b,null,a.getContainerDetails())},resizeEditor:function(a){a||(a=document.getElementById("delugeEditorArea"));var b=a,c=b.querySelector(".deluge-left-pane"),d=0,e=b.querySelector(".deluge-editor-container"),f=b.querySelector(".codemirror-div");a=b.querySelector(".CodeMirror-scroll");var g=b.querySelector(".deluge-editor-footer"),l=b.querySelector(".deluge-expr-layered-builder"),
m=0;c&&0<c.offsetWidth&&0<c.offsetHeight?(d=c.offsetWidth,e.style.marginLeft="auto"):e.style.marginLeft="0px";l&&0<l.offsetWidth&&(m=l.offsetWidth);e.style.width=Math.floor(b.clientWidth-d-m)+"px";d=Math.floor(b.clientHeight);(b=b.querySelector("#dreTopBar"))&&(d-=b.clientHeight);--d;c&&(c.style.height=d+"px");g&&(d=Math.floor(d-g.offsetHeight));c=parseInt(window.getComputedStyle(e).borderTopWidth);d-=c;e.style.height=d+"px";e=parseInt(window.getComputedStyle(f).borderTopWidth);d-=e;f.style.height=
d+"px";f=parseInt(window.getComputedStyle(a).borderTopWidth);a.style.height=Math.floor(d-f-5)+"px"},addToActionTool:function(a,b){var c=a.querySelector(".deluge-action-tools");c||(c=DelugeUtil.getDivElement("","deluge-action-tools"),a.appendChild(c));c.appendChild(b)},cookie:{set:function(a,b,c){var d=new Date;c?d.setTime(d.getTime()+864E5*c):d.setTime(d.getTime()+31536E6);document.cookie=a+"\x3d"+b+"; expires\x3d"+d+";path\x3d/"},get:function(a){if(0<document.cookie.length){var b=document.cookie.indexOf(a+
"\x3d");if(-1<b)return b+=a.length+1,a=document.cookie.indexOf(";",b),-1==a&&(a=document.cookie.length),b=document.cookie.substring(b,a)}return null}},isRestrictedParam:function(a,b){var c=[];a=a.metadata.serviceName;switch(b){case "connections":case "userAccess":c=["ZohoChat"]}return 0<c.length&&arrayContains(c,a)?!0:!1},encodeForHtml:function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26apos;")}}}();var DelugeBuiltInFunction={getFunctionDetailsByName:function(a,b){a=a.toLowerCase();if(null!==this.json)for(var c in this.json)if(this.json.hasOwnProperty(c)&&null!==this.json[c]){var d=this.json[c];if(!b||arrayContains(d.appliedType,b))for(var e=0;d.functions&&e<d.functions.length;e++){var f=d.functions[e];if(f.hasOwnProperty("functionName")&&a===f.functionName.toLowerCase())return f}}return null},searchForFunctionName:function(a,b){var c=[];b=b.map(function(a){return DelugeUtil.getDelugeDataType(a)});
a=a.toLowerCase();if(null!==this.json)for(var d in this.json)if(this.json.hasOwnProperty(d)&&null!==this.json[d]){var e=this.json[d],f=DelugeUtil.intersect(b,e.appliedType);if(f&&0<f.length)for(f=0;e.functions&&f<e.functions.length;f++){var k=e.functions[f];k.hasOwnProperty("functionName")&&-1<k.functionName.toLowerCase().indexOf(a)&&c.push(k)}}return c},getFunctionSignature:function(a){return(a=this.getFunctionDetailsByName(a))?a.functionName+a.definition:null},getAppliedFunctionDetails:function(a){if(a&&
0<a.length)return a=a.reverse().join("."),this.getFunctionDetailsFromAppliedTypes(a)},getPackageFunctions:function(){return this.getFunctionsByAppliedTypes(["PACKAGE"])},getConstantFunctions:function(a){return this.getFunctionsByAppliedTypes(["constants"],null,a)},getAggregateFunctions:function(){return this.getFunctionsByAppliedTypes(["NView"])},getServiceDetailsFromName:function(a){var b=this.getFunctionsByAppliedTypes(["PACKAGE"]),c=0;if(b)for(;c<a.length;){if(a[c]&&arrayContains(Object.keys(b),
a[c])&&(b=b[a[c]],!a.hasOwnProperty(c+1)&&!a[c+1]))return b;c++}return null},getFunctionDetailsFromAppliedTypes:function(a){var b=this.getFunctionsByAppliedTypes(["PACKAGE"]),c=a.split("."),d=0;if(b)for(;d<c.length;){if(c[d]&&arrayContains(Object.keys(b),c[d])&&(b=b[c[d]])&&b.hasOwnProperty("functionName")&&b.functionName==a)return b;d++}return null},getFunctionsByAppliedTypes:function(a,b,c){function d(a,b,c){return c&&null!=b&&a.length>b?a.slice(0,b):a}if(this.json)for(var e=0;a&&e<a.length;e++){c=
a[e];c=this.myDelugeDataType(c);c=DelugeUtil.getDelugeDataType(c);var f=0;for(var k in this.json)if(this.json.hasOwnProperty(k)&&null!==this.json[k]){var r=this.json[k],A=null==b||null!=b&&f<b;if(null!==arrayContains(r.appliedType,c)||"object"==c)var p=void 0===p?d(r.functions,b,A):p.concat(d(r.functions,b,A));f++}}else this.hasOwnProperty("loadBuiltInFunctions")&&this.loadBuiltInFunctions&&this.loadBuiltInFunctions(c);DelugeUtil.sortList(p,"functionName");return p},getFunctionReturnType:function(a){return null!==
a&&(a=this.getFunctionDetailsByName(a),null!==a&&a.hasOwnProperty("returnType"))?a.returnType.toLowerCase():null},getBuiltInFunctionRT:function(a,b){var c=this.json;a=this.myDelugeDataType(a);if(c){var d=0;for(c=c.length;d<c;d++){var e=this.json[d];if(arrayContains(e.appliedType,a)||arrayContains(e.appliedType,"STATIC")){e=e.functions;for(var f=0,k=e.length;f<k;f++){var r=e[f];if(r.functionName.toLowerCase()===b.toLowerCase())return r.hasOwnProperty("returnType")?r.returnType:null}}}}return null},
getBuiltInFunctions:function(a,b){b=b.toLowerCase();var c=[],d=this.json;a=this.myDelugeDataType(a);for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];if(arrayContains(f.appliedType,a)){f=f.functions;for(var k=0;f&&k<f.length;k++){var r=f[k];r.returnType&&r.returnType.toLowerCase()===b&&c.push(r)}}}return c},getFunctionDefinitionByToken:function(a,b,c){var d=c.metadata;a=getNameSpace(a,c);if(c=d.isUserDefinedFunction(a,c.execCompletion))return c.hasOwnProperty("tooltipDefinition")?c.tooltipDefinition:
"";c=a.split(".");if(3===c.length&&(d=this.getPackageFunctions(),d.hasOwnProperty(c[0])&&(d=d[c[0]],d.hasOwnProperty(c[1])&&(d=d[c[1]],d.hasOwnProperty(c[2])))))return d[c[2]];c=c[c.length-1].toLowerCase();for(d=0;this.json&&d<this.json.length;d++)if(a=this.json[d].appliedType,a=this.myDelugeDataType(a[0]),"STATIC"===a?b:!b){a=this.json[d].functions;for(var e=0;a&&e<a.length;e++){var f=a[e];if(f.hasOwnProperty("functionName")&&c===f.functionName.toLowerCase())return f}}return null},getArgumentsTooltip:function(a,
b,c){b=DelugeBuiltInFunction.getFunctionDefinitionByToken(a,b,c);a="(";if(b&&(b=b.args)){for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],f=e.name,k=e.dataType,r=e.restricted;"connections"==f&&(r=!0);if(!r||r&&!DelugeEditorUtil.isRestrictedParam(c,f))e.mandatory||(a+="? "),a+=k+" "+f+", "}a=a.substring(0,a.length-2);a+=")"}return a},myDelugeDataType:function(a){if(DRE.serviceFlags.isIntegration()){a=a?a.toLowerCase():a;var b={datetime:"date-time",string:"text",bigint:"number",decimal:"number",constants:"constants",
list:"list",map:"key-value",collection:"collection"};a=b.hasOwnProperty(a)?b[a]:a}return a},updateCRMModules:function(a){var b=this.getFunctionsGroup("zoho.crm"),c;for(c in b)if(b.hasOwnProperty(c)&&-1==c.indexOf("_")){var d=b[c].args,e;for(e in d)d.hasOwnProperty(e)&&"module"==d[e].name.toLowerCase()&&(d[e].module=a)}},updateCustomModules:function(a,b){a="zoho."+a.toLowerCase();a=this.getFunctionsGroup(a);for(var c in a)if(a.hasOwnProperty(c)&&-1==c.indexOf("_")){var d=a[c].args,e;for(e in d)d.hasOwnProperty(e)&&
"module"==d[e].name.toLowerCase()&&(d[e].module=b)}},getIntegrationFunctions:function(a,b,c){var d=DelugeBuiltInFunction.getPackageFunctions(),e=0;if(d){for(var f=d;e<a.length;){if((f=DelugeCommonUtil.getFromMap(f,a[e]))&&!f.hasOwnProperty("functionName")){d={};c=DelugeCommonUtil.getFromMap(c,a[e])||[];for(var k in f)if(DelugeCommonUtil.getFromMap(f,k)){var r=!0;0==e&&(r=DelugeCommonUtil.getFromMap(b,a[e]),r=0==r.length?!0:DelugeCommonUtil.arrayContains(r,k)?!0:!1);var A=!1;if(Array.isArray(c)&&0<
c.length)A=DelugeCommonUtil.arrayContains(c,k)?!0:!1;else if(!Array.isArray(c)&&"object"==typeof c){var p=DelugeCommonUtil.getFromMap(c,k);p&&0==this.getMapLength(p)&&(A=!0)}r&&!A&&(d[k]=f[k])}f=d}else return null;e++}return f}return null},getFunctionsGroup:function(a){if(a){a=a.split(".");var b=this.getFunctionsByAppliedTypes(["PACKAGE"]);if(b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.hasOwnProperty(d)&&(b=b[d])}return b}}return null},getMeta:function(){return this.json},getMapLength:function(a){var b=
0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},forIn:function(a,b){for(var c in a)a.hasOwnProperty(c)&&!a[c].hasOwnProperty("functionName")&&this.forIn(a[c],b),a[c].hasOwnProperty("deprecated")&&a[c].deprecated&&b.push(a[c].functionName)},getDeprecatedFunctions:function(){var a=this.getFunctionsByAppliedTypes(["PACKAGE"]),b=[],c;for(c in a)a.hasOwnProperty(c)&&this.forIn(a[c],b);return b},getBuiltInFunctionsCategories:function(){var a=this.getMeta(),b=[],c;for(c in a){var d=a[c].appliedType[0];
!arrayContains(b,d)&&b.push(d)}return b},add:function(a,b){var c=this.getFunctionsByAppliedTypes([a]);if(c)for(var d in b){if(b.hasOwnProperty(d)){var e=b[d];(isExists=this.getFunctionDetailsByName(e.functionName,a))||c.functions.push(e)}}else this.json.push({appliedType:[a],functions:b})}};var DelugeMeta=function(a,b){var c=this;this.delugeAppLinkName=this.delugeFormLinkName="";this.delugeSubForms={};this.delugeSubformFieldLinkName="";this.appCache={};this.serviceName=this.currentDelugeFieldId="";this.delugeFunctionArgs=[];this.parent=a;this.hintFieldRestriction=[];this.hintRestrictionMap=["row","old","thisapp"];this.connections=[];this.subformAutocomplete=!1;this.getDelugeFormLinkName=function(){return this.delugeFormLinkName};this.setDelugeFormLinkName=function(a){this.delugeFormLinkName=
a};this.setHintFieldRestriction=function(a){this.hintFieldRestriction=a};this.getDelugeAppLinkName=function(){return this.delugeAppLinkName};this.setDelugeAppLinkName=function(a){this.delugeAppLinkName=a};this.setCurrentDelugeFieldId=function(a){this.currentDelugeFieldId=a};this.getCurrentDelugeFieldId=function(){return this.currentDelugeFieldId};this.setDelugeSubFormFieldLinkName=function(a){this.delugeSubformFieldLinkName=a};this.getDelugeSubFormFieldLinkName=function(){return this.delugeSubformFieldLinkName};
this.getDelugeSubForm=function(a){return a?this.delugeSubForms[a]:(a=this.getDelugeSubFormFieldLinkName())?this.getFormFieldDetails(a).refFormLinkName:null};this.getDelugeSubFormDetails=function(){var a=this.getDelugeSubFormFieldLinkName();return a?this.getFormFieldDetails(a):null};this.addDelugeSubForm=function(a,b){this.delugeSubForms[a]=b};this.setDelugeServiceName=function(a){this.serviceName=a};this.getDelugeServiceName=function(){return this.serviceName};this.setHintRestrictionMap=function(a){this.hintRestrictionMap=
a};this.getHintRestrictionMap=function(){return this.hintRestrictionMap};this.setSubformAutocompleteStatus=function(a){this.subformAutocomplete=a};this.getSubformAutocompleteStatus=function(){return this.subformAutocomplete};(function(a){a&&(a.hasOwnProperty("integrationTasks")&&c.integrationTasks.setConfig(a.integrationTasks),a.hasOwnProperty("systemFields")&&c.systemFields.setConfig(a.systemFields))})(b)};
DelugeMeta.prototype.getConnections=function(a){var b=this.connections;b&&0<b.length||fetchConnectionNames&&fetchConnectionNames(this,a);return b};
DelugeMeta.prototype.systemFields=function(){var a=!1,b=[];return{restrict:function(c){var d=[];if(a)return null;for(var e in c)if(c.hasOwnProperty(e)){var f=c[e],k=f.name.split(".")[1].toLowerCase();DelugeCommonUtil.arrayContains(b,k)||d.push({name:k,dType:f.type})}return d},setConfig:function(a){b=a&&a.restrictions||null},setRestrictions:function(a){b=b&&b.concat(a)||a},setHideAll:function(b){a=b},isHideAll:function(){return a}}}();
DelugeMeta.prototype.integrationTasks=function(){function a(){return{zoho:d}}function b(){return e}function c(a,b){function d(a,b){for(var c in a)a.hasOwnProperty(c)&&-1==b.indexOf(a[c])&&b.push(a[c]);return b}function f(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]={})}var k;b=b||JSON.parse(JSON.stringify(e));for(var q in a){var p=DelugeCommonUtil.getFromMap(a,q);p&&((k=DelugeCommonUtil.getFromMap(b,q))?Array.isArray(k)&&Array.isArray(p)?b[q]=d(p,k):Array.isArray(k)&&"object"==typeof p?(b[q]=
p,f(k,b[q])):Array.isArray(p)&&"object"==typeof k?f(p,k):c(p,k):b[q]=p)}return b}var d=[],e={},f={},k={},r=!1;return{getAllowedServices:function(){return f},getRestrictedTasks:function(){return k},handleRestrictions:function(a){k=c(a)},setConfig:function(r){d=r.defaultZohoServices;e=r.defaultTaskRestrictions;b=r.getDomainBasedTasksRestrictions;a=r.getDomainBasedZohoServices;getDomainBasedExternalServices=r.getDomainBasedExternalServices;r=a();var p=getDomainBasedExternalServices();f=Object.assign({},
r,p);r=b();k=r==e?e:c(r)},setHideAll:function(a){r=a},isHideAll:function(){return r}}}();DelugeMeta.prototype.allowedIntegServices={};DelugeMeta.prototype.allowedIntegServices.get=function(a){switch(a){case "skydesk":return{zoho:"calendar reports creator projects mail support crm chat".split(" ")}}return{zoho:"encryption people books subscriptions crm sdp calendar reports mail creator recruit invoice support projects cliq connect".split(" ")}};
DelugeMeta.prototype.allowedIntegServices.getActionExceptions=function(a){return{crm:["_businessCardView","_slashCommands"],cliq:["postToChatAsAdmin","postToChannelAsAdmin"],chat:["postToChatAsAdmin","postToChannelAsAdmin"],connect:["addStream"]}[a]};DelugeMeta.prototype.isDREService=function(){return"DRE"==(this.service||"creator")?!0:!1};DelugeMeta.prototype.getAppMeta=function(){return"undefined"!==typeof this.appCache?this.isDREService()?this.appCache.services:this.appCache.apps:null};
DelugeMeta.prototype.isFormfield=function(a,b){b=this.getFormfieldsByFormname(b);for(var c in b)if(b.hasOwnProperty(c)&&c===a)return b[c].hasOwnProperty("refFormLinkName")?b[c].refFormLinkName:b[c].type||"object";return null};DelugeMeta.prototype.isFormfieldObj=function(a,b){b=this.getFormfieldsByFormname(b);for(var c in b)if(b.hasOwnProperty(c)&&c===a)return b[c];return null};
DelugeMeta.prototype.getFormFieldDetails=function(a,b,c){b=this.getFormfieldsByFormname(b);for(var d in b)if(b.hasOwnProperty(d)&&d===a)return b[d];return null};DelugeMeta.prototype.isSystemField=function(a){"undefined"!==typeof a&&(a=a.toLowerCase());var b=this.getFormfields(),c;for(c in b)if(b.hasOwnProperty(c)&&c.toLowerCase()===a)return b[c].isSystemField;return null};
DelugeMeta.prototype.checkForServices=function(a){return(a=a&&a.split(".").filter(function(a){return""!=a}))&&a[0]&&a[1]?this.getFormsAndFieldsByServices(a[0],a[1]):!1};DelugeMeta.prototype.getFormfields=function(){var a=this.getAppMeta(),b=this.getDelugeFormLinkName(),c=this.getDelugeAppLinkName();return c&&a&&a[c].forms.hasOwnProperty(b)&&(a=a[c].forms[b],a.hasOwnProperty("fields"))?a.fields:null};
DelugeMeta.prototype.getFormfieldsByFormname=function(a,b){var c=this.checkForServices(a);if(c)if(b&&"undefined"!==typeof b)b.call();else return c;a=a?a:this.getDelugeFormLinkName();c=this.getAppMeta();var d=this.getDelugeAppLinkName();if(d&&c&&c[d]&&c[d].forms&&c[d].forms.hasOwnProperty(a)){c=c[d].forms[a];if(c.hasOwnProperty("fields"))return c.fields;this.fetchFormFields?this.fetchFormFields(a,b):this.parent.fetchFormFields(a,b)}else this.fetchFormFields&&this.fetchFormFields(a,b);return null};
DelugeMeta.prototype.getGroupedFormFields=function(a,b,c,d){return(a=this.getFormfieldsByFormname(a,b,c))?this.filterFormFields(a,c,d):null};DelugeMeta.prototype.filterFormFields=function(a,b,c){var d=[],e=[];b=null!=b?b:!0;var f;for(f in a){var k=a[f];var r="MULTI_SELECT"==k.componentType&&!k.isSubform;if(c&&(!arrayContains(c,k.componentType)||r)||!c)k.linkName=f,k.isSystemField?b&&e.push(k):d.push(k)}DelugeUtil.sortList(d,"linkName");DelugeUtil.sortList(e,"linkName");return d=d.concat(e)};
DelugeMeta.prototype.getGroupedFormFieldsWholeApp=function(a,b){if(this.hasOwnProperty("appCache")&&this.appCache.apps.hasOwnProperty(a)&&this.appCache.apps[a].hasOwnProperty("forms")&&this.appCache.apps[a].forms.hasOwnProperty(b)){a=this.appCache.apps[a].forms[b].fields;b=[];var c=[],d;for(d in a){var e=a[d];e.linkName=d;e.isSystemField?c.push(e):b.push(e)}return b=b.concat(c)}return null};DelugeMeta.prototype.getAppList=function(){var a=this.getAppMeta();return a&&Object.keys(a)};
DelugeMeta.prototype.getCurrentAppMeta=function(){var a=this.getAppMeta(),b=this.getDelugeAppLinkName();return b&&a&&a.hasOwnProperty(b)?a[b]:null};DelugeMeta.prototype.hasForm=function(a,b){var c=this.getAppMeta();return c&&c.hasOwnProperty(a)&&c[a]&&c[a].hasOwnProperty("forms")&&c[a].forms.hasOwnProperty(b)?!0:!1};
DelugeMeta.prototype.getFormNames=function(){var a=this.getCurrentAppMeta();if(null!==a){var b=[];a=a.forms;for(var c in a)if(a.hasOwnProperty(c)&&null!=a[c]){var d=a[c];d&&!d.isStateless&&b.push(c)}return b}return null};DelugeMeta.prototype.getConnectionNames=function(){return this.appCache&&this.appCache.connections?this.appCache.connections:null};
DelugeMeta.prototype.getFormfieldReturnType=function(a,b){var c=this,d=this.getDelugeAppLinkName(),e=this.getAppMeta();if(a&&"input"==a.toLowerCase()||!a)a=this.getDelugeFormLinkName();if(a&&-1!==a.indexOf(".")){var f=a.split(".");1<f.length&&(d=f[0],a=f[1])}if(d&&e&&e[d]&&e[d].forms&&e[d].forms.hasOwnProperty(a))if(d=e[d].forms[a],d.hasOwnProperty("fields")){if(d.fields.hasOwnProperty(b))return d.fields[b].isLookup||d.fields[b].isSubform?d.fields[b].hasOwnProperty("refFormLinkName")&&d.fields[b].refFormLinkName:
d.fields[b].hasOwnProperty("type")&&d.fields[b].type}else callbackFunc=function(){c.getFormfieldReturnType(a,b)},this.fetchFormFields?this.fetchFormFields(a,callbackFunc):this.parent.fetchFormFields(a,callbackFunc);return null};DelugeMeta.prototype.getMandatoryFields=function(a){var b=[],c=this.getAppMeta(),d=this.getDelugeAppLinkName();if(d&&c&&c[d].forms.hasOwnProperty(a)){a=c[d].forms[a].fields;for(field in a)a.hasOwnProperty(field)&&a[field].isMandatory&&b.push(field);return b}return null};
DelugeMeta.prototype.getFormNameFromVariable=function(a,b){for(;b;b=b.next)if(b.name===a&&("nview"===b.dType.toLowerCase()||"subform"===b.dType.toLowerCase()))return b.formName;b=this.getFormNames();var c=a&&a.split(".").filter(function(a){return""!=a})||null;return arrayContains(b,a)||c?a:null};
DelugeMeta.prototype.getUserDefinedFunctionsList=function(a,b){var c=this.getAppMeta();if((a=a||this.getDelugeAppLinkName())&&c&&c[a]&&c[a].hasOwnProperty("functions"))return c[a].functions;this.loadUserDefinedFunctions?this.loadUserDefinedFunctions(a,"",null,b):this.parent.loadUserDefinedFunctions&&this.parent.loadUserDefinedFunctions(a,"",null,b);return null};
DelugeMeta.prototype.getUserDefinedFunctions=function(a,b,c,d){var e=this.getUserDefinedFunctionsList(a,d);b=null===b||"undefined"===typeof b||"default"===b||"default namespace"==b?"":b;if(e)for(var f=0,k=e.length;f<k;f++)if(e[f].nameSpace===b){if(e[f].hasOwnProperty("functions")){if("undefined"!==typeof c)for(a=e[f].functions,b=0,d=a.length;b<d;b++)if(a[b].functionName===c)return a[b];return e[f].functions}this.loadUserDefinedFunctions?this.loadUserDefinedFunctions(a,b,null,d):this.parent.loadUserDefinedFunctions(a,
b,null,d)}return null};DelugeMeta.prototype.getFunctionSignature=function(a,b,c){var d=this.getUserDefinedFunctions(a,b,c),e=null;d&&(a=a&&a!=this.getDelugeAppLinkName()?a:"thisapp",e=a+("default"==b||""==b?"":"."+b)+"."+c+d.definition);return e};DelugeMeta.prototype.getFunctionNames=function(a){var b=null;if(a&&0<=a.length){b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c].functionName)}return b};
DelugeMeta.prototype.searchFunctions=function(a,b){function c(a){a.namespace=r;return a}b=[];this.getDelugeAppLinkName();var d=this.getUserDefinedFunctionsList();a=a.toLowerCase();for(var e in d)if(d.hasOwnProperty(e)){var f=d[e],k=f.functions,r=f.nameSpace;if(k)if(-1<r.toLowerCase().indexOf(a))tempFunctions=k.map(c),b=b.concat(tempFunctions);else if(0<k.length)for(var A in k)k.hasOwnProperty(A)&&(f=k[A],-1<f.functionName.toLowerCase().indexOf(a)&&(f.namespace=r,b.push(f)))}return b};
DelugeMeta.prototype.getUserDefinedNameSpaces=function(a,b){a=this.getUserDefinedFunctionsList(a,b);b=null;if(a){b=[];for(var c=0,d=a.length;c<d;c++)""!==a[c].nameSpace&&b.push(a[c].nameSpace)}return b};DelugeMeta.prototype.getGlobalKeywords=function(a){var b=GLOBAL_KEYWORDS;"noapps"!=a&&(b=(a=this.getAppList())?b.concat(a):b);return b};DelugeMeta.prototype.getDelugeKeywords=function(a,b){b=getPanelKeywords(b);a=this.getGlobalKeywords(a);return b.concat(a)};
DelugeMeta.prototype.updateUserDefinedFunctions=function(a,b,c){if(this.getAppMeta().hasOwnProperty(a))if(a=appCache.apps[a],a.hasOwnProperty("functions")){a=a.functions;for(var d=0,e=a.length;d<e;d++)if(a[d].nameSpace===b){a[d].hasOwnProperty("functions")?a[d].functions.concat(c):a[d].functions=c;return}a.push({nameSpace:b,functions:c})}else a.functions=c};
DelugeMeta.prototype.isUserDefinedFunction=function(a,b){var c=this.getAppList(),d=a.split("."),e=a.indexOf("."),f=a&&-1!==e?d[0]:"";return c&&f&&("thisapp"===f||c&&-1!==c.indexOf(f))?(c="thisapp"===f?this.getDelugeAppLinkName():f,d=d[d.length-1],f=a.lastIndexOf("."),a=a.slice(e+1,f),this.getUserDefinedFunctions(c,a,d,b)):!1};
DelugeMeta.prototype.getFormsAndFieldsByServices=function(a,b){a=a||this.getDelugeAppLinkName();var c=[];b=b&&b||null;var d=this.getAppMeta();if(d&&d[a]&&d[a].forms){a=d[a].forms;if(b&&a[b])return a[b].fields;for(var e in a)a.hasOwnProperty(e)&&c.push(e)}return c};
DelugeMeta.prototype.processFormFieldsJson=function(a,b){var c=[];if(!isJsonEmpty(a))for(key in a)if(a.hasOwnProperty(key)){var d=key,e=a[key],f=e.type||"Object";e=e.isSystemField;if(d&&(b&&0==d.indexOf(b.string)||"variable"!=b.type)||!b)e?c.push({text:d,dType:f,desc:!1,type:"formfield",isSystemField:e}):c.unshift({text:d,dType:f,desc:!1,type:"formfield"})}return c};
DelugeMeta.prototype.addFuncParamsToGlobalVar=function(a){var b=this.delugeFunctionArgs,c;for(c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d&&d.name&&d.type&&!delugeVarInList(a.globalVars,d.name,d.type)){var e={};"NView"==d.type&&(e.formName=d.formName);e.name=d.name;e.dType=d.type;e.next=a.globalVars?a.globalVars:null;a.globalVars=e}}return a};DelugeMeta.prototype.isFunctionArgPresent=function(a,b){b=this.delugeFunctionArgs;for(var c=0;c<b.length;c++){var d=b[c];if(d&&d.name==a&&d.type==d.type)return!0}return!1};
DelugeMeta.prototype.gatherVariables=function(a,b){var c={};if(a)for(;null!=a;){if(1==b&&"NView"==a.dType||!b&&"NView"!=a.dType)c[a.name]=a;a=a.next}return c};DelugeMeta.prototype.gatherVariablesAsList=function(a,b){var c=[];if(a)for(;null!=a;){if(1==b&&"NView"==a.dType||!b&&"NView"!=a.dType){var d=a;c.push(d)}a=a.next}return c};
DelugeMeta.prototype.isVariable=function(a,b,c){b=b||this.parent.editor.getCursor();b=this.parent.editor.getTokenAt(b);if(b=b.state.globalVars)for(;null!=b;){if(b.name==a&&(c&&c==b.dType||!c))return!0;b=b.next}return!1};
DelugeMeta.prototype.getGroupedPackageFunctions=function(a){function b(a){var b=[],c;for(c in a)if(a.hasOwnProperty(c)&&DelugeUtil.arrayContains(a[c],"sms")){var d={label:c,value:c+".sms"};"zoho"==c?b.unshift(d):b.push(d)}return b}if(a){DelugeUtil.getDomain();var c={"Zoho Apps":a.zoho.map(function(a,b){return{label:"Zoho "+a,value:"zoho."+a}})};a=b(a);0!==a.length&&(c.SMS=a);return c}return null};(function(){function a(a,b){if(a){var c=a.querySelector(".deluge-do-close");c&&c.addEventListener("click",function(){b.hide()});a.addEventListener("DOMNodeRemovedFromDocument",function(){b.element=null})}lineNumbDiv=a.querySelector(".deluge-do-line-error");null!==lineNumbDiv&&(lineNumb=lineNumbDiv.querySelector(".deluge-do-line-number"),lineNumbDiv.addEventListener("click",function(){c.click();b.editorWrapper.gotoLine(lineNumb.textContent);b.editorWrapper.editor.execCommand("goLineEnd")}))}function b(a){"string"==
typeof a&&(a=a.replace(/&/g,"\x26amp;"),a=a.replace(/</g,"\x26lt;"),a=a.replace(/>/g,"\x26gt;"),a=a.replace(/"/g,"\x26quot;"));return a}function c(a,c,d,e){if(c){var f="\x3cdiv class\x3d'deluge-do-logo-div'\x3e";switch(d){case "info":f+="\x3cspan class\x3d'deluge-info-logo'\x3e\x3c/span\x3e";break;case "output":f+="\x3cspan class\x3d'deluge-do-output-tick'\x3e\x3c/span\x3e";break;case "failure":f+="\x3cspan class\x3d'deluge-do-failure-cross'\x3e\x3c/span\x3e"}a='\x3cdiv class\x3d"deluge-doc-row" type\x3d\''+
d+'\'\x3e\x3cdiv class\x3d"deluge-do-title"\x3e'+(f+"\x3c/div\x3e"+("\x3cdiv class\x3d'deluge-do-title-row'\x3e"+(a?a:"Failed to execute function")+"\x3c/div\x3e"))+"\x3c/div\x3e";if("info"!=d||"string"==typeof c)a+='\x3cdiv class\x3d"deluge-do-result '+(e?"deluge-do-alert":"")+'"\x3e'+c+"\x3c/div\x3e";else for(var l in c)c.hasOwnProperty(l)&&(a+='\x3cdiv class\x3d"deluge-do-result"\x3e'+b(c[l])+"\x3c/div\x3e");return a+"\x3c/div\x3e"}return""}var d=function(){this.element=null};d.prototype.show=
function(d,e){function f(a){var b="";if(a=a.hasOwnProperty("result")&&a.result)a=a.hasOwnProperty("message")&&a.message,a.hasOwnProperty("userMessage")?(b=a.hasOwnProperty("userMessage")&&a.userMessage,b=c("Info",b,"info")):a.hasOwnProperty("uniqueID")&&(b=a.hasOwnProperty("overflow")&&a.overflow,b=c("Info",b,"info",!0),(a=a.hasOwnProperty("lastMessage")&&a.lastMessage)&&(b+=c("Last Available Info",a,"info")));return b}this.onclose=e;if(d){null!=this.element&&this.hide();var k=!1,p=d.hasOwnProperty("status")&&
d.status||"";e='\x3cdiv class\x3d"deluge-output" status\x3d\''+p.toLowerCase()+"'\x3e\x3cdiv class\x3d\"deluge-do-close deluge-close\"\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-do-content'\x3e";if("success"==p.toLowerCase()){var l=d.hasOwnProperty("result")&&d.result;l&&(p=d.hasOwnProperty("message")&&d.message,p="\x3cdiv class\x3d'deluge-do-execute-div'\x3e\x3cdiv class\x3d'deluge-do-execute-message'\x3e"+p+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-output-content'\x3e",l.hasOwnProperty("output")&&
(k=l.hasOwnProperty("output")&&l.output,"object"==typeof k&&(k=JSON.stringify(k)),p+=c("Output",b(k),"output"),k=!0),l=f(d),null!=l&&0<l.length&&(p+=l,k=!0),k&&(e+=p+"\x3c/div\x3e"))}else"failure"==p.toLowerCase()&&(k="",(p=d.hasOwnProperty("lineNumber")&&d.lineNumber)&&-1<p&&(k+="\x3cspan class\x3d'deluge-do-line-error'\x3eError at line number: \x3cspan class\x3d'deluge-do-line-number'\x3e"+p+"\x3c/span\x3e\x3c/span\x3e\x3cbr\x3e"),p=d.hasOwnProperty("errorMessage")&&d.errorMessage,p=b(p),p=p.replace(/\n/g,
"\x3cbr\x3e"),k+=p,l=f(d),e+="\x3cdiv class\x3d'deluge-output-content'\x3e"+c(d.message,k,"failure")+l+"\x3c/div\x3e",k=!0);k||(p=d.hasOwnProperty("message")&&d.message)&&(e+="\x3cdiv class\x3d'deluge-do-execute-div'\x3e\x3cdiv class\x3d'deluge-do-logo-div'\x3e\x3cspan class\x3d'deluge-do-output-tick'\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-do-execute-message'\x3e"+p+"\x3c/div\x3e\x3c/div\x3e");e+="\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";d=document.createElement("div");d.innerHTML=e;d=
d.children[0];a(d,this);this.editorWrapper.addWidget(d);this.element=d}};d.prototype.hide=function(){if(this.element){this.editorWrapper.removeWidget(this.element);if(this.onclose)this.onclose(this.element);this.element=null}};var e=new d;DelugeEditorWrapper.registerHelper("response",{get:function(){return e}},e)})();(function(a){a.DelugeEditorI18N={validate:function(a){a=null!=a?a:[];a["deluge.editor.deluge.title"]=a["deluge.editor.deluge.title"]?a["deluge.editor.deluge.title"]:"Deluge";a["deluge.editor.delugetasks.title"]=a["deluge.editor.delugetasks.title"]?a["deluge.editor.delugetasks.title"]:"Deluge Tasks";a["deluge.editor.buttons.executescript"]=a["deluge.editor.buttons.executescript"]?a["deluge.editor.buttons.executescript"]:"Execute Script";a["deluge.editor.buttons.savescript"]=a["deluge.editor.buttons.savescript"]?
a["deluge.editor.buttons.savescript"]:"Save Script";a["deluge.editor.buttons.saveandexecutescript"]=a["deluge.editor.buttons.saveandexecutescript"]?a["deluge.editor.buttons.saveandexecutescript"]:"Save \x26 Execute Script";a["deluge.editor.builder.syntaxassist"]=a["deluge.editor.builder.syntaxassist"]?a["deluge.editor.builder.syntaxassist"]:"Syntax Assist";a["deluge.editor.builder.version"]=a["deluge.editor.builder.version"]?a["deluge.editor.builder.version"]:"Versions";a["deluge.editor.menu.help"]=
a["deluge.editor.menu.help"]?a["deluge.editor.menu.help"]:"Help";a["deluge.editor.menu.help.guide"]=a["deluge.editor.menu.help.guide"]?a["deluge.editor.menu.help.guide"]:"Guide";a["deluge.editor.menu.help.support"]=a["deluge.editor.menu.help.support"]?a["deluge.editor.menu.help.support"]:"Support";a["deluge.builder.button.insert"]=a["deluge.builder.button.insert"]?a["deluge.builder.button.insert"]:"Insert";a["deluge.builder.button.cancel"]=a["deluge.builder.button.cancel"]?a["deluge.builder.button.cancel"]:
"Cancel";a["deluge.editor.shortcuts.blockcomment.toggle"]=a["deluge.editor.shortcuts.blockcomment.toggle"]?a["deluge.editor.shortcuts.blockcomment.toggle"]:"Toggle Block Comment";a["deluge.editor.shortcuts.childvariables"]=a["deluge.editor.shortcuts.childvariables"]?a["deluge.editor.shortcuts.childvariables"]:"Show functions / child variables";a["deluge.editor.shortcuts.comment.toggle"]=a["deluge.editor.shortcuts.comment.toggle"]?a["deluge.editor.shortcuts.comment.toggle"]:"Toggle Comment";a["deluge.editor.shortcuts.find"]=
a["deluge.editor.shortcuts.find"]?a["deluge.editor.shortcuts.find"]:"Find";a["deluge.editor.shortcuts.findandreplace"]=a["deluge.editor.shortcuts.findandreplace"]?a["deluge.editor.shortcuts.findandreplace"]:"Find \x26 Replace";a["deluge.editor.shortcuts.gotoline"]=a["deluge.editor.shortcuts.gotoline"]?a["deluge.editor.shortcuts.gotoline"]:"Go to line";a["deluge.editor.shortcuts.hint.next"]=a["deluge.editor.shortcuts.hint.next"]?a["deluge.editor.shortcuts.hint.next"]:"Go to next hint tag";a["deluge.editor.shortcuts.hint.previous"]=
a["deluge.editor.shortcuts.hint.previous"]?a["deluge.editor.shortcuts.hint.previous"]:"Go to previous hint tag";a["deluge.editor.shortcuts.undo"]=a["deluge.editor.shortcuts.undo"]?a["deluge.editor.shortcuts.undo"]:"Undo";a["deluge.editor.shortcuts.redo"]=a["deluge.editor.shortcuts.redo"]?a["deluge.editor.shortcuts.redo"]:"Redo";a["deluge.editor.shortcuts.script.execute"]=a["deluge.editor.shortcuts.script.execute"]?a["deluge.editor.shortcuts.script.execute"]:"Execute Script";a["deluge.editor.shortcuts.script.save"]=
a["deluge.editor.shortcuts.script.save"]?a["deluge.editor.shortcuts.script.save"]:"Save Script";a["deluge.editor.shortcuts.script.saveandexecute"]=a["deluge.editor.shortcuts.script.saveandexecute"]?a["deluge.editor.shortcuts.script.saveandexecute"]:"Save and Execute Script";a["deluge.editor.shortcuts.showfunctiondefinition"]=a["deluge.editor.shortcuts.showfunctiondefinition"]?a["deluge.editor.shortcuts.showfunctiondefinition"]:"Show Function Definition";a["deluge.editor.shortcuts.showhint"]=a["deluge.editor.shortcuts.showhint"]?
a["deluge.editor.shortcuts.showhint"]:"Show Hint";a["deluge.editor.shortcuts.title"]=a["deluge.editor.shortcuts.title"]?a["deluge.editor.shortcuts.title"]:"Keyboard Shortcuts";a["deluge.editor.leftpane.tasks.groupname.condition"]=a["deluge.editor.leftpane.tasks.groupname.condition"]?a["deluge.editor.leftpane.tasks.groupname.condition"]:"Condition";a["deluge.editor.leftpane.tasks.groupname.basic"]=a["deluge.editor.leftpane.tasks.groupname.basic"]?a["deluge.editor.leftpane.tasks.groupname.basic"]:"Basic";
a["deluge.editor.leftpane.tasks.groupname.notifications"]=a["deluge.editor.leftpane.tasks.groupname.notifications"]?a["deluge.editor.leftpane.tasks.groupname.notifications"]:"Notifications";a["deluge.editor.leftpane.tasks.groupname.integrations"]=a["deluge.editor.leftpane.tasks.groupname.integrations"]?a["deluge.editor.leftpane.tasks.groupname.integrations"]:"Integrations";a["deluge.editor.leftpane.tasks.groupname.collection"]=a["deluge.editor.leftpane.tasks.groupname.collection"]?a["deluge.editor.leftpane.tasks.groupname.collection"]:
"Collection";a["deluge.editor.leftpane.tasks.groupname.datawithinzoho"]=a["deluge.editor.leftpane.tasks.groupname.datawithinzoho"]?a["deluge.editor.leftpane.tasks.groupname.datawithinzoho"]:"Data Within Zoho";a["deluge.editor.leftpane.tasks.groupname.clientfunctions"]=a["deluge.editor.leftpane.tasks.groupname.clientfunctions"]?a["deluge.editor.leftpane.tasks.groupname.clientfunctions"]:"Client functions";a["deluge.editor.leftpane.tasks.groupname.debugandbranching"]=a["deluge.editor.leftpane.tasks.groupname.debugandbranching"]?
a["deluge.editor.leftpane.tasks.groupname.debugandbranching"]:"Debug \x26 Branching";a["deluge.editor.leftpane.tasks.groupname.listmanipulation"]=a["deluge.editor.leftpane.tasks.groupname.listmanipulation"]?a["deluge.editor.leftpane.tasks.groupname.listmanipulation"]:"List manipulation";a["deluge.editor.leftpane.tasks.groupname.mapmanipulation"]=a["deluge.editor.leftpane.tasks.groupname.mapmanipulation"]?a["deluge.editor.leftpane.tasks.groupname.mapmanipulation"]:"Map manipulation";a["deluge.editor.leftpane.tasks.groupname.xmlmanipulation"]=
a["deluge.editor.leftpane.tasks.groupname.xmlmanipulation"]?a["deluge.editor.leftpane.tasks.groupname.xmlmanipulation"]:"Xml manipulation";a["deluge.builder.description.info"]=a["deluge.builder.description.info"]?a["deluge.builder.description.info"]:"Prints the expression";a["deluge.builder.description.alert"]=a["deluge.builder.description.alert"]?a["deluge.builder.description.alert"]:"Prints the expression in a popup to the user";a["deluge.builder.description.return"]=a["deluge.builder.description.return"]?
a["deluge.builder.description.return"]:"Returns the given value to the callee function";a["deluge.builder.description.if"]=a["deluge.builder.description.if"]?a["deluge.builder.description.if"]:"Performs a set of tasks conditionally based on evaluating a boolean expression.";a["deluge.builder.description.conditionalif"]=a["deluge.builder.description.conditionalif"]?a["deluge.builder.description.conditionalif"]:"Performs a set of tasks conditionally based on evaluating a boolean expression.";a["deluge.builder.description.setvariable"]=
a["deluge.builder.description.setvariable"]?a["deluge.builder.description.setvariable"]:"Sets the content of the specified field with the value of an expression";a["deluge.builder.description.sendmail"]=a["deluge.builder.description.sendmail"]?a["deluge.builder.description.sendmail"]:"Sends mail to the given address";a["deluge.builder.description.sendsms"]=a["deluge.builder.description.sendsms"]?a["deluge.builder.description.sendsms"]:"Sends sms to the given number";a["deluge.builder.description.openurl"]=
a["deluge.builder.description.openurl"]?a["deluge.builder.description.openurl"]:"Helps to open the given URL in a window";a["deluge.builder.description.callfunction"]=a["deluge.builder.description.callfunction"]?a["deluge.builder.description.callfunction"]:"Call a function with the required params";a["deluge.builder.description.invokeurl"]=a["deluge.builder.description.invokeurl"]?a["deluge.builder.description.invokeurl"]:"Helps to send different types of http request";a["deluge.builder.description.insertinto"]=
a["deluge.builder.description.insertinto"]?a["deluge.builder.description.insertinto"]:"Helps to add record to a form along with its fields";a["deluge.builder.description.integration"]=a["deluge.builder.description.integration"]?a["deluge.builder.description.integration"]:"Helps to use predefined integration tasks";a["deluge.builder.description.fetchrecord"]=a["deluge.builder.description.fetchrecord"]?a["deluge.builder.description.fetchrecord"]:"Fetch data from form along with criteria";a["deluge.builder.description.aggregaterecord"]=
a["deluge.builder.description.aggregaterecord"]?a["deluge.builder.description.aggregaterecord"]:"Apply aggregate functions over records";a["deluge.builder.description.foreachrecord"]=a["deluge.builder.description.foreachrecord"]?a["deluge.builder.description.foreachrecord"]:"Executes a set of tasks repeatedly for each row in a collection of records";a["deluge.builder.description.deleterecord"]=a["deluge.builder.description.deleterecord"]?a["deluge.builder.description.deleterecord"]:"Delete records based on the given criteria";
a["deluge.builder.description.updaterecord"]=a["deluge.builder.description.updaterecord"]?a["deluge.builder.description.updaterecord"]:"Modify the field values in the fetched data with new values";return a}}})(this);var DelugeCommonUtil={getFromMap:function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&c.toLowerCase()==b.toLowerCase())return a[c];return!1},getFromArray:function(a,b){return arrayContains(a,b)},arrayContains:function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&a[c].toLowerCase()==b.toLowerCase())return a[c];return!1}};(function(){CodeMirror.defineExtension("find",function(){var a=this.container.querySelector(".custom-deluge-search");a&&a.querySelector("#closeDiv").click();this.execCommand("find")});CodeMirror.defineExtension("findAndReplace",function(){var a=this.container.querySelector(".custom-deluge-search.custom-deluge-replace");a&&a.querySelector(".close-icon").click();this.execCommand("replace")});CodeMirror.defineExtension("goToLine",function(){this.execCommand("goToLine")})})();var DelugePopup=new function(){function a(){document.addEventListener("keyup",function(a){a=a||window.event;27==a.keyCode&&(DelugePopup.hide(),a.stopPropagation(),a.preventDefault(),a.stopImmediatePropagation())})}this.animation=!1;this.layers=[];this.freezeLayers=[];var b=-1,c=null,d=null,e=this;this.init=function(a){var c=document.createElement("div");c.setAttribute("class","deluge-popup");var d=document.createElement("div");d.setAttribute("class","deluge-popup-freeze");a.appendChild(d);a.appendChild(c);
e.layers[++b]=c;e.freezeLayers[b]=d};this.show=function(f,k,r){d=f;e.init(f);f=e.layers[b];k.style.display="block";f.appendChild(k);r&&(r.hasOwnProperty("className")&&(c=r.className,f.className+=" "+c),r.hasOwnProperty("callback")&&r.callback(),r.hasOwnProperty("animation")&&(this.animation=r.animation),r.hasOwnProperty("esc")&&1==r.esc&&a());f.style.display="block";e.adjustSize()};this.adjustSize=function(){if(e.layers[b]){var a=e.layers[b].childNodes[0];a&&(e.layers[b].style.width=a.offsetWidth+
"px")}};this.hide=function(){function f(a,b){a&&(a.childNodes[0].style.display="none",d.appendChild(a.childNodes[0]),a.parentElement&&a.parentElement.removeChild(a));b.parentElement&&b.parentElement.removeChild(b)}if(e.layers[b]){var k=e.layers.pop(),r=e.freezeLayers.pop();k.className=c;r.className="deluge-popup-freeze";e.animation?(k.className+=" deluge-popup deluge-popup-close-effect",r.className+=" deluge-popup-freeze-close-effect ",setTimeout(function(){f(k,r)},280)):f(k,r);b--;document.removeEventListener("keyup",
a)}};this.addClass=function(a){c+=" "+a;e.layers[b].className="deluge-popup "+c}},DelugeElements=new function(){this.RichTextElem=null;this.getElement=function(a){switch(a){case "rich-text":if(null==document.getElementById("dreRichText")||null==this.RichTextElem){a=document.createElement("div");a.setAttribute("id","dreRichText");a.setAttribute("class","dre-rich-text");var b=document.createElement("div");b.setAttribute("class","dre-col");var c=document.createElement("div");c.setAttribute("class","dre-col-3-4");
var d=document.createElement("div");d.setAttribute("id","dreRTContainer");d.setAttribute("class","dre-rt-container");c.appendChild(d);d=document.createElement("div");d.setAttribute("id","rt-buttons");d.setAttribute("class","rt-buttons");d.innerHTML="\x3cinput type\x3d'button' id\x3d'rtDone' class\x3d'rt-done' value\x3d'Done'/\x3e\x3cinput type\x3d'button' id\x3d'rtCancel' class\x3d'rt-cancel' value\x3d'Cancel'/\x3e";c.appendChild(d);d=document.createElement("div");d.setAttribute("class","dre-col-1-4");
var e=document.createElement("div");e.setAttribute("class","dre-rt-deluge-var");var f=document.createElement("div");f.setAttribute("class","dre-dv-vars");e.appendChild(f);d.appendChild(e);b.appendChild(d);b.appendChild(c);a.appendChild(b);this.RichTextElem=a}return this.RichTextElem}}},DelugeBasePopup=function(){function a(a){if(a&&a.hasOwnProperty("freeze")&&(a=a.freeze,a.container)){var b=d();a.className&&(b.className+=" "+a.className);a.hasOwnProperty("closeOnClick")&&b&&b.addEventListener("click",
function(){p.hide()});a.container.appendChild(b)}}function b(a,b){a&&p.animation&&(a.parentElement.style.overflow="hidden",e(a,p.animation.show),setTimeout(function(){a.parentElement.style.overflow="visible"},200))}function c(a,b){a&&(p.animation?(a.parentElement.style.overflow="hidden",f(a,p.animation.show),e(a,p.animation.hide),setTimeout(function(){a.parentElement.style.overflow="visible";f(a,p.animation.hide);b&&b()},200)):b&&b())}function d(){var a=document.createElement("div");a.setAttribute("class",
"deluge-expr-popup-freeze");return p.freezeLayer=a}function e(a,b){a&&-1==a.className.split(" ").indexOf(b)&&(a.className+=" "+b)}function f(a,b){if(a){var c=a.className.split(" ");b=c.indexOf(b);-1<b&&c.splice(b,1);a.className=c.join(" ")}}function k(a){a=a||window.event;27==a.keyCode&&(p.hide(),a.stopPropagation(),a.preventDefault(),a.stopImmediatePropagation())}function r(){setTimeout(function(){A(p.popOverElement)},10)}function A(a,b){var c=p.getContainer(),d=0,e=c.querySelector(".deluge-expr-builder-header");
null!==e&&(d=e.clientHeight);e=a.getBoundingClientRect();if(e){var f=e.left+e.width,l=e.top,g=c.parentElement.getBoundingClientRect(),m=window.innerHeight-c.clientHeight-l;var k=13;a="left";0>m?(l+=m,k=-m,0<d+m-10&&(l-=(d-e.height)/2,k=(d-e.height)/2)):l-=7;d=c.clientWidth;0>window.innerWidth-40-d-f&&(f=f-e.width-d-15,a="right");c.style.top=l-g.top+"px";c.style.left=f-g.left+"px";g.right<c.getBoundingClientRect().right&&(c.style.left="auto",c.style.right="0px");g.bottom<c.getBoundingClientRect().bottom&&
(m=g.height-c.getBoundingClientRect().height,k=k+parseFloat(c.style.top)-m,c.style.top=m+"px");d=k;(e=c.querySelector("."+b+"-pointer"))?e.classList.remove(b+"-left-pointer",b+"-right-pointer",b+"-top-pointer",b+"-bottom-pointer"):(e=DelugeUtil.getDivElement("",b+"-pointer"),c.insertBefore(e,c.childNodes[0]));e.classList.add(b+"-"+a+"-pointer");e.style.top=d+"px"}}var p=this;this.events={};this.index=-1;this.layers=[];this.windowResize=this.esc=!1;this.animation=this.freezeLayer=null;this.init=function(c,
d,f,q){var l=document.createElement("div");l.appendChild(d);l.setAttribute("class","deluge-lr-popup");f.hasOwnProperty("className")&&e(l,f.className);f.hasOwnProperty("esc")&&(p.esc=f.esc);f.hasOwnProperty("hide")&&(p.events.onClose=f.hide);f.hasOwnProperty("type")&&(p.type=f.type);f.hasOwnProperty("windowResize")&&(p.windowResize=!0);f.hasOwnProperty("pointer")&&(p.pointer=f.pointer);f.hasOwnProperty("animation")&&(p.animation=f.animation);switch(f.hasOwnProperty("type")?f.type:null){case "popover":p.popOverElement=
f.popOverElement}a(f);if(c&&l)switch(f.hasOwnProperty("appendType")?f.appendType:""){case "prepend":c.insertBefore(l,c.childNodes[0]);break;default:c.appendChild(l)}b(l,q);p.esc&&document.addEventListener("keyup",k);this.addToLayers(l);switch(p.type){case "popover":A(p.popOverElement,p.pointer)}};this.addToLayers=function(a){this.layers[++this.index]=a};this.popLayer=function(){return-1<this.index?(this.index--,this.layers.pop()):null};this.show=function(a,b,c,d){this.init(a,b,c,d);c.hasOwnProperty("show")&&
c.show();p.windowResize&&window.addEventListener("resize",r)};this.hide=function(a){function b(){d&&d.parentElement.removeChild(d);if(p.freezeLayer){var a=p.freezeLayer;a&&a.parentElement.removeChild(a)}if(p.events.onClose)p.events.onClose();p.windowResize&&window.removeEventListener("resize",r);p.esc&&document.removeEventListener("keyup",k)}var d=p.popLayer();if(d){a?b():c(d,b);if(p.onClose)p.onClose();return!0}return!1};this.getContainer=function(){return-1<p.index?p.layers[p.index]:null}},DelugeLoading=
{show:function(a){this.elem=a;$(a).showLoading()},hide:function(){this.elem&&($(this.elem).hideLoading(),this.elem=null)}};var DelugeEditorConfig={indentUnit:4,showDescription:!0},DelugeEditor=function(a,b,c,d){function e(a){q.state.isShiftorMousemove=!0}var f=a.querySelector("textarea");d=b.existingMeta?b.existingMeta:new DelugeMeta(c,d);var k=b.positionType,r=b.advancedFeatures,A=b.lineNumbers,p=b.plainMode,l=b.panelMap,m=b.returnFunctions,t=A?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:[];r&&0<t.length&&t.unshift("editmodes");var q=CodeMirror.fromTextArea(f,{mode:"deluge",lineNumbers:A,keyMap:"sublime",matchBrackets:!0,
styleActiveLine:A,autoCloseBrackets:!0,cursorHeight:.82,indentUnit:DelugeEditorConfig.indentUnit,showCursorWhenSelecting:!0,indentWithTabs:!0,smartIndent:!0,lineWrapping:!0,extraKeys:"delugeKeys",foldGutter:!0,metadata:d,panelMap:l,gutters:t,editor:q,autoRefresh:!0,theme:b.theme});q.container=f.parentNode.parentNode;q.taskDrag={markStart:function(){this.started=!0;this.script=q.getValue();this.history=q.getHistory();this.cursorPos=q.getCursor();this.foldGutterState=q.state.foldGutter;q.state.foldGutter=
null},status:function(){return this.started},markEnd:function(a){this.started&&(this.started=!1,q.setValue(this.script),q.setCursor(this.cursorPos),q.state.foldGutter=this.foldGutterState,this.line=null,a&&this.clear(),q.setHistory(this.history))},setCurrentLine:function(a,b){var c=q;c.taskDrag.clear();this.line=null;b&&(this.line=a,this.appendLine(c))},appendLine:function(a){a.replaceRange("\n",{line:this.line-1});a.indentLine(this.line,"prev")},getCurrentLine:function(){return this.line},clear:function(){var a=
q;if(null!=this.line){var b=this.line;if(0==b)a.replaceRange("",{line:b,ch:a.getLine(b).length+1},{line:b+1,ch:0});else{var c=a.getLine(b-1);a.getLine(b);c&&a.replaceRange("",{line:b-1,ch:c.length+1},{line:b,ch:0})}this.line=null}}};q.on("dragenter",function(a,b){if(a.taskDrag.status()){b=a.coordsChar({left:b.x,top:b.pageY});var c=b.line;b=b.ch;var d=c,e=a.getLine(c),f=a.lineCount()-1==c,g=0==c;if(d!=a.taskDrag.getCurrentLine()){c=a.getLine(c-1);c=null!=c?c:"";var l=!0;if(0==e.trim().length||!g&&
!f&&0==c.trim().length)l=!1;f&&0<e.trim().length&&d++;a.taskDrag.setCurrentLine(d,l);a.state.delugeDrag={line:d,ch:b};DelugeEditorUtil.delugeMarker.clear(a);DelugeEditorUtil.delugeMarker.create(d,a);(a=document.getElementById("delugeLPTaskDescription"))&&a.parentElement.removeChild(a)}}});q.on("drop",function(a,b){if(a.taskDrag.status()){a.taskDrag.markEnd();var d=a.state.delugeDrag,e=d.line,f=d.ch,g=a.getLine(e);e=0==e?0:e;var l=b.dataTransfer.getData("text");d=l;try{var m=JSON.parse(l),k=m.element,
q=m.group;d=(d=getPanelDetails(a.getPanelMap(),k,null,null,null,q.replace(/_/gi," ")))||k;var p=document.querySelector("div[id\x3d'"+k+"'][group-name\x3d'"+q+"']");removeClassName(p,"block-hover")}catch(B){}k=0===e&&!/^[\s\n]*$/.test(g)&&f<g.length/2;m=!1;a.deluge.settings&&(m=a.deluge.settings.isBuilderEnabled());k?(e=0,f={line:e,ch:0},d=setIndentation(d+"\n",f,a),a.replaceRange(d,f),DelugeEditorUtil.delugeMarker.clear(a),!m&&DelugeEditorUtil.setCursorAfterDrop(0,d,!0,a)):DelugeEditorUtil.dropCode(CodeMirror.Pos(e,
f),d,null,a,m);m&&(setTimeout(function(){a.setCursor({line:e});a.execCommand("clearAutoComplete")},0),setTimeout(function(){c.builder.trigger(a,e)},301));b.preventDefault()}});q.triggerBuilder=function(a){this.deluge.settings&&(isBuilderEnabled=this.deluge.settings.isBuilderEnabled())&&setTimeout(function(){q.execCommand("clearAutoComplete");c.builder.trigger(q,a)},320)};q.on("keyup",function(a,b){a.state.lastKeyCode=b.keyCode;if(37===b.keyCode)if(a.state.angularBrac){a.state.angularBrac=!1;var c=
a.getCursor();a.setCursor({line:c.line,ch:c.ch-1})}else a.state.rightTag&&(a.state.rightTag=!1);else if(39===b.keyCode){if(a.state.rightTag){a.state.rightTag=!1;a.state.angularBrac=!1;c=a.getCursor();var d=a.getSelection(),e=CodeMirror.Pos(c.line,c.ch+d.length+1);c=CodeMirror.Pos(c.line,c.ch+d.length);"\x3e"===a.getTokenAt(e).string&&a.replaceRange(" ",c);a.setCursor(e)}a.state.angularBrac&&(a.state.angularBrac=!1)}a.state.angularBrac=!1;b.ctrlKey||91==b.keyCode?(a.state.isPrevCtrl=1,a.state.isCtrl=
!0):1==a.state.isPrevCtrl?a.state.isPrevCtrl=2:a.state.isCtrl=!1;e=String.fromCharCode(b.keyCode);!a.state.isCtrl&&(/[a-zA-Z_]/.test(e)&&!b.ctrlKey||/[0-9]/.test(e)&&!b.shiftKey&&!b.ctrlKey)&&(a.state.isCtrl=!1,(112>b.keyCode||123<b.keyCode)&&!a.somethingSelected()&&(a.state.isAnimateTime=!0,CodeMirror.showHint(a,CodeMirror.hint.deluge,{completeSingle:!1,closeOnUnfocus:!0})));if(b.shiftKey&&55===b.keyCode||b.shiftKey&&220===b.keyCode){e=a.getCursor();d=e.ch+1;var f=a.getTokenAt({line:e.line,ch:d});
for(c=a.getLine(e.line);null==f.type&&d<c.length;)f=a.getTokenAt({line:e.line,ch:d+1}),d++;var g=a.getTokenAt(e).string;LOGICAL_OPERATORS.test(g)&&("brackets"==f.type&&"("!=f.string&&"["!=f.string&&"{"!=f.string||d>=c.length)&&(d="",/if\s?\(.*?\)/.test(c)?d=" "+condition:/[a-zA-Z_][a-zA-Z_]*\s*\[.*?\]/.test(c)&&(d=" "+condition2),a.replaceRange(d,e),a.state.isShiftorMousemove=!1,a.setCursor({line:e.line,ch:e.ch+2}))}b.shiftKey&&(a.state.isShiftorMousemove=!1)});q.on("keydown",function(a,b){a.state.lastKeyCode=
b.keyCode;if(37===b.keyCode)if(a.state.angularBrac){a.state.angularBrac=!1;var c=a.getCursor();a.setCursor({line:c.line,ch:c.ch-1})}else a.state.rightTag&&(a.state.rightTag=!1);a.state.isShiftorMousemove=!1;b.shiftKey&&(a.state.isShiftorMousemove=!0)});var z=q.getScrollerElement();z.addEventListener("mousedown",function(a){q.state.isShiftorMousemove=!1;z.addEventListener("mousemove",e)});z.addEventListener("mouseup",function(){z.removeEventListener("mousemove",e);q.state.isShiftorMousemove=!1});q.events=
{};q.events.cursorActivity=function(a){if(!CodeMirror.autoCompleteHandler){var b=a.getCursor(),c=b.line,d=a.getTokenAt({line:c,ch:b.ch+1});b=a.getTokenAt({line:c,ch:b.ch});if(!a.state.isShiftorMousemove){if(d.string===b.string){var e=d.string,f=a.getTokenAt({line:c,ch:d.start}),l=a.getTokenAt({line:c,ch:d.end+1});e=f.string+e+l.string;if(e=e.match(TAGS_TEST_PATTERN))a.setSelection({line:c,ch:l.end},{line:c,ch:f.start}),CodeMirror.showHint(a,CodeMirror.hint.deluge,{completeSingle:!1})}else if("tag"===
d.type&&"\x3e"===d.string){if(f=a.getTokenAt({line:c,ch:b.start}),e=b.string,e=f.string+e+d.string,e=e.match(TAGS_TEST_PATTERN))a.state.fromRightToken=!0,a.setSelection({line:c,ch:d.end},{line:c,ch:f.start}),CodeMirror.showHint(a,CodeMirror.hint.deluge,{completeSingle:!1})}else if("tag"===b.type&&"\x3c"===b.string){if(l=a.getTokenAt({line:c,ch:d.end+1}),e=d.string,e=b.string+e+l.string,e=e.match(TAGS_TEST_PATTERN))a.setSelection({line:c,ch:l.end},{line:c,ch:b.start}),CodeMirror.showHint(a,CodeMirror.hint.deluge,
{completeSingle:!1})}else"."===d.string[0]&&d.string.slice(1);a.state.argumentTooltip&&(d=a.state.argumentTooltip,b=a.getCursor(),c=a.getLine(b.line),f=getFunctionArgumentBlock(c,d.lpos+1),d.lno!==b.line||b.ch<=d.lpos||b.ch>(f&&f.rpos))&&(DelugeEditorUtil.tooltip.remove(),DelugeEditorUtil.functionDefinition.close(),a.state.argumentTooltip=!1)}a.somethingSelected()&&(a.getCursor(),selectedText=a.getSelection(),PANEL_GROUPS.hasOwnProperty(selectedText)&&a.execCommand("autocomplete"));a.state.suggestionSet&&
a.state.suggestionSet.line==c&&0==a.getLine(c).length?DelugeEditorUtil.suggestions.show():DelugeEditorUtil.suggestions.close();DelugeEditorUtil.functionDefinition.closeOnBlur(a.getCursor())}};q.on("cursorActivity",q.events.cursorActivity);q.on("dblclick",function(a,b){b.preventDefault();b=a.getCursor();var c=a.getSelection(),d=c.length,e=a.getTokenAt({line:b.line,ch:b.ch+1});"\x3c"===a.getTokenAt({line:b.line,ch:b.ch-d}).string&&"\x3e"===e.string?a.setCursor({line:b.line,ch:b.ch-c.length-1}):PANEL_GROUPS.hasOwnProperty(c)&&
a.execCommand("autocomplete")});q.on("gutterClick",function(a,b,c){if("CodeMirror-linenumbers"===c)return a.setSelection({line:b,ch:0},{line:b}),!0});var H;r&&!p&&(q.getWrapperElement().className+=" CodeMirror-deluge-edit-task",q.on("change",function(){clearTimeout(H);H=setTimeout(function(){c.builder.parse(q,c)},300)}));if(b.editorOnChange)q.on("change",function(a,c){b.editorOnChange(a.getValue(),c)});if(b.editorBeforeChange)q.on("beforeChange",function(a,c){b.editorBeforeChange(a.getValue(),c)});
d.setSubformAutocompleteStatus(b.subformAutocomplete);q.metadata=d;q.container=a;q.getContainerDetails=function(){var a=this.container||document.getElementById("editorContainer");if(a){var b=a.getBoundingClientRect();"fixed"==this.deluge.positionType&&0==b.height&&(b=a.querySelector(".deluge-editor-container").getBoundingClientRect());b.elem=a}return b};q.execCompletion=function(){q.execCommand("autocomplete")};q.getWrapperElement().addEventListener("keyup",function(a){a.stopPropagation()});q.deluge=
{};k&&(q.deluge.positionType=k);r&&(q.deluge.advancedFeatures=r);p&&(q.deluge.plainMode=p);q.PANEL_GROUPS_MAP=l;q.RETURN_FUNCTIONS=m;q.setPanelMap=function(a){q.PANEL_GROUPS_MAP=a};q.getPanelMap=function(){return this.PANEL_GROUPS_MAP};q.getPanelReturnFunctions=function(){return this.RETURN_FUNCTIONS};q.setPanelReturnFunctions=function(a){q.RETURN_FUNCTIONS=a};return q},btnFullScreen=document.getElementById("btnFullScreen");btnFullScreen&&btnFullScreen.addEventListener("click",function(){bindEditorFullScreen()});
function getKeyValue(a){a=a.replace(/\s/g,"");var b=a.indexOf("\x3d"),c=-1!==a.indexOf(";")?a.indexOf(";"):a.length,d=a.slice(0,b);b=a.slice(b+1,c);FOR_EACH_PATTERN.test(a)&&(b="");return{key:d,value:b}}
function createDelugeEditor(a,b,c){var d=!0,e=[],f=[];var k=null;var r="";var A=a.elem||document.getElementById("mainEditorContainer");A=a.fromDRE?null!=a.elem?a.elem:document.getElementById("delugeEditorArea"):A;var p=A.querySelector("textarea");A.querySelector(".deluge-left-pane");a&&(d=null!=a.leftPane?a.leftPane:d,e=null!=a.restriction?a.restriction:e,f=null!=a.hideTasks?a.hideTasks:f,k=null!=a.leftPaneTasks?a.leftPaneTasks:k,r=a.leftPaneTitle?a.leftPaneTitle:r);return null!=p?(k=DelugeLeftPane.handleLeftPaneTasks(k),
e=DelugeLeftPane.createPanel(e,f,k,r),a.panelMap=e.panelGroupMap,a.returnFunctions=e.returnFunctions,a=DelugeEditor(A,a,b,c),!isUndef(d)&&d&&(d=A.querySelector(".deluge-left-pane"),d.innerHTML=e.taskGroups,DelugeLeftPane.bindLeftPane(b)),A.querySelector(".CodeMirror").className+=" codemirror-div",A.querySelector(".CodeMirror").setAttribute("id","codemirror_div"),A.querySelector(".CodeMirror-scroll").setAttribute("id","codemirror_scroll"),a):null}
function initializeEditor(a,b,c){null==document.getElementById("delugeCodeArea")||!isUndef(delugeEditor)&&null!=document.getElementById("codemirror_div")||(delugeEditor=createDelugeEditor({leftPane:b,script:a}));b=editor&&editor.getCursor();delugeEditor.setEditorContent(a);b&&editor.setCursor({line:b.line,ch:b.ch})||delugeEditor.focusEditor();c?(CodeMirror.autoCompleteHandler=editor.getHelpers().hint.deluge,CodeMirror.registerHelper("hint","deluge",function(){})):CodeMirror.autoCompleteHandler&&(CodeMirror.registerHelper("hint",
"deluge",CodeMirror.autoCompleteHandler),CodeMirror.autoCompleteHandler=null);"function"==typeof delugeEditor.bindScriptChange&&delugeEditor.bindScriptChange();try{editor.refresh()}catch(d){}}function isUndef(a){return null==a||void 0==a||""==a||"undefined"==typeof a?!0:!1};var DELUGE_CONSTANTS=["true","false"],systemFields=[];
CodeMirror.defineMode("deluge",function(a,b){function c(a,b){for(var c=0;c<b.length;c++)for(var d=b[c].split(" "),h=0;h<d.length;h++)arrayContains(UD_TAGS,d[h])||(w[d[h]]=a)}function d(a){w={};N=a;a=u?u.getDelugeKeywords("noapps",a):[];a=a.concat(["get","post","put","delete"]);a=a.concat("catch from to cc bcc subject message index in attachments".split(" "));a=a.concat(DATATYPE_TAGS);a=a.concat(DEFINITION_KEYWORDS);c("constant",DELUGE_CONSTANTS);c("syntax",a);c("relop",["is","in","not"])}function e(a,
b,c){h=a;v=c;return b}function f(a,b){if(b.multiLineComment)return A(a,b);a.sol();var c=a.next();if(";"===c)return e("semicolon","semicolon");if(/\./.test(c)){if(a.eatWhile(/\d/))return e("constant","constant")}else{if(/[<>!=]/.test(c)&&a.eat("\x3d"))return e("relop","relop",a.current());if("\x3c"===c||"\x3e"===c)return e("tag","tag");if("/"===c){if(a.eat("*"))return b.tokenize=A,b.multiLineComment=!0,A(a,b);if(a.eat("/"))return a.skipToEnd(),e("comment","comment")}else{if(0<="([{}])".indexOf(c))return e(c,
"brackets");if(","===c)return a.eat(","),e(c,"separator")}}if('"'===c)return b.tokenize=k(c),b.tokenize(a,b);if("'"===c)return b.tokenize=r(c),b.tokenize(a,b);if(0<=O.indexOf(c))return e("operator","operator",a.current());if("\x26"===c&&a.eat("\x26")||"|"===c&&a.eat("|")||"!"===c)return"logicalOpr","logicalOpr";if(/[\d]/.test(c))return a.eatWhile(/[\d\.]/),a.peek()?/[\w]/.test(a.peek())?/\./.test(a.peek())?e("constant","constant"):e("variable","variable"):e("constant","constant"):e("constant","constant");
c=function(a){return this.includes(a+"(")};a.eatWhile(/[\w*]/);b=a.current();if("for"===b||"else"===b){a.eat(" ");a.eatWhile(/[\w]/);var d=a.current();if("for each"===d||"else if"===d)return e("syntax","syntax")}else if("for each"===b)return e("syntax","syntax");if(-1!=a.string.indexOf("\x3c"+b+"\x3e")||-1!=a.string.replace(" ","").indexOf(b+"\x3d"))return e("variable","variable",b);if(-1!=a.string.indexOf("zoho"+b)&&arrayContains(systemFields,b.substring(1,b.length)))return e("syntax","syntax");
0==b.indexOf(".")&&(b=b.substring(1));if(-1!=b.indexOf(":ui"))return e("syntax","syntax");if((d=ba.exec(a.string.slice(a.start)))&&d.index+a.start===a.start&&(d=a.string.slice(a.start,a.string.indexOf(";",a.start)),c=V.filter(c,d)[0]))return a.pos=a.start+c.length,b=a.current(),e("deprecated","deprecated",b);b=b.toLowerCase();return/^null$/.test(b)?e("constant","constant"):w.hasOwnProperty(b)?e(w[b],w[b],b):e("variable","variable",b)}function k(a){return function(b,c){for(var d=!1,h;null!=(h=b.next());){d=
b.string[b.pos-2];d=h===a&&"\\"==d?!0:!1;if(h===a&&!d)break;d===!d&&"\\"===h}d||(c.tokenize=f);return e("string","string")}}function r(a){return function(b,c){for(var d;null!=(d=b.next())&&d!==a;)!1;c.tokenize=f;return e("constant","constant")}}function A(a,b){for(var c=!1,d;d=a.next();){if("/"===d&&c){b.tokenize=f;b.multiLineComment=!1;break}c="*"===d}return e("comment","comment")}function p(a,b,c,d,h,e){this.indented=a;this.column=b;this.type=c;this.prev=h;this.info=e;null!==d&&(this.align=d)}function l(){for(var a=
arguments.length-1;0<=a;a--)F.cc.push(arguments[a])}function m(){l.apply(null,arguments);return!0}function t(a,b){for(;a;a=a.next)if(a.name===b)return"nview"===a.dType.toLowerCase()?(b={datatype:a.dType,formName:a.formName},a.hasOwnProperty("appLinkName")&&(b.appLinkName=a.appLinkName),b):a.dType;return null}function q(a,b,c,d){var h=d.value,e=h.replace(/\s/g,"");if(null!==b){if(c)return{dataType:c};var v=builtin.getReturnType(b);return{dataType:v}}if(""!==h){if(h.match(/\d*/)==h)return{dataType:"bigint"};
if(h.match(/\d*\.\d+/)==h)return{dataType:"decimal"};if(e.match(/^"[^"]*"$/))return{dataType:"string"};if(e.match(/^['][0-9]?[0-9][:][0-9]?[0-9][:][0-9]?[0-9]([\\s]?[aApP][Mm])?[']$/))return{dataType:"time"};if(e.match(/^['].*[']$/))return{dataType:"datetime"};if(h.match(/^(true|false)$/))return{dataType:"bool"};if(h.match(/collection\(.*\)/i))return{dataType:"collection"};if(h.match(/{((\w*|"\w*")(,(\w*|"\w*"))*)?}/)||e.match(/^List\(.*\)$/i)||e.match(/^List:([a-zA-Z]*)\(.*\)$/i)||e.match(/^\[.*\]$/))return{dataType:"list"};
if(h.match(/{(\w*|"\w*"):(\w*|"\w*"|\d*)((,\s*(\w*|"\w*"):(\w*|"\w*"|\d*))*)}/)||h.match(/map\(.*\)/i))return{dataType:"map"};if(h.match(/\w*/)){if(a===d.value)return null;a=F.state;h.match(/\w*/);var f;if(h.match(/^null$/i))return{dataType:"nullable"};if(b=h.match(/^\w+$/))return null!==(v=t(a.globalVars,h))?{dataType:v}:u&&null!==(f=u.isFormfield(h))?{dataType:f}:null;if(u&&u.getSubformAutocompleteStatus()&&(b=e.match(/(?:([a-zA-Z_][a-zA-Z0-9_]*)\.)?([a-zA-Z_][a-zA-Z0-9_]*)\(\)/)))return{dataType:"subform",
formName:b[1],fieldName:b[2]};if(b=e.match(/([a-zA-Z_][a-zA-Z0-9_]*)\s*\[(.*)[\s*]*=[\s*]*(.*)\]([\s]*\.[a-zA-Z0-9_]+)?([\s]sort[\s]+by[\s]+[a-zA-Z0-9_]+([\s]+(desc|asc))?)?([\s]+range[\s]+from[\s]+[a-zA-Z0-9_.]+[\s]+to[\s]+[a-zA-Z0-9_.]+)?/))return{dataType:"NView",formName:b[1],appLinkName:u&&u.getDelugeAppLinkName()};if(h=getLastFName(e))if(")"===e.slice(-1)){f=DelugeBuiltInFunction.getFunctionReturnType(h);if(null!==f)return{dataType:f};e=e.slice(0,e.indexOf("("));if((e=u&&u.isUserDefinedFunction(e))&&
e.hasOwnProperty("returnType"))return{dataType:e.returnType}}else if(b=e.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\s*\[.*\]/)){if(e=b[1],h.match(/^\w+$/))return e=u&&u.getFormfieldReturnType(e,h),{dataType:e}}else{if(e.match(/([a-zA-Z_][a-zA-Z0-9_]*)\./)){f=e.match(/([a-zA-Z_][a-zA-Z0-9_]*)\./);if(e.match(/zoho\..*/))return e=getZohoVariableType(e)||"object",{dataType:e};e=f[1];if(/row|input|old/.test(e))return e=u&&u.getDelugeFormLinkName(),e=u&&u.getFormfieldReturnType(e,h),{dataType:e};e=(f=t(a.globalVars,
e))&&f.hasOwnProperty("formName")?f.formName:null;if(h.match(/^\w+$/))return e=u&&u.getFormfieldReturnType(e,h),null==e||isDelugeDataType(e)?{dataType:"object"}:{dataType:"NView",formName:e,appLinkName:u&&u.getDelugeAppLinkName()}}return{dataType:"object"}}}}}function z(a,b){var c=function(){var c=F.state;c.lexical=new p(c.indented,F.stream.column(),a,null,c.lexical,b)};c.lex=!0;return c}function H(){var a=F.state;a.lexical.prev&&(")"===a.lexical.type&&(a.indented=a.lexical.indented),a.lexical=a.lexical.prev)}
function x(a,b,c,d){if("variable"===a){a:{var h=c.string;a=null;var e=getKeyValue(h),v=e.key,f=e.value;e=F.state;var E=!1,k=!1;isShowHint(h)?e.showHint=!0:e.showHint=!1;FOR_EACH_REC_PATTERN.test(v)&&(E=!0);C.test(h)&&(k=!0);if(/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(v)||E||k){if("undefined"!=typeof n&&null!=n){var I=n.getCursor();n.getLine(I.line);c=c.string.trim();if(";"!==c[c.length-1]&&!E&&!k||u&&u.isFormfield(v))break a;findTypeString=h.slice(0,I.ch)}if(h.match(/(.*)\s*=\s*(.*);/)&&!h.match(TAGS_SEARCH_PATTERN)||
E||k){k?c={}:(c={key:v,value:f},c=DRE.serviceFlags.isEnabled("peg-parser")?{dataType:DelugeEditorUtil.peg_start(h,F.state.globalVars,u)}:q(h,null,"defaultType",c),c=c||(E?{}:null));if(c){if((a=c.dataType)&&a.hasOwnProperty("datatype"))c=a,a=a.datatype;else if(null==a)if(E)if((f=h.match(FOR_EACH_REC_PATTERN))&&f[1]&&f[3]){v=f[1];0==f[2].indexOf("input")&&(f[2]=f[2].slice(6));-1!=f[3].indexOf(".")&&(f[3]=f[3].split(".")[1]);if(delugeVarInList(e.globalVars,f[3],"list"))a="object";else if(/for[\s*]*each[\s*]*([a-zA-Z_][a-zA-Z0-9_]*)[\s*]*in[\s*]*((input.)?([a-zA-Z_.][a-zA-Z0-9_.]*\((.*)\)))/.test(h))a=
"object";else{a="NView";c.formName=f[3];c.appLinkName=u&&u.getDelugeAppLinkName();var p=h.match(/for[\s*]*each[\s*]*([a-zA-Z_][a-zA-Z0-9_]*)[\s*]*in[\s*]*((input.)?([a-zA-Z_.][a-zA-Z0-9_.]*(?:\[.*\])?))/i);if(p)if(/\[.*\]/.test(p[2]))a="NView",c.formName=f[3],c.appLinkName=u&&u.getDelugeAppLinkName();else if(p=t(e.globalVars,f[3]))a="NView",c.formName=f[3],c.appLinkName=u&&u.getDelugeAppLinkName(),p.hasOwnProperty("appLinkName")&&(c.appLinkName=p.appLinkName),c.formName=p.formName}c.isForEachVar=
!0;c.dataType=a}else{if(f=h.match(FOR_EACH_PATTERN))a="bigint",c.isForEachVar=!0,c.dataType=a,v=f[2]}else if(k){if((f=h.match(C))&&f[1]&&f[2])if(a=null,f[3])for(p in h=f[3].split(/\s*,\s*/),u&&(u.delugeFunctionArgs=[]),h){if(h.hasOwnProperty(p)&&(E=h[p].split(/\s+/),f=E[0],E=E[1],I={},/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(E))){if(-1!=f.indexOf(":")){var r=f.split(":")[0].trim();-1<r.indexOf("list")?f="list":-1<r.indexOf("map")&&(f="map")}B.test(f)?f=getDelugeDataType(f):(I.formName=f,f="NView");I.name=
E;I.type=f;u&&u.isFunctionArgPresent(E,f)||u&&u.delugeFunctionArgs.push(I)}}else u&&(u.delugeFunctionArgs=[])}else INSERT_INTO_PATTERN.test(f)&&(a="bigint");if(!isDelugeDataType(a)&&!k)break a}delugeVarInList(e.globalVars,v,a)||(b&&!d&&null!==a&&(b={name:v,dType:a,next:e.globalVars?e.globalVars:null},c.hasOwnProperty("formName")&&(b.formName=c.formName),c.hasOwnProperty("fieldName")&&(b.fieldName=c.fieldName),c.hasOwnProperty("appLinkName")&&(b.appLinkName=c.appLinkName),c.hasOwnProperty("isForEachVar")&&
(b.isForEachVar=c.isForEachVar),e.globalVars=b),u&&u.addFuncParamsToGlobalVar(e))}}}return m(z("vardef"))}"{"===a&&m(z("{"),g,H);return l(z("stat"))}function g(a){return"}"===a?m():l(x,g)}function y(a,b){if("keyword b"===a&&"else"===b)return m(z("form"),x,H)}var G=b.json,K=a.indentUnit,M=b.statementIndent,u=a.metadata,n=a.editor,N=a.panelMap,w={},C=new RegExp("^[s*]*("+DATATYPE_TAGS.join("|")+")+\\s*(.*)\\(\\s*([^)]+?)?\\s*\\)","i"),B=new RegExp("^("+DATATYPE_TAGS.join("|")+")$","i"),V=DelugeBuiltInFunction.getDeprecatedFunctions(),
ba=new RegExp(V.join("|"));CodeMirror.prototype.delugeModeHelpers={init:function(a){d(a)}};var O="+-*%^/\x3d".split(""),h,v,F={state:null,column:null,marked:null,cc:null};H.lex=!0;return{startState:function(a){d(N);return{tokenize:f,reAllowed:!0,kwAllowed:!0,cc:[],lexical:new p((a||0)-K,0,"block",!1),globalVars:b.globalVars,context:b.globalVars&&{vars:b.globalVars},indented:0,startOfLine:!0}},token:function(a,b){a.sol()&&(b.lexical.hasOwnProperty("align")||(b.lexical.align=!1),b.indented=a.indentation());
if(a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"===h)return c;b.reAllowed=!!("operator"===h||"keyword c"===h||h&&h.match(/^[\[{}\(,;:]$/));a:{var d=h,e=v,f=a.string,g=b.cc;F.state=b;F.stream=a;F.marked=null;F.cc=g;b.lexical.hasOwnProperty("align")||(b.lexical.align=!0);for(d&&x(d,e,a,E);;){b=g.length?g.pop():x;d=getKeyValue(f);var E=/^\w+\.\w+/.test(d.key);if(500<a.string.length){a=null;break a}d="variable";if(b(d,e,a,E)){for(;g.length&&g[g.length-1].lex;)g.pop()();if(F.marked){a=F.marked;
break a}a=c;break a}}}return a},indent:function(a,c){if(a.tokenize===A)return CodeMirror.Pass;if(a.tokenize!==f)return 0;for(var d=c&&c.charAt(0),h=a.lexical,e=a.cc.length-1;0<=e;--e){var v=a.cc[e];if(v===H)h=h.prev;else if(v!==y)break}"stat"===h.type&&"}"===d&&(h=h.prev);M&&"}"===h.type&&"stat"===h.prev.type&&(h=h.prev);e=h.type;v=d===e;return"vardef"===e?"}"===d||"]"===d||")"===d?h.indented:isElectricChar(a.lexical.prev.type)?h.indented+K:h.indented+("operator"===a.lastType||","===a.lastType?h.info+
1:0):"form"===e&&"{"===d?h.indented:"form"===e?h.indented+K:"stat"===e?h.indented+("operator"===a.lastType||","===a.lastType?M||K:0):"switch"!==h.info||v||!1===b.doubleIndentSwitch?h.align?h.column+(v?0:1):h.indented+(v?0:K):h.indented+(/^(?:case|default)\b/.test(c)?K:2*K)},electricChars:"{}[]()",blockCommentStart:G?null:"/*",blockCommentEnd:G?null:"*/",lineComment:G?null:"//",fold:"brace"}});CodeMirror.defineMIME("text/deluge","deluge");var DelugeShortcutsContext={push:function(){KeyUtil.init(AppContexts.DELUGEEDITOR)},pop:function(){Shortcut.popContext(KeyContexts.DELUGEEDITOR)}},DelugeEvents={destroy:function(a){DelugePanePopup.hide();DelugeBuilderPopup.hide();a&&(a.hideErrorMessage(),a.destroy())}},DelugeExecuteWorkflow={handle:function(a,b){if(null!=a){a=a.replace(/\n/g,"");a=DelugeUtil.getDivElement(a);var c=a.querySelector("form[elname\x3dexecuteWorkflowWithArgs]"),d=c?ZCButton.SUBMIT:ZCButton.EXECUTEAGAIN;this.initEvent(a);
this.initCopyEvent(a);this.initArgToolTip(c);iCustomizePopup({success:function(){b(c,!0);return!0},buttons:[{name:d,type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CLOSE,type:ZCModalConstants.MODAL_CANCEL}],title:i18n["zc.workflow.builder.functions.executefunction"],body:a},function(a){$(a.parentContainer).find("#errorInfo \x3e table \x3e tbody \x3e tr:first").remove()})}},initEvent:function(a){var b=a.querySelectorAll(".dtpicker input");b&&$(b).dtPicker({format:"DD-MMM-YYYY HH:mm:ss",initParent:!0,
showIcon:!0,iconClass:"calTimeIcon flLeft zc-em zc-fb-date-Time",showClearValue:!0});a=a.querySelectorAll(".zoho-picklist");$(a).zcDropDown()},initCopyEvent:function(a){try{new Clipboard(".deluge-execute-copy-action",{text:function(a){return a.parentElement.parentElement.querySelector(".zc-dem-execute-script-content").innerText}})}catch(b){}},initArgToolTip:function(a){$(a).find(".zc-dem-form-label span").off("mouseover").on("mouseover",function(){var a=$(this).text().trim();this.offsetWidth<this.scrollWidth&&
$(this).zcTooltip({title:a,className:"zc-function-tooltip",position:"right"}).show()})}};
function initializeDelugeEditor(a,b){function c(a){function b(a){a.delugeArea.setAttribute("gutter",!1);var b=a.delugeArea.querySelector(".CodeMirror-gutter"),c=a.delugeArea.querySelector(".CodeMirror-scroll");c.addEventListener("mouseover",function(b){b.relatedTarget&&(b=b.relatedTarget.classList,(b.contains("CodeMirror-guttermarker-subtle")||b.contains("CodeMirror-linenumber")||b.contains("CodeMirror-gutter")||b.contains("CodeMirror-gutters"))&&a.delugeArea.setAttribute("gutter",!0))});c.addEventListener("mouseout",
function(c){if(c.relatedTarget){var d=c.relatedTarget.classList,e=b.getBoundingClientRect();c=c.clientX<e.left+e.width&&c.clientX>e.left;d=!d.contains("CodeMirror-guttermarker-subtle")&&!d.contains("CodeMirror-linenumber")&&!d.contains("CodeMirror-gutter")&&!d.contains("CodeMirror-gutters")&&!d.contains("CodeMirror-activeline-gutter");!c&&d&&a.delugeArea.setAttribute("gutter",!1)}})}a&&a.delugeArea&&("plain"!=a.getMode()&&b(a),a.customScroll&&a.customScroll("leftpane"))}function d(){window.onbeforeunload=
null;document.body.removeEventListener("keydown",l,!1)}function e(){this.editor.saveScript()}function f(a,b){var c=this;b=null==b||b;if(c.isEditorContentModified()&&$(c.delugeArea).is(":visible"))return iConfirm({title:i18n["zc.workflowbuilder.unsavedchanges"],message:i18n["zc.workflowbuilder.changeslost"],button:ZCButton.CLOSENAYWAY,cbutton:ZCButton.CANCEL,success:function(){a&&a.call();b&&c.destroy()},failure:function(){c.focusEditor()}}),!1;a&&a.call();b&&c.destroy();return!0}function k(a,b,c){if("failure"==
a.status){a=a.errorMessage;var d="error";this.rollbackContent();c&&c.call()}else c=null!=a.accessInfo&&""!=a.accessInfo&&a.accessInfo,a=null!=a.warningMessage&&""!=a.warningMessage&&a.warningMessage||c||null,d="warning",b&&b.call();null!=a?this.showErrorMessage(a,d):(b=this.delugeArea.querySelector(".deluge-error-msg-container"))&&(b.style.display="none")}function r(a,b){return"plain"!=a.getMode()&&b.header?(b=b.metadata,new DelugeReferFields(a,{appName:variable.appLinkName,formName:b&&b.formLinkName,
callback:function(){var b=a.delugeArea.querySelector(".deluge-error-msg-container");DelugeReferFields.isVisible(a.delugeArea)?b&&b.classList.add("deluge-error-msg-ref"):b&&b.classList.remove("deluge-error-msg-ref")}})):null}function A(){var a={externalServices:{clockworksms:["sms"],hoiio:["sms"],clickatell:["sms"],smsmagic:["sms"],nexmo:["sms"],twilio:["sms"]},defaultZohoServices:["crm","reports","calendar","support"],defaultTaskRestrictions:{zoho:{crm:["invokeConnector","getOrgVariable"],cliq:["postToChatAsAdmin",
"postToChannelAsAdmin"],recruit:"_addRecord _getRecords _searchRecords _updateRecord _getRecordById _uploadDocument".split(" "),writer:["mergeAndDownload"]}},getDomainBasedZohoServices:function(b){b=b||DelugeUtil.getDomain();var c=a.defaultZohoServices;switch(b){case "skydesk":break;default:c.push("subscriptions","invoice","recruit","books","sdpod","desk","sign","inventory","workdrive","ai","sheet","writer","projects","docs","map","connect","notebook","creator","people","chat","service","bookings",
"outlook","cliq")}return{zoho:c}},getDomainBasedTasksRestrictions:function(){var b=b||DelugeUtil.getDomain(),c=a.defaultTaskRestrictions;switch(b){case "skydesk":c.google=["drive"]}return c},getDomainBasedExternalServices:function(){var b=b||DelugeUtil.getDomain(),c=a.externalServices;switch(b){case "skydesk":break;default:c.google=["drive"]}return c}};return{integrationTasks:a}}function p(a){function b(b){var c=b.keyCode||b.which;!b.ctrlKey||b.shiftKey||b.altKey||b.metaKey||32!=c||(b.delugeHint=
function(){a.editor.execCommand("autocomplete")})}var c=a.delugeArea;c&&(c.addEventListener("keydown",b,!0),document.body.addEventListener("keydown",l,!1))}function l(a){var b=a.keyCode||a.which;!a.ctrlKey||a.shiftKey||a.altKey||a.metaKey||32!=b||!a.delugeHint||(a.delugeHint(),a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())}function m(a){a.editor.metadata.allowedIntegServices.get=function(a){switch(a){case "skydesk":return{clockworksms:["sms"],hoiio:["sms"],clickatell:["sms"],
zoho:["crm","reports","calendar","support"],smsmagic:["sms"],twilio:["sms"]};default:return{clockworksms:["sms"],google:["drive"],hoiio:["sms"],clickatell:["sms"],zoho:"crm reports calendar subscriptions invoice recruit books sdp desk sign inventory workdrive ai sheet writer projects docs map connect notebook creator people chat service bookings outlook cliq".split(" "),smsmagic:["sms"],twilio:["sms"]}}};a.editor.metadata.allowedIntegServices.getActionExceptions=function(a){return{crm:["invokeConnector",
"getOrgVariable"],cliq:["postToChatAsAdmin","postToChannelAsAdmin"],recruit:"_addRecord _getRecords _searchRecords _updateRecord _getRecordById _uploadDocument".split(" ")}[a]}}a=a?a:document.getElementById("delugeEditorArea");b=b?b:{};if(a){var t=b.hasOwnProperty("preventWarning")?b.preventWarning:!1,q=null;b.hasOwnProperty("metadata")&&b.metadata.hasOwnProperty("appLinkName")&&(b.metadata.appLinkName=b.metadata.appLinkName.replace(/-/g,"_"));b.loadMeta=b.hasOwnProperty("loadMeta")?b.loadMeta:!0;
if(a.querySelector(".deluge-code-area"))return delugeEditor.setOptions(b),m(delugeEditor),null;b.editWidget=!0;b.service="ZohoCreator";b.header=b.hasOwnProperty("header")?b.header:!0;b.headerTitle=i18n["zc.deluge.leftpane.header"];b.footer=b.hasOwnProperty("footer")?b.footer:!1;b.shortcutKeys=!1;b.scopeName=variable.scopeName;b.appLinkName=variable.appLinkName;b.advancedFeatures=b.hasOwnProperty("advancedFeatures")?b.advancedFeatures:!0;b.builder=DelugeBuilderParser;b.subformAutocomplete=!0;b.topBar=
b.hasOwnProperty("topBar")?b.topBar:{config:[{type:"referfields",label:i18n["zc.deluge.referfields.title"],action:"add",image:"\x3ci class\x3d'zc-em zc-refer-fields'\x3e\x3c/i\x3e",after:"Versions",customChildClass:"deluge-refer-fields-icon",attachEvent:{event:"click",action:function(a){if(a=a.currentTarget){var b=a.parentNode.querySelector(".deluge-actions-menu-active");b&&a!=b&&b.click();DelugeUtil.arrayContains(a.classList,"deluge-actions-menu-active")?a.className="deluge-actions-menu":a.className+=
" deluge-actions-menu-active"}}},init:function(){}},{type:"connections",label:i18n["zc.c5.setup.connections.title"],action:"add",image:"\x3ci class\x3d'zc-li-outline tech-2-connection'\x3e\x3c/i\x3e",before:"Versions",attachEvent:{event:"click",action:function(a){ComponentBuilder.getConnectionsList(b.connectionUrl)}}},{type:"menu",action:"hide"}]};b.version={actionClass:DelugeVersions,baseUrl:"/appbuilder/"+GlobalUrls.getAppUrlFragment(variable.appLinkName)+"/workflowbuilder/edit",versionsUrl:"getVersions",
scriptUrl:"getVersionsScript"};b.hasOwnProperty("hintRestrictionMap")||(b.hintRestrictionMap=["row","old"]);q=new DelugeEditorWrapper(a,b,A());c(q);b&&b.hasOwnProperty("callback")&&b.callback(q);"undefined"!=typeof ConnectionContext&&ConnectionContext.initHandlebars();var z;if(appbuilder.bootConfig.useCompression&&"undefined"!=typeof Requires){var H=new Requires(Modules.CLIPBOARD);require(H.get(),H.getPromise(function(){x=(z=r(q,b))&&function(){z.changeAppDropdown()};b.loadMeta&&q.loadAppMetaInfo(b.sharedBy,
x)}))}else{var x=(z=r(q,b))&&function(){z.changeAppDropdown()};b.loadMeta&&q.loadAppMetaInfo(b.sharedBy,x)}DelugeBuiltInFunction.loadBuiltInFunctions();q.destroy=d;q.verifyScriptChange=f;q.handleResponse=k;q.saveAction=e;p(q);window.onbeforeunload=function(){if(0==t&&a&&q.isEditorContentModified())return"You have not saved the recent changes !"};return q}};var DelugeBuilder=function(a){function b(a){return null==a||void 0==a||""==a||a&&0==a.length?!0:!1}function c(a){return b(a)||"none"==a.toLowerCase()||"-- Select --"==a||"No fields available"==a||"No collection variables found"==a?!1:!0}function d(a,b){var c=b&&b.title?b.title:a.label;c=b&&b.titlePrefix?b.titlePrefix+c:c;b="\x3cdiv class\x3d'deluge-expr-header'\x3e\x3cspan class\x3d'deluge-expr-title'\x3e"+c+"\x3c/span\x3e";a.hasOwnProperty("description")&&(b+="\x3cspan class\x3d'deluge-expr-header-desc'\x3e"+
a.description+"\x3c/span\x3e");a.hasOwnProperty("cols")&&(c=f(a))&&(b+=c.outerHTML);if(a.hasOwnProperty("closeButton")?a.closeButton:1)b+="\x3cspan class\x3d'deluge-close-icon'\x3e\x3ci class\x3d'de de-close'\x3e\x3c/i\x3e\x3c/span\x3e";return DelugeUtil.getDivElement(b+"\x3c/div\x3e",C.ROW+" deluge-expr-builder-header")}function e(a){a=a.querySelectorAll("span[deluge-btag]");DelugeUtil.attachEventForAll(a,"mouseover",function(a){V.tag(this)});DelugeUtil.attachEventForAll(a,"click",function(a){V.scrollElem(this)})}
function f(a){if((a=a.cols)&&0<a.length){for(var b="",c=0;c<a.length;c++){var d=a[c];switch(d.buttonType){case "primary":b+="\x3cdiv class\x3d'deluge-expr-btn deluge-expr-save'\x3e"+d.label+"\x3c/div\x3e";break;case "secondary":b+="\x3cdiv class\x3d'deluge-expr-btn deluge-expr-cancel'\x3e"+d.label+"\x3c/div\x3e"}}a=b}else a=void 0;return a&&0<a.length?DelugeUtil.getDivElement("\x3cdiv class\x3d'deluge-expr-buttons'\x3e"+a+"\x3c/div\x3e").childNodes[0]:null}function k(a){return"\x3cdiv class\x3d'deluge-expr-input-label'\x3e"+
a.label+x(a)+"\x3c/div\x3e"}function r(a,b){DelugeUtil.attachEvent(a,"click",function(){var b=a.getAttribute("toggle");A(a,"true"!=b)})}function A(a,b){a.setAttribute("toggle",b);n.customScroll&&n.customScroll();n.popup&&n.popup.resize&&n.popup.resize()}function p(a){a&&(a=a.replace(/"/g,"\x26quot;"));return a}function l(a){try{a=DOMPurify.sanitize(a)}catch(v){a&&(a=a.replace(/"/g,"\x26quot;"),a=a.replace(/'/g,"\x26#39;"))}return a}function m(a,b,c){c=c?c:"";for(var d in a)if(a.hasOwnProperty(d)){var h=
a[d],e={};e.name=c.replace(/\./g,"_")+h.linkName;e.mandatory=h.isMandatory;e.label=c+h.linkName;e.type="input";e.dataType=h.type.toLowerCase();e.expressionCapable=!0;h.isMandatory&&(e.mandatory=!0);b.push(e)}}function t(a){return'\x3cdiv attr\x3d"group" class\x3d"de-dropdown-headder"\x3e'+a+'\x3ci class\x3d"de de-arrow-down"\x3e\x3c/i\x3e\x3c/div\x3e'}function q(a,b){if(a){b="\x3cli\x3e"+t(b);b+='\x3cdiv class\x3d"de-dropdown-elements"\x3e';var c=0,d;for(d in a)if(a.hasOwnProperty(d)){var h="";a[d].hasOwnProperty("linkName")?
(h=a[d].linkName,c++):a[d].hasOwnProperty("name")&&(h=a[d].name,c++);b+="\x3cspan value\x3d"+h+"\x3e"+h+"\x3c/span\x3e"}if(0<c)return b+"\x3c/div\x3e\x3c/li\x3e"}return""}function z(a,b,c,d,e){function h(){z(a,b,c,d,e);n.popup&&n.popup.resize&&n.popup.resize()}var f=b.action,v=[];e=e?null:h;switch(b.name){case "app_link_name":v=f.method.call(n.delugeMeta,c,e);g(b.action.relatedTo);v&&0<=v.length?(n.loading.hide(),v.unshift("default namespace"),n.initArray[f.relatedTo[0]].innerHTML=G(v),v=new CustomEvent("change"),
a.hasOwnProperty("options")&&(a.options.app_namespaces&&(n.initArray[f.relatedTo[0]].value=a.options.app_namespaces),v.options=a.options),n.initArray[b.action.relatedTo[0]].dispatchEvent(v)):n.loading.show(n.container.parentNode);break;case "app_namespaces":v=f.hasOwnProperty("value")?n.initArray[f.value]:null;v=f.method.call(n.delugeMeta,v.value,c,null,e);v=n.delugeMeta.getFunctionNames(v);g(b.action.relatedTo);if(v&&0<=v.length){n.loading.hide();v.unshift("-- Select --");n.initArray[f.relatedTo[0]].innerHTML=
G(v);var F=new CustomEvent("change");a.hasOwnProperty("options")&&(a.options.app_functions&&(n.initArray[f.relatedTo[0]].value=a.options.app_functions),F.options=a.options);1<v.length&&n.initArray[b.action.relatedTo[0]].dispatchEvent(F)}else n.loading.show(n.container.parentNode);break;case "app_functions":if(g(b.action.relatedTo),f.hasOwnProperty("value")){v=n.initArray[f.value[0]].value;F=n.initArray[f.value[1]].value;F="default"==F?"":F;var l=n.initArray[b.name].value;null!=l&&"-- Select --"!=
l&&(f=f.method.call(n.delugeMeta,v,F,l,e),n.showFunctionParams(f,d))}}n.popup&&n.popup.resize&&n.popup.resize()}function H(a){return a&&a.expressionCapable?"\x3cspan class\x3d'deluge-expr-insert-expr-icon' title\x3d'Advanced Edit'\x3e\x3ci class\x3d'de de-code'\x3e\x3c/i\x3e\x3c/span\x3e":""}function x(a){return a.hasOwnProperty("mandatory")&&a.mandatory&&(a.hasOwnProperty("mandatorySymbol")?a.mandatorySymbol:1)?"\x3cspan class\x3d'deluge-expr-mandatory'\x3e*\x3c/span\x3e":""}function g(a){if(a)for(var b in a)a.hasOwnProperty(b)&&
(n.initArray[a[b]].innerHTML="");n.initArray.function_params.style.display="none"}function y(a,b){b=b&&b.expressionCapable;a&&b&&a.setAttribute("expr-builder",!0)}function G(a){if(a){for(var b="",c=0;c<a.length;c++){var d=a[c],h=-1==d.toLowerCase().indexOf("-- select --")||-1==d.toLowerCase().indexOf("default namespace")?" value\x3d'"+d+"'":"";b+="\x3coption "+h+"\x3e"+d+"\x3c/option\x3e"}return b}}function K(a,b){return c(b)?a.gatherVariables(n.sharedVars,!0)[b]:null}function M(a,b,c,d,e,f,g){a=
a.getGroupedFormFields(b,d,f);b=[];if(a){if(0==a.length)return b;for(var h in a)if(a.hasOwnProperty(h)){d=a[h];f=c&&!arrayContains(c,d.componentType);var v=e&&arrayContains(e,d.type),F=d.isSystemField&&g&&arrayContains(g,d.linkName)||!d.isSystemField||!g;(f||!c&&!e||v&&F)&&b.push(d.linkName)}return b}return null}function u(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b+="\x3coption value\x3d'"+a[c]+"'\x3e"+a[c]+"\x3c/option\x3e");0==b.length&&(b+="\x3coption \x3eNo fields available\x3c/option\x3e");
return b}var n=this,N="",w=new RegExp("\x3c("+TAGS_VALUES.join("|")+")\x3e","ig"),C={ROW:"deluge-expr-row",INPUT_DIV:"deluge-expr-input-div",TOGGLE:"deluge-expr-toggle",DS_INPUT:"deluge-expr-ds-input"},B=this.CONSTANTS=Object.freeze({IF:"if",ELSE_IF:"else if",CONDITIONAL_IF:"conditional if",SET_VARIABLE:"set variable",SEND_MAIL:"send mail",SEND_SMS:"send sms",INVOKE_URL:"invoke url",INTEGRATION:"integration",OPEN_URL:"open url",CALL_FUNCTION:"call function",INSERT_INTO:"insert into",FETCH_RECORD:"fetch record",
SORT_AND_RANGE:"sort and range",AGGREGATE_RECORD:"aggregate record",FOR_EACH_RECORD:"for each record",DELETE_RECORD:"delete record",UPDATE_RECORD:"update record",INFO:"info",RETURN:"return",ALERT:"alert",CRITERIA:"criteria",EXPRESSION:"expression"});this.modulesMeta=null;this.type=a;this.initArray={};this.lazyArray={};this.additionalParams=[];this.mandatoryFields={};this.NInputs=[];this.editorHintPreset={};this.hintFieldRestrictions=[];this.popup=null;this.init=function(a,b,c){N=b?b.spaces:N;b&&(this.options=
b,b.popup&&(this.popup=b.popup));a&&(this.saveFnCallback=a);c&&(this.sharedVars=c);this.construct();this.initialize();this.attachEvents()};this.setFromRichText=function(a){this.fromRichText=a};this.setHintFieldRestriction=function(a){this.hintFieldRestrictions=a};this.isFromRichText=function(){return this.fromRichText};this.initialize=function(){switch(this.type){case B.EXPRESSION:case B.CRITERIA:var a=this.editorHintPreset?this.editorHintPreset.formLinkName:null;a&&refreshTabValues(a);break;case B.INSERT_INTO:this.populateFields(this.initArray.insert_form_name.value);
break;case B.DELETE_RECORD:case B.FOR_EACH_RECORD:n.setEditorPreset({formLinkName:this.lazyArray.form_name});this.setFormName();break;case B.FETCH_RECORD:this.updateFetchFields(this.lazyArray.fetch_form_name,null,this.options.fetch_field_value,this.options.fetch_sort_field);break;case B.AGGREGATE_RECORD:this.updateAggregateFields(this.lazyArray.aggregate_form,null,this.options.aggregate_field);break;case B.UPDATE_RECORD:this.changeFields(this.lazyArray.collection_var);this.options.field_name&&(this.initArray.field_name.value=
this.options.field_name);break;case B.CALL_FUNCTION:this.delugeMeta.getUserDefinedFunctions(this.options.app_link_name||this.initArray.app_link_name.value,null,null,function(){n.initialize.call(n)});a=new CustomEvent("change");a.options=this.options;n.initArray.app_link_name.dispatchEvent(a);break;case B.INTEGRATION:this.refreshIntegrationFunction(this.initArray.integ_service.value,this.options);break;case B.OPEN_URL:n.showWindowParams(this.initArray.window_type.value)}setTimeout(function(){switch(n.type){case B.CRITERIA:case B.EXPRESSION:n.exprEditor.focusEditor();
break;default:var a=n.container.querySelector("input");a&&a.focus()}},100)};this.attachEvents=function(){if(this.container){var a=this.container.querySelector(".deluge-close-icon");a&&a.addEventListener("click",function(){n.popup&&n.popup.hide();n.destroy();window.tempZE_Init&&(window.ZE_Init=window.tempZE_Init)});(a=this.container.querySelector(".deluge-expr-cancel"))&&a.addEventListener("click",function(){n.popup&&n.popup.hide();n.destroy()});(a=this.container.querySelector(".deluge-expr-save"))&&
a.addEventListener("click",function(){var a=n.getFinalValue();a.errorFree&&(n.isFromRichText()||n.type==B.SEND_MAIL?n.saveFnCallback(a.value,function(){n.destroy();n.popup&&n.popup.hide()}):(n.saveFnCallback(a.value),n.destroy(),n.popup&&n.popup.hide()))})}};this.destroyVariables=function(){this.modulesMeta=null;this.type=a;this.initArray={};this.lazyArray={};this.additionalParams=[];this.mandatoryFields={};this.NInputs=[];this.editorHintPreset={};this.container=this.sharedVars=this.saveFnCallback=
this.options=null;this.exprEditor&&this.exprEditor.destroy();this.descriptionDiv=this.exprEditor=null};this.destroy=function(){};this.construct=function(){var a=n.modulesMeta,b=n.getModifiedClassName(b),c=document.createElement("div");c.setAttribute("class","deluge-expr-builder "+b);c.appendChild(d(a[0],this.options));b=DelugeUtil.getDivElement("","deluge-expr-main-content");!arrayContains([n.CONSTANTS.CRITERIA,n.CONSTANTS.EXPRESSION],n.type)&&n.type&&(b.className+=" deluge-scroll");var e=a.length,
g=a[a.length-1];g&&"footer"==g.type&&--e;for(g=1;g<e;g++){var l=this.getRowConstruct(a[g]);l&&b.appendChild(l)}c.appendChild(b);(a=f(a[a.length-1]))&&c.appendChild(a);this.container=c};this.getModifiedClassName=function(a){return a=(a=a||n.type)?"deluge-expr-"+a.trim().replace(/\s/g,"-").toLowerCase():""};this.initializeEditor=function(a,b){if(this.exprEditor)this.exprEditor.setSharedVariables(b),this.exprEditor.gotoLine(a.split("\n").length,a.length+1),this.exprEditor.setEditorContent(a),this.setEditorPreset(this.editorHintPreset),
this.exprEditor.refreshEditor(),this.exprEditor.setHintFieldRestriction(this.hintFieldRestrictions);else{var c=this.container.querySelector(".deluge-expr-editor"),d={mode:"plain",position:"static",existingMeta:this.delugeMeta,restrictAllTasks:!0,hintRestrictionMap:this.delugeMeta.getHintRestrictionMap(),isExprBuilderEnabled:!0};a&&(d.script=a);this.exprEditor=initializeDelugeEditor(c,d);this.exprEditor.setSharedVariables(b);this.exprEditor.gotoLine(a.split("\n").length,a.length+1);this.setEditorPreset(this.editorHintPreset);
this.exprEditor.setHintFieldRestriction(this.hintFieldRestrictions);this.exprEditor.refreshEditor()}};this.setEditorPreset=function(a){a.hasOwnProperty("appLinkName")&&a.appLinkName&&this.delugeMeta.setDelugeAppLinkName(a.appLinkName);this.editorHintPreset=a;this.exprEditor&&this.exprEditor.setHintPreset(this.editorHintPreset)};this.getRowConstruct=function(a,b){var c=a.type;b=b?b:this.options;var d=null;switch(c){case "description":d=this.getDescription(a);break;case "dropdown":d=this.getDropdownDiv(a,
b);break;case "input":d=this.getInputElement(a,b);break;case "radio":d=this.getRadioInputDiv(a,b);break;case "hidden":d=this.getHiddenDiv(a,b);break;case "decision_box":d=this.getDecisionBoxDiv(a,b);break;case "textarea":d=this.getTextAreaElement(a,b);break;case "expression":b=a.cols;c="\x3cdiv class\x3d'deluge-expr-textarea-btn'\x3e";for(d=0;d<b.length;d++){var e=b[d];switch(e.type){case "textarea":c+="\x3cdiv class\x3d'deluge-expr-textarea'\x3e\x3ctextarea class\x3d'deluge-expr-input' placeholder\x3d'"+
e.placeholder+"'\x3e\x3c/textarea\x3e\x3c/div\x3e";break;case "buttons":c+="\x3cdiv class\x3d'deluge-expr-buttons'\x3e\x3c/div\x3e"}}d=DelugeUtil.getDivElement(c,C.ROW);break;case "richtext":d=this.getRichTextDiv(a);break;case "editor":b="";a.hasOwnProperty("label")&&(b+="\x3cdiv class\x3d'deluge-expr-input-label deluge-expr-editor-label'\x3e"+a.label+x(a)+"\x3c/div\x3e");b+="\x3cdiv class\x3d'deluge-expr-editor'\x3e\x3c/div\x3e"+O.getErrorDiv();d=DelugeUtil.getDivElement(b,C.ROW+" deluge-expr-editor-row");
break;case "suggestion":b=DelugeUtil.getDivElement("\x3cdiv class\x3d'deluge-expr-suggestions'\x3e\x3cdiv class\x3d'deluge-expr-suggestions-title'\x3e"+a.label+": \x3c/div\x3e\x3cdiv class\x3d'deluge-expr-suggestion-area'\x3e\x3c/div\x3e\x3c/div\x3e",C.ROW+" deluge-expr-suggestion-row");n.showSuggestion("",b);d=b;break;case "inputs":d=this.getInputs(a,b);break;case "label":d=this.getLabel(a);break;case "cols":d=this.getColumns(a,b);break;case "toggle":d=this.getToggleDiv(a,b);break;case "link":d=
this.getLinkElement(a,b)}this.addToMandatoryFields(a);this.appendTags(a,d);return d};var V={clear:function(){var a=n.descriptionDiv.querySelectorAll("span[deluge-btag]");this.dehighlight(a);a=n.container.querySelectorAll(".deluge-expr-row[active-tag]");this.dehighlight(a)},dehighlight:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];c&&c.setAttribute("active-tag",!1)}},tagRow:function(a){V.clear();a.setAttribute("active-tag",!0);a=a.getAttribute("deluge-btag");(a=n.descriptionDiv.querySelector("span[deluge-btag\x3d'"+
a+"']"))&&a.setAttribute("active-tag",!0)},tag:function(a){V.clear();a.setAttribute("active-tag",!0);a=a.getAttribute("deluge-btag");(a=n.container.querySelector(".deluge-expr-row[deluge-btag\x3d'"+a+"']"))&&a.setAttribute("active-tag",!0)},scrollElem:function(a){a=a.getAttribute("deluge-btag");var b=n.container.querySelector(".deluge-expr-row[deluge-btag\x3d'"+a+"']");a=n.container.querySelector(".deluge-expr-main-content");if(b){if(0==b.clientHeight){var c=b;if(c){for(;c.parentElement&&!c.classList.contains("deluge-expr-toggle");)c=
c.parentElement;c&&(c=c.querySelector("div[toggle]"))&&c.setAttribute("toggle","true")}}for(c=n.container.querySelector(".deluge-expr-main-content");!b.isSameNode(c);){var d=b;b=b.parentNode}d=b.isSameNode(c)?d.offsetTop:null;a.scrollTop=d-80}}};this.addToMandatoryFields=function(a){a.mandatory&&a.name&&(this.mandatoryFields[a.name]=a.type)};this.appendTags=function(a,b){function c(a){DelugeUtil.attachEvent(a,"mouseover",function(b){V.tagRow(a)})}if(b){var d=this.dbtags;d&&d.hasOwnProperty(a.tag)&&
(b.setAttribute("deluge-btag",d[a.tag]),c(b))}};this.setContentToEditor=function(a){"richtext"==n.type&&0<n.exprEditor.getEditorValue().trim().length&&(a=" + "+a);n.exprEditor.editor.replaceRange(a,n.exprEditor.editor.getCursor());n.exprEditor.focusEditor()};this.insertToTextarea=function(a){var b=n.container.querySelector(".deluge-expr-input");DelugeUtil.insertAtCaret(b,a)};this.insertCodeToEditor=function(a){if(n.exprEditor.editor.getSelection())n.exprEditor.editor.replaceSelection(a);else{var b=
n.exprEditor.getEditorValue(),c=n.exprEditor.editor.getCursor(),d=null;0==b.replace(w,"").trim().length&&(d={line:c.line,ch:b.length},c={line:c.line,ch:0});n.exprEditor.editor.replaceRange(a,c,d)}n.exprEditor.focusEditor()};this.getExpressionFromTextarea=function(){return n.container.querySelector(".deluge-expr-input").value};this.showSuggestion=function(a,b){};this.getFinalValue=function(){var a=this.checkForMandatoryFields();if(!a)return!1;switch(n.type){case B.SET_VARIABLE:var b=this.getSetVariableValue();
break;case B.FOR_EACH_RECORD:b=this.getForEachRecord();break;case B.DELETE_RECORD:b=this.getDeleteRecordValue();break;case B.FETCH_RECORD:b=this.getFetchRecordValue();break;case B.UPDATE_RECORD:b=this.getUpdateRecordValue();break;case B.AGGREGATE_RECORD:b=this.getAggregateRecord();break;case B.SEND_MAIL:b=this.getSendMailValue();break;case B.SEND_SMS:b=this.getSendSMSValue();break;case B.OPEN_URL:b=this.getOpenUrlValue();break;case B.CALL_FUNCTION:b=this.getCallFunctionValue();break;case B.INVOKE_URL:b=
this.getInvokeUrlValues();break;case B.INSERT_INTO:b=this.getInsertIntoValues();break;case B.INTEGRATION:b=this.getIntegrationValue();break;case B.IF:case B.ELSE_IF:b=this.getIfElseValue();break;case B.CONDITIONAL_IF:b=this.getConditionalIfValue();break;case B.INFO:case B.RETURN:case B.ALERT:b=this.getInlineStatementValue();break;default:b=this.exprEditor.getEditorValue()}return{errorFree:a,value:b}};this.checkForMandatoryFields=function(){var a=this.mandatoryFields,d=!0,e=!0,f;for(f in a)if(a.hasOwnProperty(f)){var g=
a[f],l=this.initArray[f],m=!1;if(l){switch(g){case "textarea":case "input":m=b(l.value);break;case "radio":m=l.querySelector("input[type\x3d'radio']:checked");m=b(m&&m.value);break;case "dropdown":m=!c(l.value);break;case "richtext":m=b(this.richTextEditor.getContent())}m&&n.InputError.show(l,n.InputError.MESSAGES.MANDATORY);l.setAttribute("dserror",m);if(e&&m){e=this.container.querySelector(".deluge-expr-main-content");g=l.offsetTop;if(0==g){a:{if(l){for(;!l.classList.contains("deluge-expr-row");)l=
l.parentNode;if(l.classList.contains("deluge-expr-row"))break a}l=null}g=l.offsetTop-100}e.scrollTop=g;e=!1}}d=d&&m?!1:d}return d};this.getInlineStatementValue=function(){return this.type+" "+this.initArray.expression_value.value+";"};this.getIfElseValue=function(){return this.initArray.if_condition.value};this.getConditionalIfValue=function(){return this.initArray.if_variable.value+" \x3d if("+this.initArray.if_condition.value+", "+this.initArray.if_success_value.value+", "+this.initArray.if_failure_value.value+
");"};this.getAggregateRecord=function(){var a=this.initArray.collection_var.value+" \x3d "+this.initArray.aggregate_form.value;var b=this.initArray.aggregate_criteria.value;""!=b&&(a+="[ "+b+" ]");b=this.initArray.aggregate_function.value;var c=this.initArray.aggregate_field.value;"All Records"==c&&(c="");return a+("."+b+"("+c+");")};this.getIntegrationValue=function(){return N+this.initArray.integ_response_variable.value+" \x3d "+this.initArray.integ_service_function.value+this.getParamsInString()};
this.getInsertIntoValues=function(){var a=N+"insert into "+this.initArray.insert_form_name.value+"\n"+N+"[",b=["insert_form_name","insert_form_fields"],c;for(c in this.initArray)if(this.initArray.hasOwnProperty(c)&&!DelugeUtil.arrayContains(b,c)){var d=c,e=this.initArray[c].value;null!=e&&""!=e&&(a+="\n"+N+"\t"+d+" \x3d "+e)}return a+="\n"+N+"]"};this.getInvokeUrlValues=function(){var a=this.initArray.response_variable.value,b=this.initArray.url_string.value,c=this.initArray.request_type.querySelector("input[type\x3d'radio']:checked");
c=c?c.value:"";var d=this.initArray.request_parameters.value,e=this.initArray.request_headers.value,f="",g=this.initArray.connection_name;"-select-"!=g.value.toLowerCase()&&(f=g.value);g="invokeUrl\n";null!=a&&""!=a&&(g=N+a+" \x3d "+g);g+=N+"[\n"+N+"\turl : "+b+"\n"+N+"\ttype : "+c+"\n";null!=d&&""!=d&&(g+=N+"\tparameters : "+d+"\n");null!=e&&""!=e&&(g+=N+"\theaders : "+e+"\n");null!=f&&""!=f&&(g+=N+'\tconnection : "'+f+'"\n');return g+=N+"]"};this.getCallFunctionValue=function(){var a=this.initArray.app_link_name.value;
a=a==this.delugeMeta.getDelugeAppLinkName()?"thisapp":a;var b=this.initArray.app_namespaces.value;return N+a+("default namespace"==b?"":"."+b)+("."+this.initArray.app_functions.value)+this.getParamsInString()};this.getParamsInString=function(){var a="(",b;for(b in this.additionalParams)if(this.additionalParams.hasOwnProperty(b)){var c=this.additionalParams[b];""!=this.initArray[c].value&&(a+=this.initArray[c].value+", ")}1<a.length&&(a=a.substring(0,a.length-2));return a+")"};this.getOpenUrlValue=
function(){var a=this.initArray.window_type.value,b=this.initArray.window_parameters.value,c=N+"openUrl("+this.initArray.url_string.value+', "'+a+'"';DelugeUtil.arrayContains(["popup window","iframe"],a)&&""!=b&&0<b.length&&(c+=", "+b);return c+");"};this.getSendSMSValue=function(){return{to:this.initArray.to.value,message:this.initArray.message.value}};this.getSendMailValue=function(){var a=this.initArray.from.value,b=this.initArray.to.value,c=this.initArray.subject.value,d=this.richTextEditor.getContent();
return{from:a,to:b,cc:this.initArray.add_cc?this.initArray.add_cc.value:"",bcc:this.initArray.add_bcc?this.initArray.add_bcc.value:"",reply_to:this.initArray.add_reply_to?this.initArray.add_reply_to.value:"",subject:c,message:d,attachments:this.initArray.attachments?this.initArray.attachments.value:"",contentType:this.initArray.contentType}};this.getForEachRecord=function(){return N+"for each "+this.initArray.row_variable.value+" in "+this.initArray.form_name.value+" [ "+this.initArray.for_each_criteria.value+
" ]"};this.getDeleteRecordValue=function(){return N+"delete from "+this.initArray.form_name.value+" [ "+this.initArray.delete_criteria.value+" ];"};this.getFetchRecordValue=function(){var a=this.initArray.collection_var.value+" \x3d ",b=this.initArray.fetch_form_name.value+" [ "+this.initArray.fetch_criteria.value+" ]",c="";var d=n.initArray.fetch_sort_field;var e=n.initArray.fetch_sort_type;d.constructor!=Array&&(d=[d],e=[e]);for(var f="",g=0;g<d.length;g++){var l=d[g];"select field"!=l.value.toLowerCase()&&
(f+=l.value,sortFieldFlag=!0,1==e[g].checked&&(f+=" desc"),f+=", ")}e=0<f.length?f=" sort by "+f.slice(0,-2):"";d=0<e.length?!0:!1;g=this.initArray.fetch_range_from;f="";null!=g.value&&""!=g.value&&(l=this.initArray.fetch_range_to,null!=l&&""!=l&&(d=!0,f=" range from "+g.value+" to "+l.value));g=this.initArray.fetch_field_name;"all fields"!=g.value.toLowerCase()&&(c+="."+g.value);b+=c+e+f;1==this.initArray.fetch_field_value_list.checked&&(b=d?"("+b+").getAll()":b+".getAll()");return a+(b+";")};this.getSetVariableValue=
function(){var a=this.initArray.set_variable.value;return a=a+" \x3d "+this.initArray.set_expression.value+";"};this.getUpdateRecordValue=function(){return N+this.initArray.collection_var.value+"."+this.initArray.field_name.value+" \x3d "+this.initArray.update_expression.value+";"};this.getEditorContainer=function(){return n.container.querySelector(".deluge-expr-editor")};this.getDescription=function(a){var b=a.code;a=a.hasOwnProperty("description")?a.description:null;if(b){var c=b.match(/<([\w_\s/]*(?:(\[\d*\]))?)>/g);
if(c){this.dbtags=[];count=0;for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];this.dbtags[h]=++count;var f=h.slice(1,-1);f=f.replace(/\[\d*\]/g,"");b=b.replace(h,'\x3cspan class\x3d"deluge-expr-selected-code" deluge-btag\x3d\''+count+"'\x3e"+f+"\x3c/span\x3e")}}}d="";a&&(d+="\x3cdiv class\x3d'deluge-expr-desc'\x3e"+a+"\x3c/div\x3e");b&&(d+="\x3cdiv class\x3d'deluge-expr-desc-code'\x3e"+b+"\x3c/div\x3e");if(!b&&!a)return null;this.descriptionDiv=DelugeUtil.getDivElement(d,C.ROW+" "+n.getModifiedClassName("syntax-code"));
e(this.descriptionDiv);return this.descriptionDiv};this.getHiddenDiv=function(a,b){var c=DelugeUtil.getDivElement("","deluge-expr-hidden-elements");if(a.hasOwnProperty("inputs")){var d=a.inputs,e;for(e in d)if(d.hasOwnProperty(e)){var h=this.getRowConstruct(a.inputs[e],b);h&&c.appendChild(h)}}this.addToInputArray(a.name,c);return c};this.getRichTextDiv=function(a,b){var c=a&&a.fieldsCapable?"\x3cspan class\x3d'deluge-expr-insert-field-icon' title\x3d'Advanced Edit'\x3e\x3ci class\x3d'de de-insert'\x3e\x3c/i\x3e\x3c/span\x3e":
"";var d=H(a),e=k(a)+"\x3cdiv class\x3d'deluge-expr-input'\x3e\x3cdiv class\x3d'deluge-expr-richtext "+C.DS_INPUT+"' id\x3d'delugeRichText'\x3e\x3c/div\x3e"+d+c+O.getErrorDiv()+"\x3c/div\x3e";e=DelugeUtil.getDivElement(e,C.ROW+" "+C.INPUT_DIV);(d||c)&&this.bindLayeredEvent(e,a,b);this.addToInputArray(a.name,e.querySelector("#delugeRichText"));d&&y(e,a);return e};this.initRichTextEvent=function(a,b){var c=n.container.querySelector(".deluge-expr-richtext");c.classList.add("form-rte");if(c){var d=a.message,
e=DRE.serviceFlags.isCreator(),h=e?JSON.parse('[["bold","italic","underline"],["strikethrough"],["fontcolor"],["bgcolor"],["fontfamily"],["fontsize"],["justifyleft","justifyright","justifyfull","justifycenter"],["insertunorderedlist","insertorderedlist"],["outdent","indent"],["removeformat"],["link","unlink"],["table","inserthorizontalrule","quote"],["insertHTML"],["code"],["edithtml"]]'):JSON.parse('[["bold","italic","underline"],["strikethrough"],["fontcolor"],["bgcolor"],["fontfamily"],["fontsize"],["justifyleft","justifyright","justifyfull","justifycenter"],["insertunorderedlist","insertorderedlist","outdent","indent"],["removeformat"],["link","unlink","table","inserthorizontalrule","quote"],["code"],["edithtml"]]'),
f=JSON.parse('[["8pt"],["10pt"],["12pt"],["14pt"],["18pt"],["24pt"],["36pt"]]'),v=JSON.parse('[["Serif"],["Arial"],["Courier New"],["Georgia"],["Tahoma"],["Times New Roman"],["Trebuchet"],["Verdana"],["Comic Sans MS"]]');window.ZE_Init&&DRE.serviceFlags.isEnabled("ze-init")&&(window.tempZE_Init=window.ZE_Init,window.ZE_Init=window.dreZE_Init);c={id:c.getAttribute("id"),editorheight:175,content:l(d),fontsize:f,fontfamily:v};e?(c.toolbar=h,c.avoidMoreOption=!0,c.enableGrammarly=!0,c.popupConstructedCallback=
function(a,b){$(b).addClass("ze-edithtml-popup")}):(ZE_Init.toolbarOrderGenerate&&(c.toolbar=h),c.containerClsName="dre",c.dropdownContainerCls="dre",c.popupContainerCls="dre",c.dialogContainerCls="dre");if(b.ZEChangeobj)for(h=Object.keys(b.ZEChangeobj),d=0;d<h.length;d++)f=h[d],c.hasOwnProperty(f)&&(c[b.ZEChangeobj[f]]=c[f],delete c[f]);n.richTextEditor=b.ZECreate?b.ZECreate(c):e?ZE.create(c):ZE_Init.globalNamespace.create(c);e&&($(n.richTextEditor.editordiv).find("ul:has(span.zei-bgclr)").addClass("zc-ze-richtext-bgclr"),
$(n.richTextEditor.editordiv).find("ul:has(span.zei-textclr)").addClass("zc-ze-richtext-textclr"),$(n.richTextEditor.editordiv).find("ul:has(em#fontsizeEditable)").addClass("zc-ze-richtext-fs"),$(n.richTextEditor.editordiv).find("ul:has(span.zeFFce)").addClass("zc-ze-richtext-ff"),$(n.richTextEditor.editordiv).find("li:has(span.zei-arrow.ze-big)").addClass("zc-ze-richtext-modeswitch"))}a.subject&&(n.initArray.subject.value=a.subject)};this.getRichTextContainer=function(){return n.container.querySelector(".deluge-expr-richtext")};
this.getInputElement=function(a,b){var c=a.placeholder?' placeholder\x3d"'+p(a.placeholder)+'" ':"",d=a.dataType?' data-type\x3d"'+a.dataType+'" ':"",e=b&&b.hasOwnProperty(a.name)&&null!=b[a.name]?' value\x3d"'+p(b[a.name])+'" ':"",h=a&&a.hasOwnProperty("name")?' name\x3d"deluge-expr-'+a.name+'" ':"",f=k(a)+"\x3cdiv class\x3d'deluge-expr-input'\x3e";var v=a.dataType;c=f+(v?"\x3cspan class\x3d'deluge-expr-input-datatype'\x3e"+v+"\x3c/span\x3e":"")+"\x3cinput type\x3d'text' class\x3d'"+C.DS_INPUT+"' "+
c+e+h+d+" /\x3e"+H(a)+O.getErrorDiv()+"\x3c/div\x3e";c=DelugeUtil.getDivElement(c,C.ROW+" "+C.INPUT_DIV);d=c.querySelector("[name\x3d'deluge-expr-"+a.name+"']");this.addToInputArray(a.name,d);this.bindLayeredEvent(c,a,b,d);y(c,a);return c};this.getTextAreaElement=function(a,b){var c=a.placeholder?' placeholder\x3d"'+a.placeholder+'" ':"",d=a&&a.hasOwnProperty("name")?' name\x3d"deluge-expr-'+a.name+'" ':"";c=k(a)+"\x3cdiv class\x3d'deluge-expr-input'\x3e\x3ctextarea class\x3d'"+C.DS_INPUT+"' "+c+
d+" \x3e\x3c/textarea\x3e"+H(a)+O.getErrorDiv()+"\x3c/div\x3e";c=DelugeUtil.getDivElement(c,C.ROW+" "+C.INPUT_DIV);d=c.querySelector("[name\x3d'deluge-expr-"+a.name+"']");b.hasOwnProperty(a.name)&&(d.value=b[a.name]);this.addToInputArray(a.name,d);this.bindLayeredEvent(c,a,b,d);y(c,a);return c};this.getRadioInputDiv=function(a,b){b&&b.hasOwnProperty(a.name);a&&a.hasOwnProperty("name");var c=k(a)+"\x3cdiv class\x3d'deluge-expr-input-radio-div' name\x3d'deluge-expr-input-"+a.name+"'\x3e",d="",e=a.name,
h=a.list;if(h&&0<h.length)for(var f=0;f<h.length;f++){var v=h[f];d+="\x3clabel \x3e\x3cinput name\x3d'deluge-expr-input-"+e+"' type\x3d'radio' value\x3d'"+v+"'"+(b[a.name]==v?" checked":"")+"/\x3e\x3cspan class\x3d'deluge-expr-input-option'\x3e"+v+"\x3c/span\x3e\x3c/label\x3e"}c=c+d+"\x3c/div\x3e"+O.getErrorDiv();c=DelugeUtil.getDivElement(c,C.ROW+" "+C.INPUT_DIV);d=c.querySelector("[name\x3d'deluge-expr-input-"+a.name+"']");this.addToInputArray(a.name,d);this.bindLayeredEvent(c,a,b,d);return c};
var ba=(a,b)=>{var c=DelugeUtil.getDivElement("","deluge-expr-links-input-wrapper");b=this.getRowConstruct(a,b);c.append(b);c.setAttribute("linkName",a.name);b=DelugeUtil.getDivElement(a.clearLabel,"deluge-expr-link deluge-expr-remove-link");b.addEventListener("click",()=>{document.querySelector(".deluge-expr-link[linkName\x3d"+a.name+"]").style.display="inline-block";c.querySelector(".deluge-expr-ds-input").value="";c.style.display="none"});c.append(b);return c};this.getLinkElement=function(a,b){var c=
DelugeUtil.getDivElement("","deluge-expr-links deluge-expr-add-link"),d=DelugeUtil.getDivElement("","deluge-expr-links-inputs"),e=DelugeUtil.getDivElement("","deluge-expr-link-wrapper");if(a.cols&&0<a.cols.length)for(i=0;i<a.cols.length;i++){var h=ba(a.cols[i],b);d.append(h);var f=document.createElement("span");f.className="deluge-expr-link";f.setAttribute("linkName",a.cols[i].name);f.innerHTML=a.cols[i].addLabel;f.addEventListener("click",(a)=>{a=a.target;var b=a.getAttribute("linkname");b=document.querySelector(".deluge-expr-links-input-wrapper[linkName\x3d"+
b+"]");a.style.display="none";b.style.display="block"});c.append(f);b[a.cols[i].name]?f.style.display="none":h.style.display="none"}e.append(c);e.append(d);return e};this.getToggleDiv=function(a,b){var c=DelugeUtil.getDivElement("\x3cdiv class\x3d'deluge-expr-input-label' toggle\x3d'false'\x3e"+a.label+" \x3cdiv class\x3d'deluge-expr-toggle-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-hidden-toggle'\x3e\x3c/div\x3e",C.ROW+" "+C.TOGGLE+" "+n.getModifiedClassName(a.label)),d=c.querySelector(".deluge-expr-hidden-toggle"),
e=c.querySelector(".deluge-expr-input-label");this.generateSortAndRangeRows(d,a.rows,b);r(e,d);(b.hasOwnProperty("fetch_sort_field")||b.hasOwnProperty("fetch_range_from")||b.hasOwnProperty("fetch_range_to"))&&A(e,!0);return c};this.generateSortAndRangeRows=function(a,b,c){if(b&&0<b.length)for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],h=this.getRowConstruct(e,c);h.classList.add(n.getModifiedClassName(e.label));h&&a.appendChild(h)}};this.getDecisionBoxDiv=function(a,b){var c="\x3cdiv class\x3d'deluge-expr-input-cb-div'\x3e\x3clabel \x3e\x3cinput name\x3d'deluge-expr-input-"+
a.name+"' type\x3d'checkbox' "+(1==b[a.name]?" checked":"")+"/\x3e\x3cspan class\x3d'deluge-expr-input-option'\x3e"+a.label+"\x3c/span\x3e\x3c/label\x3e";"\x3c/div\x3e";c=DelugeUtil.getDivElement(c,C.ROW+" "+C.INPUT_DIV);var d=c.querySelector("input[name\x3d'deluge-expr-input-"+a.name+"']");this.addToInputArray(a.name,d);this.bindLayeredEvent(c,a,b,d);return c.childNodes[0]};this.populateFields=function(a,b){this.clearAdditionalParams();var c=this.initArray.insert_form_fields;c.innerHTML="";var d=
DelugeUtil.getDivElement("\x3cdiv class\x3d'"+C.ROW+" deluge-expr-hidden-elements-title'\x3eFields\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-insert-fields-content'\x3e\x3c/div\x3e","deluge-expr-insert-fields");c.appendChild(d);d=c.querySelector(".deluge-expr-insert-fields-content");b=b?null:function(){n.loading.hide();n.populateFields(a,b);n.popup&&n.popup.resize&&n.popup.resize()};var e=this.delugeMeta.getGroupedFormFields(a,b,!1,RESTRICT_FIELDS.INSERT),h=[];if(e&&0<=e.length||null==b){h.push({name:"Added_User",
label:"Added User",type:"dropdown",list:["zoho.loginuser","zoho.adminuser"]});m(e,h);for(e=0;e<h.length;e++){var f=h[e],g=this.getRowConstruct(f);this.additionalParams.push(f.name);g&&d.appendChild(g)}0==e&&d.appendChild(DelugeUtil.getDivElement("\x3cdiv class\x3d'deluge-expr-msg-div'\x3eNo fields are available\x3c/div\x3e"))}else n.loading.show(d),n.popup&&n.popup.resize&&n.popup.resize();c.style.display="block"};this.getDropdownDiv=function(a,b){var c=a&&a.hasOwnProperty("name")?' name\x3d"deluge-expr-'+
a.name+'" ':"",d=a.hasOwnProperty("inputs")&&a.inputs,e="";a.label&&(e+=k(a));e+="\x3cdiv class\x3d'deluge-expr-input deluge-expr-select-div'\x3e\x3cselect class\x3d'deluge-expr-select "+C.DS_INPUT+"'"+c+"\x3e"+this.getDropdownValues(a)+"\x3c/select\x3e"+O.getErrorDiv()+"\x3c/div\x3e";c=DelugeUtil.getDivElement(e,C.ROW+" "+C.INPUT_DIV);a.hasOwnProperty("allowMultipleInputs")&&a.allowMultipleInputs&&(e="\x3cdiv class\x3d'deluge-expr-mi-add-btn'\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e",this.NInputs.hasOwnProperty(a.name)?
(this.NInputs[a.name]++,e+="\x3cdiv class\x3d'deluge-expr-mi-delete-btn'\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e"):this.NInputs[a.name]=1,c.appendChild(DelugeUtil.getDivElement(e,"deluge-expr-mi-btn")));d&&this.handleAdditionalInputs(c,a.inputs,b);d=c.querySelector("[name\x3d'deluge-expr-"+a.name+"']");b&&b.hasOwnProperty(a.name)&&null!=b[a.name]&&""!=b[a.name]&&(d.value=b[a.name]);this.addToInputArray(a.name,d);this.bindDropdownEvent(c,a,b);return c};this.handleAdditionalInputs=function(a,b,c){for(var d in b){var e=
b[d];if(c[e.name]&&c[e.name].constructor==Array)for(var h=0;h<c[e.name].length;h++){var f=this.getRowConstruct(e,c[e.name][h]);f&&a.append(f)}else(f=this.getRowConstruct(e,c))&&a.append(f)}};this.getInputs=function(a,b){var c="";a.label&&(c+=k(a));var d=a.hasOwnProperty("display")&&"inline-block"==a.display?" deluge-expr-multiple-inputs-ib":"";c+="\x3cdiv class\x3d'deluge-expr-multiple-inputs "+d+" "+n.getModifiedClassName(a.label)+"'\x3e\x3c/div\x3e";c=DelugeUtil.getDivElement(c,C.ROW+" "+C.INPUT_DIV);
d=c.querySelector(".deluge-expr-multiple-inputs");this.handleAdditionalInputs(d,a.inputs,b);return c};this.getLabel=function(a){var b="";a.label&&(b+="\x3cdiv class\x3d'deluge-expr-label'\x3e"+a.label+x(a)+"\x3c/div\x3e");return DelugeUtil.getDivElement(b,"deluge-expr-label-div")};this.addToInputArray=function(a,b){switch(this.type){case B.CALL_FUNCTION:case B.INVOKE_URL:case B.OPEN_URL:case B.SEND_SMS:case B.SEND_MAIL:case B.SET_VARIABLE:case B.IF:case B.ELSE_IF:case B.CONDITIONAL_IF:case B.INFO:case B.ALERT:case B.RETURN:case B.FOR_EACH_RECORD:case B.DELETE_RECORD:case B.UPDATE_RECORD:case B.FETCH_RECORD:case B.AGGREGATE_RECORD:case B.INSERT_INTO:case B.INTEGRATION:this.initArray.hasOwnProperty(a)?
this.initArray[a].constructor==Array?this.initArray[a].push(b):this.initArray[a]=[this.initArray[a],b]:this.initArray[a]=b}};this.getVariableDropdownHTML=function(a,b){var c=a.getFormsAndFieldsByServices(a.getDelugeAppLinkName(),a.getDelugeFormLinkName());var d=[],e;for(e in c)c.hasOwnProperty(e)&&d.push({name:e});c=q(d,"Fields");a=a.gatherVariablesAsList(b,!1);if(a.length){b="\x3cli\x3e"+t("Variables");b+='\x3cdiv class\x3d"de-dropdown-elements"\x3e';for(d=0;d<a.length;d+=1)b+="\x3cspan value\x3d"+
a[d].name+"\x3e"+a[d].name+"\x3c/span\x3e";a=b+"\x3c/div\x3e\x3c/li\x3e"}else a="";return c=c+a+q(DelugeBuiltInFunction.getConstantFunctions(),"Constants")};this.bindDropdownEvent=function(a,b,c){var d=a.querySelector("select");if(a){n.lazyArray[b.name]=d.value;switch(b.name){case "insert_form_name":d.addEventListener("change",function(){n.populateFields(d.value)});break;case "aggregate_form":d.addEventListener("change",function(){n.updateAggregateFields(d.value)});break;case "aggregate_function":d.addEventListener("change",
function(){n.updateAggregateFields(n.initArray.aggregate_form.value)});break;case "fetch_form_name":d.addEventListener("change",function(){n.updateFetchFields(d.value)});break;case "fetch_field_name":d.addEventListener("change",function(){n.updateFieldsListInput(d.value)});break;case "form_name":d.addEventListener("change",function(){n.setEditorPreset({formLinkName:d.value})});break;case "collection_var":d.addEventListener("change",function(){n.changeFields(d.value)});break;case "integ_service":d.addEventListener("change",
function(){n.refreshIntegrationFunction(d.value)});break;case "integ_service_function":d.addEventListener("change",function(){n.refreshIntegrationParams(d.value)});break;case "fetch_sort_field":this.handleMultipleInputs(a,b,c);break;case "window_type":d.addEventListener("change",function(){n.showWindowParams(d.value,b,c)})}b.hasOwnProperty("action")&&d.addEventListener("change",function(a){z(a,b,this.value,c)})}};this.updateFieldsListInput=function(a){a&&("all fields"==a.toLowerCase()?n.initArray.fetch_field_value_list.disabled=
!0:n.initArray.fetch_field_value_list.disabled=!1)};this.handleMultipleInputs=function(a,b,c){a&&this.bindMultipleInputAddDeleteBtn(a,b,c)};this.bindMultipleInputAddDeleteBtn=function(a,b,c){if(a){var d=function(a,b){n.initArray[a.name].splice(b,1);if(a.hasOwnProperty("inputs"))for(var c=0;c<a.inputs.length;c++)d(a.inputs[c],b)},e=a.querySelector(".deluge-expr-mi-add-btn"),f=a.querySelector(".deluge-expr-mi-delete-btn");e&&e.addEventListener("click",function(){if(n.NInputs[b.name]<b.limit.max){var d=
a.parentNode,e=this.parentNode.parentNode.childNodes[0].childNodes[0],f=n.getRowConstruct(b,c);f.querySelector("[name\x3d'deluge-expr-"+b.name+"']").innerHTML=e.innerHTML;d.appendChild(f)}});f&&f.addEventListener("click",function(){n.NInputs[b.name]--;for(var c=this.parentNode.parentNode,e=d,f=c.parentNode.children,h=f.length-1;0<=h&&c!=f[h];h--);e(b,h);a.parentNode.removeChild(a)})}};this.bindLayeredEvent=function(a,b,c,d){function e(a,b,c,d,e){var f={delugeMeta:n.delugeMeta},g=n.editorHintPreset.hasOwnProperty("formLinkName")?
"criteria":"expression";n.exprBuilder||(n.exprBuilder=DelugeExpressionBuilder.getInstance());c&&(f.title=c);n.exprBuilder.setBuilderType(g);n.exprBuilder.setOptions(f);n.exprBuilder.setFromRichText(d);n.exprBuilder.setEditorPreset(n.editorHintPreset);n.exprBuilder.setHintFieldRestriction(e);n.exprBuilder.show(n.options._container,a,b,{},n.sharedVars,h)}function f(a,c,d,f){var h=[a];n.convertRichTextToDeluge(h,function(a){e(a[0],function(a,b){n.exprBuilder.InputError.hide(n.exprBuilder.getEditorContainer());
h=[a];n.exprBuilder.convertDelugeToRichText(h,function(a){c(a[0]);b&&b()},function(a){n.exprBuilder.InputError.show(n.exprBuilder.getEditorContainer(),a)})},b.expBuilderTitle,!0,f)},d)}if(b&&1==b.expressionCapable)switch(b.type){case "richtext":var h=a.querySelector(".deluge-expr-insert-expr-icon");DelugeUtil.attachEvent(h,"click",function(){n.InputError.hide(n.getRichTextContainer());f(n.richTextEditor.getContent(),function(a){n.richTextEditor.setContent(l(a))},function(a){n.InputError.show(n.getRichTextContainer(),
a)},b.restriction)});break;case "textarea":case "input":h=a.querySelector(".deluge-expr-insert-expr-icon"),"subject"==b.name?DelugeUtil.attachEvent(h,"click",function(){n.InputError.hide(n.initArray.subject);f(n.initArray.subject.value,function(a){n.initArray.subject.value=a},function(a){n.InputError.show(n.initArray.subject,a)},b.restriction)}):DelugeUtil.attachEvent(h,"click",function(){e(d.value,function(a){d.value=a},b.expBuilderTitle)})}if(b&&!0===b.fieldsCapable)switch(b.type){case "richtext":var g=
a.querySelector(".deluge-expr-insert-field-icon");DelugeUtil.attachEvent(g,"click",function(){n.InputError.hide(n.getRichTextContainer());var a=document.createElement("ul");a.innerHTML=n.getVariableDropdownHTML(n.delugeMeta,n.sharedVars);(new DelugeDropdownPopover(n.options._container)).show(g,a,function(a){n.richTextEditor.insertHTML("${"+a+"}")})})}};this.showWindowParams=function(a,b){switch(a){case "iframe":case "popup window":n.initArray.window_type_params.style.display="block";break;default:n.initArray.window_type_params.style.display=
"none"}};this.refreshIntegrationFunction=function(a,b){a=a.split(".");var c=n.delugeMeta.integrationTasks,d=c.getAllowedServices();c=c.getRestrictedTasks();a=DelugeBuiltInFunction.getIntegrationFunctions(a,d,c);d="";c=b&&b.isOtherIntegration;var e=new CustomEvent("change");if(a)for(var f in a)a.hasOwnProperty(f)&&(d+='\x3coption value\x3d"'+a[f].functionName+'"\x3e'+f+"\x3c/option\x3e");this.initArray.integ_service_function.innerHTML=d;c&&(this.initArray.integ_service.value="twilio.sms",this.initArray.integ_service.dispatchEvent(e));
b&&b.integ_service_function&&(this.initArray.integ_service_function.value=b.integ_service_function);this.initArray.integ_service_function.dispatchEvent(e)};this.refreshIntegrationParams=function(a){this.clearAdditionalParams();var b=this.initArray.integ_service_params;b.innerHTML="";var c=DelugeUtil.getDivElement("\x3cdiv class\x3d'"+C.ROW+" deluge-expr-hidden-elements-title'\x3eParameters\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-integ-params-content'\x3e\x3c/div\x3e","deluge-expr-integ-params");
b.appendChild(c);c=b.querySelector(".deluge-expr-integ-params-content");if(a=DelugeBuiltInFunction.getFunctionDetailsFromAppliedTypes(a))if(a=a.args){for(var d=0;d<a.length;d++){var e=a[d],f=e.name,h=f.charAt(0).toUpperCase()+f.slice(1),g=e.hasOwnProperty("mandatory")?e.mandatory:!1;e={name:f,label:h,type:"input",expressionCapable:!0,mandatory:g,dataType:e.dataType.toLowerCase()};f=this.getRowConstruct(e);this.additionalParams.push(e.name);f&&c.appendChild(f)}b.style.display="block"}else b.style.display=
"none"};this.showFunctionParams=function(a,b){this.clearAdditionalParams();if(a)if((a=a.args)&&0<a.length){var c=DelugeUtil.getDivElement("\x3cdiv class\x3d'"+C.ROW+" deluge-expr-hidden-elements-title'\x3eArguments\x3c/div\x3e","deluge-expr-function-params-div"),d=DelugeUtil.getDivElement("","deluge-expr-function-params-content"),e;for(e in a){var f=a[e];f.expressionCapable=!0;f.type="input";f.name=f.argName;f.mandatory=!0;var h=b,g=e,l=f.hasOwnProperty("argName")?" name\x3d'"+f.argName+"'":"",v=
h.hasOwnProperty("args")?null!=h.args[g]?h.args[g]:null:null,m=(g=f.argType||f.dataType)?' data-type\x3d"'+g+'" ':"";v=null!=v?' value\x3d"'+p(v)+'" ':"";l="\x3cdiv class\x3d'deluge-expr-fn-param-name'\x3e"+f.argName+x(f)+"\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-input'\x3e\x3cspan class\x3d'deluge-expr-fn-param-type'\x3e"+g+"\x3c/span\x3e\x3cdiv class\x3d'deluge-expr-fn-input-set'\x3e\x3cinput type\x3d'text' class\x3d'"+C.DS_INPUT+"'"+v+l+m+" /\x3e"+H(f)+O.getErrorDiv()+"\x3c/div\x3e\x3c/div\x3e";
l=DelugeUtil.getDivElement(l,C.ROW+" "+C.INPUT_DIV+" deluge-expr-function-params");g=l.querySelector(".deluge-expr-input input");n.addToInputArray(f.name,g);n.additionalParams.push(f.name);n.addToMandatoryFields(f);n.bindLayeredEvent(l,f,h,g);y(l,f);d.appendChild(l)}c.appendChild(d);this.initArray.function_params.appendChild(c);this.initArray.function_params.style.display="block"}else this.initArray.function_params.style.display="none"};this.clearAdditionalParams=function(){var a=n.additionalParams,
b;for(b in a)if(a.hasOwnProperty(b)){var c=n.additionalParams[b];c&&(delete n.mandatoryFields[c],delete n.initArray[c])}n.additionalParams=[]};this.setFormName=function(){if(this.options.form_name){var a=K(this.delugeMeta,this.options.form_name);a&&(this.initArray.form_name.value=a.formName)}};this.changeFields=function(a,b){function c(){n.loading.hide();n.changeFields(a,b)}b=b?null:c;var d=K(this.delugeMeta,a);if(d){var e=this.initArray.field_name;(d=M(this.delugeMeta,d.formName,RESTRICT_FIELDS.FETCH,
b))&&0<d.length||null==b?e.innerHTML=u(d):n.loading.show(n.container.parentNode)}};this.updateAggregateFields=function(a,b,c){function d(){n.loading.hide();n.updateAggregateFields(a,b,c)}this.setEditorPreset({formLinkName:a});b=b?null:d;var e=this.initArray.aggregate_function.value,f=DelugeUtil.getAllowedFieldTypesForAggregateFunction(e);(f=M(this.delugeMeta,a,null,b,f.types,f.allowSystemFields,["Added_Time","Modified_Time"]))||null==b?(f=u(f),"count"==e&&(f="\x3coption\x3eAll Records\x3c/option\x3e"+
f),this.initArray.aggregate_field.innerHTML=f,c&&(this.initArray.aggregate_field.value=c)):n.loading.show(n.container.parentNode)};this.updateFetchFields=function(a,b,c,d){function e(a){var b=n.initArray.fetch_sort_field;if(b){b.constructor!=Array&&(b=[b]);for(var c=0;c<b.length;c++){var e=b[c];e.innerHTML=a;d&&d[c]&&(e.value=d[c].fetch_sort_field)}}}function f(){n.loading.hide();n.updateFetchFields(a,b,c,d)}b=b?null:f;this.setEditorPreset({formLinkName:a});var h=M(this.delugeMeta,a,RESTRICT_FIELDS.FETCH,
b);h&&0<h.length||null==b?(h=u(h),this.initArray.fetch_field_name.innerHTML="\x3coption\x3eAll Fields\x3c/option\x3e"+h,e("\x3coption\x3eSelect field\x3c/option\x3e"+h),c&&(this.initArray.fetch_field_name.value=c),this.initArray.fetch_field_name.dispatchEvent(new CustomEvent("change"))):n.loading.show(n.container.parentNode)};this.getDropdownValues=function(a){switch(a.name){case "collection_var":var b="",c=this.delugeMeta.gatherVariables(n.sharedVars,!0);if(c){for(var d in c){var e=c[d];e.formName&&
(b+="\x3coption value\x3d'"+e.name+"'\x3e"+e.name+" ("+e.formName+")\x3c/option\x3e")}0==b.length&&(b+="\x3coption\x3eNo collection variables found\x3c/option\x3e")}return b;case "field_name":return u(M(this.delugeMeta,this.initArray.collection_var.value,RESTRICT_FIELDS.FETCH));case "insert_form_name":case "fetch_form_name":case "aggregate_form":case "form_name":b="";if(c=this.delugeMeta.getFormNames())for(d=0;d<c.length;d++)e=c[d],b+="\x3coption value\x3d'"+e+"'\x3e"+e+"\x3c/option\x3e";else b=void 0;
return b;case "app_namespaces":return b=a.list,b.unshift("default namespace"),G(b);case "window_type":case "app_link_name":case "Added_User":return G(a.list);case "integ_service":d=this.delugeMeta;e=d.integrationTasks.getAllowedServices();d=d.getGroupedPackageFunctions(e);e="";for(b in d)if(d.hasOwnProperty(b)){a=d[b];e+='\x3coptgroup label\x3d"'+b+'"\x3e';for(c in a)if(a.hasOwnProperty(c)){var f=a[c];e+='\x3coption value\x3d"'+f.value+'" \x3e'+f.label+"\x3c/option\x3e"}e+="\x3c/optgroup\x3e"}return e;
case "aggregate_function":b=DelugeBuiltInFunction.getAggregateFunctions();c="\x3coptgroup label\x3d'Aggregate Functions'\x3e";for(e in b)b.hasOwnProperty(e)&&(d=b[e])&&(c+="\x3coption value\x3d'"+d.functionName+"'\x3e"+d.functionName+"\x3c/option\x3e");return c;case "connection_name":b="\x3coption\x3e-Select-\x3c/option\x3e";if(c=this.delugeMeta.getConnectionNames())for(d=0;d<c.length;d++)e=c[d],b+="\x3coption value\x3d'"+e+"'\x3e"+e+"\x3c/option\x3e";else b=void 0;return b}};var O=new function(){this.MESSAGES=
{MANDATORY:"Please provide value"};this.getErrorDiv=function(a){return"\x3cdiv class\x3d'deluge-expr-ds-error'\x3e"+this.MESSAGES.MANDATORY+"\x3cdiv\x3e"};this.show=function(a,b){if(a){var c=a.parentNode;c&&(c.querySelector(".deluge-expr-ds-error").innerHTML=b);a.setAttribute("dserror",!0)}};this.hide=function(a){a&&a.setAttribute("dserror",!1)}};this.InputError=O};DelugeBuilder.prototype.loading=DelugeLoading;
var DelugeExpBuilder=function(){function a(b){var c="";if(b)for(var d in b)if(b.hasOwnProperty(d))if(b[d].hasOwnProperty("filters"))c+="\x3cdiv class\x3d'deluge-expr-uvf-filter-group'\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-gname'\x3e"+d+"\x3c/div\x3e",c+=a(b[d].filters),c+="\x3c/div\x3e";else{var e=b[d];c+="\x3cdiv class\x3d'deluge-expr-uvf-filter-input deluge-expr-input-cb-div' \x3e\x3clabel\x3e\x3cinput type\x3d'checkbox' name\x3d'deluge-expr-uvf-filter-var' value\x3d'"+(e.value||e.displayName)+
"'/\x3e\x3cspan class\x3d'deluge-expr-uvf-filter-label deluge-expr-input-option' title\x3d'"+e.displayName+"'\x3e"+e.displayName+"\x3c/span\x3e\x3c/label\x3e\x3c/div\x3e"}return c}function b(a){a=w.holders[a].filters.querySelector(".deluge-expr-uvf-filter-menu").querySelectorAll("input[name\x3d'deluge-expr-uvf-filter-var']");var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];d&&1==d.checked&&b.push(d.value)}return b}function c(a,b){a=w.holders[a].content.childNodes;b=b.map(function(a){return a.toLowerCase()});
(function(a){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c],e=d.getAttribute("type");0<b.length&&-1<b.indexOf(e.toLowerCase())||0==b.length?d.style.display="block":d.style.display="none"}})(a)}function d(a,b){function c(b,c,d){return b.getUserDefinedFunctions(c,d,null,function(){var b=w.delugeMeta.getUserDefinedFunctions(c,d);b=G(b,g);e(a,b,!0);w.defaults.functions+=b})}var d="",f=w.delugeMeta.getDelugeAppLinkName();if(b&&0<b.length)for(var h in b){if(b.hasOwnProperty(h)){var g=b[h],l=DelugeBuiltInFunction.getFunctionsByAppliedTypes([g]);
l&&0<l.length?(DelugeUtil.sortList(l,"functionName"),d+=u(l,g)):(l=c(w.delugeMeta,f,g),DelugeUtil.sortList(l,"functionName"),d+=G(l,g))}}else d=w.defaults.functions;e(a,d)}function e(a,b,c){a&&(a=w.holders[a].content,"string"==typeof b?a.innerHTML=c?a.innerHTML+b:b:a.appendChild(b),w.customScroll&&w.customScroll(f(a,"deluge-scroll")))}function f(a,b){for(var c=a.classList;a&&!c.contains(b);)a=a.parentNode,c=a.classList;return a&&c.contains(b)?a:null}function k(a){var b=a.querySelector(".deluge-expr-uvf-search input[name\x3d'deluge-expr-variables']");
b.addEventListener("keyup",function(a){w.searchVariablesAndFields(this.value)});r(b,B.VARIABLES);a.querySelector(".deluge-expr-uvf-mc").addEventListener("click",function(a){for(a=a.target;a&&!a.classList.contains("deluge-expr-uv-var")&&!a.classList.contains("deluge-expr-uvf-mc");)a=a.parentNode;"deluge-expr-uv-var"==a.className&&w.insertCodeToEditor(a.getAttribute("value"))})}function r(a,b){if(a){var c=!1;a.addEventListener("mouseover",function(a){!c&&O.hovered(b,!0)});a.addEventListener("mouseout",
function(a){!c&&O.hovered(b,!1)});a.addEventListener("focus",function(a){c=!0;O.hovered(b,!0)});a.addEventListener("blur",function(a){c=!1;O.hovered(b,!1)})}}function A(a){var b=a.querySelector(".deluge-expr-uvf-search input[name\x3d'deluge-expr-functions']");b.addEventListener("keyup",function(a){w.searchFunctions(this.value)});r(b,B.FUNCTIONS);a.querySelector(".deluge-expr-uvf-mc").addEventListener("click",function(a){for(var b=a.target;!b.classList.contains("deluge-expr-bin")&&!b.classList.contains("deluge-expr-udf")&&
!b.classList.contains("deluge-expr-uvf-mc");)b=b.parentNode;"deluge-expr-bin"==b.className?(b=b.getAttribute("value"),(a=DelugeBuiltInFunction.getFunctionSignature(b))&&w.insertCodeToEditor("."+a)):"deluge-expr-udf"==b.className&&(a=b.getAttribute("namespace"),b=b.getAttribute("function-name"),a=w.delugeMeta.getFunctionSignature(null,a,b),w.insertCodeToEditor(a))})}function p(a){var c=b(a);c&&0<c.length&&w.setFilter(a,c)}function l(){return"\x3cdiv class\x3d'deluge-expr-uvf-no-results'\x3eNo results found\x3c/div\x3e"}
function m(a,b){function c(a,b,c,d){return z(a,b,function(){var f=z(a,b,null,c,d),h=DelugeUtil.getDivElement(f,"").childNodes[0];e(B.VARIABLES,h);w.defaults.variablesAndFields+=f;w.initializeFilters(B.VARIABLES)},c,d)}var d="",f=!0;if(0<a.length){for(var h in a)if(a.hasOwnProperty(h)){var g=a[h],l="",m="",k={};"string"==typeof g?l=g:(l=g.refFormName,m=l+" Formfields",b&&(k.name=g.varName,k.value=g.varName,m=k.name+" ( "+l+" )  Formfields",f=!1));d+=c(l,m,f,k)}a=[]}return d}function t(a){var b=" placeholder\x3d";
switch(a){case B.VARIABLES:b+="'Search Variables / Fields'";break;case B.FUNCTIONS:b+="'Search Functions'"}a="\x3cdiv class\x3d'deluge-expr-input'\x3e\x3cinput class\x3d'deluge-expr-ds-input' type\x3d'text' name\x3d'deluge-expr-"+a+"'"+b+"/\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter'\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-icon'\x3e\x3ci class\x3d'de de-filter'\x3e\x3c/i\x3e\x3cspan class\x3d'deluge-expr-uvf-filter-count'\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-freeze'\x3e\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-menu'\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-container deluge-scroll'\x3e\x3cdiv class\x3d'deluge-expr-uvf-filter-content'\x3e\x3c/div\x3e\x3c/div\x3e";
"\x3c/div\x3e\x3c/div\x3e";return DelugeUtil.getDivElement(a,"deluge-expr-uvf-search deluge-expr-input-div")}function q(){var a="",b=DelugeBuiltInFunction.getConstantFunctions(function(){var a=q();e(B.VARIABLES,DelugeUtil.getDivElement(a).childNodes[0]);w.defaults.variablesAndFields+=a;w.initializeFilters(B.VARIABLES)});DelugeUtil.sortList(b,"name");if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d.value=d.name;a+=g(B.ZOHO_CONSTANTS,d);w.addToSearchKeys(B.VARIABLES,d.name,d)}return 0<a.length?
(a="\x3cdiv class\x3d'deluge-expr-uv-group' type\x3d'"+B.ZOHO_CONSTANTS+"'\x3e\x3cdiv class\x3d'deluge-expr-uv-group-title'\x3e"+V[B.ZOHO_CONSTANTS]+"\x3c/div\x3e"+a,w.addToFilters(B.VARIABLES,{displayName:V[B.ZOHO_CONSTANTS],value:B.ZOHO_CONSTANTS}),a):""}function z(a,b,c,d,e,f,g){var h="",l={displayName:a};f=f||w.delugeMeta.getGroupedFormFields(a,c,d,w.hintFieldRestrictions);c=a;d="Forms";g=g||a;e&&(l.displayName=e.name+" ( "+g+" ) ",l.value=e.value,c=e.name,d="Collections");f&&0<f.length&&(w.addToFilters(B.VARIABLES,
{displayName:d},l),a=H(f,g,e),0<a.length&&(h+="\x3cdiv class\x3d'deluge-expr-uv-group' type\x3d'"+c+"'\x3e\x3cdiv class\x3d'deluge-expr-uv-group-title'\x3e"+b+"\x3c/div\x3e"+a+"\x3c/div\x3e"));return h}function H(a,b,c){var d="",e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];if(f){var h={name:f.linkName,type:f.type,value:f.linkName,formName:b};c&&(c.value&&(h.value=c.value+"."+h.value),c.name&&(h.name=c.name+"."+h.name));d+=g("formfields",h);c||(f.hasOwnProperty("compositeFields")&&!f.isSystemField&&
(d+=H(f.compositeFields,b,{name:h.name,value:h.value})),f.hasOwnProperty("subformFields")&&(d+=H(f.subformFields,"Subform",{name:f.linkName,value:f.linkName})));w.addToSearchKeys(B.VARIABLES,h.name+"_"+b,h)}}return d}function x(a){var b=a?V[B.COLLECTIONS]:V[B.VARIABLES],c=a?B.COLLECTIONS:B.VARIABLES,d=a?B.COLLECTIONS:B.VARIABLES,e=w.delugeMeta.gatherVariables(w.sharedVars,a);e=DelugeUtil.convertMapToList(e);DelugeUtil.sortList(e,"name");d="\x3cdiv class\x3d'deluge-expr-uv-group' type\x3d'"+d+"'\x3e\x3cdiv class\x3d'deluge-expr-uv-group-title'\x3e"+
b+"\x3c/div\x3e";var f="";if(e)for(var h in e)if(e.hasOwnProperty(h)){var l=e[h],m=l.dType,k={name:l.name,value:l.name};a&&(m=B.COLLECTIONS,k.formName=l.formName,k.formName&&-1==ba.indexOf(k.formName)&&ba.push({refFormName:k.formName,varName:l.name}));k.type=m;f+=g(c,k);w.addToSearchKeys(B.VARIABLES,k.name,k)}d+=f+"\x3c/div\x3e";return 0<f.length?(w.addToFilters(B.VARIABLES,{displayName:b,value:c}),d):""}function g(a,b){var c=b.type,d=b.name,e=b.value,f=f?" form-name\x3d'"+DelugeEditorUtil.encodeForHtml(b.formName)+
"'":"";a="\x3cdiv class\x3d'deluge-expr-uv-var' value\x3d'"+e+"' type\x3d'"+a+"' data-type\x3d'"+DelugeEditorUtil.encodeForHtml(c.toLowerCase())+"'"+DelugeEditorUtil.encodeForHtml(f)+"\x3e\x3cdiv class\x3d'deluge-expr-uv-var-name'\x3e"+DelugeEditorUtil.encodeForHtml(d)+"\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-uv-var-type-details'\x3e\x3cspan class\x3d'deluge-expr-uv-var-type'\x3e"+DelugeEditorUtil.encodeForHtml(c.toLowerCase())+"\x3c/span\x3e";b.formName&&(a+="\x3cspan class\x3d'deluge-expr-uv-form-name'\x3e"+
DelugeEditorUtil.encodeForHtml(b.formName)+"\x3c/span\x3e");return a+"\x3c/div\x3e\x3c/div\x3e"}function y(a){var b="",c=a.getUserDefinedFunctionsList(a.getDelugeAppLinkName(),function(){var b=y(a);e(B.FUNCTIONS,b,!0);w.defaults.functions+=b;w.initializeFilters(B.FUNCTIONS)});if(c)for(var d in c)if(c.hasOwnProperty(d)){var f=c[d].functions,h=c[d].nameSpace;h=""==h?"default":h;DelugeUtil.sortList(f,"functionName");b+=G(f,h);w.addToFilters(B.FUNCTIONS,{displayName:"Namespaces"},{displayName:h})}return b}
function G(a,b){var c="";DelugeUtil.sortList(a,"functionName");for(var d in a)a.hasOwnProperty(d)&&(c+=K(a[d],b));return 0<c.length?"\x3cdiv class\x3d'deluge-expr-udf-group'\x3e"+c+"\x3c/div\x3e":c}function K(a,b){b=""==b?"default":b;return"\x3cdiv class\x3d'deluge-expr-udf' function-name\x3d'"+a.functionName+"' namespace\x3d'"+b+"'\x3e\x3cdiv class\x3d'deluge-expr-udf-fname'\x3e"+a.functionName+"\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-udf-ns'\x3e"+b+"\x3c/div\x3e\x3c/div\x3e"}function M(){var a=
"",b=DelugeBuiltInFunction.getFunctionsByAppliedTypes(C,5,function(){var a=M();e(B.FUNCTIONS,a,!0);w.defaults.functions+=a;w.initializeFilters(B.FUNCTIONS)});b&&0<b.length&&(DelugeUtil.sortList(b,"functionName"),a=u(b),N());return a}function u(a,b){var c="",d;for(d in a)a.hasOwnProperty(d)&&(c+=n(a[d]));return 0<c.length?"\x3cdiv class\x3d'deluge-expr-bin-group' "+(b?" type\x3d'"+b+"'":"")+"\x3e"+c+"\x3c/div\x3e":c}function n(a){return"\x3cdiv class\x3d'deluge-expr-bin' return-type\x3d'"+a.returnType+
"'"+("value\x3d'"+a.functionName+"'")+"\x3e\x3cdiv class\x3d'deluge-expr-bin-fname'\x3e"+a.functionName+"\x3c/div\x3e\x3cdiv class\x3d'deluge-expr-bin-fdesc'\x3e"+a.description+"\x3c/div\x3e\x3c/div\x3e"}function N(){var a=C,b;for(b in a)a.hasOwnProperty(b)&&w.addToFilters(B.FUNCTIONS,{displayName:"Built In Functions"},{displayName:a[b]})}DelugeBuilder.call(this);var w=this,C=["String","Decimal","Datetime","List","Map"],B={VARIABLES:"variables",FUNCTIONS:"functions",COLLECTIONS:"collections",ZOHO_CONSTANTS:"zoho_constants"},
V={};V[B.VARIABLES]="User Variables";V[B.COLLECTIONS]="Collections";V[B.ZOHO_CONSTANTS]="Zoho Constants";var ba=[];this.defaults={};this.holders=[];this.searchKeys={};this.filters=[];this.getColumns=function(a,b){var c=DelugeUtil.getDivElement("","deluge-expr-cols");if(a=a.cols)for(var d=0;d<a.length;d++){var e=a[d];e&&c.appendChild(w.getColumnData(e,b))}b=DelugeUtil.getDivElement("","deluge-expr-row");b.appendChild(c);return this.container=b};this.getColumnData=function(a,b){a=a.type;b=DelugeUtil.getDivElement("",
"deluge-expr-uvf-mc-wrapper deluge-scroll");var c=DelugeUtil.getDivElement("","deluge-expr-uvf-mc"),d=DelugeUtil.getDivElement("","deluge-expr-uvf-col");b.appendChild(c);d.appendChild(t(a));d.appendChild(b);this.holders[a]={};this.holders[a].content=c;this.holders[a].filters=d.querySelector(".deluge-expr-uvf-filter");this.bindEvent(d,a);this.initFilters(a);return d};this.getValues=function(a){var b="";switch(a){case B.VARIABLES:b=w.getVariablesAndFieldsAsHTML();break;case B.FUNCTIONS:b=w.getFunctionsAsHTML()}return b};
this.refreshValues=function(){var a={title:this.exprBuilderTitle},b=a&&a.title?a.title:this.modulesMeta[0].label;b=a&&a.titlePrefix?a.titlePrefix+b:b;w.container.querySelector(".deluge-expr-header .deluge-expr-title").textContent=b;if(this.container)for(var c in w.modulesMeta)switch(a=w.modulesMeta[c],a.type){case "cols":if(a=a.cols)for(c=0;c<a.length;c++)if(b=a[c]){var d=this.holders[b.type].content;if(d){for(;d.firstChild;)d.removeChild(d.firstChild);d.className="deluge-expr-uvf-mc"}d=void 0;var e=
this.holders[b.type].content,f=this.getValues(b.type);if(e)for(d in f=Array.from(f),f)f.hasOwnProperty(d)&&e.appendChild(f[d]);this.initializeFilters(b.type)}}this.customScroll&&this.customScroll(this.getMainContent())};this.getMainContent=function(){return w.container.querySelectorAll(".deluge-expr-uvf-mc-wrapper")};this.setBuilderType=function(a){w.type=a;w.setModulesMeta();w.reinitialize();return this};this.setDelugeMeta=function(a){this.delugeMeta=a};this.setOptions=function(a){a&&(a.hasOwnProperty("saveCallBack")&&
(this.saveFnCallback=a.saveCallBack),a.hasOwnProperty("sharedVars")&&(this.sharedVars=a.sharedVars),a.hasOwnProperty("popup")&&(this.popup=a.popup),a.hasOwnProperty("delugeMeta")&&(this.delugeMeta=a.delugeMeta),a.hasOwnProperty("title")&&(this.exprBuilderTitle=a.title),this.options=a);this.delugeMeta=this.delugeMeta||new DelugeMeta;return this};this.initBuilder=function(a){this.container?a&&this.setOptions(a):(this.setOptions(a),this.init())};this.reinitialize=function(){this.container.className=
"deluge-expr-builder "+this.getModifiedClassName();this.defaults={};this.searchKeys={};this.filters=[];this.exprBuilderTitle=null;ba=[];relatedForm=[];this.hideAllFilters()};this.bindEvent=function(a,b){switch(b){case B.VARIABLES:k(a);break;case B.FUNCTIONS:A(a)}};this.initializeFilters=function(b){var c=a(this.filters[b]);this.holders[b].filters.querySelector(".deluge-expr-uvf-filter-menu .deluge-expr-uvf-filter-content").innerHTML=c;this.bindFilters(b)};this.hideAllFilters=function(a){for(var b in this.holders)this.holders.hasOwnProperty(b)&&
(a=this.holders[b].filters)&&(a.querySelector(".deluge-expr-uvf-filter-icon").dispatchEvent(new CustomEvent("hide")),O.updateCount(b,0))};var O={toggle:function(a){var b=w.holders[a].filters,c=b.getAttribute("show");this.clicked=(c="true"==c?!0:!1)?!1:!0;c=!c;b.setAttribute("show",c);1==c?this.makeActive(a):this.makeInactive(a)},show:function(a){var b=w.holders[a].filters;"true"!=b.getAttribute("show")&&(b.setAttribute("show",!0),this.makeActive(a),w.customScroll&&w.customScroll(b.querySelector(".deluge-scroll")));
this.hovered(a,!0)},hide:function(a){var b=w.holders[a].filters;this.clicked||(b.setAttribute("show",!1),this.makeInactive(a));this.hovered(a,!1)},clear:function(a){this.clicked=!1;this.hide(a);this.makeInactive(a)},enable:function(a){w.holders[a].filters.setAttribute("filtered",!0)},disable:function(a){w.holders[a].filters.setAttribute("filtered",!1)},hovered:function(a,b){a=w.holders[a].filters;var c=a.parentNode,d=c.getAttribute("active");b+="";this.clicked||(!d||d==b)&&d||c.setAttribute("active",
b);b&&w.customScroll&&w.customScroll(a.querySelector(".deluge-scroll"))},updateCount:function(a,b){if(a=w.holders[a].filters.querySelector(".deluge-expr-uvf-filter-count"))0<b?(a.style.display="block",a.textContent=b):a.style.display="none"},makeActive:function(a){a=w.holders[a].filters.querySelector(".deluge-expr-uvf-filter-menu");a.classList.contains("dre-expr-uvf-filter-menu-active")||a.classList.add("dre-expr-uvf-filter-menu-active")},makeInactive:function(a){w.holders[a].filters.querySelector(".deluge-expr-uvf-filter-menu").classList.remove("dre-expr-uvf-filter-menu-active")}};
this.initFilters=function(a){function b(){for(var a in d)d.hasOwnProperty(a)&&clearTimeout(d[a]);d=[]}var c=w.holders[a].filters;c.setAttribute("show",!1);var d=[],e=!1;if(c){var f=c.querySelector(".deluge-expr-uvf-filter-icon"),g=c.querySelector(".deluge-expr-uvf-filter-menu");f.addEventListener("click",function(b){O.toggle(a);b.preventDefault();b.stopPropagation()});f.addEventListener("mouseover",function(){e||(b(),O.hovered(a,!0),O.makeActive(a))});f.addEventListener("mouseout",function(b){b=b.relatedTarget.classList;
b.contains("zc-li-outline")||b.contains("deluge-expr-uvf-filter-icon")||b.contains("deluge-expr-uvf-filter-menu")||d.push(setTimeout(function(){O.hovered(a,!1);!O.clicked&&O.makeInactive(a)},200))});f.addEventListener("hide",function(){O.clear(a)});g.addEventListener("mouseover",function(){b();O.show(a)});g.addEventListener("mouseout",function(b){O.hide(a)})}(c=c.querySelector(".deluge-expr-uvf-filter-freeze"))&&c.addEventListener("click",function(b){O.clear(a);b.preventDefault();b.stopPropagation();
b.stopImmediatePropagation();e=!0;setTimeout(function(){e=!1},300)});this.bindFilters(a)};this.bindFilters=function(a){var c=w.holders[a].filters.querySelector(".deluge-expr-uvf-filter-menu").querySelectorAll("input[name\x3ddeluge-expr-uvf-filter-var]");DelugeUtil.attachEventForAll(c,"change",function(){O.hovered(a,!0);var c=b(a);c&&0<c.length?O.enable(a):O.disable(a);w.setFilter(a,c)})};this.setFilter=function(a,b){switch(a){case B.VARIABLES:c(a,b);break;case B.FUNCTIONS:d(a,b)}O.updateCount(a,b.length);
w.customScroll&&w.customScroll(w.getMainContent())};this.searchVariablesAndFields=function(a){if(""!=a&&0<a.trim().length){var b=this.searchKeys.variables,c=a.toLowerCase();a=[];for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];-1<d.toLowerCase().indexOf(c)&&a.push(e)}b="";for(f in a)a.hasOwnProperty(f)&&(d=a[f])&&(b+=g("",d));var f=b;0==f.length&&(f=l());this.holders.variables.content.innerHTML=f}else f=this.defaults.variablesAndFields,this.holders.variables.content.innerHTML=f,p(B.VARIABLES);this.customScroll&&
this.customScroll(this.getMainContent())};this.searchFunctions=function(a){var b="";if(""!=a&&0<a.trim().length){var c="",d=DelugeBuiltInFunction.searchForFunctionName(a,C);if(d&&0<d.length)for(var e in d)d.hasOwnProperty(e)&&(c+=n(d[e]));e=b+c;b="";if(a=w.delugeMeta.searchFunctions(a))for(var f in a)a.hasOwnProperty(f)&&(c=a[f],b+=K(c,c.namespace));0<b.length&&(b="\x3cdiv class\x3d'deluge-expr-udf-group'\x3e"+b+"\x3c/div\x3e");b=e+b;0==b.length&&(b=l());this.holders.functions.content.innerHTML=b}else b=
this.defaults.functions,this.holders.functions.content.innerHTML=b,p(B.FUNCTIONS);this.customScroll&&this.customScroll(this.getMainContent())};this.getVariablesAndFieldsAsHTML=function(){function a(a,b,c,d,f){a=z(a,b,null,c,d,null,f);e(B.VARIABLES,DelugeUtil.getDivElement(a).childNodes[0]);w.defaults.variablesAndFields+=a;w.initializeFilters(B.VARIABLES)}if(this.defaults.variablesAndFields)return this.defaults.variablesAndFields;var b="",c=w.editorHintPreset.formLinkName,d=w.delugeMeta.getDelugeFormLinkName(),
f="";c&&c!=d&&(f=c+"'s Fields",b+=z(c,f,function(){a(c,f)},l));var g=w.delugeMeta.getDelugeSubFormDetails();if(g){var l=!0,k=g.refFormLinkName,p={name:"row",value:"row"};if(g.hasOwnProperty("subformFields")){k=g.linkName;var n=g.subformFields;n=DelugeUtil.convertMapToList(n);b+=z(k,"row ("+k+") Fields",null,l,p,n)}else f="row ("+g.linkName+") Fields",b+=z(k,f,function(){a(k,f,l,p,g.linkName)},l,p,null,g.linkName)}b+=x();b+=x(!0);d&&(b+=z(d,"Current Formfields"));b+=m(ba,!0);b+=q();this.defaults.variablesAndFields=
b;return DelugeUtil.getDivElement(b,"").childNodes};this.addToSearchKeys=function(a,b,c){this.searchKeys[a]||(this.searchKeys[a]={});this.searchKeys[a][b]=c};this.addToFilters=function(a,b,c){this.filters[a]||(this.filters[a]=[]);c?(this.filters[a]||(this.filters[a]={}),this.filters[a][b.displayName]?this.filters[a][b.displayName].filters.push(c):(this.filters[a][b.displayName]=b,this.filters[a][b.displayName].filters=[c])):this.filters[a].push(b)};this.getFunctionsAsHTML=function(a,b){a=M();a+=y(w.delugeMeta);
this.defaults.functions=a;return DelugeUtil.getDivElement(a,"").childNodes}};DelugeExpBuilder.prototype=Object.create(DelugeBuilder.prototype);DelugeExpBuilder.prototype.constructor=DelugeBuilder;(function(a){function b(a){return a=a.replace(/\n/g,"\\n")}function c(a,b,c){var e=b.getDelugeFormLinkName(),f=b.gatherVariablesAsList(c),k=b.gatherVariablesAsList(c,!0),q=b.getGroupedFormFields(e,null,!0),p={},r=[],A=[];f=d(f);var g="",y;for(y in q)if(q.hasOwnProperty(y)){var G=q[y];g+="\x3cvariable\x3e\x3cname\x3e"+G.linkName+"\x3c/name\x3e\x3ctype\x3e"+G.type.toLowerCase()+"\x3c/type\x3e\x3c/variable\x3e"}f+=g;0<f.length&&(p.variables=f);0<k.length&&(q=null,c&&c.formName&&(q=b.isFormfield(c.formName)),
p.collections=d(k,q));if(a&&0<a.length)for(var K in a)a.hasOwnProperty(K)&&(0<a[K].trim().length?(b=a[K],b=b.replace(/\${([^\}]*)}/g,"\x3c%\x3d$1%\x3e"),r.push(b)):A.push(K));if(0==r.length)return null;p.expr=JSON.stringify(r);p.zccpn=variable.csrfToken;p.emptyOffsets=A;e&&(p.formLinkName=e);return p}function d(a,b){var c="",d={},e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e],k=f.dType;switch(k.toLowerCase()){case "nview":k=f.isForEachVar&&b?b:f.formName;break;case "object":k="string"}d[f.name]=
k}a=d;for(var r in a)a.hasOwnProperty(r)&&(c+="\x3cvariable\x3e\x3cname\x3e"+r+"\x3c/name\x3e\x3ctype\x3e"+a[r]+"\x3c/type\x3e\x3c/variable\x3e");return c}function e(a,b){if(b&&0<b.length)for(var c in b)b.hasOwnProperty(c)&&a.splice(b[c],0,"");return a}function f(a,b,c,d,e){$.ajax({url:a,type:"POST",data:b,beforeSend:function(){e=e||d.container;d.loading.show(e)},success:function(a){d.loading.hide();c(a)},error:function(){d.loading.hide();iAlert(i18n["zc.deluge.editor.save.requesterror"])}})}var k=
/Error\s*at\s*line\s*number\s*:\s*(.*)\s*\n\s*/g;a.prototype.convertDelugeToRichText=function(a,b,d,l){if(a){var m=c(a,this.delugeMeta,this.sharedVars);if(m){m.query="delugetorich";var p=m.emptyOffsets;delete m.emptyOffsets;f(appbuilder.component.WORKFLOW.getGenerateExpressionUrl(),m,function(a){if(a)if("success"==a.status){if(a.convertedString){a=a.convertedString;var c=[];for(l in a)if(a.hasOwnProperty(l)){var f=a[l];f=f.replace(/<%=([^%>]*)%>/g,"${$1}");f=f.replace(/\\n/g,"\n");c.push(f)}b(e(c,
p))}}else{var l=(l=a.errorMessage)?l.replace(k,""):"";d&&d(l,a.errorAtIndex)}},this,l)}else b(a)}else b()};a.prototype.convertRichTextToDeluge=function(a,d,p,l){var m=c(a,this.delugeMeta,this.sharedVars);if(m){m.query="plaintodeluge";var t=m.emptyOffsets;delete m.emptyOffsets;f(appbuilder.component.WORKFLOW.getGenerateExpressionUrl(),m,function(a){if(a)if("success"==a.status){if(a.convertedString){a=a.convertedString;var c=[];for(f in a)a.hasOwnProperty(f)&&c.push(b(a[f]));d(e(c,t))}}else{var f=(f=
a.errorMessage)?f.replace(k,""):"";p&&p(f,a.errorAtIndex)}},this,l)}else d(a)}})(DelugeBuilder);var DelugeVersions=function(a,b,c,d,e){function f(a){var b=k.versionDiv.querySelector("#versionScript");k.replaceScript=a;a=DelugeUtil.renderScript(a,!0);$(b).data("zcsp")&&$(b).data("zcsp").destroy();$(b).html(a);$(b).zcScrollPane({autoReinit:!0})}var k=this,r={title:i18n["zc.deluge.versions.header.content"],buttons:{ok:i18n["zc.deluge.button.replace"],cancel:i18n["zc.deluge.button.cancel"]}};this.baseUrl=b.baseUrl;this.versionsUrl=b.versionsUrl;this.scriptUrl=b.scriptUrl;this.replaceScript="";this.workflow=
c;this.trash=d;this.labels=e||r;this.show=function(){if(this.workflow){var b={};b.zccpn=variable.csrfToken;k.trash||(b.componentType=this.workflow.componentType,"Workflow"==this.workflow.componentType?(b.wfLinkName=this.workflow.wfLinkName,b.actionLinkName=this.workflow.actionLinkName):(b.workflowId=this.workflow.workflowId,b.actionType=this.workflow.actionType));$.ajax({url:this.baseUrl+"/"+this.versionsUrl,type:"POST",data:b,beforeSend:function(){DelugeLoading.show(a.delugeArea)},success:function(b){DelugeLoading.hide();
if(null!=b)if(b=DelugeUtil.getDivElement(b),b.querySelector(".no-version-msg"))iCustomizePopup({buttons:[{name:ZCButton.OKAY,type:ZCModalConstants.MODAL_CANCEL}],title:k.labels.title,body:b.childNodes[1]});else{k.versionDiv=b.childNodes[1];k.showScript(b);k.bindEvents(b);b={name:ZCButton.REPLACE,type:ZCModalConstants.MODAL_SUBMIT};var c={title:k.labels.title,body:k.versionDiv,buttons:[{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],parentClass:"zc-wf-deluge-version",submitOnEnterKey:!1,
success:function(){a.setEditorContent(k.replaceScript,!1);return!0},afterOpen:function(a){$(a).find("div[class\x3dversion-list]").zcScrollPane()}};!k.trash&&c.buttons.unshift(b);iCustomizePopup(c)}}})}};this.showScript=function(a){if(a=a.querySelector("#latestVersionScript"))f(a.innerText),a.parentElement.removeChild(a)};this.bindEvents=function(a){var b=a.querySelectorAll(".deluge-version .version-list .version"),c=a.querySelector(".version-script");b.forEach(function(a){a.addEventListener("click",
function(){var b=k.versionDiv.querySelector(".deluge-version .version-list .version.active");null!=b&&(b.className="version");a.className="version active";k.getVersionsScript(a.getAttribute("fid"),a.getAttribute("version"),k.workflow.actionType,c)})})};this.getVersionsScript=function(a,b,c,d){var e={};e.zccpn=variable.csrfToken;e.fileId=a;e.version=b;c&&(e.actionType=c);$.ajax({url:this.baseUrl+"/"+this.scriptUrl,type:"POST",data:e,beforeSend:function(){DelugeLoading.show(d)},success:function(a){DelugeLoading.hide();
null!=a&&f(a)}})}};var DelugeBuilderPopup=new DelugeBasePopup;DelugeBuilderPopup.onClose=function(){var a=DelugeExpressionBuilder.getInstance();a.parentDelugeEditor&&(delugeEditor=a.parentDelugeEditor,a.parentDelugeEditor=null)};
var DelugeExpressionBuilder=function(a,b){DelugeExpBuilder.call(this);this.type=a;this.parentDelugeEditor=null;a=this.CONSTANTS;var c={};c[a.CRITERIA]="Specify Criteria";c[a.EXPRESSION]="Set Expression";this.setModulesMeta=function(){this.modulesMeta=[{type:"header",label:c[this.type],cols:[{type:"button",buttonType:"primary",label:"done"}],closeButton:!1},{type:"editor"},{type:"cols",cols:[{type:"variables"},{type:"functions"}]}]};this.setModulesMeta();this.initBuilder(b);this.popup={hide:function(){DelugeBuilderPopup.hide()}}};
DelugeExpressionBuilder.prototype=Object.create(DelugeExpBuilder.prototype);DelugeExpressionBuilder.prototype.constructor=DelugeExpressionBuilder;DelugeExpressionBuilder.getInstance=function(){return this.instance?this.instance:this.instance=new DelugeExpressionBuilder};
DelugeExpressionBuilder.prototype.show=function(a,b,c,d,e,f){var k=this;DelugeBuilderPopup.hide();d=d?d:{};d.scrollFn=function(){};this.saveFnCallback=c;this.sharedVars=e;this.refreshValues(d.scrollFn);c=DRE.serviceFlags.isIntegration()?a:d.freezeLayer||$(a).parents(".zc-wfb-add-newfunc")[0]||$(a).parents(".zc-dem-slider")[0]||$(a).parents(".zc-pb-popup-container")[0]||document.querySelector(".deluge-mc-editor-layer").parentElement;DelugeBuilderPopup.show(a,this.container,{className:"deluge-expr-popup deluge-expr-builder-popup",
esc:!0,freeze:{container:c,closeOnClick:!0,className:"deluge-expr-builder-popup-freeze"},animation:{show:"deluge-expr-builder-popup-active",hide:"deluge-expr-builder-popup-inactive"},show:function(){k.customScroll&&k.customScroll(k.getMainContent())},pointer:"deluge-expr-popover",popOverElement:f,type:"popover",windowResize:!0});k.parentDelugeEditor=delugeEditor;this.initializeEditor(b,e)};
var DelugeDropdownPopover=function(a){var b=new DelugeBasePopup,c=this;this.show=function(d,e,f){b.hide();DelugeUtil.attachEventForAll(e.querySelectorAll("[attr\x3dgroup]"),"click",function(a){a=a.currentTarget.closest("li");a.classList.contains("minimize")?a.classList.remove("minimize"):a.classList.add("minimize")});DelugeUtil.attachEventForAll(e.querySelectorAll("span"),"click",function(a){f(a.currentTarget.getAttribute("value"));DelugeBuilderPopup.hide()});DelugeBuilderPopup.show(a,e,{className:"deluge-dropdown-popup",
esc:!0,freeze:{container:a,closeOnClick:!0,className:"deluge-dropdown-popup-freeze"},animation:{show:"active",hide:"inactive"},show:function(){c.customScroll&&c.customScroll()},pointer:"deluge-dropdown-popover",popOverElement:d,type:"popover",windowResize:!0})}};var DelugePanePopup=new DelugeBasePopup,DelugeLayeredBuilder=function(a,b,c){DelugeBuilder.call(this);var d=this.CONSTANTS,e={};e[d.IF]="if statement";e[d.ELSE_IF]="else if statement";e[d.INFO]="info statement";e[d.RETURN]="Return statement";e[d.ALERT]="alert statement";e.insert=c["deluge.builder.button.insert"];e.cancel=c["deluge.builder.button.cancel"];var f={};f[d.INFO]=c["deluge.builder.description.info"];f[d.ALERT]=c["deluge.builder.description.alert"];f[d.RETURN]=c["deluge.builder.description.return"];
f[d.IF]=c["deluge.builder.description.if"];f[d.CONDITIONAL_IF]=c["deluge.builder.description.conditionalif"];f[d.SET_VARIABLE]=c["deluge.builder.description.setvariable"];f[d.SEND_MAIL]=c["deluge.builder.description.sendmail"];f[d.SEND_SMS]=c["deluge.builder.description.sendsms"];f[d.OPEN_URL]=c["deluge.builder.description.openurl"];f[d.CALL_FUNCTION]=c["deluge.builder.description.callfunction"];f[d.INVOKE_URL]=c["deluge.builder.description.invokeurl"];f[d.INSERT_INTO]=c["deluge.builder.description.insertinto"];
f[d.INTEGRATION]=c["deluge.builder.description.integration"];f[d.FETCH_RECORD]=c["deluge.builder.description.fetchrecord"];f[d.AGGREGATE_RECORD]=c["deluge.builder.description.aggregaterecord"];f[d.FOR_EACH_RECORD]=c["deluge.builder.description.foreachrecord"];f[d.DELETE_RECORD]=c["deluge.builder.description.deleterecord"];f[d.UPDATE_RECORD]=c["deluge.builder.description.updaterecord"];this.setModulesMeta=function(){switch(this.type){case d.IF:case d.ELSE_IF:this.modulesMeta=[{type:"header",label:e[this.type],
description:f[this.type]},{type:"description",code:this.type+" ( \x3ccondition\x3e )"},{type:"textarea",label:"Specify Condition",expBuilderTitle:"Specify Condition",name:"if_condition",mandatory:!0,expressionCapable:!0,tag:"\x3ccondition\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.CONDITIONAL_IF:this.modulesMeta=[{type:"header",label:"Conditional If Statement",description:f[this.type]},{type:"description",
code:"\x3cvariable\x3e \x3d if(\x3ccondition\x3e,\x3csuccess\x3e,\x3cfailure\x3e);"},{type:"input",label:"Assign / Declare a variable",name:"if_variable",expressionCapable:!0,mandatory:!0,tag:"\x3cvariable\x3e"},{type:"textarea",label:"Specify Condition",expBuilderTitle:"Specify Condition",name:"if_condition",mandatory:!0,expressionCapable:!0,tag:"\x3ccondition\x3e"},{type:"input",label:"Success Value",name:"if_success_value",expressionCapable:!0,mandatory:!0,tag:"\x3csuccess\x3e"},{type:"input",
label:"Failure Value",name:"if_failure_value",expressionCapable:!0,mandatory:!0,tag:"\x3cfailure\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.INFO:case d.ALERT:case d.RETURN:this.modulesMeta=[{type:"header",label:e[this.type],description:f[this.type]},{type:"description",code:this.type+" \x3cexpression\x3e;"},{type:"textarea",label:"Specify expression",name:"expression_value",expressionCapable:!0,
mandatory:!0,tag:"\x3cexpression\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.SET_VARIABLE:this.modulesMeta=[{type:"header",label:"Set Variable",description:f[this.type]},{type:"description",code:"\x3cvariable\x3e \x3d \x3cexpression\x3e;"},{type:"input",label:"Declare or select variable",name:"set_variable",expBuilderTitle:"Specify / Declare a Variable",placeholder:"Eg: name",expressionCapable:!0,
mandatory:!0,tag:"\x3cvariable\x3e"},{type:"textarea",label:"Specify Expression",name:"set_expression",mandatory:!0,expressionCapable:!0,tag:"\x3cexpression\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.SEND_MAIL:this.modulesMeta=[{type:"header",label:"Send Mail",description:f[this.type]},{type:"input",label:"From",name:"from",mandatory:!0,expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist")},
{type:"input",label:"To",name:"to",mandatory:!0,expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist")},{type:"link",cols:[{type:"input",label:"Cc",addLabel:"Add Cc",name:"add_cc",clearLabel:"Remove CC",expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist")},{type:"input",label:"Bcc",addLabel:"Add Bcc",name:"add_bcc",clearLabel:"Remove Bcc",expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist")},{type:"input",label:"Reply-to",addLabel:"Add Reply-to",name:"add_reply_to",clearLabel:"Remove Reply-to",
expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist")}]},{type:"textarea",label:"Subject",name:"subject",placeholder:"Subject of the mail",mandatory:!0,expressionCapable:DRE.serviceFlags.isEnabled("syntax-assist"),restriction:["FILE_UPLOAD","IMAGE"]},{type:"richtext",label:"Message",name:"message",mandatory:!0,fieldsCapable:DRE.serviceFlags.isIntegration(),expressionCapable:DRE.serviceFlags.isCreator(),restriction:["FILE_UPLOAD","IMAGE"]}];DRE.serviceFlags.isEnabled("syntax-assist")&&this.modulesMeta.push({type:"input",
label:"Attachments",name:"attachments",expressionCapable:!0});this.modulesMeta.push({type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]});break;case d.SEND_SMS:this.modulesMeta=[{type:"header",label:"Send SMS",description:f[this.type]},{type:"input",label:"To",name:"to",mandatory:!0,expressionCapable:!0},{type:"textarea",label:"Message",name:"message",mandatory:!0,expressionCapable:!0},{type:"footer",cols:[{type:"button",
buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.OPEN_URL:this.modulesMeta=[{type:"header",label:"Open Url",description:f[this.type]},{type:"description",code:"openUrl ( \x3cURL\x3e, \x3cwindow_type\x3e );"},{type:"input",label:"URL String",name:"url_string",mandatory:!0,expressionCapable:!0,tag:"\x3cURL\x3e"},{type:"dropdown",label:"Open in",name:"window_type",list:DelugeUtil.getWindowTypes(),tag:"\x3cwindow_type\x3e"},{type:"hidden",name:"window_type_params",
inputs:[{type:"input",label:"Parameters",name:"window_parameters",expressionCapable:!0,placeholder:'"height\x3d100,width\x3d100"'}]},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.CALL_FUNCTION:this.modulesMeta=[{type:"header",label:"Call Function",description:f[this.type]},{type:"description",code:"\x3capplication\x3e.\x3cnamespace\x3e.\x3cfunction\x3e(\x3cparams\x3e)"},{type:"dropdown",label:"Select Application",
name:"app_link_name",list:this.delugeMeta.getAppList(),mandatory:!0,tag:"\x3capplication\x3e",action:{relatedTo:["app_namespaces","app_functions","function_params"],method:this.delugeMeta.getUserDefinedNameSpaces}},{type:"dropdown",label:"Select Namespace",name:"app_namespaces",mandatory:!0,tag:"\x3cnamespace\x3e",list:this.delugeMeta.getUserDefinedNameSpaces(),action:{relatedTo:["app_functions","function_params"],value:"app_link_name",method:this.delugeMeta.getUserDefinedFunctions}},{type:"dropdown",
label:"Select Function",name:"app_functions",tag:"\x3cfunction\x3e",mandatory:!0,action:{relatedTo:["function_params"],value:["app_link_name","app_namespaces"],method:this.delugeMeta.getUserDefinedFunctions}},{type:"hidden",name:"function_params",tag:"\x3cparams\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.INVOKE_URL:this.modulesMeta=[{type:"header",label:"Invoke Url",description:f[this.type]},
{type:"input",label:"Store response in ",name:"response_variable"},{type:"input",label:"URL String",name:"url_string",mandatory:!0,expressionCapable:!0},{type:"radio",label:"Request type",name:"request_type",mandatory:!0,list:["GET","POST","PUT","DELETE"]},{type:"input",label:"Request Parameters",name:"request_parameters",expressionCapable:!0},{type:"input",label:"Request Headers",name:"request_headers",expressionCapable:!0},{type:DRE.serviceFlags.isCreator()?"dropdown":"input",label:"Connection",
name:"connection_name",tag:"\x3cconnection\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.INSERT_INTO:this.modulesMeta=[{type:"header",label:"Add Record",description:f[this.type]},{type:"dropdown",label:"Select Form",name:"insert_form_name",mandatory:!0},{type:"hidden",name:"insert_form_fields"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",
label:e.cancel}]}];break;case d.INTEGRATION:this.modulesMeta=[{type:"header",label:"Integrations",description:f[this.type]},{type:"description",code:"\x3cvariable\x3e \x3d \x3cservice\x3e.\x3caction\x3e(\x3cparams\x3e);"},{type:"input",label:"Response Variable",name:"integ_response_variable",tag:"\x3cvariable\x3e",mandatory:!0,expressionCapable:!0},{type:"dropdown",label:"Select Service",name:"integ_service",tag:"\x3cservice\x3e",mandatory:!0},{type:"dropdown",label:"Select Function",name:"integ_service_function",
tag:"\x3caction\x3e",mandatory:!0},{type:"hidden",name:"integ_service_params",title:"Parameters",tag:"\x3cparams\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.FETCH_RECORD:this.modulesMeta=[{type:"header",label:"Fetch Records",description:f[this.type]},{type:"description",code:"\x3ccollection variable\x3e \x3d \x3cformname\x3e[\x3ccriteria\x3e] sort by \x3cfield[1]\x3e desc range from \x3cx\x3e to \x3cy\x3e;"},
{type:"input",label:"Collection Variable",name:"collection_var",mandatory:!0,tag:"\x3ccollection variable\x3e"},{type:"dropdown",label:"Select Form",name:"fetch_form_name",mandatory:!0,tag:"\x3cformname\x3e"},{type:"textarea",label:"Specify Criteria",name:"fetch_criteria",mandatory:!0,expressionCapable:!0,tag:"\x3ccriteria\x3e"},{type:"dropdown",label:"Fetch field",name:"fetch_field_name",tag:"\x3cfield[0]\x3e",inputs:[{type:"decision_box",label:"Return values as list",name:"fetch_field_value_list"}]},
{type:"toggle",label:"Sort and Range",rows:[{type:"inputs",label:"Sort by",display:"inline-block",inputs:[{type:"dropdown",name:"fetch_sort_field",tag:"\x3cfield[1]\x3e",allowMultipleInputs:!0,limit:{min:1,max:5},inputs:[{type:"decision_box",label:"Sort in descending order",name:"fetch_sort_type"}]}]},{type:"inputs",label:"Range",inputs:[{type:"input",label:"From",expressionCapable:!0,name:"fetch_range_from",tag:"\x3cx\x3e"},{type:"input",label:"To",expressionCapable:!0,name:"fetch_range_to",tag:"\x3cy\x3e"}]}]},
{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.AGGREGATE_RECORD:this.modulesMeta=[{type:"header",label:"Aggregate Records",description:f[this.type]},{type:"description",code:"\x3caggregate variable\x3e \x3d \x3cformname\x3e[\x3ccriteria\x3e].\x3caggregate function\x3e(\x3cfield\x3e)"},{type:"input",label:"Aggregate Variable",name:"collection_var",mandatory:!0,tag:"\x3caggregate variable\x3e"},{type:"dropdown",
label:"Select Form",name:"aggregate_form",mandatory:!0,tag:"\x3cformname\x3e"},{type:"textarea",label:"Specify Criteria",name:"aggregate_criteria",mandatory:!0,expressionCapable:!0,tag:"\x3ccriteria\x3e"},{type:"inputs",label:"Aggregate Function",mandatory:!0,display:"inline-block",inputs:[{type:"dropdown",name:"aggregate_function",tag:"\x3caggregate function\x3e",inputs:[{type:"label",label:"of"},{type:"dropdown",tag:"\x3cfield\x3e",mandatory:!0,mandatorySymbol:!1,name:"aggregate_field"}]}]},{type:"footer",
cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.FOR_EACH_RECORD:this.modulesMeta=[{type:"header",label:"For each row",description:f[this.type]},{type:"description",code:"for each \x3crow variable\x3e in \x3cform/collection\x3e [\x3coptional criteria\x3e]"},{type:"input",label:"Declare row variable",name:"row_variable",mandatory:!0,tag:"\x3crow variable\x3e"},{type:"dropdown",label:"Select Form",name:"form_name",mandatory:!0,
tag:"\x3cform/collection\x3e"},{type:"textarea",label:"Specify Criteria",name:"for_each_criteria",expressionCapable:!0,tag:"\x3ccriteria\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.DELETE_RECORD:this.modulesMeta=[{type:"header",label:"Delete Record",description:f[this.type]},{type:"description",code:"delete from \x3cformname\x3e[\x3ccriteria\x3e];"},{type:"dropdown",label:"Select Form",name:"form_name",
mandatory:!0,tag:"\x3cformname\x3e"},{type:"textarea",label:"Criteria",name:"delete_criteria",mandatory:!0,expressionCapable:!0,tag:"\x3ccriteria\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}];break;case d.UPDATE_RECORD:this.modulesMeta=[{type:"header",label:"Update Records",description:f[this.type]},{type:"description",code:"\x3cformvariable name\x3e.\x3cfieldname\x3e \x3d \x3cexpression\x3e;"},{type:"dropdown",
label:"Select a collection variable",name:"collection_var",mandatory:!0,tag:"\x3cformvariable name\x3e"},{type:"dropdown",label:"Select Field",name:"field_name",mandatory:!0,tag:"\x3cfieldname\x3e"},{type:"textarea",label:"Specify Expression",name:"update_expression",expressionCapable:!0,tag:"\x3cexpression\x3e"},{type:"footer",cols:[{type:"button",buttonType:"primary",label:e.insert},{type:"button",buttonType:"secondary",label:e.cancel}]}]}};this.delugeMeta=b||new DelugeMeta;a&&(this.type=a,this.setModulesMeta())};
DelugeLayeredBuilder.prototype=Object.create(DelugeBuilder.prototype);DelugeLayeredBuilder.prototype.constructor=DelugeLayeredBuilder;
DelugeLayeredBuilder.prototype.show=function(a,b,c,d,e,f){function k(){var a=DelugePanePopup.getContainer();r.resize(a,f);setTimeout(function(){r.resize(a,f)},100)}var r=this,A=DelugePanePopup.hide(!0);c.popup={hide:function(){DelugePanePopup.hide();r.deActivate(f,DelugePanePopup)}};this.init(b,c,e);var p={className:"deluge-expr-popup deluge-expr-layered-builder deluge-expr-lb-"+this.type.replace(/\s/g,"-"),appendType:"prepend",show:function(){r.activate(f,!0);f.activateBuilderMode();r.resize(DelugePanePopup.getContainer(),
f);r.customScroll&&r.customScroll()},hide:function(){r.deActivate(f);window.removeEventListener("resize",k)},animation:{show:"deluge-expr-layered-builder-active",hide:"deluge-expr-layered-builder-inactive"}};r.type==r.CONSTANTS.SEND_MAIL?(f.hideErrorMessage(),r.convertDelugeToRichText([c.subject,c.message],function(c){var l=[];l.subject=c[0];l.message=c[1];DelugePanePopup.show(a,r.container,p,A);r.initEvents(l,d,e,f,b)},function(a,b){DelugeBuilderParser.removeLineSelection(f.editor);null!=b&&(a="Error at line number : \x3cspan\x3e"+
c._lineNos[0==b?"subject":"message"]+"\x3c/span\x3e\n"+a);f.showErrorMessage(a,"error")},f.delugeArea)):DelugePanePopup.show(a,r.container,p,A);window.addEventListener("resize",k)};DelugeLayeredBuilder.prototype.activate=function(a,b){a.setReadOnly(b)};DelugeLayeredBuilder.prototype.deActivate=function(a){a.deActivateBuilderMode();a.builder.removeLineSelection(a.editor);this.activate(a,!1);a.focusEditor()};
DelugeLayeredBuilder.prototype.resize=function(a,b){b=b.delugeArea;var c=b.clientWidth,d=b.querySelector(".deluge-mc-editor-layer");b.querySelector(".deluge-editor-container").style.width=c-a.offsetWidth-1+"px";DRE.serviceFlags.isCreator()&&(a.style.height=d.offsetHeight+"px")};
DelugeLayeredBuilder.prototype.initEvents=function(a,b,c,d,e){var f=this;f.initRichTextEvent(a,d);f.saveFnCallback=function(a,b){f.convertRichTextToDeluge([a.subject,a.message],function(c){c&&(a.subject=c[0],a.message=c[1]);e(a,b)},function(a,b){null!=b&&(0==b?f.InputError.show(f.initArray.subject,a):f.InputError.show(f.getRichTextContainer(),a))})}};var DELUGE_PATTERNS={OPEN_URL:/\s*openUrl\s*\(\s*(.[^,]*)\s*,\s*(.[^,]*)\s*(?:,\s*(.*)\s*)?\);/,TAGS:new RegExp("\x3c("+ALL_DELUGE_TAGS.join("|")+")\x3e","i"),FUNCTION_SIGNATURE:new RegExp("^[\\s]*("+DATATYPE_TAGS.join("|")+")[\\s]*("+LOOKUP_PATTERN.source+")[\\s]*\\(.*\\)"),COMMENT:{GROUP_START:/\/\*[\s\S]*?/,GROUP_END:/[\s\S]*?\*\//,INLINE:/^[\s]*\/\//},INVOKE_URL:/^\s*((<variable>|[a-zA-Z0-9_]*)\s*=)?\s*invokeurl\s*$/i,INTEGRATION:/(?:\s*(?:(<variable>|[a-zA-Z0-9_]*)\s*=)?\s*(<provider>|[a-zA-Z0-9_]*)\.(<service>|[a-zA-Z0-9_]*)\.(<action>|[a-zA-Z0-9_]*)\s*\((.*)\);?)/,
CALL_FUNCTION:new RegExp("(?:[\\s*]*("+VARIABLE_PATTERN.source+")(\\."+LOOKUP_PATTERN.source+")*\\.("+VARIABLE_PATTERN.source+"|\x3cfunctionname\x3e)(\\((.*)\\))?;?)","i"),FOR_EACH_REC_PATTERN:new RegExp("[\\s*]*for[\\s*]*each[\\s*]*("+VARIABLE_PATTERN.source+"|\x3cmyvariable\x3e)[\\s*]*in[\\s*]*((?:input.)?"+FETCH_REC_PATTERN.source+")","i"),START_END_QUOTE:/(^"|"$)/g},DelugeBuilderParser=function(){function a(a,c,d){function e(a){var b=[];if(a){0==a.indexOf("(")&&(a=a.substring(1,a.length-1));a.indexOf(")")==
a.length-1&&(a=a.substring(0,a.length-1));a=a.split(",");for(var c=0;c<a.length;c+=1){var d=a[c];DELUGE_PATTERNS.TAGS.test(d)||b.push(d.trim())}}return b}function f(a){a=a.split(",");var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c].trim().split(" ");b.push({fetch_sort_field:d[0],fetch_sort_type:d[1]?!0:!1})}return b}function k(b,c){a.addLineClass(b,"line",c)}function l(d,e,f){var g=d.match(DELUGE_PATTERN.EXPRESSION_PATTERN),l="",h="";g&&g[1]&&g[2]&&(l=g[1],h=g[2],";"==h.charAt(h.length-1)&&
(h=h.substring(0,h.length-1)),l.match(DELUGE_PATTERNS.TAGS)&&(l=""));e={line:e,ch:d.indexOf(g[1])};e.actualToken=K;a.setGutterMarker(t,"editmodes",b(c,"set variable",a,d,G,e,h,{set_variable:l,set_expression:h}));k(t,"deluge-task-edit-"+f)}d=d||a.getValue();d=d.split("\n");for(var m=!1,t=0;t<d.length;t++){var q=d[t],z=q.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,'""');DELUGE_PATTERNS.COMMENT.GROUP_START.test(z)?(m=!0,DELUGE_PATTERNS.COMMENT.GROUP_END.test(z)&&(m=!1)):DELUGE_PATTERNS.COMMENT.GROUP_END.test(z)&&
m&&(m=!1);var H=DELUGE_PATTERN.LIST_MAP_DECL.test(q),x=DELUGE_PATTERN.EXECUTE_XPATH.test(q),g=DELUGE_PATTERN.GET_URL.test(q)||DELUGE_PATTERN.POST_URL.test(q),y=0==q.trim().length||DELUGE_PATTERNS.COMMENT.INLINE.test(z);y=y||/^[\s]*[{}]/.test(q.trim());if(!(y||m||DELUGE_PATTERNS.FUNCTION_SIGNATURE.test(q)||H||x||g)){H=0;x="";var G=q.match(/(^[\s]*)/);G=G?G[1]:"";var K=a.getTokenAt({line:t,ch:0});if(/^\s*sendmail\s*/i.test(z)||/^\s*sendsms\s*/i.test(z)){y=q.match(/\s*(sendmail)\s*/i)||q.match(/\s*(sendsms)\s*/i);
var M="sendmail"==y[1]?"send mail":"sendsms"==y[1]?"send sms":"",u=q,n=t;x=u+"\n";for(var N={_lineNos:{}};(u=d[++n])&&u&&!u.match(/^\s*\]\s*$/i)&&n<d.length;){if(u.match(/^\s*from\s*:\s*(.*)/i)){g=u.match(/^\s*from\s*:\s*(.*)/i);var w="";g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]);N.from=w}else u.match(/^\s*to\s*:\s*(.*)/i)?(g=u.match(/^\s*to\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.to=w):u.match(/^\s*cc\s*:\s*(.*)/i)?(g=u.match(/^\s*cc\s*:\s*(.*)/i),w="",g[1]&&
(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.add_cc=w):u.match(/^\s*bcc\s*:\s*(.*)/i)?(g=u.match(/^\s*bcc\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.add_bcc=w):u.match(/^\s*reply to\s*:\s*(.*)/i)?(g=u.match(/^\s*reply to\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.add_reply_to=w):u.match(/^\s*subject\s*:\s*(.*)/i)?(g=u.match(/^\s*subject\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.subject=w,N._lineNos.subject=n+
1):u.match(/^\s*message\s*:\s*(.*)/i)?(g=u.match(/^\s*message\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.message=w,N._lineNos.message=n+1):u.match(/^\s*attachments\s*:\s*(.*)/i)&&(g=u.match(/^\s*attachments\s*:\s*(.*)/i),w="",g[1]&&(w=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),N.attachments=w,N._lineNos.attachments=n+1);x+=u+"\n"}y={line:t,ch:q.indexOf(y[0])};y.actualToken=K;N.endToken={line:n,ch:u.length};a.setGutterMarker(t,"editmodes",b(c,M,a,x,G,y,"",N));k(t,"deluge-task-edit-"+
H++);t=n}if(DELUGE_PATTERNS.INVOKE_URL.test(z)){y=q.match(DELUGE_PATTERNS.INVOKE_URL);u=q;n=t;x=u+"\n";z={};y[2]&&(g=y[2].match(DELUGE_PATTERNS.TAGS),z.response_variable=g?"":y[2]);for(;u&&!u.match(/\s*\]\s*/i)&&n<d.length;)if(u=d[++n])u.match(/\s*url\s*:\s*(.*)/i)?(g=u.match(/\s*url\s*:\s*(.*)/i),M="",g[1]&&(M=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),z.url_string=M.replace(DELUGE_PATTERNS.START_END_QUOTE,"")):u.match(/\s*type\s*:\s*(.*)/i)?(g=u.match(/\s*type\s*:\s*(.*)/i),M="",g[1]&&(M=g[1].match(DELUGE_PATTERNS.TAGS)?
"":g[1],0==M.indexOf('"')&&(M=M.substring(1,M.length-1))),z.request_type=M):u.match(/\s*parameters\s*:\s*(.*)/i)?(g=u.match(/\s*parameters\s*:\s*(.*)/i),M="",g[1]&&(M=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),z.request_parameters=M):u.match(/\s*headers\s*:\s*(.*)/i)?(g=u.match(/\s*headers\s*:\s*(.*)/i),M="",g[1]&&(M=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),z.request_headers=M):u.match(/\s*connection\s*:\s*(.*)/i)&&(g=u.match(/\s*connection\s*:\s*(.*)/i),M="",g[1]&&(M=g[1].match(DELUGE_PATTERNS.TAGS)?
"":g[1]),z.connection_name=M.replace(DELUGE_PATTERNS.START_END_QUOTE,"")),x+=u+"\n";y={line:t,ch:q.indexOf(y[0])};z.endToken={line:n,ch:u.length};y.actualToken=K;a.setGutterMarker(t,"editmodes",b(c,"invoke url",a,x,G,y,"",z));k(t,"deluge-task-edit-"+H++);t=n}else if(DELUGE_PATTERNS.FOR_EACH_REC_PATTERN.test(z)){if(g=q.match(DELUGE_PATTERNS.FOR_EACH_REC_PATTERN),u={},x=q,y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,g){g[1]&&(q=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.row_variable=q);if(g[3]){z=
g[3].match(DELUGE_PATTERNS.TAGS)?"":g[3];q=a.metadata.isVariable(z,y,"NView")||arrayContains(a.metadata.getFormNames(),z);if(""!=z&&!q)continue;u.form_name=z}g[5]&&(C=g=g[5],u.for_each_criteria=g);a.setGutterMarker(t,"editmodes",b(c,"for each record",a,x,G,y,C,u));k(t,"deluge-task-edit-"+H++)}}else if(DELETE_REC_ORIGINAL_PATTERN.test(z)||DELETE_REC_PATTERN.test(z))g=q.match(DELETE_REC_ORIGINAL_PATTERN)||q.match(DELETE_REC_PATTERN),u={},x=q,y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,g&&(g[1]&&(z=
g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.form_name=z),g[2]&&(C=g=g[2],u.delete_criteria=g),a.setGutterMarker(t,"editmodes",b(c,"delete record",a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERN.FETCH_STATEMENT_GETALL_WSR.test(z)){g=q.match(DELUGE_PATTERN.FETCH_STATEMENT_GETALL_WSR);x=q;var C="";u={};y={line:t,ch:q.indexOf(g[0])};y.actualToken=K;q="fetch record";g&&(null!=g[1]&&(z=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.collection_var=z),null!=g[2]&&(z=g[2].match(DELUGE_PATTERNS.TAGS)?
"":g[2],u.fetch_form_name=z),null!=g[3]&&(C=g[3].trim(),u.fetch_criteria=C),null!=g[4]&&(u.fetch_field_value=g[4]),null!=g[5]&&(z=f(g[5]),u.fetch_sort_field=z),null!=g[6]&&(u.fetch_range_from=g[6]),null!=g[7]&&(u.fetch_range_to=g[7]),null!=g[8]&&(u.fetch_field_value_list=!0),a.setGutterMarker(t,"editmodes",b(c,q,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++))}else if(DELUGE_PATTERN.FETCH_STATEMENT_GETALL.test(z))g=q.match(DELUGE_PATTERN.FETCH_STATEMENT_GETALL),x=q,C="",u={},y={line:t,ch:q.indexOf(g[0])},
y.actualToken=K,q="fetch record",g&&(null!=g[1]&&(z=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.collection_var=z),null!=g[2]&&(z=g[2].match(DELUGE_PATTERNS.TAGS)?"":g[2],u.fetch_form_name=z),null!=g[3]&&(C=g[3].trim(),u.fetch_criteria=C),null!=g[4]&&(u.fetch_field_value=g[4]),null!=g[5]&&(u.fetch_field_value_list=!0),a.setGutterMarker(t,"editmodes",b(c,q,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERN.AGGREGATE_STATEMENT.test(z))g=q.match(DELUGE_PATTERN.AGGREGATE_STATEMENT),x=q,
C="",u={},y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,q="aggregate record",g&&(null!=g[1]&&(z=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.collection_var=z),null!=g[2]&&(z=g[2].match(DELUGE_PATTERNS.TAGS)?"":g[2],u.aggregate_form=z),null!=g[3]&&(C=g[3].trim(),u.aggregate_criteria=C),null!=g[4]&&(z=g[4].match(DELUGE_PATTERNS.TAGS)?"":g[4],u.aggregate_function=z),null!=g[5]&&(u.aggregate_field=g[5]),a.setGutterMarker(t,"editmodes",b(c,q,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERN.FETCH_STATEMENT.test(z))g=
q.match(DELUGE_PATTERN.FETCH_STATEMENT),x=q,C="",u={},y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,q="fetch record",g&&(null!=g[1]&&(z=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.collection_var=z),null!=g[2]&&(z=g[2].match(DELUGE_PATTERNS.TAGS)?"":g[2],u.fetch_form_name=z),null!=g[3]&&(C=g[3].trim(),u.fetch_criteria=C),null!=g[4]&&(u.fetch_field_value=g[4]),null!=g[5]&&(z=f(g[5]),u.fetch_sort_field=z),null!=g[6]&&(u.fetch_range_from=g[6]),null!=g[7]&&(u.fetch_range_to=g[7]),a.setGutterMarker(t,"editmodes",
b(c,q,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERN.INLINE_STATEMENT.test(z))g=q.match(DELUGE_PATTERN.INLINE_STATEMENT),M=g[1],x=g[0],C="",y={line:t,ch:q.indexOf(g[1])},y.actualToken=K,u={},g&&g[1]&&(u.expression_value=g[2].trim(),a.setGutterMarker(t,"editmodes",b(c,M,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERN.CONDITIONAL_IF.test(z))g=q.match(DELUGE_PATTERN.CONDITIONAL_IF),x=g[0],C="",u={},g&&(y={line:t,ch:q.indexOf(g[1])},y.actualToken=K,g[1]&&(q=g[1].trim(),
DELUGE_PATTERNS.TAGS.test(q)&&(q=""),u.if_variable=q),g[2]&&(u.if_condition=g[2].trim()),g[3]&&(q=g[3].trim(),/<success_value>/.test(q)&&(q=""),u.if_success_value=q),g[4]&&(g=g[4].trim(),/<failure_value>/.test(g)&&(g=""),u.if_failure_value=g),a.setGutterMarker(t,"editmodes",b(c,"conditional if",a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(/\s*if\s*\((.*)\)/i.test(z))g=q.match(/\s*if\s*\((.*)\)/i),M=q.match(/^\s*else\sif\s*\((.*)\)/i)?"else if":"if",x=g[1],C="",y={line:t,ch:q.indexOf(g[1])},
y.actualToken=K,u={},g&&g[1]&&(u.if_condition=g[1],a.setGutterMarker(t,"editmodes",b(c,M,a,x,G,y,C,u)),k(t,"deluge-task-edit-"+H++));else if(UPDATE_REC_PATTERN.test(z)){if(g=q.match(UPDATE_REC_PATTERN),u={},x=q,y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,g){if(null!=g[1]){z=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1];if("input"==z){l(q,t,H++);continue}u.collection_var=z}null!=g[2]&&(q=g[2].match(DELUGE_PATTERNS.TAGS)?"":g[2],u.field_name=q);null!=g[3]&&(C=g=g[3],u.update_expression=g);a.setGutterMarker(t,
"editmodes",b(c,"update record",a,x,G,y,C,u));k(t,"deluge-task-edit-"+H++)}}else if(DELUGE_PATTERNS.OPEN_URL.test(z))g=q.match(DELUGE_PATTERNS.OPEN_URL),x=q,u={},g&&(y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,g[1]&&(u.url_string=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1]),g[2]&&(z=g[2].match(DELUGE_PATTERNS.TAGS)?"":g[2],u.window_type=z.substring(1,z.length-1)),g[3]&&(u.window_parameters=g[3]),u.endToken={line:t,ch:q.indexOf(g[0])+g[0].length},a.setGutterMarker(t,"editmodes",b(c,"open url",a,x,G,
y,"",u)),k(t,"deluge-task-edit-"+H++));else if(DELUGE_PATTERNS.INTEGRATION.test(z)){if(g=q.match(DELUGE_PATTERNS.INTEGRATION),x=q,u={},M="integration",endCh=0,g)if(y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,n=g[2].trim(),a.metadata.isVariable(n,y)||arrayContains(["input","row","old"],n))DELUGE_PATTERN.EXPRESSION_PATTERN.test(z)&&l(q,t,H++);else{N=g[3];w=g[4];var B=[n,N,w];"\x3caction\x3e"==w.trim()&&(B=[n,N]);var V=DelugeBuiltInFunction.getServiceDetailsFromName(B);B=!1;if(V){u.integ_service=n+
"."+N;u.integ_service_function=V.functionName;n=V.args;N=e(g[5]);if(n)for(w=0;w<n.length;w++)u[n[w].name]=N[w];B=!0}else"\x3caction\x3e"==w&&(B=!0),"\x3cprovider\x3e"==n&&(B=u.isOtherIntegration=!0);g[1]&&(n=g[1].match(DELUGE_PATTERNS.TAGS)?"":g[1],u.integ_response_variable=n);B?(z=";"==g[0].charAt(g[0].length-1)?g[0].length-1:g[0].length,endCh=q.indexOf(g[0])+z,u.endToken={line:t,ch:endCh},a.setGutterMarker(t,"editmodes",b(c,M,a,x,G,y,"",u)),k(t,"deluge-task-edit-"+H++)):DELUGE_PATTERN.EXPRESSION_PATTERN.test(z)&&
l(q,t,H++)}}else if(DELUGE_PATTERNS.CALL_FUNCTION.test(z)){if(g=q.match(DELUGE_PATTERNS.CALL_FUNCTION),x=q,u={},N=!1,endCh=0,g)if(y={line:t,ch:q.indexOf(g[0])},y.actualToken=K,w="thisapp"==g[1]?a.metadata.getDelugeAppLinkName():g[1],a.metadata.isVariable(w,y))DELUGE_PATTERN.EXPRESSION_PATTERN.test(z)&&l(q,t,H++);else if(N=!0,B=g[2]?g[2]:"default namespace",0==B.indexOf(".")&&(B=B.substring(1,B.length)),g[4]&&g[5]&&(n=e(g[5].trim()))&&(u.args=n),z="\x3cfunctionName\x3e"==g[3]?null:g[3],M="",arrayContains(a.metadata.getAppList(),
w)||!N)u.app_link_name=w,u.app_namespaces=B,u.app_functions=z,M="call function",z=";"==g[0].charAt(g[0].length-1)?g[0].length-1:g[0].length,endCh=q.indexOf(g[0])+z,u.endToken={line:t,ch:endCh},a.setGutterMarker(t,"editmodes",b(c,M,a,x,G,y,"",u)),k(t,"deluge-task-edit-"+H++)}else if(INSERT_INTO_PATTERN.test(z)){g=q.match(INSERT_INTO_PATTERN);x=u=q;n=t;M=[];z=g[3]?"\x3cform\x3e"==g[3]?"":g[3]:null;y={line:t,ch:q.indexOf(g[0])};y.actualToken=K;for(M.insert_form_name=z;u&&!u.match(/\s*\]\s*/i)&&n<d.length;)(u=
d[++n])&&(g=u.match(DELUGE_PATTERN.EXPRESSION_PATTERN))&&(g[2]&&g[2].match(TAGS_SEARCH_PATTERN_GREEDY)||(M[g[1]]=g[2])),x+=u+"\n";M.endToken={line:n,ch:u.indexOf("]")+u.length};a.setGutterMarker(t,"editmodes",b(c,"insert into",a,x,G,y,"",M));k(t,"deluge-task-edit-"+H++);t=n}else DELUGE_PATTERN.EXPRESSION_PATTERN.test(z)&&l(q,t,H++)}}}function b(a,b,k,r,A,p,l,m){function e(a){k.replaceRange(a,p,{line:p.line,ch:p.ch+r.length})}function f(a,b){var c=A+"sendmail\n"+A+"[ \n\t"+A+"from : "+a.from+"\n\t"+
A+"to : "+a.to+"\n\t";""!==a.cc&&(c+=A+"cc : "+a.cc+"\n\t");""!==a.bcc&&(c+=A+"bcc : "+a.bcc+"\n\t");""!==a.reply_to&&(c+=A+"reply to : "+a.reply_to+"\n\t");c+=A+"subject: "+a.subject+"\n\t"+A+"message : "+a.message+"\n";""!==a.attachments&&(c+=A+"\tattachments : "+a.attachments+"\n");c+=A+"]";H(c);b&&b()}function z(a){H(A+"sendsms\n[ "+A+"\n\t"+A+"to : "+a.to+"\n\t"+A+'message : "'+a.message+'"\n'+A+"]")}function H(a){k.replaceRange(a,p,m.endToken)}var x=DelugeUtil.getDivElement('\x3ci class\x3d"de de-edit"\x3e\x3c/i\x3e',
"deluge-gutter-edit-btn"),g=p.actualToken,y=k.container,G=a.editor.metadata,K=g?g.state?g.state.globalVars:null:null;(m=m?m:{})&&(m._container=y);m&&(m.spaces=A);switch(b){case "aggregate record":case "for each record":case "delete record":case "fetch record":case "update record":case "if":case "else if":case "conditional if":case "set variable":case "info":case "return":case "alert":DelugeUtil.attachEvent(x,"click",function(f){d(k);(new DelugeLayeredBuilder(b,G,a.getI18N())).show(y,e,m,l,K,a);c(k,
p.line);f.preventDefault();f.stopPropagation();f.stopImmediatePropagation()});break;case "call function":case "insert into":case "invoke url":case "integration":case "open url":DelugeUtil.attachEvent(x,"click",function(){d(k);(new DelugeLayeredBuilder(b,G,a.getI18N())).show(y,H,m,l,K,a);c(k,p.line)});break;case "send sms":DelugeUtil.attachEvent(x,"click",function(){d(k);(new DelugeLayeredBuilder(b,G,a.getI18N())).show(y,z,m,null,K,a);c(k,p.line)});break;case "send mail":DelugeUtil.attachEvent(x,"click",
function(){d(k);(new DelugeLayeredBuilder(b,G,a.getI18N())).show(y,f,m,null,K,a);c(k,p.line)})}return x}function c(a,b){a.deluge.selectedLine=b;a.addLineClass(b,"line","deluge-expr-line-selection")}function d(a){var b=a.deluge.selectedLine;-1<b&&a.removeLineClass(b,"line","deluge-expr-line-selection")}return{parse:function(b,c){b.operation(function(){b.clearGutter("editmodes");a(b,c)})},trigger:function(a,b,c){a.execCommand("clearAutoComplete");if(a=a.lineInfo(b).gutterMarkers)if(a=a.editmodes)b=
new CustomEvent("click"),a.dispatchEvent(b)},removeLineSelection:d}}();var DelugeReferFields=function(a,b){this.container=null;this.appName=b.appName;this.formName=b.formName;this.callback=b.callback;this.namespace=null;this.enableLoading=function(){DelugeLoading.show($(a.delugeArea.querySelector(".deluge-refer-fields-content")))};this.disableLoading=function(){setTimeout(function(){DelugeLoading.hide($(a.delugeArea.querySelector(".deluge-refer-fields-content")))},500)};this.LABELS={CLOSE:i18n["zc.deluge.button.close"],COPIED:i18n["zc.deluge.referfields.message.copied"]};
this.MESSAGES={NO_FORM_WARNING:i18n["zc.deluge.referfields.message.noformwarning"],NO_FUNCTION_WARNING:i18n["zc.deluge.referfields.message.nofunctionwarning"],NO_DEFAULT_FUNCTION_WARNING:i18n["zc.deluge.referfields.message.default.nofunctionwarning"]};var c=this,d={RFApps:{},forms:{},namespaces:{}},e=a.editor.metadata,f=!1,k=[];this.init=function(){this.bindMenuEvent()};this.bindMenuEvent=function(){var b=a.delugeArea.querySelector(".deluge-actions-menu[type\x3dreferfields]");null!==b&&b.addEventListener("click",
c.toggle)};this.constructElements=function(){var b=document.createElement("a");b.innerHTML="\x3cspan class\x3d'zc-common-close zc-em'\x3e\x3c/span\x3e "+c.LABELS.CLOSE;b.setAttribute("class","close");var d=DelugeUtil.getDivElement("","deluge-rf-body-header");d.appendChild(DelugeUtil.getDivElement("Fields","deluge-rf-app-header underlined"));d.appendChild(DelugeUtil.getDivElement("Function","deluge-rf-function-header"));DelugeUtil.attachEventForAll(d.querySelectorAll("div"),"click",c.switchAppAndFunc);
var e=DelugeUtil.getDivElement("","deluge-rf-body"),f=DelugeUtil.getDivElement("","deluge-refer-fields-content"),k=DelugeUtil.getDivElement("","deluge-rf-body-container deluge-scroll"),p=c.getAppWrapper(),r=c.getFuncWrapper();k.appendChild(p);k.appendChild(r);f.appendChild(d);f.appendChild(k);e.appendChild(b);e.appendChild(f);DelugeEditorUtil.addToActionTool(a.delugeArea,e);c.bindCloseEvent();c.bindReferFieldsEvents()};this.getAppWrapper=function(){var a=DelugeUtil.getDivElement("","deluge-rf-app-contents"),
b=DelugeUtil.getDivElement("","app-select"),d=DelugeUtil.getDivElement("Application","deluge-rf-header-bold"),f=DelugeUtil.getDivElement("","deluge-rf-app"),k=e.getAppList(),p=e.getDelugeAppLinkName()||c.getAppName(k),r=e.getDelugeFormLinkName()||c.getFormName(p,Object.keys(e.appCache.apps[p].forms));k=c.createSelectTag("deluge-rf-application",k,c.appChange);k.value=p;c.appName=p;c.formName=r;f.appendChild(k);k=c.getForms(e,p,r);b.appendChild(d);b.appendChild(f);a.appendChild(b);a.appendChild(k.firstChild);
a.appendChild(k.lastChild);c.ajaxReqRecord(p,"RFApps");c.ajaxReqRecord(p+"_"+r,"forms");return a};this.getFuncWrapper=function(){var b=DelugeUtil.getDivElement("","deluge-rf-func-contents"),d=DelugeUtil.getDivElement("","app-select"),f=DelugeUtil.getDivElement("Application","deluge-rf-header-bold"),k=DelugeUtil.getDivElement("","FuncApp"),p=e.getAppList(),r=e.getDelugeAppLinkName()||p[0];p=c.createSelectTag("deluge-rf-func-application",p,c.appChangeInFunc);p.value=r;k.appendChild(p);d.appendChild(f);
d.appendChild(k);f=c.getNamespaceDiv(a,r);b.appendChild(d);null!=f?(b.appendChild(f.firstChild),b.appendChild(f.lastChild)):b.appendChild(c.noFuncWarn());c.ajaxReqRecord(r+"_","namespaces");return b};this.appChange=function(b){c.enableLoading();c.appName=b;var f=d.RFApps[b];null==e.appCache.apps[b].forms||f&&c.checkTimeInterval(f.requestTime)?(a.editor.metadata.loadSpecificAppMetaInfo(b.replace(/_/g,"-"),variable.scopeName,c.formMetaChange),c.ajaxReqRecord(b,"RFApps")):c.formMetaChange()};this.formChange=
function(b){c.enableLoading();c.formName=b;var f=a.delugeArea.querySelector(".deluge-refer-fields-content .deluge-rf-app-contents").querySelector(".app-select select");f=f.options[f.selectedIndex].value;var l=d.forms[f+"_"+b];null==e.appCache.apps[f].forms[b].fields||l&&c.checkTimeInterval(l.requestTime)?(a.editor.metadata.fetchFormAndItsSubformFields(f.replace(/_/g,"-"),b,c.fieldMetaChange),c.ajaxReqRecord(f+"_"+b,"forms")):c.fieldMetaChange()};this.appChangeInFunc=function(b){c.enableLoading();
c.appName=b;var f=d.namespaces[b+"_"];null==e.appCache.apps[b].functions||f&&c.checkTimeInterval(f.requestTime)?(a.loadUserDefinedFunctions(b,"",null,c.namespaceMetaChange),c.ajaxReqRecord(b+"_","namespaces")):c.namespaceMetaChange(b)};this.namespaceChange=function(b){c.enableLoading();b="default"==b?"":b;c.namespace=b;var f=a.delugeArea.querySelector(".deluge-refer-fields-content .deluge-rf-func-contents").querySelector(".app-select select");f=f.options[f.selectedIndex].value;var l=c.getFuncsOfNamespace(e,
f,b),k=d.namespaces[f+"_"+b];null==l||k&&c.checkTimeInterval(k.requestTime)?(a.loadUserDefinedFunctions(f,b,null,c.functionMetaChange),c.ajaxReqRecord(f+"_"+b,"namespaces")):c.functionMetaChange()};this.formMetaChange=function(){var b=a.delugeArea.querySelector(".deluge-refer-fields-content").querySelector(".deluge-rf-app-contents"),d=b.querySelector(".app-select select");d=d.options[d.selectedIndex].value;var f=c.getFormName(d,Object.keys(e.appCache.apps[d].forms));d=c.getForms(e,d,f);f=b.querySelector(".form-select");
var k=b.querySelector(".deluge-rf-fields"),p=b.querySelector(".deluge-rf-no-form");f&&f.remove();k&&k.remove();p&&p.remove();null!=d?(b.appendChild(d.firstChild),b.appendChild(d.lastChild)):b.appendChild(c.noFormWarn());c.bindReferFieldsEvents();c.disableLoading()};this.fieldMetaChange=function(){var b=a.delugeArea.querySelector(".deluge-rf-app-contents"),d=b.querySelector(".app-select select"),f=b.querySelector(".form-select select");d=c.getFields(e,d.options[d.selectedIndex].value,f.options[f.selectedIndex].value);
b.querySelector(".deluge-rf-fields").remove();b.appendChild(d);c.bindReferFieldsEvents();c.disableLoading()};this.namespaceMetaChange=function(b){var d=a.delugeArea.querySelector(".deluge-rf-func-contents");b||(b=d.querySelector(".app-select select"),b=b.options[b.selectedIndex].value);b=c.getNamespaceDiv(a,b);var e=d.querySelector(".namespaceDropDown"),f=d.querySelector(".deluge-rf-functions"),l=d.querySelector(".deluge-rf-no-functions");e&&e.remove();f&&f.remove();l&&l.remove();null!=b?(d.appendChild(b.firstChild),
d.appendChild(b.lastChild)):d.appendChild(c.noFuncWarn());c.bindReferFieldsEvents();c.disableLoading()};this.functionMetaChange=function(){var b=a.delugeArea.querySelector(".deluge-rf-func-contents"),d=b.querySelector(".app-select select"),f=b.querySelector(".namespaceDropDown select");f=f.options[f.selectedIndex].value;d=c.getAppFunctions(e,d.options[d.selectedIndex].value,"default"==f?"":f);f=b.querySelector(".deluge-rf-functions");var k=b.querySelector(".deluge-rf-no-functions");f&&f.remove();
k&&k.remove();b.appendChild(d);c.bindReferFieldsEvents();c.disableLoading()};this.toggle=function(){var b=a.delugeArea.querySelector(".deluge-rf-body");if(b)b.style.display="block"==b.style.display?"none":"block";else if(c.checkForMeta()){if(c.constructElements(),f&&DelugeLoading.hide($(a.delugeArea)),referFieldsDiv=a.delugeArea.querySelector(".deluge-rf-body"))referFieldsDiv.style.display="block",$(referFieldsDiv).find(".deluge-scroll").zcScrollPane()}else k.push(setTimeout(function(){c.toggle()},
200)),!f&&DelugeLoading.show($(a.delugeArea)),f=!0;c.callback&&c.callback()};this.changeAppDropdown=function(){var b=a.delugeArea.querySelector(".deluge-rf-body");if(null!=b){var d=Object.keys(e.appCache.apps),f=e.getDelugeAppLinkName(),k=b.querySelector("select[name\x3ddeluge-rf-application]");b=b.querySelector("select[name\x3ddeluge-rf-func-application]");k=c.optionsForSelectTag(c.deleteOptions(k),d);b=c.optionsForSelectTag(c.deleteOptions(b),d);f&&(k.value=f,b.value=f)}};this.getAppName=function(a){for(var b=
0;b<a.length;b++)if(null!=e.appCache.apps[a[b]].forms)return a[b];return null};this.getFormName=function(a,b){a=e.appCache.apps[a];if(c.formName&&arrayContains(b,c.formName)&&a.forms[c.formName].fields)return c.formName;for(var d=0;d<b.length;d++)if(null!=a.forms[b[d]].fields)return b[d];return null};this.checkForMeta=function(){return 0<Object.keys(e.appCache).length?!0:!1};this.clearTimeOutArr=function(){for(var a=0;a<k.length;a++)clearTimeout(k[a])};this.bindReferFieldsEvents=function(){var b=
a.delugeArea.querySelector(".deluge-rf-body"),d;$(b).find(".fieldName[marquee\x3d'true']").mouseover(function(){var a=this;d=setTimeout(function(){$(a).width($(a).width());$(a).find(".field-name-sub").css({position:"absolute",width:"auto"});var b=$(a).find(".field-name-sub").width();$(a).parent().addClass("rf-field-marquee");b=parseInt($(a).width()-b);$(a).find(".field-name-sub").css({left:b})},500)}).mouseout(function(){clearTimeout(d);var a=this;setTimeout(function(){$(a).css({width:"auto"});$(a).find(".field-name-sub").css({position:"relative",
width:"100%"});$(a).parent().removeClass("rf-field-marquee")},400);$(this).find(".field-name-sub").css({left:0})});c.copyToClipboardBind();c.bindSelectElements();c.insertToEditorBind();c.delugeScrollReinit()};this.bindCloseEvent=function(){var b=a.delugeArea.querySelector(".deluge-actions-menu[type\x3dreferfields]"),c=a.delugeArea.querySelector(".deluge-rf-body a.close");DelugeUtil.attachEvent(c,"click",function(){$(b).trigger("click")})};this.bindSelectElements=function(){var b=a.delugeArea.querySelector(".deluge-rf-body");
$(b).find("select").zcDropDown();var d=$("select[name\x3d'deluge-rf-application']").data("zcdd");d&&d.change(function(){c.appChange(d.getValue())});var e=$("select[name\x3d'deluge-rf-func-application']").data("zcdd");e&&e.change(function(){c.appChangeInFunc(e.getValue())});var f=$("select[name\x3d'RFForms']").data("zcdd");f&&f.change(function(){c.formChange(f.getValue())});var k=$("select[name\x3d'RFNameSpace']").data("zcdd");k&&k.change(function(){c.namespaceChange(k.getValue())})};this.switchAppAndFunc=
function(){var b=a.delugeArea.querySelector(".deluge-rf-app-contents"),d=a.delugeArea.querySelector(".deluge-rf-func-contents");this.classList.contains("deluge-rf-function-header")?(b.style.display="none",d.style.display="block",a.delugeArea.querySelector(".deluge-rf-app-header").setAttribute("class","deluge-rf-app-header"),a.delugeArea.querySelector(".deluge-rf-function-header").setAttribute("class","deluge-rf-function-header underlined"),c.appName=d.querySelector("select[name\x3d'deluge-rf-func-application']").value):
(d.style.display="none",b.style.display="block",a.delugeArea.querySelector(".deluge-rf-function-header").setAttribute("class","deluge-rf-function-header"),a.delugeArea.querySelector(".deluge-rf-app-header").setAttribute("class","deluge-rf-app-header underlined"),c.appName=b.querySelector("select[name\x3d'deluge-rf-application']").value);c.delugeScrollReinit()};var r,A,p;this.copyToClipboardBind=function(){void 0!==r&&(r.destroy(),A.destroy(),p.destroy());r=new Clipboard(".deluge-refer-fields-content .fieldElem .rf-copy-btn",
{text:function(a){return a.previousSibling.innerText}});A=new Clipboard(".deluge-refer-fields-content .subform-elem .rf-copy-btn",{text:function(a){a=a.previousSibling;return a.parentNode.parentNode.getAttribute("subform")+"."+a.innerText}});p=new Clipboard(".deluge-refer-fields-content .funcElem .rf-copy-btn",{text:function(a){return c.getFuncCopyContent(e,a.previousSibling.innerText)}});r.on("success",function(){c.copyAlert()});A.on("success",function(){c.copyAlert()});p.on("success",function(){c.copyAlert()})};
this.insertToEditorBind=function(){var a=document.querySelectorAll(".rf-function-funcName,.fieldName,.subform-field-name");DelugeUtil.attachEventForAll(a,"click",c.insertFieldsToEditor)};this.insertFieldsToEditor=function(){var b=a.editor;var d="rf-function-funcName"==this.className?c.getFuncCopyContent(e,this.innerText):"subform-field-name"==this.className?this.parentNode.parentNode.getAttribute("subform")+"."+this.innerText:this.innerText;null!=d&&""!=d&&(DelugeEditorUtil.insertCode(b,d),a.focusEditor())};
this.delugeScrollReinit=function(){var b=$(a.delugeArea).find(".deluge-rf-body .deluge-scroll").data("zcsp");b&&b.reinit()};this.ajaxReqRecord=function(a,b){var c=Math.floor(Date.now()/1E3);d[b][a]={requestTime:c}};this.checkTimeInterval=function(a){return Math.floor(Date.now()/1E3)>=a+30};this.init()};
DelugeReferFields.prototype.getForms=function(a,b,c){var d=Object.keys(a.appCache.apps[b].forms),e=DelugeUtil.getDivElement("");d=this.createSelectTag("RFForms",d,this.formChange);if(null==c)return null;var f=DelugeUtil.getDivElement("","form-select"),k=DelugeUtil.getDivElement("Form","deluge-rf-header-bold"),r=DelugeUtil.getDivElement("","RFForm");d.value=c;a=this.getFields(a,b,c);r.appendChild(d);f.appendChild(k);f.appendChild(r);e.appendChild(f);e.appendChild(a);return e};
DelugeReferFields.prototype.getFields=function(a,b,c){var d=["AUDIO","VIDEO","SECTION"],e=a.getGroupedFormFieldsWholeApp(b,c),f=DelugeUtil.getDivElement("","deluge-rf-fields"),k=DelugeUtil.getDivElement("","deluge-rf-field-list"),r=DelugeUtil.getDivElement("\x3cspan class\x3d'deluge-rf-header-bold'\x3eFields\x3c/span\x3e","RFSubHeader");f.appendChild(r);if(e)for(r=0;r<e.length;r++){var A=e[r].linkName;if(!arrayContains(d,A)){var p=e[r],l=this.dataTypeChange(p.type);k.appendChild(this.createFieldElem(A,
l));p.isSubform&&(p=p.refFormLinkName,p=p.startsWith("ZC_SUBFORM")?this.getInlineSubformFields(a,b,c,A):this.getSubformFields(a,b,p))&&(p.setAttribute("subform",A),k.appendChild(p))}}f.appendChild(k);return f};
DelugeReferFields.prototype.getSubformFields=function(a,b,c){var d=this,e=["AUDIO","VIDEO","SECTION"],f=a.appCache.apps[b].forms[c].fields;if(!f)return a.fetchFormAndItsSubformFields(b,c,function(){d.fieldMetaChange()}),null;a=Object.keys(f);b=DelugeUtil.getDivElement("","subform-field-wrapper");for(c=0;c<a.length;c++){var k=a[c];if(!arrayContains(e,k)){var r=f[k];r.isSystemField||(r=d.dataTypeChange(r.type),b.appendChild(d.createSubformFieldElem(k,r)))}}return b};
DelugeReferFields.prototype.getInlineSubformFields=function(a,b,c,d){var e=["AUDIO","VIDEO","SECTION"];a=a.appCache.apps[b].forms[c].fields[d].subformFields;b=Object.keys(a);c=DelugeUtil.getDivElement("","subform-field-wrapper");for(d=0;d<b.length;d++){var f=b[d];if(!arrayContains(e,f)){var k=a[f];k.isSystemField||(k=this.dataTypeChange(k.type),c.appendChild(this.createSubformFieldElem(f,k)))}}return c};
DelugeReferFields.prototype.createFieldElem=function(a,b){var c=DelugeUtil.getDivElement("","fieldElem");b='\x3cdiv class\x3d"fieldName" data-clipboard-text\x3d'+a+'\x3e\x3cspan class\x3d"field-name-sub"\x3e'+a+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"zc-em zc-wb-duplicate rf-copy-btn" title\x3d"Copy to Clipboard" data-title-position\x3d"top"\x3e\x3c/div\x3e\x3cdiv class\x3d"fieldType"\x3e'+ZSEC.Encoder.encodeForHTML(b)+"\x3c/div\x3e";c.innerHTML=b;21<a.length&&(c.querySelector(".fieldName").setAttribute("marquee",
"true"),c.style.overflow="hidden");return c};
DelugeReferFields.prototype.createSubformFieldElem=function(a,b){var c=DelugeUtil.getDivElement("","subform-elem");c.innerHTML='\x3cdiv class\x3d"subform-field-name" data-clipboard-text\x3d'+a+'\x3e\x3cspan class\x3d"field-name-sub"\x3e'+a+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"zc-em zc-wb-duplicate rf-copy-btn" title\x3d"Copy to Clipboard" data-title-position\x3d"top"\x3e\x3c/div\x3e\x3cdiv class\x3d"subform-field-type"\x3e'+b+"\x3c/div\x3e";21<a.length&&(c.querySelector(".subform-field-name").setAttribute("marquee",
"true"),c.style.overflow="hidden");return c};
DelugeReferFields.prototype.getNamespaceDiv=function(a,b){var c=!0;a=a.editor.metadata;var d=a.getUserDefinedFunctionsList(b),e=this.getNamespaces(d);1==d.length&&(c=""==d[0].nameSpace&&0<d[0].functions.length);if(null!=e&&c){this.namespace="";e=this.createSelectTag("RFNameSpace",e,this.namespaceChange);c=DelugeUtil.getDivElement("");d=DelugeUtil.getDivElement("\x3cdiv class\x3d'deluge-rf-header-bold'\x3eNamespace\x3c/div\x3e","namespaceDropDown");var f=DelugeUtil.getDivElement("","rf-namespace");
document.createElement("i").className="zc-common-angle-down zc-em";e.value="default";f.appendChild(e);d.appendChild(f);b=this.getAppFunctions(a,b,"");c.appendChild(d);c.appendChild(b);return c}return null};DelugeReferFields.prototype.getAppFunctions=function(a,b,c){a=this.getFuncsOfNamespace(a,b,c);return(a=this.createFuncElem(a))?a:this.noFuncForNamespaceWarn()};
DelugeReferFields.prototype.createFuncElem=function(a){var b=DelugeUtil.getDivElement("\x3cdiv class\x3d'RFSubHeader'\x3e\x3cspan class\x3d'deluge-rf-header-bold'\x3eFunctions\x3c/span\x3e\x3c/div\x3e","deluge-rf-functions"),c=DelugeUtil.getDivElement("","deluge-rf-function-list");if(!a||a&&0==a.length)return!1;for(var d=0;d<a.length;d++){var e=a[d];if(e.hasOwnProperty("functionName")){var f=DelugeUtil.getDivElement("","funcElem"),k=DelugeUtil.getUserDataType(e.returnType.toLowerCase())||e.returnType.toLowerCase();
e=e.functionName;f.innerHTML='\x3cdiv class\x3d"rf-function-funcName" data-clipboard-text\x3d'+e+'\x3e\x3cspan class\x3d"field-name-sub"\x3e'+e+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"zc-em zc-wb-duplicate rf-copy-btn" title\x3d"Copy to Clipboard" data-title-position\x3d"top"\x3e\x3c/div\x3e\x3cdiv class\x3d"rf-function-returnType"\x3e'+k+"\x3c/div\x3e";21<e.length&&(f.querySelector(".rf-function-funcName").setAttribute("marquee","true"),f.style.overflow="hidden");c.appendChild(f)}}b.appendChild(c);
return b};DelugeReferFields.prototype.getSpecificFuncOfNamespace=function(a,b,c,d){a=this.getFuncsOfNamespace(a,b,c);if(null!=a)for(b=0;b<a.length;b++)if(a[b].functionName==d)return a[b];return null};DelugeReferFields.prototype.getFuncsOfNamespace=function(a,b,c){a=a.appCache.apps[b].functions;for(b=0;b<a.length;b++)if(a[b].nameSpace==c)return a[b].functions;return null};
DelugeReferFields.prototype.getNamespaces=function(a){if(null!=a&&0<a.length){for(var b=[],c=0;c<a.length;c++)b.push(a[c].nameSpace);a=b.indexOf("");~a&&(b[a]="default");return b}return null};DelugeReferFields.prototype.dataTypeChange=function(a){return a.startsWith("ZC_SUBFORM")?"subform":DelugeUtil.getUserDataType(a)||a};DelugeReferFields.prototype.createSelectTag=function(a,b,c){c=document.createElement("select");c.name=a;return c=this.optionsForSelectTag(c,b)};
DelugeReferFields.prototype.optionsForSelectTag=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.innerHTML+="\x3coption value\x3d'"+d+"'\x3e"+d+"\x3c/option\x3e"}return a};DelugeReferFields.prototype.deleteOptions=function(a){var b=a.querySelectorAll("option");for(i=0;i<b.length;i++)a.removeChild(b[i]);return a};DelugeReferFields.prototype.copyAlert=function(){$(".deluge-rf-body-container").showToast(this.LABELS.COPIED)};
DelugeReferFields.prototype.getFuncCopyContent=function(a,b){var c="",d=a.getDelugeAppLinkName();c+=this.appName==d?"thisapp.":this.appName+".";c+=""==this.namespace?b:this.namespace+"."+b;a=this.getSpecificFuncOfNamespace(a,this.appName,this.namespace,b);return c+=null!=a?a.definition:""};DelugeReferFields.prototype.noFormWarn=function(){return DelugeUtil.getDivElement(this.MESSAGES.NO_FORM_WARNING,"deluge-rf-no-form")};
DelugeReferFields.prototype.noFuncWarn=function(){return DelugeUtil.getDivElement(this.MESSAGES.NO_FUNCTION_WARNING,"deluge-rf-no-functions")};DelugeReferFields.prototype.noFuncForNamespaceWarn=function(){return DelugeUtil.getDivElement(this.MESSAGES.NO_DEFAULT_FUNCTION_WARNING,"deluge-rf-no-functions")};DelugeReferFields.isVisible=function(a){return(a=a.querySelector(".deluge-rf-body"))&&"block"==a.style.display||null};var DELUGE_ACTION_MAP={onload:"ON_LOAD",onvalidate:"ON_VALIDATE",onsuccess:"ON_SUCCESS",onupdate:"ON_UPDATE",onuserinput:"ON_USER_INPUT",ondeleteonvalidate:"ON_DELETE_ON_VALIDATE",onaddrow:"ON_ADD_ROW",ondeleterow:"ON_DELETE_ROW",functions:"FUNCTION",html:"HTML",schedule:"SCHEDULE"},DelugeEventVsAction=function(a,b){switch(b){case "3":if(a==DELUGE_ACTION_MAP.onvalidate)return DELUGE_ACTION_MAP.ondeleteonvalidate}return a},DelugeAjaxUtil={requestStack:{},sendRequest:function(a,b,c,d,e){var f=this,
k=f.getLockKey(c);f.checkForLockKey(k)&&$.ajax({url:a,type:b,data:c,dataType:"json"}).done(function(a){f.invokeCallbacks(k,a,c)});f.pushToRequestStack(k,d,e)},invokeCallbacks:function(a,b,c){var d=this.requestStack[a];if(d&&0<d.length){for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];f[0].call(f[1],b,c)}delete this.requestStack[a]}},pushToRequestStack:function(a,b,c){var d=this.requestStack;d.hasOwnProperty(a)?d[a].push([b,c]):d[a]=[[b,c]]},checkForLockKey:function(a){return this.requestStack.hasOwnProperty(a)?
!1:!0},getLockKey:function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b+="_"+a[c]);0<b.length&&(b=b.substring(1));return b}};
DelugeEditorWrapper.prototype.tasksRestrictions=Object.freeze({ON_LOAD:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],ON_VALIDATE:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},
{groupName:"Client functions"},{groupName:"Debug",elements:["try catch","break","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:["info","return","cancel delete","success message","share | unshare"]}],ON_SUCCESS:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Client functions"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},
{groupName:"Miscellaneous",elements:["info","return","cancel submit","cancel delete","share | unshare"]}],ON_UPDATE:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Client functions"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],ON_DELETE_ON_VALIDATE:[{groupName:"Data Within Zoho"},
{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Client functions"},{groupName:"Debug",elements:["try catch","break","inline alert","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:["info","return","cancel submit","success message","share | unshare"]}],ON_USER_INPUT:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},
{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],ON_ADD_ROW:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],
ON_DELETE_ROW:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Debug",elements:"return;try catch;break;inline alert;alert;continue".split(";")},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],BUTTON_EVENT_ONCLICK:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Debug",elements:["try catch",
"break","inline alert","alert","continue"]},{groupName:"Client functions",elements:"hide | show;enable | disable;select | deselect;add | append item;selectAll | deselectAll;clear items".split(";")},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Miscellaneous",elements:"info;return;cancel submit;cancel delete;success message;share | unshare".split(";")}],FUNCTION:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Client functions"},{groupName:"HTML Tasks"},
{groupName:"Embed"},{groupName:"Debug",elements:["try catch","break","inline alert","alert","continue"]},{groupName:"Miscellaneous",elements:["info","cancel submit","cancel delete","success message","share | unshare"]}],HTML:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications"},{groupName:"Client functions"},{groupName:"Debug",elements:"info;try catch;break;inline alert;alert;continue".split(";")},{groupName:"Data access",elements:["add record","update records","delete records"]},
{groupName:"Miscellaneous",elements:"return;send mail;share | unshare;cancel submit;cancel delete;success message".split(";")}],SCHEDULE:[{groupName:"Data Within Zoho"},{groupName:"Integrations"},{groupName:"Notifications",elements:["push notification","send sms","post to chat"]},{groupName:"Debug"},{groupName:"HTML Tasks"},{groupName:"Embed"},{groupName:"Client functions"},{groupName:"Miscellaneous",elements:"send mail;return;cancel submit;cancel delete;success message;share | unshare".split(";")}]});
DelugeEditorWrapper.prototype.getRestrictedEntries=function(a,b){a=DelugeEventVsAction(a,b);return this.tasksRestrictions[a]};
DelugeBuiltInFunction.loadBuiltInFunctions=function(a){var b=variable.scopeName;DelugeBuiltInFunction.json&&0!=DelugeBuiltInFunction.json.length||DelugeAjaxUtil.sendRequest("/appbuilder/"+b+"/getBuiltInFunctions","GET",null,function(b){DelugeBuiltInFunction.json=b;b=DelugeBuiltInFunction.getFunctionsByAppliedTypes(["NVIEW"]);for(var c in b){var e=b[c];e&&(e.definition=e.definition.replace("BIGINT","field"),e.tooltipDefinition=e.tooltipDefinition.replace("BIGINT","field"));e.functionName=e.functionName.toLowerCase()}DelugeBuiltInFunction.add("SUBFORM",
[{functionName:"insert",args:[{dataType:"OBJECT",mandatory:!0,name:"collection"}],showDefinition:!1,definition:"(\x3cexpression\x3e)"},{functionName:"clear",definition:"()",showDefinition:!1}]);a&&a()},this)};DelugeEditorWrapper.prototype.loadAppMetaInfo=function(a,b){this.editor.metadata.loadAppMetaInfo.apply(this.editor.metadata,arguments)};
DelugeMeta.prototype.getMetaDetails=function(){return{scopeName:this.scopeName||variable.scopeName,appLinkName:this.getDelugeAppLinkName()||variable.appLinkName.toLowerCase(),formLinkName:this.getDelugeFormLinkName()}};
DelugeMeta.prototype.loadAppMetaInfo=function(a,b){function c(c,e){var f=e.appLinkName.replace(/-/g,"_");d.appCache.hasOwnProperty("apps")?d.appCache.apps.hasOwnProperty(f)&&(d.appCache.apps[f]=c.apps[f]):d.appCache=c;d.loadWholeAppMetaInfo(e.appLinkName,a,b);d.loadUserDefinedFunctions(f,"",a);d.loadConnections(f)}var d=this,e=d.appCache,f=d.getMetaDetails();a=a||f.scopeName;if(!e.hasOwnProperty("apps")&&(e=f.appLinkName,f=f.formLinkName,e&&a)){e=e.replace(/_/g,"-");var k={query:"currentapp",appLinkName:e};
k.formLinkName=f;DelugeAjaxUtil.sendRequest("/appbuilder/"+a+"/"+e+"/workflow/getMetaInfo","GET",k,c,d)}};DelugeEditorWrapper.prototype.loadWholeAppMetaInfo=function(a,b,c){this.editor.metadata.loadWholeAppMetaInfo.apply(this.editor.metadata,arguments)};
DelugeMeta.prototype.loadWholeAppMetaInfo=function(a,b,c){var d=this;b="/appbuilder/"+GlobalUrls.getAppUrlFragment(variable.appLinkName)+"/workflow/getMetaInfo";DelugeAjaxUtil.sendRequest(b,"GET",{query:"apps",appLinkName:a},function(b){var e=d.appCache;if(e&&e.apps&&b&&b.apps){b=b.apps;delete b[a.replace(/-/g,"_")];for(var k in b)b.hasOwnProperty(k)&&(e.apps[k]=b[k]);d.appCache=e;c&&c.call()}},d)};
DelugeEditorWrapper.prototype.loadConnections=function(a,b){this.editor.metadata.loadConnections.apply(this.editor.metadata,arguments)};DelugeMeta.prototype.loadConnections=function(a,b){var c=this,d="/appbuilder/"+GlobalUrls.getAppUrlFragment(variable.appLinkName)+"/workflow/getMetaInfo";a={query:"connections",appLinkName:a.replace(/_/g,"-")};DelugeAjaxUtil.sendRequest(d,"GET",a,function(a){c.appCache&&a&&a.connections&&(c.appCache.connections=a.connections,b&&b.call())},c)};
DelugeEditorWrapper.prototype.loadUserDefinedFunctions=function(a,b,c,d){this.editor.metadata.loadUserDefinedFunctions.apply(this.editor.metadata,arguments)};
DelugeMeta.prototype.loadUserDefinedFunctions=function(a,b,c,d){function e(c,e){a=a.replace(/-/g,"_");var k=f.appCache;k.apps||(k.apps={});k.apps.hasOwnProperty(a)||(k.apps[a]={});e=k.apps[a].functions;if(""===b)k.apps[a].functions=c.functions;else if(e){for(var m=0,p=e.length;m<p;m++)if(e[m].nameSpace===b&&!e[m].hasOwnProperty("functions")){e[m].functions=[];for(var r in c.functions)k=c.functions[r],e[m].functions.push(k)}f.appCache.apps[a].functions=e}else{k.apps[a].functions=[];r=k.apps[a].functions;
k=[];""==b&&(k=c.functions);for(m in k)r.push(k[m]);f.appCache.apps[a].functions=r}d&&d.call()}var f=this,k=f.appCache,r=f.getMetaDetails();c=c||r.scopeName;a=a||r.appLinkName;r=a.replace(/_/g,"-");c="/appbuilder/"+c+"/"+r+"/workflow/getMetaInfo";r={query:"functions",appLinkName:r,nameSpace:b};(k&&k.apps&&k.apps.hasOwnProperty(a)||!k||!k.apps)&&DelugeAjaxUtil.sendRequest(c,"GET",r,e,f)};DelugeEditorWrapper.prototype.fetchFormFields=function(a,b){this.editor.metadata.apply(this.editor.metadata,arguments)};
DelugeMeta.prototype.fetchFormFields=function(a,b){function c(c,e){e=c.fields;c=c.subform;k=k.replace(/-/g,"_");d.appCache.hasOwnProperty("apps")||(d.appCache.apps={},d.appCache.apps[k]={forms:{}},d.appCache.apps[k].forms[a]={});d.appCache.apps[k].forms||(d.appCache.apps[k].forms={},d.appCache.apps[k].forms[a]={});d.appCache.apps[k].forms[a].fields=e;if(null!=c||""!=c)for(var f in c)c.hasOwnProperty(f)&&(d.appCache.apps[k].forms[f]=c[f]);b&&b.call()}var d=this,e=this.getMetaDetails(),f=e.scopeName,
k=e.appLinkName;e=k&&k.replace(/_/g,"-");k&&a&&(d&&d.hasForm(k,a)||!d.appCache.hasOwnProperty("apps"))&&DelugeAjaxUtil.sendRequest("/appbuilder/"+f+"/"+e+"/workflow/getMetaInfo","GET",{query:"formfields",appLinkName:e,formLinkName:a},c,this)};
DelugeMeta.prototype.fetchFormAndItsSubformFields=function(a,b,c){var d=this,e=d.getMetaDetails().scopeName;DelugeAjaxUtil.sendRequest("/appbuilder/"+e+"/"+a+"/workflow/getMetaInfo","GET",{query:"forms",appLinkName:a,formLinkName:b},function(b,e){a=a.replace(/-/g,"_");for(var f in b)b.hasOwnProperty(f)&&b[f].hasOwnProperty("fields")&&(d.appCache.apps[a].forms[f]=b[f]);c&&c.call()},d)};
DelugeMeta.prototype.loadSpecificAppMetaInfo=function(a,b,c){var d=this;DelugeAjaxUtil.sendRequest("/appbuilder/"+b+"/"+a+"/workflow/getMetaInfo","GET",{query:"app",appLinkName:a},function(b,f){a=a.replace(/-/g,"_");d.appCache.apps[a].forms=b;c&&c.call()},d)};